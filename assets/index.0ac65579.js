var un=Object.defineProperty,fn=Object.defineProperties;var pn=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var hn=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable;var we=(e,t,n)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))hn.call(t,n)&&we(e,n,t[n]);if(tt)for(var n of tt(t))gn.call(t,n)&&we(e,n,t[n]);return e},N=(e,t)=>fn(e,pn(t));var D=(e,t,n)=>(we(e,typeof t!="symbol"?t+"":t,n),n);import{j as o,a as v,F as I,r as L,M as yn,m as nt,R as bn,b as Se,u as xn,c as vn,l as at,d as wn,e as te,f as $,g as ot,h as st,i as lt,p as Sn,k as Nn,n as kn,o as Cn,q as _n,s as Ln,v as $n,Q as jn,t as Dn,w as Fn,P as Mn}from"./vendor.e4100676.js";const Vn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}};Vn();const Ne=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],it={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function In(e){return e?h(h({},it),e):h({},it)}function Pn({value:e,fieldDefinition:t,setField:n}){const[a,s]=L.exports.useState(-1),[r,d]=L.exports.useState(e);L.exports.useEffect(()=>{d(e)},[e]);let l=o("input",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",type:typeof e=="number"?"number":"text",value:r,onChange:c=>{const u=typeof e=="number"?Number.parseFloat(c.target.value):c.target.value;d(u),a>-1&&clearTimeout(a),s(setTimeout(()=>n(u),1e3))}});return t.type==="select"&&(l=v("select",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",value:r,onChange:c=>{n(c.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${t.name}-empty`,children:"\xA0"}),t.items.map(c=>o("option",{value:c.name,"data-testid":`input-editor-${t.name}-${c.name}`,children:c.name},c.name))]})),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${t.name}`,className:"text-l font-bold",children:t.name}),t.description?o("span",{className:"text-sm",children:t.description}):o(I,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function ne({title:e,items:t,setItems:n,fieldDefinitions:a,ignoreFields:s,deletable:r,controls:d}){const l=t[0],c=Object.keys(l).map((u,b)=>{if(s==null?void 0:s.includes(u))return{element:o("span",{style:{display:"hidden"}},u),order:b+1e4};let f=l[u];for(const x of t)if(x[u]!==f){f="-";break}const m=u in a&&a[u];return m?{element:o(Pn,{value:f,fieldDefinition:m,setField:x=>n({[u]:x})},u),order:m.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${u}`,className:"text-l font-bold",children:u}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${u}`,className:"bg-gray-800 w-full",type:typeof f=="number"?"number":"text",value:f,onChange:x=>{n({[u]:typeof f=="number"?Number.parseFloat(x.target.value):x.target.value})}})})]},u),order:b+1e3}}).sort((u,b)=>u.order-b.order).map(u=>u.element);return v("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:e}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[d,r?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):o(I,{})]})]}),c]})}ne.defaultProps={ignoreFields:[],controls:o(I,{})};const On={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},Rn=["",...Ne];var At;const Bn=JSON.parse((At=window.localStorage.getItem("blockDisplaySettings"))!=null?At:"false")||On;function En({settings:e,setSettings:t,selected:n,blocks:a,setBlockData:s,addNewBlock:r,save:d,open:l}){const c=f=>{t(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},u=n.map(f=>a[f]).filter(f=>f),b=u.length>0?o(ne,{title:u.length===1?u[0].name:"Edit Selected Blocks",items:u,deletable:!0,setItems:f=>s(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(I,{});return v(I,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{c(N(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:f=>{c(N(h({},e),{color:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:f=>{c(N(h({},e),{selectedColor:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:e.radius,onChange:f=>{c(N(h({},e),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:f=>{c(N(h({},e),{plottableKey:f.currentTarget.value}))},children:Rn.map(f=>o("option",{value:f,children:f},f))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),b]})}function An({command:e,save:t,open:n,setCommandData:a}){return v(I,{children:[o("div",{className:"flex flex-col gap-2",children:v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Command File"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>t(),children:"Save Command File"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{t(!0)},children:"Save As"})]})}),o(ne,{title:e.file_name,items:[e],deletable:!1,setItems:s=>s&&a(s),fieldDefinitions:{},ignoreFields:["segment_file_name","station_file_name","block_file_name","mesh_parameters_file_name","file_name"]})]})}function Tn(e){let t="..";for(let n=2;n<e;n+=1)t=`${t}/..`;return t}function Wn({root:e,chooseFile:t,close:n,extension:a,isSaveDialog:s}){var g,S;const[r,d]=L.exports.useState(""),[l,c]=L.exports.useState(),[u,b]=L.exports.useState(""),[f,m]=L.exports.useState([e]),x=(g=f.at(-1))!=null?g:e,w=[...f.filter(k=>k!==e).map((k,_)=>o("button",{type:"button","data-testid":`back-${_}`,onClick:async()=>{m(f.slice(0,_+1))},children:Tn(f.length-_)},_)),...x.folderList.map(k=>o("button",{type:"button","data-testid":`folder-${k}`,onClick:async()=>{m([...f,await x.getDirectory(k)])},children:k},k))],y=x.fileList.filter(k=>k.endsWith(a)).map(k=>o("button",{type:"button","data-testid":`file-${k}`,className:(l==null?void 0:l.name)===k?"font-bold":"",onClick:async()=>{const _=await x.getFile(k);c(_),d(_.name),b(await _.getContents())},children:k},k));return o("div",{role:"none","data-testid":"explorer-backdrop",className:"fixed w-full h-full flex flex-col justify-center items-center z-50 bg-black/50",onClick:()=>n(),children:v("div",{role:"none",className:"bg-black p-5 flex flex-col gap-2",onClick:k=>k.stopPropagation(),children:[o("span",{children:"Open File"}),v("div",{className:"flex flex-row gap-2 pointer-events-auto",children:[v("div",{className:"border-gray-800 border p-2 flex flex-col gap-1 min-w-[20rem] max-w-[30rem] max-h-40 overflow-auto items-start",children:[w,y]}),l?v("div",{className:"border-gray-800 border p-2 max-w-[30rem] max-h-40 overflow-auto whitespace-pre",children:[o("span",{"data-testid":"selected-file-name",className:"text-xl font-bold",children:l.name}),o("p",{"data-testid":"selected-file-content",children:u})]}):o(I,{})]}),v("div",{className:"flex flex-row",children:[o("div",{"data-testid":"file-path",className:"flex-grow p-1",children:s?x.path.join("/"):(S=l==null?void 0:l.path.join("/"))!=null?S:""}),s?o("input",{"data-testid":"file-path-input",className:"flex-grow p-1 bg-gray-800",value:r,onChange:k=>d(k.target.value)}):o(I,{})]}),v("div",{className:"flex flex-row-reverse gap-2 pointer-events-auto",children:[o("button",{"data-testid":"select-button",type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2 disabled:bg-gray-900",disabled:!l&&!r,onClick:async()=>{let k=l;if(s&&(k=await x.getFile(r.endsWith(a)?r:`${r}${a}`)),k){const _=f.filter(H=>H!==e).map(H=>H.name);_.push(k.name),t(k,_)}},children:s?"Save":"Select"}),o("button",{"data-testid":"close-button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",type:"button",onClick:()=>n(),children:"Close"})]})]})})}const Gn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Tt;const Kn=h(h({},Gn),JSON.parse((Tt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Tt:"{}"));function zn({settings:e,setSettings:t,collections:n,setCollectionVertexKeys:a,open:s}){const r=l=>{t(l),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(l))},d=Object.keys(n).map(l=>{const{startLat:c,startLon:u,endLat:b,endLon:f,segments:m,plot:x}=n[l],w=Object.keys(m[0]).map((y,g)=>({name:y,value:g}));return o(ne,{title:l,items:[{startLat:c,startLon:u,endLat:b,endLon:f,plot:x}],deletable:!1,setItems:y=>{a(h({collection:l,startLat:c,startLon:u,endLat:b,endLon:f,plot:x},y))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:w},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:w},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:w},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:w},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:w}}},l)});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{r(N(h({},e),{hide:!e.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>s(),children:"Open Segments"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:l=>{r(N(h({},e),{color:l.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:l=>{r(N(h({},e),{width:Number.parseFloat(l.target.value)}))}})})]}),d]})}function Hn({view:e,buttons:t,active:n,setActive:a}){if(!t)return o("span",{});const s=[];for(const r of Object.keys(t)){const d=t[r],l=r===n;s.push(o("button",{type:"button","data-testid":`tab-${r}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(l?"":r),children:d},r))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:e}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:s})]})}const rt={lon:0,lat:0},Jn=180,oe=360;function ct(e){let{lon:t,lat:n}=e;for(;t<0;)t+=oe;for(;t>oe;)t-=oe;return[t,n]}function ke([e,t]){return{lon:e<0?e+oe:e,lat:t}}function Ce(e,t){const n=ct(e),a=ct(t),s=[a[0],a[1]];return a[0]-n[0]>=Jn?s[0]-=oe:s[0]+=oe,Math.abs(n[0]-a[0])>Math.abs(n[0]-s[0])?[n,s]:[n,a]}const q=1e6;function se(e,t,n,a){const s=`${Math.floor(e.lon*q)},${Math.floor(e.lat*q)}`;if(s in t)return[t[s],a];const r=a;return n[r]=e,t[s]=r,[r,a+1]}function dt(e,t){let n=!1;for(const a of e.segments)if(a.start===t||a.end===t){n=!0;break}if(!n&&e.vertecies[t]){const a=e.vertecies[t],s=`${Math.floor(a.lon*q)},${Math.floor(a.lat*q)}`,r=h({},e.vertecies);delete r[t];const d=h({},e.vertexDictionary);return delete d[s],N(h({},e),{vertecies:r,vertexDictionary:d})}return e}const X=Math.PI/6,Y=2*Math.PI-X;function Un(e,t,{map:n,popup:a,internalArrowSources:s,mapLoaded:r,internalSelections:d},{arrowSources:l,selections:c}){var f;if(n&&r&&s!==l)if(console.log("Setting arrows in map!"),s){for(const m of s){const x=n.getSource(`arrow:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${m.name}`),n.removeLayer(`layer:arrow:${m.name}:click`);try{n.getLayer(`layer:arrow:${m.name}:labels`)&&n.removeLayer(`layer:arrow:${m.name}:labels`)}catch{console.log("no label layer")}}t({internalArrowSources:void 0})}else{for(const m of l){let x=n.getSource(`arrow:${m.name}`);const w=x===void 0;if(w&&(n.addSource(`arrow:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${m.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`arrow:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.arrows.map(y=>{var F;const g=y.scale*m.scale,S=m.scale*m.arrowHeadScale,k=[y.longitude+y.direction[0]*g,y.latitude+y.direction[1]*g],_=[k[0]+(Math.cos(X)*-y.direction[0]-Math.sin(X)*-y.direction[1])*S,k[1]+(Math.sin(X)*-y.direction[0]+Math.cos(X)*-y.direction[1])*S],H=[k[0]+(Math.cos(Y)*-y.direction[0]-Math.sin(Y)*-y.direction[1])*S,k[1]+(Math.sin(Y)*-y.direction[0]+Math.cos(Y)*-y.direction[1])*S];return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:(F=c[m.name])==null?void 0:F.includes(y.index)},geometry:{type:"LineString",coordinates:[[y.longitude,y.latitude],k,_,k,H]}}})}),n.addLayer({id:`layer:arrow:${m.name}`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],m.selectedColor,m.color],"line-width":m.width}}),n.addLayer({id:`layer:arrow:${m.name}:click`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(f=m.arrows[0])==null?void 0:f.label){const y=n.getSource(`arrow:${m.name}:points`);y&&(y.setData({type:"FeatureCollection",features:m.arrows.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),n.addLayer({id:`layer:arrow:${m.name}:labels`,type:"symbol",source:`arrow:${m.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}w&&(n.on("mouseenter",`layer:arrow:${m.name}:click`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[...g.geometry.coordinates],{description:k}=g.properties;for(;Math.abs(y.lngLat.lng-S[0])>180;)S[0]+=y.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(k).addTo(n)}}),n.on("mouseleave",`layer:arrow:${m.name}:click`,()=>{a.remove()}),n.on("click",`layer:arrow:${m.name}:click`,y=>{let g;if(e.state.internalArrowSources)for(const k of e.state.internalArrowSources)g=k.click;if(!y.features||!g)return;const S=y.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:k}=S.properties;g(k)}}))}t({internalArrowSources:l})}const u=h({},d);let b=!1;for(const m of Object.keys(c))if(c[m]!==d[m]){for(const x of l)if(x.name===m){b=!0,u[m]=c[m];const w=n==null?void 0:n.getSource(`arrow:${x.name}`);if(w){const y=c[m];w.setData({type:"FeatureCollection",features:x.arrows.map(g=>{const S=g.scale*x.scale,k=x.scale*x.arrowHeadScale,_=[g.longitude+g.direction[0]*S,g.latitude+g.direction[1]*S],H=[_[0]+(Math.cos(X)*-g.direction[0]-Math.sin(X)*-g.direction[1])*k,_[1]+(Math.sin(X)*-g.direction[0]+Math.cos(X)*-g.direction[1])*k],F=[_[0]+(Math.cos(Y)*-g.direction[0]-Math.sin(Y)*-g.direction[1])*k,_[1]+(Math.sin(Y)*-g.direction[0]+Math.cos(Y)*-g.direction[1])*k];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:y==null?void 0:y.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],_,H,_,F]}}})})}}}b&&t({internalSelections:u})}function qn(e,{map:t,draw:n,drawnPointSettings:a,mapLoaded:s,internalDrawnPointSource:r,internalSelections:d},{drawnPointSource:l,selections:c}){var u;if(t&&s&&r!==l){console.log("Drawning Points"),e({internalDrawnPointSource:l});let b=n;if((l.selectedColor!==a.selectedColor||l.selectedRadius!==a.selectedRadius||l.color!==a.color||l.radius!==a.radius)&&(e({drawnPointSettings:{color:l.color,radius:l.radius,selectedRadius:l.selectedRadius,selectedColor:l.selectedColor}}),n&&(t.removeControl(n),b=void 0),l?(b=new yn({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":l.selectedRadius,"circle-color":l.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":l.radius,"circle-color":l.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),t.addControl(b),e({draw:b})):b=void 0),b){const f=b.getAll();let m=l.points.length!==f.features.length?void 0:b.getSelected().features.map(w=>{var y,g;return(g=(y=w.properties)==null?void 0:y.index)!=null?g:-1}).filter(w=>w>-1);const x={type:"FeatureCollection",features:l.points.map(w=>({type:"Feature",id:w.index.toString(),properties:{description:"",index:w.index,name:""},geometry:{type:"Point",coordinates:[w.longitude,w.latitude]}}))};b.set(x),d.draw!==c.draw&&(m=c.draw,e({internalSelections:N(h({},d),{draw:c.draw})})),m&&m.length>0&&b.changeMode("simple_select",{featureIds:m.map(w=>`${w}`)})}}if(n&&d.draw!==c.draw&&!!c.draw){const b=(u=c.draw)!=null?u:[];e({internalSelections:N(h({},d),{draw:c.draw})}),n.changeMode("simple_select",{featureIds:b.map(f=>`${f}`)})}}const z="grid";function Qn(e,t,{map:n,internalGridDisplay:a,popup:s,mapLoaded:r},{displayGrid:d}){if(n&&r&&a!==d){if(console.log("Drawing Grid on map!"),a&&a>0){const l=n.getSource(z);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),n.removeLayer(z),t({internalGridDisplay:void 0})}else if(d&&d>0){let l=n.getSource(z);const c=l===void 0;if(c&&(n.addSource(z,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=n.getSource(z)),l!==void 0){const u=[];for(let b=-170;b<=180;b+=d)u.push({type:"Feature",properties:{label:`Lon: ${b<0?b+360:b}`},geometry:{type:"LineString",coordinates:[[b,-90],[b,90]]}});for(let b=-90;b<=90;b+=d)u.push({type:"Feature",properties:{label:`Lat: ${b}`},geometry:{type:"LineString",coordinates:[[180,b],[-180,b]]}});l.setData({type:"FeatureCollection",features:u})}n.addLayer({id:z,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${z}:click`,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),c&&(n.on("mouseenter",`${z}:click`,u=>{if(!u.features)return;const b=u.features[0];b.geometry.type==="LineString"&&b.properties&&typeof b.properties.label=="string"&&s.setLngLat(u.lngLat).setHTML(`${b.properties.label}`).addTo(n)}),n.on("mouseleave",`${z}:click`,()=>{s.remove()}))}t({internalGridDisplay:d})}}function Xn(e,t,{map:n,popup:a,internalLineSources:s,mapLoaded:r,internalSelections:d},{lineSources:l,selections:c}){var f;if(n&&r&&s!==l)if(console.log("Setting lines in map!"),s){for(const m of s){const x=n.getSource(`line:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${m.name}`);try{n.getLayer(`layer:line:${m.name}:click`)&&n.removeLayer(`layer:line:${m.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${m.name}:labels`)&&n.removeLayer(`layer:line:${m.name}:labels`)}catch{console.log("no label layer")}}t({internalLineSources:void 0})}else{for(const m of l){let x=n.getSource(`line:${m.name}`);const w=x===void 0;if(w&&(n.addSource(`line:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${m.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`line:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.lines.map(y=>{var g,S;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,label:(g=y.label)!=null?g:"",selected:((S=c[m.name])==null?void 0:S.includes(y.index))||!1},geometry:{type:"LineString",coordinates:[[y.startLongitude,y.startLatitude],[y.endLongitude,y.endLatitude]]}}})}),n.addLayer({id:`layer:line:${m.name}`,type:"line",source:`line:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],m.selectedColor,m.color],"line-width":["case",["get","selected"],m.selectedWidth,m.width]}}),(f=m.lines[0])==null?void 0:f.label){const y=n.getSource(`line:${m.name}:points`);y&&(y.setData({type:"FeatureCollection",features:m.lines.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[(g.startLongitude+g.endLongitude)/2,(g.startLatitude+g.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${m.name}:labels`,type:"symbol",source:`line:${m.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}m.click&&(n.addLayer({id:`layer:line:${m.name}:click`,type:"line",source:`line:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":m.width*10}}),w&&(n.on("mouseenter",`layer:line:${m.name}:click`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="LineString"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[(g.geometry.coordinates[0][0]+g.geometry.coordinates[1][0])/2,(g.geometry.coordinates[0][1]+g.geometry.coordinates[1][1])/2],{description:k}=g.properties;for(;Math.abs(y.lngLat.lng-S[0])>180;)S[0]+=y.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(k).addTo(n)}}),n.on("mouseleave",`layer:line:${m.name}:click`,()=>{a.remove()}),n.on("click",`layer:line:${m.name}:click`,y=>{let g;if(e.state.internalLineSources)for(const k of e.state.internalLineSources)k.name===m.name&&(g=k.click);if(!y.features||!g)return;const S=y.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:k}=S.properties;g(k)}})))}t({internalLineSources:l})}const u=h({},d);let b=!1;for(const m of Object.keys(c))if(c[m]!==d[m]){for(const x of l)if(x.name===m){b=!0,u[m]=c[m];const w=n==null?void 0:n.getSource(`line:${x.name}`);if(w){const y=c[m];w.setData({type:"FeatureCollection",features:x.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:y==null?void 0:y.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))})}}}b&&t({internalSelections:u})}function Zn(e,t,{map:n,popup:a,internalPointSources:s,mapLoaded:r,internalSelections:d},{pointSources:l,selections:c}){var f;if(!n||!r)return;if(s!==l)if(console.log("Setting points in map!"),s){for(const m of s){const x=n.getSource(`point:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${m.name}`);try{n.getLayer(`layer:point:${m.name}:labels`)&&n.removeLayer(`layer:point:${m.name}:labels`)}catch{console.log("no label layer")}}t({internalPointSources:void 0})}else{for(const m of l){let x=n.getSource(`point:${m.name}`);const w=x===void 0;w&&(n.addSource(`point:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`point:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.points.map(y=>{var g;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:!((g=c[m.name])==null?void 0:g.includes(y.index)),label:y.label},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}}})}),n.addLayer({id:`layer:point:${m.name}`,type:"circle",source:`point:${m.name}`,paint:{"circle-color":["case",["get","selected"],m.color,m.selectedColor],"circle-radius":m.radius}}),((f=m.points[0])==null?void 0:f.label)&&n.addLayer({id:`layer:point:${m.name}:labels`,type:"symbol",source:`point:${m.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),w&&(n.on("mouseenter",`layer:point:${m.name}`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[...g.geometry.coordinates],{description:k}=g.properties;for(;Math.abs(y.lngLat.lng-S[0])>180;)S[0]+=y.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(k).addTo(n)}}),n.on("mouseleave",`layer:point:${m.name}`,()=>{a.remove()}),n.on("click",`layer:point:${m.name}`,y=>{let g;if(e.state.internalPointSources)for(const k of e.state.internalPointSources)g=k.click;if(!y.features||!g)return;const S=y.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:k}=S.properties;g(k)}}))}t({internalPointSources:l})}const u=h({},d);let b=!1;for(const m of Object.keys(c))if(c[m]!==d[m]){for(const x of l)if(x.name===m){b=!0,u[m]=c[m];const w=n.getSource(`point:${x.name}`);if(w){const y=c[m];w.setData({type:"FeatureCollection",features:x.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:!(y==null?void 0:y.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))})}}}b&&t({internalSelections:u})}function Yn(e,t,{map:n,internalPolygonSources:a,mapLoaded:s},{polygonSources:r,selections:d}){if(n&&s&&a!==r)if(a){for(const l of a){const c=n.getSource(`poly:${l.name}`);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${l.name}`),n.removeLayer(`layer:poly:${l.name}:fill`)}t({internalPolygonSources:void 0})}else{for(const l of r){let c=n.getSource(`poly:${l.name}`);c===void 0&&(n.addSource(`poly:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=n.getSource(`poly:${l.name}`)),c!==void 0&&c.setData({type:"FeatureCollection",features:l.polygons.map(b=>{var f;return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:((f=d[l.name])==null?void 0:f.includes(b.index))||!1},geometry:{type:"Polygon",coordinates:[b.polygon.map(m=>[m.lon,m.lat])]}}})}),n.addLayer({id:`layer:poly:${l.name}:fill`,type:"fill",source:`poly:${l.name}`,layout:{},paint:{"fill-color":l.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${l.name}`,type:"line",source:`poly:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.borderColor,"line-width":l.borderRadius}})}t({internalPolygonSources:r})}}nt.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class ea extends bn.Component{constructor(t){super(t);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:L.exports.createRef(),popup:new Se.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=t.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:t,style:n}=this.state,{initialPosition:a}=this.props,s=typeof t=="object"?t==null?void 0:t.current:void 0;if(nt.accessToken&&s){const r=new Se.exports.Map({container:s,style:n,center:a?a.center:[0,0],zoom:a?a.zoom:2});r.addControl(new Se.exports.NavigationControl),this.setState({map:r}),r.on("load",()=>{this.setState({mapLoaded:!0})}),r.on("click",({lngLat:d})=>{const{click:l}=this.props;l(ke([d.lng,d.lat]))}),r.on("mousemove",({lngLat:d})=>{const{mouseMove:l}=this.props;l&&l(ke([d.lng,d.lat]))}),r.on("moveend",()=>{const d=r.getZoom(),l=r.getCenter(),{mapMoved:c}=this.props;c&&c(d,l)}),r.on("draw.selectionchange",({features:d})=>{const{internalDrawnPointSource:l}=this.state;if(!l||!(l==null?void 0:l.select))return;const c=d.map(u=>u&&u.type==="Feature"&&u.geometry.type==="Point"&&u.properties&&"index"in u.properties&&typeof u.properties.index=="number"?u.properties.index:-1).filter(u=>u>-1);l.select(c)}),r.on("draw.update",({features:d,action:l})=>{const{internalDrawnPointSource:c}=this.state;if(!!(c==null?void 0:c.update)&&l==="move"&&d.length>0)for(const u of d)u.type==="Feature"&&u.geometry.type==="Point"&&u.properties&&"index"in u.properties&&typeof u.properties.index=="number"&&c.update(u.properties.index,ke(u.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:t}=this.props,{style:n,map:a}=this.state;return t&&t!==n&&(this.setState({style:t}),a==null||a.setStyle(t)),Qn(this,s=>this.setState(s),this.state,this.props),Yn(this,s=>this.setState(s),this.state,this.props),Xn(this,s=>this.setState(s),this.state,this.props),Un(this,s=>this.setState(s),this.state,this.props),Zn(this,s=>this.setState(s),this.state,this.props),qn(s=>this.setState(s),this.state,this.props),!1}render(){const{mapReference:t}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:t})}}const ie={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},ta=(()=>{var t;const e=h(h({},ie),JSON.parse((t=window.localStorage.getItem("mapSettings"))!=null?t:"{}"));return e.savedStyles=h(h({},e.savedStyles),ie.savedStyles),e})();function na({settings:e,setSettings:t}){const[n,a]=L.exports.useState(""),[s,r]=L.exports.useState(""),[d,l]=L.exports.useState(""),c=u=>{t(u),window.localStorage.setItem("mapSettings",JSON.stringify(u))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Select Style"}),o("span",{className:"w-2/5 flex-shrink-0",children:v("select",{className:"bg-gray-800 w-full",value:e.currentStyleName,onChange:u=>{const b=u.target.value;if(b==="***CUSTOM")a(""),l(e.savedStyles.default.styleId),r(e.savedStyles.default.user),c(N(h({},e),{currentStyleName:"",currentStyle:e.savedStyles.default}));else{const f=e.savedStyles[b];a(b),l(f.styleId),r(f.user),c(N(h({},e),{currentStyleName:b,currentStyle:f}))}},children:[o("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(e.savedStyles).map(u=>o("option",{value:u,children:u},u))]})})]}),e.currentStyleName in ie.savedStyles?o(I,{}):v(I,{children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Style Name"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:u=>{a(u.target.value)}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in ie.savedStyles)&&c({currentStyle:{user:s,styleId:d},currentStyleName:n,savedStyles:N(h({},e.savedStyles),{[n]:{user:s,styleId:d}})})},children:"Save Style"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in e.savedStyles&&!(n in ie.savedStyles)){const u={};for(const b of Object.keys(e.savedStyles))b!==n&&(u[b]=e.savedStyles[b]);c({currentStyle:u.default,currentStyleName:"default",savedStyles:u})}},children:"Delete Style"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"User"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:s,onChange:u=>{r(u.target.value)}})}),o("span",{className:"text-l font-bold",children:"Style Id"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:d,onChange:u=>{l(u.target.value)}})})]}),v("div",{children:["Adding a custom mapbox style:",v("ul",{children:[v("li",{children:["If you are creating a new style, go to"," ",o("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),o("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const aa={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Wt;const oa=h(h({},aa),JSON.parse((Wt=window.localStorage.getItem("meshDisplaySettings"))!=null?Wt:"{}"));function sa({settings:e,setSettings:t,open:n,openMultiple:a}){const s=r=>{t(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{s(N(h({},e),{hide:!e.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Mesh"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>a(),children:"Open Meshes"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:r=>{s(N(h({},e),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:r=>{s(N(h({},e),{width:Number.parseFloat(r.target.value)}))}})})]})]})}const ce=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],_e={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},la={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Gt;const ia=h(h({},la),JSON.parse((Gt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Gt:"{}")),ra=["",...ce];function ca({settings:e,setSettings:t,segments:n,selected:a,setSegmentData:s,addNewSegment:r,splitSegment:d,setSelectionMode:l,save:c,open:u}){const b=x=>{t(x),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(x))},f=a.map(x=>n[x]).filter(x=>x),m=f.length>0?o(ne,{title:f.length===1?f[0].name:"Edit Selected Segments",items:f,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:x=>s(a,x),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>d(a),children:"Split Segment"})}):o(I,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{b(N(h({},e),{hide:!e.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hideProjection,onChange:()=>{b(N(h({},e),{hideProjection:!e.hideProjection}))}})})]}),v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Open Segments"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Segments & Vertices"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:x=>{b(N(h({},e),{color:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:x=>{b(N(h({},e),{width:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:x=>{b(N(h({},e),{activeColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.activeWidth,onChange:x=>{b(N(h({},e),{activeWidth:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.projectionColor,onChange:x=>{b(N(h({},e),{projectionColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:x=>{b(N(h({},e),{plottableKey:x.currentTarget.value}))},children:ra.map(x=>o("option",{value:x,children:x},x))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:x=>{l({mode:"mapClick",label:"Select Segment End point",callback:w=>{r(x,w),l("normal")}})}})},children:"New Segment"})]}),m]})}const mt=()=>xn(),W=vn;function da({folder:e,openFolder:t,filesOpen:n,saveFiles:a}){function s(){t()}const r=mt(),[d,l]=W(c=>[c.main.past.length>0,c.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[e?o("button",{type:"button",onClick:()=>{r(at.ActionCreators.undo())},"data-testid":"undo-button",disabled:!d,children:"Undo"}):o(I,{}),e?o("button",{type:"button",onClick:()=>{r(at.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):o(I,{}),e?v("span",{children:["Working in ",e.name]}):o("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),n?o("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Active Files"}):o(I,{})]})]})}const de=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],ma={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function ua(e){return h(h({},ma),e)}const fa={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},pa=["",...de];var Kt;const ha=JSON.parse((Kt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Kt:"false")||fa;function ga({settings:e,setSettings:t,selected:n,velocitys:a,setVelocityData:s,addNewVelocity:r,save:d,open:l}){const c=f=>{t(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},u=n.map(f=>a[f]).filter(f=>f),b=u.length>0?o(ne,{title:u.length===1?u[0].name:"Edit Selected Velocities",items:u,deletable:!0,setItems:f=>s(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(I,{});return v(I,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{c(N(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:f=>{c(N(h({},e),{color:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:f=>{c(N(h({},e),{selectedColor:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:e.scale,onChange:f=>{c(N(h({},e),{scale:Number.parseFloat(f.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:f=>{c(N(h({},e),{width:Number.parseFloat(f.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:e.arrowHead,onChange:f=>{c(N(h({},e),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:f=>{c(N(h({},e),{plottableKey:f.currentTarget.value}))},children:pa.map(f=>o("option",{value:f,children:f},f))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),b]})}const ya={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var zt;const ba=h(h({},ya),JSON.parse((zt=window.localStorage.getItem("vertexDisplaySettings"))!=null?zt:"{}"));function xa({settings:e,setSettings:t,vertices:n,selected:a,setVertexData:s,setSelectionMode:r,mergeVertices:d,bridgeVertices:l,extrudeVertex:c,save:u,open:b}){const f=w=>{t(w),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(w))},x=a.map(w=>({selectedVertex:n[w],index:w})).filter(w=>w.selectedVertex).map(({selectedVertex:w,index:y})=>o(ne,{title:"Selected Vertex",items:[w],ignoreFields:[],deletable:!1,setItems:g=>s(y,h(h({},w),g)),fieldDefinitions:{},controls:v(I,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:g=>{d(y,g[0]),r("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:g=>{l(y,g[0]),r("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:g=>{c(y,g),r("normal")}})},children:"Extrude"})]})},y));return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{f(N(h({},e),{hide:!e.hide}))}})}),v("span",{className:"w-2/5 flex-shrink flex flex-row justify-end gap-2",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>b(),children:"Open Segments"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Save Segments & Vertices"})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:w=>{f(N(h({},e),{color:w.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.radius,onChange:w=>{f(N(h({},e),{radius:Number.parseFloat(w.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:w=>{f(N(h({},e),{activeColor:w.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.activeRadius,onChange:w=>{f(N(h({},e),{activeRadius:Number.parseFloat(w.target.value)}))}})})]}),x]})}const va=e=>e.mode,wa=e=>e.setSelectedBlock,Sa=e=>e.setSelectedSegment,Na=e=>e.setSelectedVelocity,ka=e=>e.setSelectedVertex,Ca=e=>e.setActiveTab,_a=e=>e.setLassoSelection,ut=wn(va,wa,Sa,Na,ka,Ca,_a,(e,t,n,a,s,r,d)=>e==="normal"||e.mode==="lasso"?(l,c)=>{t(l==="block"?c:[]),n(l==="segment"?c:[]),a(l==="velocities"?c:[]),s(l==="vertex"?c:[]),e!=="normal"&&e.mode==="lasso"&&d(c),r(l)}:e.mode==="override"?(l,c)=>{l===e.type&&e.callback(c)}:()=>{});function La(e,{data:t}){return[...e,In(t)]}function $a(e,t){const n=[];for(const[a,s]of e.entries())t.includes(a)||n.push(s);return n}function ja(e,t){const n=[...e];for(const a of t.indices){const s=h(h({},n[a]),t.data);n[a]=s}return n}function Da(e,t){return t}function Fa(e,{index:t,position:n}){const a=[...e],s=h({},a[t]);return s.interior_lat=n.lat,s.interior_lon=n.lon,a[t]=s,a}const Ma=[],ft=$("createBlock"),pt=$("editBlock"),ht=$("deleteBlock"),Le=$("loadNewBlockData"),gt=$("moveBlock"),Va=te(Ma,e=>{e.addCase(ft,(t,n)=>La(t,n.payload)).addCase(pt,(t,n)=>ja(t,n.payload)).addCase(ht,(t,n)=>$a(t,n.payload)).addCase(Le,(t,n)=>Da(t,n.payload)).addCase(gt,(t,n)=>Fa(t,n.payload))}),me={file_name:"Default Command",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""},Ia=Object.keys(me),Pa=h({},me),yt=$("loadNewCommandData"),Oa=$("newCommandFile"),$e=$("editCommandData"),Ra=te(Pa,e=>{e.addCase(yt,(t,n)=>n.payload).addCase(Oa,()=>h({},me)).addCase($e,(t,n)=>h(h({},t),n.payload))}),bt=$("setRootFolder"),E=$("openFile"),Ba=$("closeFile"),Ea={rootFolder:void 0,files:{}},Aa=te(Ea,e=>{e.addCase(bt,(t,n)=>({rootFolder:n.payload,files:{},fileOpenCallback:()=>{}})).addCase(E,(t,n)=>{const a=h({},t.files);return a[n.payload.key]={path:n.payload.path,file:n.payload.file},N(h({},t),{files:a})}).addCase(Ba,(t,n)=>{const a={};return Object.keys(t.files).filter(s=>s!==n.payload).map(s=>(a[s]=t.files[s],!0)),N(h({},t),{files:a})})});function Ta(e,t){return N(h({},e),{[t.name]:{name:t.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:t.data}})}function Wa(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}function Ga(e,t){const n=e[t.collection];if(!n)return e;const a=N(h({},n),{startLon:t.startLon,startLat:t.startLat,endLon:t.endLon,endLat:t.endLat,plot:t.plot});return N(h({},e),{[t.collection]:a})}const Ka={},xt=$("loadNewGenericCollectionData"),vt=$("setGenericSegmentPositionKeys"),za=$("removeGenericSegmentCollection"),Ha=te(Ka,e=>e.addCase(xt,(t,n)=>Ta(t,n.payload)).addCase(vt,(t,n)=>Ga(t,n.payload)).addCase(za,(t,n)=>Wa(t,n.payload))),Ja={mesh_filename:"",smoothing_weight:1e7,edge_constraints:[0,1,0],n_eigenvalues:20,a_priori_slip_filename:""};function Ua(e,t){var n;return N(h({},e),{[t.mesh]:{parameters:(n=t.parameters)!=null?n:Ja,line:t.data}})}function qa(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}const wt={},ue=$("loadMeshLineData"),Qa=$("removeMesh"),je=$("clearMeshes"),Xa=te(wt,e=>e.addCase(ue,(t,n)=>Ua(t,n.payload)).addCase(Qa,(t,n)=>qa(t,n.payload)).addCase(je,()=>wt));function Za(e,{a:t,b:n}){const a=N(h({},_e),{start:t,end:n}),s=[...e.segments,a];return N(h({},e),{segments:s})}function Ya(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),{lastIndex:s}=e,[r,d]=se(t.start,a,n,s),[l,c]=se(t.end,a,n,d),u=N(h(h({},_e),t),{start:r,end:l}),b=[...e.segments,u];return{vertecies:n,vertexDictionary:a,segments:b,lastIndex:c}}function eo(e,t){const n=[],a=[];let s=h({},e);for(const[r,d]of e.segments.entries())t.index.includes(r)?a.push(d):n.push(d);s.segments=n;for(const r of a)s=dt(dt(s,r.start),r.end);return s}function to(e,t){const n=[...e.segments];for(const a of t.indices){const s=h(h({},n[a]),t.data);n[a]=s}return N(h({},e),{segments:n})}function no(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),[s,r]=se(t.targetPoint,a,n,e.lastIndex),d=N(h({},_e),{start:t.index,end:s}),l=[...e.segments,d];return{vertecies:n,vertexDictionary:a,segments:l,lastIndex:r}}function ao(e,t){return t}function oo(e,{a:t,b:n}){if(t===n)return e;const a=e.segments.map(c=>{let u=c;return u.start===n&&(u=N(h({},u),{start:t})),u.end===n&&(u=N(h({},u),{end:t})),u}).filter(c=>c.start!==c.end),s=e.vertecies[n],r=`${Math.floor(s.lon*q)},${Math.floor(s.lat*q)}`,d=h({},e.vertecies);delete d[n];const l=h({},e.vertexDictionary);return delete l[r],N(h({},e),{vertecies:d,vertexDictionary:l,segments:a})}function so(e,{index:t,vertex:n}){const a=h({},e.vertecies),s=h({},e.vertexDictionary),r=[...e.segments],d=a[t],l=`${Math.floor(n.lon*q)},${Math.floor(n.lat*q)}`,c=`${Math.floor(d.lon*q)},${Math.floor(d.lat*q)}`;if(delete s[c],l in s){const u=s[l];for(const b of r)b.start===u&&(b.start=t),b.end===u&&(b.end=t);delete a[u]}return a[t]=n,N(h({},e),{segments:r,vertecies:a,vertexDictionary:s})}function lo(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),s=[...e.segments];let{lastIndex:r}=e;for(const d of t){const l=e.segments[d],c=e.vertecies[l.start],u=e.vertecies[l.end],b={lon:(c.lon+u.lon)/2,lat:(c.lat+u.lat)/2},[f,m]=se(b,a,n,r);r=m;const x=N(h({},l),{end:f,name:`${l.name}_a`}),w=N(h({},l),{start:f,name:`${l.name}_b`});s[d]=x,s.push(w)}return{vertecies:n,vertexDictionary:a,segments:s,lastIndex:r}}const io={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},St=$("bridgeVertices"),Nt=$("createSegmet"),kt=$("deleteSegment"),Ct=$("editSegmentData"),_t=$("extrudeSegment"),fe=$("loadNewSegmentData"),Lt=$("mergeVertices"),De=$("moveVertex"),$t=$("splitSegment");function ro(e,t,n){if(n.dip===90||n.locking_depth<=0)return!1;const a=n.dip<90,r=(a?90-n.dip:n.dip-90)*(Math.PI/180),d=Math.abs(Math.tan(r)*n.locking_depth),[l,c]=e.lon>=t.lon?[e,t]:[t,e],u={lon:c.lat-l.lat,lat:-(c.lon-l.lon)};a&&(u.lon*=-1,u.lat*=-1);const b=ot(st([[l.lon,l.lat],[l.lon+u.lon,l.lat+u.lat]]),d,{units:"kilometers"}),f=ot(st([[c.lon,c.lat],[c.lon+u.lon,c.lat+u.lat]]),d,{units:"kilometers"});return[l,{lon:b.geometry.coordinates[0],lat:b.geometry.coordinates[1]},{lon:f.geometry.coordinates[0],lat:f.geometry.coordinates[1]},c]}function co(e){return e.segments.map(t=>ro(e.vertecies[t.start],e.vertecies[t.end],t)).filter(t=>t)}const mo=te(io,e=>{e.addCase(St,(t,n)=>Za(t,n.payload)).addCase(Nt,(t,n)=>Ya(t,n.payload)).addCase(kt,(t,n)=>eo(t,n.payload)).addCase(Ct,(t,n)=>to(t,n.payload)).addCase(_t,(t,n)=>no(t,n.payload)).addCase(fe,(t,n)=>ao(t,n.payload)).addCase(Lt,(t,n)=>oo(t,n.payload)).addCase(De,(t,n)=>so(t,n.payload)).addCase($t,(t,n)=>lo(t,n.payload))});function uo(e,{data:t}){return[...e,ua(t)]}function fo(e,t){const n=[];for(const[a,s]of e.entries())t.includes(a)||n.push(s);return n}function po(e,t){const n=[...e];for(const a of t.indices){const s=h(h({},n[a]),t.data);n[a]=s}return n}function ho(e,t){return t}function go(e,{index:t,position:n}){const a=[...e],s=h(h({},a[t]),n);return a[t]=s,a}const yo=[],jt=$("createVelocity"),Dt=$("editVelocity"),Ft=$("deleteVelocity"),Fe=$("loadNewVelocityData"),Mt=$("moveVelocity"),bo=te(yo,e=>{e.addCase(jt,(t,n)=>uo(t,n.payload)).addCase(Dt,(t,n)=>po(t,n.payload)).addCase(Ft,(t,n)=>fo(t,n.payload)).addCase(Fe,(t,n)=>ho(t,n.payload)).addCase(Mt,(t,n)=>go(t,n.payload))});function re(e){const t=e.split(/\n/g),n=t[0].split(",").map(r=>r.trim()),a=t.slice(1),s=[];for(const r of a)if(r.trim()!==""){const d=r.split(/\s*,\s*/),l={};for(let c=0;c<n.length;c+=1){let u=d[c];const b=n[c],f=Number.parseFloat(u);u=Number.isNaN(f)?u:f,typeof u=="string"&&(u=u.startsWith('"')&&u.endsWith('"')?u.slice(1,-1).trim():u.trim()),l[b]=u}s.push(l)}return s}function Me(e,t){const n=[t.join(",")];for(const a of e){const s=a;n.push(t.map(r=>{if(r in s){const d=s[r];return typeof d=="string"&&/\s/.test(`${d}`)?`"${d.trim()}"`:`${typeof d=="number"&&(r.includes("lon")||r.includes("lat"))?d.toFixed(6):d}`}return""}).join(","))}return n.join(`
`)}function xo(e){return e.map(t=>{const n={};for(const a of Ne)n[a]=t[a]||(a==="name"?"":0);return n})}function Ve(e){return Me(e,Ne)}async function Vt(e){return xo(re(await e.getContents()))}class vo{constructor(t,n,a){D(this,"name");D(this,"path");D(this,"parent");this.name=t,this.parent=n,this.path=a!=null?a:[this.name]}async getContents(){const t=this.parent[this.name];if(typeof t!="string")throw new Error("No Such File");return t}async setContents(t){this.parent[this.name]=t}}class Ie{constructor(t,n,a){D(this,"name");D(this,"path");D(this,"parent");D(this,"fileList");D(this,"folderList");this.name=t,this.parent=n,this.fileList=[],this.folderList=[],this.path=a!=null?a:[this.name];const s=n[t];for(const r of Object.keys(s))typeof s[r]=="string"?this.fileList.push(r):this.folderList.push(r)}async getFile(t){return new vo(t,this.parent[this.name],[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("No Such Directory");return new Ie(t,this.parent[this.name],[...this.path,t])}}const wo=async e=>new Ie("root",e);let It=async()=>{var t;return wo((t=window.FakeDirectory)!=null?t:{})};function So(e){It=e}async function No(){return It()}async function Pt(e,t,n){const a=t.split("/");let s=[...e.path];"getContents"in e&&s.pop();for(const c of a)if(c===".."){if(s.length===0)return!1;s.pop()}else c!==""&&c!=="."&&s.push(c);if(s.length<2)return!1;const r=s.pop();if(!r)return!1;s=s.slice(1);let d=n;for(const c of s)d=await d.getDirectory(c);return await d.getFile(r)}async function pe(e,t,n){const a=t.replace("../","").replace("./","").replace("data/","../");return Pt(e,a,n)}function he(e){return`../data/${e.path.slice(-2).join("/")}`}function ko(e){const t=h({},me);for(const n of Ia)n in e&&(t[n]=e[n]);return t}function Co(e){const t=JSON.parse(e);return ko(t)}class _o{constructor(t){D(this,"data");D(this,"handle");this.handle=t,this.data=void 0}async initialize(){const t=await this.handle.getContents(),n=re(t);this.data=n}async save(){}}function Lo(e){const n=[...e.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const s=Number.parseFloat(a[1]),r=Number.parseFloat(a[2]);return{lon:s,lat:r}});return n.splice(0,0,{lon:0,lat:0}),n}const $o={"1":e=>{var a,s;const t=Number.parseInt((a=e[e.length-2])!=null?a:"",10),n=Number.parseInt((s=e[e.length-1])!=null?s:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)?[[t,n]]:!1},"2":e=>{var s,r,d;const t=Number.parseInt((s=e[e.length-3])!=null?s:"",10),n=Number.parseInt((r=e[e.length-2])!=null?r:"",10),a=Number.parseInt((d=e[e.length-1])!=null?d:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)&&!Number.isNaN(a)?[[t,n],[n,a],[a,t]]:!1}};function jo(e){return e.split(/\n/).map(t=>t.trim()).map(t=>t.split(/\s+/)).filter(t=>t.length>2).map(t=>{var a;return((a=$o[t[1]])!=null?a:()=>!1)(t)}).filter(t=>t).flat()}function Do(e,t){return t.map(([n,a])=>n!==a&&n>-1&&n<e.length&&a>-1&&a<e.length?[e[n],e[a]]:!1).filter(n=>n)}function Fo(e){if(!e.startsWith("$"))return[];const t=e.split("$");let n=[],a=[];for(const s of t)s.startsWith("Nodes")?n=Lo(s):s.startsWith("Elements")&&(a=jo(s));return Do(n,a)}class Ot{constructor(t){D(this,"data");D(this,"handle");D(this,"startLonColumn");D(this,"endLonColumn");D(this,"startLatColumn");D(this,"endLatColumn");this.handle=t,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const t=await this.handle.getContents();if(t.startsWith("$"))this.data=Fo(t);else{const n=re(t);this.data=n.map(a=>{const s={lon:0,lat:0},r={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(s.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(s.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(r.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(r.lat=a[this.endLatColumn]);const d=Object.keys(a).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(d.length>0){const l={};for(const c of d)l[c]=a[c];return[s,r]}return[s,r]})}}async save(){console.log("Mesh files do not get saved")}}function Mo(e){const t=e.map(d=>{const l={};for(const c of ce)l[c]=d[c]||(c==="name"?"":0);return l}).filter(d=>{for(const l of ce)if(!(l in d))return!1;return!0}),n={},a={},s=[];let r=0;for(const d of t){const[l,c]=se({lon:d.lon1,lat:d.lat1},n,a,r),[u,b]=se({lon:d.lon2,lat:d.lat2},n,a,c),f=N(h({},d),{start:l,end:u});r=b,s.push(f)}return{vertecies:a,vertexDictionary:n,segments:s,lastIndex:r}}function ge({vertecies:e,segments:t}){const n=t.map(a=>{const s=e[a.start],r=e[a.end];return N(h({},a),{lon1:s.lon,lat1:s.lat,lon2:r.lon,lat2:r.lat})});return Me(n,ce)}async function Pe(e){const t=await e.getContents();return Mo(re(t))}function Vo(e){return e.map(t=>{const n={};for(const a of de)n[a]=t[a]||(a==="name"?"":0);return n}).filter(t=>{for(const n of de)if(!(n in t))return!1;return!0})}function Oe(e){return Me(e,de)}async function Rt(e){const t=await e.getContents();return Vo(re(t))}async function Io(e){const t=new Ot(e);return await t.initialize(),t}async function Bt(e,t){const n=await e.getContents(),a=JSON.parse(n);return Array.isArray(a)?(await Promise.all(a.map(async r=>{const d=r.mesh_filename.split("/"),l=await Pt(e,d[d.length-1],t);if(!l)return!1;const c=await Io(l);return c.data?{line:c.data,parameters:r}:!1}))).filter(r=>!!r):[]}async function Po(e,t){const n=Co(await t.getContents()),a={commands:t,segments:!1,blocks:!1,velocities:!1,mesh:!1};return console.log("Opened command file",n),console.log("Current File",t),console.log("Root",e),n.segment_file_name&&(a.segments=await pe(t,n.segment_file_name,e)),n.block_file_name&&(a.blocks=await pe(t,n.block_file_name,e)),n.station_file_name&&(a.velocities=await pe(t,n.station_file_name,e)),n.mesh_parameters_file_name&&(a.mesh=await pe(t,n.mesh_parameters_file_name,e)),{command:n,files:a}}class Oo{constructor(t,n){D(this,"name");D(this,"path");D(this,"handle");this.handle=t,this.name=t.name,this.path=n!=null?n:[this.name]}async getContents(){return(await this.handle.getFile()).text()}async setContents(t){const n=await this.handle.createWritable();await n.write(t),await n.close()}}class Re{constructor(t,n){D(this,"name");D(this,"path");D(this,"handle");D(this,"fileList");D(this,"folderList");this.handle=t,this.fileList=[],this.folderList=[],this.name=t.name,this.path=n!=null?n:[this.name]}async initialize(){for await(const t of this.handle.values())t.kind==="directory"?this.folderList.push(t.name):this.fileList.push(t.name)}async getFile(t){const n=await this.handle.getFileHandle(t,{create:!0});return new Oo(n,[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(t),a=new Re(n,[...this.path,t]);return await a.initialize(),a}}const Ro=async()=>{const e=await window.showDirectoryPicker();await e.requestPermission({mode:"readwrite"});const t=new Re(e);return await t.initialize(),t};function Bo(e,t){if(e.length===0||t.length===0)return[];const n=lt(e.map(r=>Sn([r.point.lon,r.point.lat],{index:r.id}))),a=lt([Nn([[...t,t[0]].map(r=>[r.lon,r.lat])])]);return kn(n,a).features.map(r=>{var d;return(d=r.properties.index)!=null?d:-1}).filter(r=>r>=0)}window.location.search.includes("fake-dir")||So(Ro);var R;(function(e){e.Vertex="vertex",e.Block="block",e.Velocity="velocities",e.Segments="segment"})(R||(R={}));const Et={Block:R.Block,Vertex:R.Vertex,Velocity:R.Velocity,Segment:R.Segments},Eo={command:"Command",segment:"Segment",vertex:"Vertices",block:"Block",velocities:"Velocities",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function Ao(){var Ye,et;const e=mt(),t=W(i=>i.main.present.fileHandles.rootFolder),[n,a]=L.exports.useState(!1),[s,r]=L.exports.useState("command"),d=W(i=>i.main.present.fileHandles.files.segment),l=W(i=>i.main.present.fileHandles.files.block),c=W(i=>i.main.present.fileHandles.files.velocity),u=W(i=>i.main.present.fileHandles.files.command),b=W(i=>i.main.present.fileHandles.files.mesh_params),f=W(i=>i.main.present.segment),m=W(i=>i.main.present.block),x=W(i=>i.main.present.velocity),w=W(i=>i.main.present.meshLine),y=W(i=>i.main.present.genericSegments),g=W(i=>i.main.present.command),[S,k]=L.exports.useState(ha),[_,H]=L.exports.useState(Bn),[F,Be]=L.exports.useState(ia),[V,Ee]=L.exports.useState(ba),[J,Ae]=L.exports.useState(oa),[U,Te]=L.exports.useState(Kn),[le,Ht]=L.exports.useState(ta),[j,K]=L.exports.useState("normal"),[ee,Jt]=L.exports.useState(R.Vertex),[ye,We]=L.exports.useState([]),[Ge,Ke]=L.exports.useState([]),[ze,He]=L.exports.useState([]),[Je,Ue]=L.exports.useState([]),[Ut,qe]=L.exports.useState([]),[P,zo]=L.exports.useState({select:ut({mode:j,setSelectedBlock:We,setSelectedSegment:Ke,setSelectedVelocity:He,setSelectedVertex:Ue,setActiveTab:r,setLassoSelection:qe})}),[qt,Qt]=L.exports.useState([]),[Xt,Qe]=L.exports.useState([]),[Zt,Yt]=L.exports.useState([]),[en,tn]=L.exports.useState([]),[nn,be]=L.exports.useState({color:V.color,selectedColor:V.activeColor,radius:V.radius,selectedRadius:V.activeRadius,points:[]}),[Xe,an]=L.exports.useState({lon:0,lat:0}),[xe,on]=L.exports.useState(!1),[sn,ln]=L.exports.useState();L.exports.useEffect(()=>{P.select=ut({mode:j,setSelectedBlock:We,setSelectedSegment:Ke,setSelectedVelocity:He,setSelectedVertex:Ue,setActiveTab:r,setLassoSelection:qe})},[j,P]),L.exports.useEffect(()=>{const i=[];ee!==R.Block&&!_.hide&&i.push({name:"blocks",color:_.color,selectedColor:_.selectedColor,radius:_.radius,points:m.map((p,C)=>({longitude:p.interior_lon,latitude:p.interior_lat,name:p.name,description:"",index:C,label:_.plottableKey in p?`${p[_.plottableKey]}`:""})),click:p=>{P.select("block",[p])}}),ee!==R.Vertex&&!V.hide&&i.push({name:"vertices",color:V.color,selectedColor:V.activeColor,radius:V.radius,click:p=>{P.select("vertex",[p])},points:Object.keys(f.vertecies).map(p=>{const C=Number.parseInt(p,10),M=f.vertecies[C];return M?{longitude:M.lon,latitude:M.lat,index:C,name:"",description:""}:!1}).filter(p=>!!p)}),j!=="normal"&&j.mode==="lasso"&&i.push({name:"selection",color:"#fff",selectedColor:"#fff",radius:1.5,points:j.polygon.map((p,C)=>({longitude:p.lon,latitude:p.lat,name:"",description:"",index:C}))}),Qt(i)},[_,m,F,P,ee,V.hide,V.color,V.activeColor,V.radius,f.vertecies,j]),L.exports.useEffect(()=>{const i=[];if(F.hide||i.push({name:"segments",color:F.color,selectedColor:F.activeColor,width:F.width,selectedWidth:F.activeWidth,lines:f.segments.map((p,C)=>{var ae,Z;const M=(ae=f.vertecies[p.start])!=null?ae:rt,A=(Z=f.vertecies[p.end])!=null?Z:rt,[[O,T],[G,B]]=Ce(M,A);return{startLongitude:O,startLatitude:T,endLongitude:G,endLatitude:B,name:p.name,description:`${M.lon},${M.lat} to ${A.lon},${A.lat}`,index:C,label:F.plottableKey in p?`${p[F.plottableKey]}`:""}}),click:p=>{P.select("segment",[p])}}),!J.hide)for(const p of Object.keys(w)){const C=w[p].line;i.push({name:`mesh:${p}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:C.map((M,A)=>{const O=M[0],T=M[1],[[G,B],[ae,Z]]=Ce(O,T);return{startLongitude:G,startLatitude:B,endLongitude:ae,endLatitude:Z,name:"",description:"",index:A}})||[]})}if(!U.hide)for(const p of Object.keys(y)){const{startLat:C,startLon:M,endLat:A,endLon:O,plot:T,segments:G}=y[p];C in G[0]&&A in G[0]&&M in G[0]&&O in G[0]&&i.push({name:`generic_segment:${p}`,color:U.color,selectedColor:U.activeColor,width:U.width,selectedWidth:U.activeWidth,lines:G.map((B,ae)=>{const Z={lat:B[C],lon:B[M]},ve={lat:B[A],lon:B[O]};if(typeof Z.lat!="number"||typeof Z.lon!="number"||typeof ve.lat!="number"||typeof ve.lon!="number")return!1;const[[rn,cn],[dn,mn]]=Ce(Z,ve);return{startLongitude:rn,startLatitude:cn,endLongitude:dn,endLatitude:mn,name:"",description:"",index:ae,label:T&&T in B?`${B[T]}`:""}}).filter(B=>B)||[]})}Yt(i)},[f,F,U,y,J,w,P]),L.exports.useEffect(()=>{switch(ee){case R.Vertex:{be({color:V.color,radius:V.radius,selectedColor:V.activeColor,selectedRadius:V.activeRadius,points:V.hide?[]:Object.keys(f.vertecies).map(i=>{const p=Number.parseInt(i,10),C=f.vertecies[p];return C?{longitude:C.lon,latitude:C.lat,index:p}:!1}).filter(i=>!!i),update:(i,p)=>{e(De({index:i,vertex:p}))},select:i=>{P.select("vertex",i)}});break}case R.Block:{be({color:_.color,radius:_.radius,selectedColor:_.selectedColor,selectedRadius:_.radius,points:_.hide?[]:m.map((i,p)=>({longitude:i.interior_lon,latitude:i.interior_lat,name:i.name,description:"",index:p,label:_.plottableKey in i?`${i[_.plottableKey]}`:""})),update:(i,p)=>{e(gt({index:i,position:p}))},select:i=>{P.select("block",i)}});break}case R.Velocity:{be({color:S.color,radius:S.width,selectedColor:S.selectedColor,selectedRadius:S.width,points:S.hide?[]:x.map((i,p)=>({longitude:i.lon,latitude:i.lat,name:i.name,description:"",index:p})),update:(i,p)=>{e(Mt({index:i,position:p}))},select:i=>{P.select("velocities",i)}});break}}},[V,P,f.vertecies,e,ee,_.color,_.radius,_.selectedColor,_.hide,m,S.color,S.width,S.selectedColor,S.hide,x,_.plottableKey]),L.exports.useEffect(()=>{S.hide?Qe([]):Qe([{name:"velocities",color:S.color,selectedColor:S.selectedColor,scale:S.scale,arrowHeadScale:S.arrowHead,width:S.width,arrows:x.map((i,p)=>{const C=Math.sqrt(i.east_vel*i.east_vel+i.north_vel*i.north_vel);return{longitude:i.lon,latitude:i.lat,direction:[i.east_vel/C,i.north_vel/C],scale:C,name:i.name,description:`north: ${i.north_vel}, east: ${i.east_vel}`,index:p,label:S.plottableKey in i?`${i[S.plottableKey]}`:""}}),click:i=>{P.select("velocities",[i])}}])},[P,S,x]),L.exports.useEffect(()=>{const i=[];j!=="normal"&&j.mode==="lasso"&&i.push({name:"selection_polygon",color:"#ffffff",borderColor:"#ffffff",borderRadius:.5,polygons:[{polygon:j.polygon,index:0,name:"",description:""}]}),!F.hideProjection&&!F.hide&&i.push({name:"fault_dip_projections",color:F.projectionColor,borderColor:F.projectionColor,borderRadius:.5,polygons:co(f).map((p,C)=>({polygon:p,index:C,name:"",description:""}))}),tn(i)},[F,f,j]);let Q=o("span",{});switch(s){case"velocities":Q=o(ga,{open:()=>{console.log("opening velocities file"),a({extension:"csv",callback:async i=>{const p=await Rt(i);e(Fe(p)),e(E({file:i,key:"velocity",path:i.path}))}})},settings:S,setSettings:k,selected:ze,velocitys:x,setVelocityData:(i,p)=>{p?e(Dt({indices:i,data:p})):(e(Ft(i)),P.select("velocity",[]))},addNewVelocity:()=>{K({label:"Click to place velocity estimate",mode:"mapClick",callback:i=>{K("normal");const p=x.length;e(jt({data:{lat:i.lat,lon:i.lon}})),P.select("velocity",[p])}})},save:async i=>{i?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(E({file:p,key:"velocity",path:p.path})),await p.setContents(Oe(x))}}):c&&await c.file.setContents(Oe(x))}});break;case"block":Q=o(En,{open:()=>{console.log("opening block file"),a({extension:"csv",callback:async i=>{const p=await Vt(i);e(Le(p)),e(E({file:i,key:"block",path:i.path}))}})},settings:_,setSettings:H,selected:ye,blocks:m,addNewBlock:()=>{K({label:"Click to place new block",mode:"mapClick",callback:i=>{const p=m.length;e(ft({data:{name:"New Block",interior_lon:i.lon,interior_lat:i.lat}})),P.select("block",[p]),K("normal")}})},setBlockData:(i,p)=>{p?e(pt({indices:ye,data:p})):(e(ht(i)),P.select("block",[]))},save:async i=>{i?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(E({file:p,key:"block",path:p.path})),await p.setContents(Ve(m))}}):l&&await l.file.setContents(Ve(m))}});break;case"segment":Q=o(ca,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async i=>{const p=await Pe(i);e(fe(p)),e(E({file:i,key:"segment",path:i.path}))}})},settings:F,setSettings:Be,segments:(Ye=f.segments)!=null?Ye:[],selected:Ge,setSelectionMode:i=>K(i),addNewSegment:(i,p)=>{const C=f.segments.length;e(Nt({start:i,end:p})),P.select("segment",[C])},setSegmentData:(i,p)=>{e(p?Ct({indices:i,data:p}):kt({index:i}))},splitSegment:i=>{e($t(i)),P.select("segment",[])},save:async i=>{i?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(E({file:p,key:"segment",path:p.path})),await p.setContents(ge(f))}}):d&&await d.file.setContents(ge(f))}});break;case"vertex":Q=o(xa,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async i=>{const p=await Pe(i);e(fe(p)),e(E({file:i,key:"segment",path:i.path}))}})},settings:V,setSettings:Ee,vertices:(et=f.vertecies)!=null?et:{},selected:Je,setVertexData:(i,p)=>{p&&e(De({index:i,vertex:p}))},setSelectionMode:i=>K(i),mergeVertices:(i,p)=>{e(Lt({a:i,b:p}))},bridgeVertices:(i,p)=>{e(St({a:i,b:p}))},extrudeVertex:(i,p)=>{e(_t({index:i,targetPoint:p}))},save:async()=>{d&&await d.file.setContents(ge(f))}});break;case"mesh":Q=o(sa,{open:()=>{console.log("opening mesh file"),a({extension:"msh",callback:async i=>{const p=new Ot(i);await p.initialize(),p.data&&e(ue({mesh:i.name,data:p.data}))}})},openMultiple:()=>{console.log("opening mesh file"),a({extension:"json",callback:async i=>{if(t){e(je());const p=await Bt(i,t);e(E({file:i,key:"mesh_params",path:i.path}));for(const C of p)e(ue({mesh:C.parameters.mesh_filename,parameters:C.parameters,data:C.line}))}}})},settings:J,setSettings:Ae});break;case"csv":Q=o(zn,{open:()=>{console.log("opening generic segment file"),a({extension:"csv",callback:async i=>{const p=new _o(i);await p.initialize(),p.data&&e(xt({name:i.name,data:p.data}))}})},settings:U,setSettings:Te,setCollectionVertexKeys:i=>{e(vt(i))},collections:y});break;case"map":Q=o(na,{settings:le,setSettings:Ht});break;case"command":Q=o(An,{command:g,setCommandData:i=>{e($e(i))},open:()=>{console.log("opening command file"),a({extension:"json",callback:async i=>{if(t){const{command:p,files:C}=await Po(t,i);if(e(yt(p)),e(E({file:i,key:"command",path:i.path})),C.blocks){const M=await Vt(C.blocks);e(Le(M)),e(E({file:C.blocks,key:"block",path:C.blocks.path}))}if(C.segments){const M=await Pe(C.segments);e(fe(M)),e(E({file:C.segments,key:"segment",path:C.segments.path}))}if(C.velocities){const M=await Rt(C.velocities);e(Fe(M)),e(E({file:C.velocities,key:"velocity",path:C.velocities.path}))}if(C.mesh&&t){e(je());const M=await Bt(C.mesh,t);e(E({file:C.mesh,key:"mesh_params",path:C.mesh.path}));for(const A of M)e(ue({mesh:A.parameters.mesh_filename,parameters:A.parameters,data:A.line}))}}}})},save:async i=>{const p=h({},g);d&&(p.segment_file_name=he(d.file)),l&&(p.block_file_name=he(l.file)),c&&(p.station_file_name=he(c.file)),b&&(p.mesh_parameters_file_name=he(b.file)),i?a({extension:".json",isSaveFile:!0,callback:async C=>{e(E({file:C,key:"command",path:C.path})),e($e({file_name:C.name})),p.file_name=C.name,await C.setContents(JSON.stringify(p))}}):u&&await u.file.setContents(JSON.stringify(p))}});break}const Ze={Block:{state:_.hide,change:()=>{H(N(h({},_),{hide:!_.hide}))}},Vertex:{state:V.hide,change:()=>{Ee(N(h({},V),{hide:!V.hide}))}},Velocity:{state:S.hide,change:()=>{k(N(h({},S),{hide:!S.hide}))}},Segment:{state:F.hide,change:()=>{Be(N(h({},F),{hide:!F.hide}))}},Grid:{state:!xe,change:()=>{on(!xe)}},Mesh:{state:J.hide,change:()=>{Ae(N(h({},J),{hide:!J.hide}))}},GenericSegments:{state:U.hide,change:()=>{Te(N(h({},U),{hide:!U.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:i=>{if(i.key==="Escape")K("normal");else if(i.key==="Enter"&&j!=="normal"&&j.mode==="lasso"){if(j.polygon.length>2){let p=[];const C=ee;switch(C){case R.Block:p=m.map((O,T)=>({point:{lon:O.interior_lon,lat:O.interior_lat},id:T}));break;case R.Velocity:p=x.map((O,T)=>({point:{lon:O.lon,lat:O.lat},id:T}));break;case R.Vertex:p=Object.keys(f.vertecies).map(O=>({point:f.vertecies[O],id:O}));break;case R.Segments:p=f.segments.map((O,T)=>{const G=f.vertecies[O.start],B=f.vertecies[O.end];return{point:{lon:(G.lon+B.lon)/2,lat:(G.lat+B.lat)/2},id:T}});break;default:K("normal");return}const{polygon:M}=j,A=Bo(p,M);P.select(C,A)}K("normal")}},children:[o(da,{filesOpen:t!==void 0,saveFiles:async()=>{d&&await d.file.setContents(ge(f)),l&&await l.file.setContents(Ve(m)),c&&await c.file.setContents(Oe(x))},folder:t,openFolder:async()=>{const i=await No();e(bt(i)),r("command")}}),j!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center pointer-events-none",children:v("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:j.mode==="lasso"?"lasso":j.label}),j.mode==="lasso"||j.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:j.mode==="lasso"?"Press Enter to Select":j.subtitle}):o(I,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(I,{}),v("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-between gap-5",children:o("span",{className:"p-1 text-sm text-center",children:o("button",{type:"button",className:`${j!=="normal"&&j.mode==="lasso"?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{K({mode:"lasso",polygon:[]})},children:"Lasso Selection"})})}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor(Xe.lon*1e3)/1e3,","," ",Math.floor(Xe.lat*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Et).map(i=>{const p=Et[i];return o("button",{type:"button",className:`${ee===p?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Jt(p)},children:i},i)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Ze).map(i=>{const p=Ze[i];return o("button",{type:"button",className:`${p.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{p.change()},children:i},i)})]})]}),o(ea,{pointSources:qt,arrowSources:Xt,lineSources:Zt,drawnPointSource:nn,polygonSources:en,selections:{segments:Ge,blocks:ye,velocities:ze,vertices:Je,draw:Ut},displayGrid:xe?10:-1,click:i=>{typeof j!="string"&&j.mode==="mapClick"?j.callback(i):typeof j!="string"&&j.mode==="lasso"&&K({mode:"lasso",polygon:[...j.polygon,i]})},mouseMove:i=>{an(i)},styleUri:`mapbox://styles/${le.currentStyle.user}/${le.currentStyle.styleId}`,mapMoved:(i,p)=>ln({zoom:i,center:p}),initialPosition:sn},`${le.currentStyle.user}:${le.currentStyle.styleId}`),t?o(Hn,{view:Q,buttons:Eo,active:s,setActive:i=>r(i)}):o(I,{}),t&&n?o(Wn,{root:t,chooseFile:(i,p)=>{n.callback(i,p),a(!1)},close:()=>{a(!1)},extension:n.extension,isSaveDialog:n.isSaveFile===!0}):o(I,{})]})}const To=Cn({reducer:{main:_n(Ln({segment:mo,block:Va,velocity:bo,meshLine:Xa,genericSegments:Ha,fileHandles:Aa,command:Ra}))}});function Wo(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:s,onRegisterError:r}=e;let d;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(d=new $n("./sw.js",{scope:"./"}),d.addEventListener("activated",c=>{c.isUpdate?window.location.reload():a==null||a()}),d.register({immediate:t}).then(c=>{s==null||s(c)}).catch(c=>{r==null||r(c)})),l}Wo();const Go=1,Ko=new jn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Go}}});Dn.render(o(L.exports.StrictMode,{children:o(Fn,{client:Ko,children:o(Mn,{store:To,children:o(Ao,{})})})}),document.querySelector("#root"));
