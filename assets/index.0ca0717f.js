var V=Object.defineProperty,W=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var v=(n,e,t)=>e in n?V(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))J.call(e,t)&&v(n,t,e[t]);if(L)for(var t of L(e))B.call(e,t)&&v(n,t,e[t]);return n},_=(n,e)=>W(n,H(e));var c=(n,e,t)=>(v(n,typeof e!="symbol"?e+"":e,t),t);import{j as F,m as D,r as m,a as z,M as q,v as Q,Q as G,R as Z,b as K}from"./vendor.2c6bff34.js";const U=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};U();const l=F.exports.jsx,p=F.exports.jsxs,X=F.exports.Fragment;function Y({folder:n,files:e,setFile:t}){const a=Object.keys(e).map(i=>{const s=e[i];return p("div",{className:"flex flex-row justify-between items-center",children:[p("div",{className:"flex flex-col",children:[l("span",{className:"text-l font-bold","data-testid":`file-${i}-label`,children:s.name}),l("span",{className:"text-sm","data-testid":`file-${i}-description`,children:s.description})]}),l("span",{className:"w-2/5 flex-shrink-0",children:p("select",{"data-testid":`file-${i}-select`,className:"w-full rounded",value:s.currentFilePath,onChange:async o=>{const r=o.currentTarget.value;try{const d=await n.getFile(r);t(i,d.name,d)}catch{t(i,"")}},children:[l("option",{value:"","data-testid":`file-${i}-empty`,children:"\xA0"}),n.fileList.filter(o=>o.endsWith(s.extension)).map(o=>l("option",{value:o,"data-testid":`file-${i}-select-${o}`,children:o},o))]})})]},i)});return l("div",{className:"flex flex-col gap-2",children:a})}function ee({view:n,buttons:e,active:t,setActive:a}){if(!e)return l("span",{});const i=[];for(const s of Object.keys(e)){const o=e[s],r=s===t;i.push(l("button",{type:"button","data-testid":`tab-${s}`,className:`${r?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>a(r?"":s),children:o},s))}return p("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?l("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:n}):"",l("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:i})]})}D.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";function te(){const n=m.exports.useRef(null),[e,t]=m.exports.useState(),[a,i]=m.exports.useState();return m.exports.useEffect(()=>{if(!e&&D.accessToken&&n.current){const s=new z.exports.Map({container:n.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new z.exports.NavigationControl);const o=new q({});s.addControl(o),t(s),i(o)}},[e,a]),l("div",{"data-testid":"map",className:"w-full h-full",ref:n})}function ne({folder:n,openFolder:e}){function t(){e()}return p("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[l("h3",{className:"text-lg font-bold",children:"Celeri UI"}),l("span",{children:n?p(X,{children:["Working in ",n.name]}):l("button",{type:"button",onClick:t,children:"Open Folder"})})]})}function x(n){const e=n.split(/\n/g),t=e[0].split(","),a=e.slice(1),i=[];for(const s of a){const o=s.split(/\s*,\s*/),r={};for(let d=0;d<t.length;d+=1){let h=o[d];const S=t[d],g=Number.parseFloat(h);h=Number.isNaN(g)?h:g,typeof h=="string"&&h.startsWith('"')&&h.endsWith('"')&&(h=h.slice(0,-1)),r[S]=h}i.push(r)}return i}function k(n,e){const t=[e.join(",")];for(const a of n){const i=a;t.push(e.map(s=>s in i?typeof i[s]=="string"&&/\s/.test(`${i[s]}`)?`"${i[s]}"`:`${i[s]}`:"").join(","))}return t.join(`
`)}const E=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"];class ie{constructor(e){c(this,"handle");c(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=x(e).map(i=>{const s={};for(const o of E)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=k((t=this.data)!=null?t:[],E);await this.handle.setContents(e)}}const se={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function ae(n){return f(f({},se),n)}class oe{constructor(e){c(this,"handle");c(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=ae(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}}const P=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"];class re{constructor(e){c(this,"handle");c(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=x(e).map(i=>{const s={};for(const o of P)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=k((t=this.data)!=null?t:[],P);await this.handle.setContents(e)}}const M=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class le{constructor(e){c(this,"handle");c(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=x(e).map(i=>{const s={};for(const o of M)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=k((t=this.data)!=null?t:[],M);await this.handle.setContents(e)}}async function $(n){const e=new re(n);return await e.initialize(),e}async function I(n){const e=new ie(n);return await e.initialize(),e}async function R(n){const e=new le(n);return await e.initialize(),e}async function ce(n,e,t){const a=new oe(e);if(await a.initialize(),a.data){const i=await $(await n.getFile(a.data.segment_file_name)),s=await I(await n.getFile(a.data.block_file_name)),o=await R(await n.getFile(a.data.station_file_name)),r=f({},t);return"command"in r&&(r.command=_(f({},r.command),{currentFilePath:e.name})),"segment"in r&&(r.segment=_(f({},r.segment),{currentFilePath:a.data.segment_file_name})),"block"in r&&(r.block=_(f({},r.block),{currentFilePath:a.data.block_file_name})),"velocities"in r&&(r.velocities=_(f({},r.velocities),{currentFilePath:a.data.station_file_name})),{openableFiles:r,commands:a,segments:i,blocks:s,velocities:o}}throw new Error("Can't open command file")}class de{constructor(e){c(this,"name");c(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class N{constructor(e){c(this,"name");c(this,"handle");c(this,"fileList");c(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new de(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),a=new N(t);return await a.initialize(),a}}const he=async()=>{const n=await window.showDirectoryPicker(),e=new N(n);return await e.initialize(),e};class me{constructor(e,t){c(this,"name");c(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class C{constructor(e,t){c(this,"name");c(this,"parent");c(this,"fileList");c(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const a=t[e];for(const i of Object.keys(a))typeof a[i]=="string"?this.fileList.push(i):this.folderList.push(i)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new me(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new C(e,this.parent[this.name])}}const fe=async n=>new C("root",n);let A=async()=>{var e;return fe((e=window.FakeDirectory)!=null?e:{})};function ue(n){A=n}async function pe(){return A()}const _e=window;_e.FakeDirectory||ue(he);const ge={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",mesh:"Mesh"};function we(){const[n,e]=m.exports.useState(),[t,a]=m.exports.useState(""),[i,s]=m.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[o,r]=m.exports.useState(),[d,h]=m.exports.useState(),[S,g]=m.exports.useState(),[Fe,j]=m.exports.useState();let O=l("span",{});switch(t){case"files":O=n?l(Y,{folder:n,files:i,setFile:async(u,T,w)=>{if(w){let b=f({},i);switch(b[u]=_(f({},b[u]),{currentFilePath:T}),u){case"segment":h(await $(w));break;case"block":g(await I(w));break;case"velocity":j(await R(w));break;case"command":const y=await ce(n,w,i);r(y.commands),h(y.segments),g(y.blocks),j(y.velocities),b=y.openableFiles;break}s(b)}}}):l("span",{});break}return p("div",{className:"w-screen h-screen flex flex-col",children:[l(ne,{folder:n,openFolder:async()=>{const u=await pe();e(u),a("files")}}),l(te,{}),l(ee,{view:O,buttons:n?ge:void 0,active:t,setActive:u=>a(u)})]})}function ye(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:i,onRegisterError:s}=n;let o;const r=async(d=!0)=>{};return"serviceWorker"in navigator&&(o=new Q("./sw.js",{scope:"./"}),o.addEventListener("activated",d=>{d.isUpdate?window.location.reload():a==null||a()}),o.register({immediate:e}).then(d=>{i==null||i(d)}).catch(d=>{s==null||s(d)})),r}ye();const be=1,ve=new G({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:be}}});Z.render(l(m.exports.StrictMode,{children:l(K,{client:ve,children:l(we,{})})}),document.querySelector("#root"));
