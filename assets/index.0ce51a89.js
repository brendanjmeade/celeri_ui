var W=Object.defineProperty,H=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var C=(n,e,t)=>e in n?W(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,w=(n,e)=>{for(var t in e||(e={}))J.call(e,t)&&C(n,t,e[t]);if(D)for(var t of D(e))q.call(e,t)&&C(n,t,e[t]);return n},x=(n,e)=>H(n,B(e));var p=(n,e,t)=>(C(n,typeof e!="symbol"?e+"":e,t),t);import{j as N,m as M,r as h,a as L,M as Q,v as G,Q as Z,R as U,b as K}from"./vendor.2c6bff34.js";const X=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};X();const d=N.exports.jsx,b=N.exports.jsxs,Y=N.exports.Fragment;function ee({folder:n,files:e,setFile:t}){const a=Object.keys(e).map(i=>{const s=e[i];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[d("span",{className:"text-l font-bold","data-testid":`file-${i}-label`,children:s.name}),d("span",{className:"text-sm","data-testid":`file-${i}-description`,children:s.description})]}),d("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${i}-select`,className:"w-full rounded",value:s.currentFilePath,onChange:async o=>{const r=o.currentTarget.value;try{const f=await n.getFile(r);t(i,f.name,f)}catch{t(i,"")}},children:[d("option",{value:"","data-testid":`file-${i}-empty`,children:"\xA0"}),n.fileList.filter(o=>o.endsWith(s.extension)).map(o=>d("option",{value:o,"data-testid":`file-${i}-select-${o}`,children:o},o))]})})]},i)});return d("div",{className:"flex flex-col gap-2",children:a})}function te({view:n,buttons:e,active:t,setActive:a}){if(!e)return d("span",{});const i=[];for(const s of Object.keys(e)){const o=e[s],r=s===t;i.push(d("button",{type:"button","data-testid":`tab-${s}`,className:`${r?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>a(r?"":s),children:o},s))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?d("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:n}):"",d("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:i})]})}M.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";function ne({pointSources:n}){const e=h.exports.useRef(null),[t,a]=h.exports.useState(),[i,s]=h.exports.useState(!1),[o,r]=h.exports.useState(),[f]=h.exports.useState(new L.exports.Popup({closeButton:!1,closeOnClick:!1})),[m,y]=h.exports.useState();return h.exports.useEffect(()=>{if(!t&&M.accessToken&&e.current){const l=new L.exports.Map({container:e.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});l.addControl(new L.exports.NavigationControl);const _=new Q({});l.addControl(_),a(l),r(_),l.on("load",()=>{s(!0)})}console.log("Updating map...")},[t,o]),h.exports.useEffect(()=>{if(console.log("Adding layers"),t&&i&&m!==n)if(console.log("Setting points in map!"),m){for(const l of m){const _=t.getSource(`point:${l.name}`);_!==void 0&&_.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${l.name}`)}y(void 0)}else{for(const l of n){let _=t.getSource(`point:${l.name}`);const F=_===void 0;F&&(t.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),_=t.getSource(`point:${l.name}`)),_!==void 0&&_.setData({type:"FeatureCollection",features:l.points.map((u,c)=>({type:"Feature",properties:{description:`<strong>${u.name}</strong><p>${u.description}</p>`,index:c,name:u.name},geometry:{type:"Point",coordinates:[u.longitude,u.latitude]}}))}),t.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":l.color,"circle-radius":6,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),F&&(t.on("mouseenter",`layer:point:${l.name}`,u=>{if(!u.features)return;const c=u.features[0];if(c.geometry.type==="Point"&&c.properties&&typeof c.properties.description=="string"){const g=[...c.geometry.coordinates],{description:v}=c.properties;for(;Math.abs(u.lngLat.lng-g[0])>180;)g[0]+=u.lngLat.lng>g[0]?360:-360;f.setLngLat(g).setHTML(v).addTo(t)}}),t.on("mouseleave",`layer:point:${l.name}`,()=>{f.remove()}),t.on("click",`layer:point:${l.name}`,u=>{if(!u.features||!l.clickPoint)return;const c=u.features[0];if(c.properties&&typeof c.properties.index=="number"&&typeof c.properties.name=="string"){const{index:g,name:v}=c.properties;l.clickPoint(g,v)}}))}y(n)}},[t,m,n,i,f]),d("div",{"data-testid":"map",className:"w-full h-full",ref:e})}function ie({folder:n,openFolder:e}){function t(){e()}return b("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[d("h3",{className:"text-lg font-bold",children:"Celeri UI"}),d("span",{"data-testid":"open-folder-topbar",children:n?b(Y,{children:["Working in ",n.name]}):d("button",{type:"button",onClick:t,"data-testid":"open-folder-button",children:"Open Folder"})})]})}function $(n){const e=n.split(/\n/g),t=e[0].split(","),a=e.slice(1),i=[];for(const s of a){const o=s.split(/\s*,\s*/),r={};for(let f=0;f<t.length;f+=1){let m=o[f];const y=t[f],l=Number.parseFloat(m);m=Number.isNaN(l)?m:l,typeof m=="string"&&m.startsWith('"')&&m.endsWith('"')&&(m=m.slice(1,-1)),r[y]=m}i.push(r)}return i}function j(n,e){const t=[e.join(",")];for(const a of n){const i=a;t.push(e.map(s=>s in i?typeof i[s]=="string"&&/\s/.test(`${i[s]}`)?`"${i[s]}"`:`${i[s]}`:"").join(","))}return t.join(`
`)}const E=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"];class se{constructor(e){p(this,"handle");p(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=$(e).map(i=>{const s={};for(const o of E)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=j((t=this.data)!=null?t:[],E);await this.handle.setContents(e)}}const ae={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function oe(n){return w(w({},ae),n)}class re{constructor(e){p(this,"handle");p(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=oe(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}}const z=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"];class le{constructor(e){p(this,"handle");p(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=$(e).map(i=>{const s={};for(const o of z)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=j((t=this.data)!=null?t:[],z);await this.handle.setContents(e)}}const I=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class ce{constructor(e){p(this,"handle");p(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=$(e).map(i=>{const s={};for(const o of I)s[o]=i[o]||(o==="name"?"":0);return s});this.data=a}async save(){var t;const e=j((t=this.data)!=null?t:[],I);await this.handle.setContents(e)}}async function R(n){const e=new le(n);return await e.initialize(),e}async function T(n){const e=new se(n);return await e.initialize(),e}async function A(n){const e=new ce(n);return await e.initialize(),e}async function de(n,e,t){const a=new re(e);if(await a.initialize(),a.data){const i=await R(await n.getFile(a.data.segment_file_name)),s=await T(await n.getFile(a.data.block_file_name)),o=await A(await n.getFile(a.data.station_file_name)),r=w({},t);return"command"in r&&(r.command=x(w({},r.command),{currentFilePath:e.name})),"segment"in r&&(r.segment=x(w({},r.segment),{currentFilePath:a.data.segment_file_name})),"block"in r&&(r.block=x(w({},r.block),{currentFilePath:a.data.block_file_name})),"velocities"in r&&(r.velocities=x(w({},r.velocities),{currentFilePath:a.data.station_file_name})),{openableFiles:r,commands:a,segments:i,blocks:s,velocities:o}}throw new Error("Can't open command file")}class pe{constructor(e){p(this,"name");p(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class O{constructor(e){p(this,"name");p(this,"handle");p(this,"fileList");p(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new pe(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),a=new O(t);return await a.initialize(),a}}const fe=async()=>{const n=await window.showDirectoryPicker(),e=new O(n);return await e.initialize(),e};class me{constructor(e,t){p(this,"name");p(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class P{constructor(e,t){p(this,"name");p(this,"parent");p(this,"fileList");p(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const a=t[e];for(const i of Object.keys(a))typeof a[i]=="string"?this.fileList.push(i):this.folderList.push(i)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new me(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new P(e,this.parent[this.name])}}const ue=async n=>new P("root",n);let V=async()=>{var e;return ue((e=window.FakeDirectory)!=null?e:{})};function he(n){V=n}async function _e(){return V()}window.location.search.includes("fake-dir")||he(fe);const ge={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",mesh:"Mesh"};function we(){const[n,e]=h.exports.useState(),[t,a]=h.exports.useState(""),[i,s]=h.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[o,r]=h.exports.useState(),[f,m]=h.exports.useState(),[y,l]=h.exports.useState(),[_,F]=h.exports.useState();let u=d("span",{});switch(t){case"files":u=n?d(ee,{folder:n,files:i,setFile:async(c,g,v)=>{if(v){let S=w({},i);switch(S[c]=x(w({},S[c]),{currentFilePath:g}),c){case"segment":m(await R(v));break;case"block":l(await T(v));break;case"velocity":F(await A(v));break;case"command":const k=await de(n,v,i);r(k.commands),m(k.segments),l(k.blocks),F(k.velocities),S=k.openableFiles;break}s(S)}}}):d("span",{});break}return b("div",{className:"w-screen h-screen flex flex-col",children:[d(ie,{folder:n,openFolder:async()=>{const c=await _e();e(c),a("files")}}),d(ne,{pointSources:[{name:"blocks",color:"blue",points:(y==null?void 0:y.data)?y.data.map(c=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:""})):[],clickPoint:(c,g)=>console.log(`Clicked ${c}: ${g}`)}]}),d(te,{view:u,buttons:n?ge:void 0,active:t,setActive:c=>a(c)})]})}function ye(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:i,onRegisterError:s}=n;let o;const r=async(f=!0)=>{};return"serviceWorker"in navigator&&(o=new G("./sw.js",{scope:"./"}),o.addEventListener("activated",f=>{f.isUpdate?window.location.reload():a==null||a()}),o.register({immediate:e}).then(f=>{i==null||i(f)}).catch(f=>{s==null||s(f)})),r}ye();const ve=1,be=new Z({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ve}}});U.render(d(h.exports.StrictMode,{children:d(K,{client:be,children:d(we,{})})}),document.querySelector("#root"));
