var Nt=Object.defineProperty,St=Object.defineProperties;var Ct=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var Dt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Y=(n,e,t)=>e in n?Nt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,u=(n,e)=>{for(var t in e||(e={}))Dt.call(e,t)&&Y(n,t,e[t]);if(Re)for(var t of Re(e))$t.call(e,t)&&Y(n,t,e[t]);return n},x=(n,e)=>St(n,Ct(e));var $=(n,e,t)=>(Y(n,typeof e!="symbol"?e+"":e,t),t);import{j as l,a as v,F as M,r as k,M as Ft,m as Oe,R as Vt,b as ee,u as Lt,c as jt,l as Be,d as te,e as V,f as Mt,g as It,h as Rt,v as Ot,Q as Bt,i as Pt,k as Et,P as At}from"./vendor.6cf141b2.js";const Tt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}};Tt();function Ht({value:n,fieldDefinition:e,setField:t}){const[s,a]=k.exports.useState(-1),[i,o]=k.exports.useState(n);return k.exports.useEffect(()=>{o(n)},[n]),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[l("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?l("span",{className:"text-sm",children:e.description}):l(M,{})]}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof n=="number"?"number":"text",value:i,onChange:d=>{const f=typeof n=="number"?Number.parseFloat(d.target.value):d.target.value;o(f),s>-1&&clearTimeout(s),a(setTimeout(()=>t(f),1e3))}})})]})}function Q({title:n,item:e,setItem:t,fieldDefinitions:s,ignoreFields:a,deletable:i,controls:o}){const d=Object.keys(e).map((f,m)=>{if(a==null?void 0:a.includes(f))return{element:l("span",{style:{display:"hidden"}},f),order:m+1e4};const b=e[f],r=f in s&&s[f];return r?{element:l(Ht,{value:b,fieldDefinition:r,setField:g=>t({[f]:g})},f),order:r.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":`input-title-${f}`,className:"text-l font-bold",children:f}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${f}`,className:"rounded w-full",type:typeof b=="number"?"number":"text",value:b,onChange:g=>{t({[f]:typeof b=="number"?Number.parseFloat(g.target.value):g.target.value})}})})]},f),order:m+1e3}}).sort((f,m)=>f.order-m.order).map(f=>f.element);return v("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[o,i?l("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):l(M,{})]})]}),d]})}Q.defaultProps={ignoreFields:[],controls:l(M,{})};const Wt={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var mt;const zt=JSON.parse((mt=window.localStorage.getItem("blockDisplaySettings"))!=null?mt:"false")||Wt;function Jt({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:i}){const o=m=>{e(m),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(m))},d=s[t],f=d?l(Q,{title:d.name,item:d,deletable:!0,setItem:m=>a(t,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):l(M,{});return v(M,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(x(u({},n),{hide:!n.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:m=>{o(x(u({},n),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:m=>{o(x(u({},n),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:m=>{o(x(u({},n),{radius:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Block"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Block"})]}),f]})}function qt({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const i=e[a];return v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[l("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:i.name}),l("span",{className:"text-sm","data-testid":`file-${a}-description`,children:i.description})]}),l("span",{className:"w-2/5 flex-shrink-0",children:v("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:i.currentFilePath,onChange:async o=>{const d=o.currentTarget.value;try{const f=await n.getFile(d);t(a,f.name,f)}catch{t(a,"")}},children:[l("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(o=>o.endsWith(i.extension)).map(o=>l("option",{value:o,"data-testid":`file-${a}-select-${o}`,children:o},o))]})})]},a)});return l("div",{className:"flex flex-col gap-2",children:s})}function Gt({view:n,buttons:e,active:t,setActive:s}){if(!e)return l("span",{});const a=[];for(const i of Object.keys(e)){const o=e[i],d=i===t;a.push(l("button",{type:"button","data-testid":`tab-${i}`,className:`${d?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>s(d?"":i),children:o},i))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?l("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm",children:n}):"",l("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}const Pe={lon:0,lat:0},Ut=180,J=360;function Ee(n){let{lon:e,lat:t}=n;for(;e<0;)e+=J;for(;e>J;)e-=J;return[e,t]}function ne([n,e]){return{lon:n<0?n+J:n,lat:e}}function Kt(n,e){const t=Ee(n),s=Ee(e),a=[s[0],s[1]];return s[0]-t[0]>=Ut?a[0]-=J:a[0]+=J,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const j=1e3;function P(n,e,t,s){const a=`${Math.floor(n.lon*j)},${Math.floor(n.lat*j)}`;if(a in e)return[e[a],s];const i=s;return t[i]=n,e[a]=i,[i,s+1]}function Ae(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*j)},${Math.floor(s.lat*j)}`,i=u({},n.vertecies);delete i[e];const o=u({},n.vertexDictionary);return delete o[a],x(u({},n),{vertecies:i,vertexDictionary:o})}return n}const E=Math.PI/6,A=2*Math.PI-E;function Qt(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:i,internalSelections:o},{arrowSources:d,selections:f}){if(t&&i&&a!==d)if(console.log("Setting arrows in map!"),a){for(const r of a){const g=t.getSource(`arrow:${r.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${r.name}`),t.removeLayer(`layer:arrow:${r.name}:click`)}e({internalArrowSources:void 0})}else{for(const r of d){let g=t.getSource(`arrow:${r.name}`);const C=g===void 0;C&&(t.addSource(`arrow:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`arrow:${r.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:r.arrows.map(p=>{const h=p.scale*r.scale,w=r.scale*r.arrowHeadScale,_=[p.longitude+p.direction[0]*h,p.latitude+p.direction[1]*h],N=[_[0]+(Math.cos(E)*-p.direction[0]-Math.sin(E)*-p.direction[1])*w,_[1]+(Math.sin(E)*-p.direction[0]+Math.cos(E)*-p.direction[1])*w],H=[_[0]+(Math.cos(A)*-p.direction[0]-Math.sin(A)*-p.direction[1])*w,_[1]+(Math.sin(A)*-p.direction[0]+Math.cos(A)*-p.direction[1])*w];return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:p.index===f[r.name]},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],_,N,_,H]}}})}),t.addLayer({id:`layer:arrow:${r.name}`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":r.width}}),t.addLayer({id:`layer:arrow:${r.name}:click`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),C&&(t.on("mouseenter",`layer:arrow:${r.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:arrow:${r.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${r.name}:click`,p=>{let h;if(n.state.internalArrowSources)for(const _ of n.state.internalArrowSources)h=_.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;h(_)}}))}e({internalArrowSources:d})}const m=u({},o);let b=!1;for(const r of Object.keys(f))if(f[r]!==o[r]){for(const g of d)if(g.name===r){b=!0,m[r]=f[r];const C=t==null?void 0:t.getSource(`arrow:${g.name}`);if(C){const p=f[r];C.setData({type:"FeatureCollection",features:g.arrows.map(h=>{const w=h.scale*g.scale,_=g.scale*g.arrowHeadScale,N=[h.longitude+h.direction[0]*w,h.latitude+h.direction[1]*w],H=[N[0]+(Math.cos(E)*-h.direction[0]-Math.sin(E)*-h.direction[1])*_,N[1]+(Math.sin(E)*-h.direction[0]+Math.cos(E)*-h.direction[1])*_],F=[N[0]+(Math.cos(A)*-h.direction[0]-Math.sin(A)*-h.direction[1])*_,N[1]+(Math.sin(A)*-h.direction[0]+Math.cos(A)*-h.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index===p},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],N,H,N,F]}}})})}}}b&&e({internalSelections:m})}function Xt(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:i},{drawnPointSource:o}){if(e&&a&&i!==o){console.log("Drawning Points"),n({internalDrawnPointSource:o});let d=t;if((o.selectedColor!==s.selectedColor||o.selectedRadius!==s.selectedRadius||o.color!==s.color||o.radius!==s.radius)&&(n({drawnPointSettings:{color:o.color,radius:o.radius,selectedRadius:o.selectedRadius,selectedColor:o.selectedColor}}),t&&(e.removeControl(t),d=void 0),o?(d=new Ft({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":o.selectedRadius,"circle-color":o.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":o.radius,"circle-color":o.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(d),n({draw:d})):d=void 0),d){const f=d.getAll(),m=o.points.length!==f.features.length?void 0:d.getSelected(),b={type:"FeatureCollection",features:o.points.map(r=>({type:"Feature",id:r.index.toString(),properties:{description:"",index:r.index,name:""},geometry:{type:"Point",coordinates:[r.longitude,r.latitude]}}))};if(d.set(b),m&&m.features.length>0&&m.features[0].properties&&typeof m.features[0].properties.index=="number"){const r=m.features[0].id;r&&d.changeMode("simple_select",{featureIds:[r]})}}}}function Zt(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:i,internalSelections:o},{lineSources:d,selections:f}){if(t&&i&&a!==d)if(console.log("Setting lines in map!"),a){for(const r of a){const g=t.getSource(`line:${r.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${r.name}`),t.removeLayer(`layer:line:${r.name}:click`)}e({internalLineSources:void 0})}else{for(const r of d){let g=t.getSource(`line:${r.name}`);const C=g===void 0;C&&(t.addSource(`line:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`line:${r.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:r.lines.map(p=>({type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:p.index===f[r.name]},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))}),t.addLayer({id:`layer:line:${r.name}`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":["case",["get","selected"],r.selectedWidth,r.width]}}),t.addLayer({id:`layer:line:${r.name}:click`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":r.width*10}}),C&&(t.on("mouseenter",`layer:line:${r.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="LineString"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[(h.geometry.coordinates[0][0]+h.geometry.coordinates[1][0])/2,(h.geometry.coordinates[0][1]+h.geometry.coordinates[1][1])/2],{description:_}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:line:${r.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${r.name}:click`,p=>{let h;if(n.state.internalLineSources)for(const _ of n.state.internalLineSources)h=_.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;h(_)}}))}e({internalLineSources:d})}const m=u({},o);let b=!1;for(const r of Object.keys(f))if(f[r]!==o[r]){for(const g of d)if(g.name===r){b=!0,m[r]=f[r];const C=t==null?void 0:t.getSource(`line:${g.name}`);if(C){const p=f[r];C.setData({type:"FeatureCollection",features:g.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index===p},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))})}}}b&&e({internalSelections:m})}function Yt(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:i,internalSelections:o},{pointSources:d,selections:f}){if(!t||!i)return;if(a!==d)if(console.log("Setting points in map!"),a){for(const r of a){const g=t.getSource(`point:${r.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${r.name}`)}e({internalPointSources:void 0})}else{for(const r of d){let g=t.getSource(`point:${r.name}`);const C=g===void 0;C&&(t.addSource(`point:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`point:${r.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:r.points.map(p=>({type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:p.index!==f[r.name]},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))}),t.addLayer({id:`layer:point:${r.name}`,type:"circle",source:`point:${r.name}`,paint:{"circle-color":["case",["get","selected"],r.color,r.selectedColor],"circle-radius":r.radius}}),C&&(t.on("mouseenter",`layer:point:${r.name}`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:point:${r.name}`,()=>{s.remove()}),t.on("click",`layer:point:${r.name}`,p=>{let h;if(n.state.internalPointSources)for(const _ of n.state.internalPointSources)h=_.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;h(_)}}))}e({internalPointSources:d})}const m=u({},o);let b=!1;for(const r of Object.keys(f))if(f[r]!==o[r]){for(const g of d)if(g.name===r){b=!0,m[r]=f[r];const C=t.getSource(`point:${g.name}`);if(C){const p=f[r];C.setData({type:"FeatureCollection",features:g.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index!==p},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}b&&e({internalSelections:m})}Oe.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class en extends Vt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:k.exports.createRef(),popup:new ee.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Oe.accessToken&&t){const s=new ee.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new ee.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:i}=this.props;i(ne([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:i}=this.props;i&&i(ne([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:i}=this.state;if(!i||!(i==null?void 0:i.select))return;const o=a[0];o&&o.type==="Feature"&&o.geometry.type==="Point"&&o.properties&&"index"in o.properties&&typeof o.properties.index=="number"&&i.select(o.properties.index)}),s.on("draw.modechange",({mode:a})=>{const{selections:i}=this.props,{draw:o}=this.state;a==="simple_select"&&i.drawnPoint&&o&&o.changeMode("direct_select",{featureId:`${i.drawnPoint}`})}),s.on("draw.update",({features:a,action:i})=>{const{internalDrawnPointSource:o}=this.state;if(!!(o==null?void 0:o.update)&&i==="move"&&a.length>0)for(const d of a)d.type==="Feature"&&d.geometry.type==="Point"&&d.properties&&"index"in d.properties&&typeof d.properties.index=="number"&&o.update(d.properties.index,ne(d.geometry.coordinates))})}}componentDidUpdate(){return Zt(this,e=>this.setState(e),this.state,this.props),Qt(this,e=>this.setState(e),this.state,this.props),Yt(this,e=>this.setState(e),this.state,this.props),Xt(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return l("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const tn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var ht;const nn=u(u({},tn),JSON.parse((ht=window.localStorage.getItem("segmentDisplaySettings"))!=null?ht:"{}"));function sn({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:i,splitSegment:o,setSelectionMode:d}){const f=r=>{e(r),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(r))},m=t[s],b=m?l(Q,{title:m.name,item:m,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:r=>a(s,r),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>o(s),children:"Split Segment"})}):l(M,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{f(x(u({},n),{hide:!n.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:r=>{f(x(u({},n),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:r=>{f(x(u({},n),{width:Number.parseFloat(r.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:r=>{f(x(u({},n),{activeColor:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:r=>{f(x(u({},n),{activeWidth:Number.parseFloat(r.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Segment"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{d({mode:"mapClick",label:"Select Segment Starting Point",callback:r=>{d({mode:"mapClick",label:"Select Segment End point",callback:g=>{i(r,g),d("normal")}})}})},children:"New Segment"})]}),b]})}const Te=()=>Lt(),X=jt;function an({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const i=Te(),[o,d]=X(f=>[f.main.past.length>0,f.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[l("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?l("button",{type:"button",onClick:()=>{i(Be.ActionCreators.undo())},"data-testid":"undo-button",disabled:!o,children:"Undo"}):l(M,{}),n?l("button",{type:"button",onClick:()=>{i(Be.ActionCreators.redo())},disabled:!d,"data-testid":"undo-button",children:"Redo"}):l(M,{}),n?v("span",{children:["Working in ",n.name]}):l("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?l("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):l(M,{})]})]})}const on={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var pt;const rn=JSON.parse((pt=window.localStorage.getItem("velocityDisplaySettings"))!=null?pt:"false")||on;function ln({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:i}){const o=m=>{e(m),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(m))},d=s[t],f=d?l(Q,{title:d.name,item:d,deletable:!0,setItem:m=>a(t,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):l(M,{});return v(M,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(x(u({},n),{hide:!n.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:m=>{o(x(u({},n),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:m=>{o(x(u({},n),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Scale"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:m=>{o(x(u({},n),{scale:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:m=>{o(x(u({},n),{width:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Arrow Head Size"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:m=>{o(x(u({},n),{arrowHead:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Velocity"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Velocity"})]}),f]})}const cn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var gt;const dn=u(u({},cn),JSON.parse((gt=window.localStorage.getItem("vertexDisplaySettings"))!=null?gt:"{}"));function un({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:i,mergeVertices:o,bridgeVertices:d,extrudeVertex:f}){const m=g=>{e(g),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(g))},b=t[s],r=b?l(Q,{title:"Selected Vertex",item:b,ignoreFields:[],deletable:!1,setItem:g=>a(s,u(u({},b),g)),fieldDefinitions:{},controls:v(M,{children:[l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:g=>{o(s,g),i("normal")}})},children:"Merge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:g=>{d(s,g),i("normal")}})},children:"Bridge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:g=>{f(s,g),i("normal")}})},children:"Extrude"})]})}):l(M,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{m(x(u({},n),{hide:!n.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:g=>{m(x(u({},n),{color:g.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:g=>{m(x(u({},n),{radius:Number.parseFloat(g.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:g=>{m(x(u({},n),{activeColor:g.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:g=>{m(x(u({},n),{activeRadius:Number.parseFloat(g.target.value)}))}})})]}),r]})}const He=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],We={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function fn(n){return n?u(u({},We),n):u({},We)}function mn(n,{data:e}){return[...n,fn(e)]}function hn(n,e){const t=[...n];return t.splice(e,1),t}function pn(n,e){const t=[...n],s=u(u({},t[e.index]),e.data);return t[e.index]=s,t}function gn(n,e){return e}function yn(n,{index:e,position:t}){const s=[...n],a=u({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const xn=[],ze=V("createBlock"),Je=V("editBlock"),qe=V("deleteBlock"),se=V("loadNewBlockData"),Ge=V("moveBlock"),vn=te(xn,n=>{n.addCase(ze,(e,t)=>mn(e,t.payload)).addCase(Je,(e,t)=>pn(e,t.payload)).addCase(qe,(e,t)=>hn(e,t.payload)).addCase(se,(e,t)=>gn(e,t.payload)).addCase(Ge,(e,t)=>yn(e,t.payload))}),Ue=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],q={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function bn(n,{a:e,b:t}){const s=x(u({},q),{start:e,end:t}),a=[...n.segments,s];return x(u({},n),{segments:a})}function wn(n,e){const t=u({},n.vertecies),s=u({},n.vertexDictionary),{lastIndex:a}=n,[i,o]=P(e.start,s,t,a),[d,f]=P(e.end,s,t,o),m=x(u({},q),{start:i,end:d}),b=[...n.segments,m];return{vertecies:t,vertexDictionary:s,segments:b,lastIndex:f}}function _n(n,e){const t=[...n.segments],s=t.splice(e.index,1)[0];return Ae(Ae(x(u({},n),{segments:t}),s.start),s.end)}function kn(n,e){const t=[...n.segments],s=u(u({},t[e.index]),e.data);return t[e.index]=s,x(u({},n),{segments:t})}function Nn(n,e){const t=u({},n.vertecies),s=u({},n.vertexDictionary),[a,i]=P(e.targetPoint,s,t,n.lastIndex),o=x(u({},q),{start:e.index,end:a}),d=[...n.segments,o];return{vertecies:t,vertexDictionary:s,segments:d,lastIndex:i}}function Sn(n,e){return e}function Cn(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(f=>{let m=f;return m.start===t&&(m=x(u({},m),{start:e})),m.end===t&&(m=x(u({},m),{end:e})),m}).filter(f=>f.start!==f.end),a=n.vertecies[t],i=`${Math.floor(a.lon*j)},${Math.floor(a.lat*j)}`,o=u({},n.vertecies);delete o[t];const d=u({},n.vertexDictionary);return delete d[i],x(u({},n),{vertecies:o,vertexDictionary:d,segments:s})}function Dn(n,{index:e,vertex:t}){const s=u({},n.vertecies),a=u({},n.vertexDictionary),i=[...n.segments],o=s[e],d=`${Math.floor(t.lon*j)},${Math.floor(t.lat*j)}`,f=`${Math.floor(o.lon*j)},${Math.floor(o.lat*j)}`;if(delete a[f],d in a){const m=a[d];for(const b of i)b.start===m&&(b.start=e),b.end===m&&(b.end=e);delete s[m]}return s[e]=t,x(u({},n),{segments:i,vertecies:s,vertexDictionary:a})}function $n(n,e){const t=n.segments[e],s=n.vertecies[t.start],a=n.vertecies[t.end],i={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},o=u({},n.vertecies),d=u({},n.vertexDictionary),[f,m]=P(i,d,o,n.lastIndex),b=x(u({},t),{end:f,name:`${t.name}_a`}),r=x(u({},t),{start:f,name:`${t.name}_b`}),g=[...n.segments];return g[e]=b,g.push(r),{vertecies:o,vertexDictionary:d,segments:g,lastIndex:m}}const Fn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},Ke=V("bridgeVertices"),Qe=V("createSegmet"),Xe=V("deleteSegment"),Ze=V("editSegmentData"),Ye=V("extrudeSegment"),ae=V("loadNewSegmentData"),et=V("mergeVertices"),oe=V("moveVertex"),tt=V("splitSegment"),Vn=te(Fn,n=>{n.addCase(Ke,(e,t)=>bn(e,t.payload)).addCase(Qe,(e,t)=>wn(e,t.payload)).addCase(Xe,(e,t)=>_n(e,t.payload)).addCase(Ze,(e,t)=>kn(e,t.payload)).addCase(Ye,(e,t)=>Nn(e,t.payload)).addCase(ae,(e,t)=>Sn(e,t.payload)).addCase(et,(e,t)=>Cn(e,t.payload)).addCase(oe,(e,t)=>Dn(e,t.payload)).addCase(tt,(e,t)=>$n(e,t.payload))}),nt=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Ln={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function jn(n){return u(u({},Ln),n)}function Mn(n,{data:e}){return[...n,jn(e)]}function In(n,e){const t=[...n];return t.splice(e,1),t}function Rn(n,e){const t=[...n],s=u(u({},t[e.index]),e.data);return t[e.index]=s,t}function On(n,e){return e}function Bn(n,{index:e,position:t}){const s=[...n],a=u(u({},s[e]),t);return s[e]=a,s}const Pn=[],st=V("createVelocity"),at=V("editVelocity"),ot=V("deleteVelocity"),ie=V("loadNewVelocityData"),it=V("moveVelocity"),En=te(Pn,n=>{n.addCase(st,(e,t)=>Mn(e,t.payload)).addCase(at,(e,t)=>Rn(e,t.payload)).addCase(ot,(e,t)=>In(e,t.payload)).addCase(ie,(e,t)=>On(e,t.payload)).addCase(it,(e,t)=>Bn(e,t.payload))});function re(n){const e=n.split(/\n/g),t=e[0].split(","),s=e.slice(1),a=[];for(const i of s)if(i.trim()!==""){const o=i.split(/\s*,\s*/),d={};for(let f=0;f<t.length;f+=1){let m=o[f];const b=t[f],r=Number.parseFloat(m);m=Number.isNaN(r)?m:r,typeof m=="string"&&m.startsWith('"')&&m.endsWith('"')&&(m=m.slice(1,-1)),d[b]=m}a.push(d)}return a}function le(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(i=>i in a?typeof a[i]=="string"&&/\s/.test(`${a[i]}`)?`"${a[i]}"`:`${a[i]}`:"").join(","))}return t.join(`
`)}class ce{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(a=>{const i={};for(const o of He)i[o]=a[o]||(o==="name"?"":0);return i});this.data=s}async save(){var t;const e=le((t=this.data)!=null?t:[],He);await this.handle.setContents(e)}clone(){return new ce(this.handle)}}const An={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Tn(n){return u(u({},An),n)}class de{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Tn(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new de(this.handle)}}class ue{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(f=>{const m={};for(const b of Ue)m[b]=f[b]||(b==="name"?"":0);return m}),a={},i={},o=[];let d=0;for(const f of s){const[m,b]=P({lon:f.lon1,lat:f.lat1},a,i,d),[r,g]=P({lon:f.lon2,lat:f.lat2},a,i,b),C=x(u({},f),{start:m,end:r});d=g,o.push(C)}this.data={vertecies:i,segments:o,vertexDictionary:a,lastIndex:d}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(i=>{const o=s[i.start],d=s[i.end];return x(u({},i),{lon1:o.lon,lat1:o.lat,lon2:d.lon,lat2:d.lat})})}const t=le(e,Ue);await this.handle.setContents(t)}clone(){return new ue(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*j)},${Math.floor(s.lat*j)}`,i=u({},this.data.vertecies);delete i[e];const o=u({},this.data.vertexDictionary);delete o[a];const d=this.clone();return d.data=x(u({},this.data),{vertecies:i,vertexDictionary:o}),d}}return this}mergeVertices(e,t){if(this.data){for(const f of this.data.segments)f.start===t&&(f.start=e),f.end===t&&(f.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*j)},${Math.floor(s.lat*j)}`,i=u({},this.data.vertecies);delete i[t];const o=u({},this.data.vertexDictionary);delete o[a];const d=this.clone();return d.data=x(u({},this.data),{vertecies:i,vertexDictionary:o}),d}return this}moveVertex(e,t){if(this.data){const s=u({},this.data.vertecies),a=u({},this.data.vertexDictionary),i=[...this.data.segments],o=s[e],d=`${Math.floor(t.lon*j)},${Math.floor(t.lat*j)}`,f=`${Math.floor(o.lon*j)},${Math.floor(o.lat*j)}`;if(delete a[f],d in a){const b=a[d];for(const r of i)r.start===b&&(r.start=e),r.end===b&&(r.end=e);delete s[b]}s[e]=t;const m=this.clone();return m.data=x(u({},this.data),{segments:i,vertecies:s,vertexDictionary:a}),m}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],i={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[o,d]=P(i,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),f=x(u({},t),{end:o,name:`${t.name}_a`}),m=x(u({},t),{start:o,name:`${t.name}_b`}),b=[...this.data.segments];b[e]=f,b.push(m);const r=this.clone();return r.data=x(u({},this.data),{segments:b,lastIndex:d}),r}return this}bridgeVertices(e,t){if(this.data){const s=x(u({},q),{start:e,end:t}),a=[...this.data.segments,s],i=this.clone();return i.data=x(u({},this.data),{segments:a}),i}return this}extrudeSegment(e,t){if(this.data){const s=u({},this.data.vertecies),a=u({},this.data.vertexDictionary),[i,o]=P(t,a,s,this.data.lastIndex),d=x(u({},q),{start:e,end:i}),f=[...this.data.segments,d],m=this.clone();return m.data={vertecies:s,vertexDictionary:a,segments:f,lastIndex:o},m}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=x(u({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=u({},this.data.vertecies),a=u({},this.data.vertexDictionary),[i,o]=P(e,a,s,this.data.lastIndex),[d,f]=P(t,a,s,o),m=x(u({},q),{start:i,end:d}),b=[...this.data.segments,m],r=this.clone();return r.data={vertecies:s,vertexDictionary:a,segments:b,lastIndex:f},r}return this}}class fe{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(a=>{const i={};for(const o of nt)i[o]=a[o]||(o==="name"?"":0);return i});this.data=s}async save(){var t;const e=le((t=this.data)!=null?t:[],nt);await this.handle.setContents(e)}clone(){return new fe(this.handle)}}async function rt(n){const e=new ue(n);return await e.initialize(),e}async function lt(n){const e=new ce(n);return await e.initialize(),e}async function ct(n){const e=new fe(n);return await e.initialize(),e}async function Hn(n,e,t){const s=new de(e);if(await s.initialize(),s.data){const a=await rt(await n.getFile(s.data.segment_file_name)),i=await lt(await n.getFile(s.data.block_file_name)),o=await ct(await n.getFile(s.data.station_file_name)),d=u({},t);return"command"in d&&(d.command=x(u({},d.command),{currentFilePath:e.name})),"segment"in d&&(d.segment=x(u({},d.segment),{currentFilePath:s.data.segment_file_name})),"block"in d&&(d.block=x(u({},d.block),{currentFilePath:s.data.block_file_name})),"velocities"in d&&(d.velocities=x(u({},d.velocities),{currentFilePath:s.data.station_file_name})),{openableFiles:d,commands:s,segments:a,blocks:i,velocities:o}}throw new Error("Can't open command file")}class Wn{constructor(e){$(this,"name");$(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class me{constructor(e){$(this,"name");$(this,"handle");$(this,"fileList");$(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Wn(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new me(t);return await s.initialize(),s}}const zn=async()=>{const n=await window.showDirectoryPicker(),e=new me(n);return await e.initialize(),e};class Jn{constructor(e,t){$(this,"name");$(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class he{constructor(e,t){$(this,"name");$(this,"parent");$(this,"fileList");$(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Jn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new he(e,this.parent[this.name])}}const qn=async n=>new he("root",n);let dt=async()=>{var e;return qn((e=window.FakeDirectory)!=null?e:{})};function Gn(n){dt=n}async function Un(){return dt()}window.location.search.includes("fake-dir")||Gn(zn);var ut;(function(n){n[n.Vertex=0]="Vertex",n[n.Block=1]="Block",n[n.Velocity=2]="Velocity"})(ut||(ut={}));const ft={Block:1,Vertex:0,Velocity:2},Kn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function Qn(){var Ve,Le,je;const n=Te(),[e,t]=k.exports.useState(),[s,a]=k.exports.useState(""),[i,o]=k.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[d,f]=k.exports.useState(),[m,b]=k.exports.useState(),[r,g]=k.exports.useState(),[C,p]=k.exports.useState(),h=X(c=>c.main.present.segment),w=X(c=>c.main.present.block),_=X(c=>c.main.present.velocity),[N,H]=k.exports.useState(rn),[F,pe]=k.exports.useState(zt),[B,ge]=k.exports.useState(nn),[D,ye]=k.exports.useState(dn),[R,T]=k.exports.useState("normal"),[W,yt]=k.exports.useState(0),[xe,ve]=k.exports.useState(-1),[be,we]=k.exports.useState(-1),[_e,ke]=k.exports.useState(-1),[Ne,Se]=k.exports.useState(-1),[L,ts]=k.exports.useState({select:(c,y)=>{ve(c==="block"?y:-1),we(c==="segment"?y:-1),ke(c==="velocities"?y:-1),Se(c==="vertex"?y:-1),a(c)}}),[xt,vt]=k.exports.useState([]),[bt,Ce]=k.exports.useState([]),[wt,De]=k.exports.useState([]),[_t,Z]=k.exports.useState({color:D.color,selectedColor:D.activeColor,radius:D.radius,selectedRadius:D.activeRadius,points:[]}),[$e,kt]=k.exports.useState({lon:0,lat:0});k.exports.useEffect(()=>{R==="normal"?L.select=(c,y)=>{ve(c==="block"?y:-1),we(c==="segment"?y:-1),ke(c==="velocities"?y:-1),Se(c==="vertex"?y:-1),a(c)}:R.mode==="override"?L.select=(c,y)=>{c===R.type&&R.callback(y)}:L.select=()=>{}},[R,L]),k.exports.useEffect(()=>{const c=[];W!==1&&!F.hide&&c.push({name:"blocks",color:F.color,selectedColor:F.selectedColor,radius:F.radius,points:w.map((y,S)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:S})),click:y=>{L.select("block",y)}}),W!==0&&!D.hide&&c.push({name:"vertices",color:D.color,selectedColor:D.activeColor,radius:D.radius,click:y=>{L.select("vertex",y)},points:Object.keys(h.vertecies).map(y=>{const S=Number.parseInt(y,10),O=h.vertecies[S];return O?{longitude:O.lon,latitude:O.lat,index:S,name:"",description:""}:!1}).filter(y=>!!y)}),vt(c)},[F,w,B,L,W,D.hide,D.color,D.activeColor,D.radius,h.vertecies]),k.exports.useEffect(()=>{B.hide?De([]):De([{name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:h.segments.map((c,y)=>{var Me,Ie;const S=(Me=h.vertecies[c.start])!=null?Me:Pe,O=(Ie=h.vertecies[c.end])!=null?Ie:Pe,[[G,U],[K,I]]=Kt(S,O);return{startLongitude:G,startLatitude:U,endLongitude:K,endLatitude:I,name:c.name,description:`${S.lon},${S.lat} to ${O.lon},${O.lat}`,index:y}}),click:c=>{L.select("segment",c)}}])},[h,B,L]),k.exports.useEffect(()=>{switch(W){case 0:{Z({color:D.color,radius:D.radius,selectedColor:D.activeColor,selectedRadius:D.activeRadius,points:D.hide?[]:Object.keys(h.vertecies).map(c=>{const y=Number.parseInt(c,10),S=h.vertecies[y];return S?{longitude:S.lon,latitude:S.lat,index:y}:!1}).filter(c=>!!c),update:(c,y)=>{n(oe({index:c,vertex:y}))},select:c=>{L.select("vertex",c)}});break}case 1:{Z({color:F.color,radius:F.radius,selectedColor:F.selectedColor,selectedRadius:F.radius,points:F.hide?[]:w.map((c,y)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:y})),update:(c,y)=>{n(Ge({index:c,position:y}))},select:c=>{L.select("block",c)}});break}case 2:{Z({color:N.color,radius:N.width,selectedColor:N.selectedColor,selectedRadius:N.width,points:N.hide?[]:_.map((c,y)=>({longitude:c.lon,latitude:c.lat,name:c.name,description:"",index:y})),update:(c,y)=>{n(it({index:c,position:y}))},select:c=>{L.select("velocities",c)}});break}}},[D,L,h.vertecies,n,W,F.color,F.radius,F.selectedColor,F.hide,w,N.color,N.width,N.selectedColor,N.hide,_]),k.exports.useEffect(()=>{N.hide?Ce([]):Ce([{name:"velocities",color:N.color,selectedColor:N.selectedColor,scale:N.scale,arrowHeadScale:N.arrowHead,width:N.width,arrows:_.map((c,y)=>{const S=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/S,c.north_vel/S],scale:S,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`,index:y}}),click:c=>{L.select("velocities",c)}}])},[L,N,_]);let z=l("span",{});switch(s){case"files":z=e?l(qt,{folder:e,files:i,setFile:async(c,y,S)=>{if(S){let O=u({},i);switch(O[c]=x(u({},O[c]),{currentFilePath:y}),c){case"segment":const G=await rt(S);b(G),G.data&&n(ae(G.data));break;case"block":const U=await lt(S);g(U),U.data&&n(se(U.data));break;case"velocity":const K=await ct(S);p(K),K.data&&n(ie(K.data));break;case"command":const I=await Hn(e,S,i);f(I.commands),b(I.segments),I.segments.data&&n(ae(I.segments.data)),g(I.blocks),I.blocks.data&&n(se(I.blocks.data)),p(I.velocities),I.velocities.data&&n(ie(I.velocities.data)),O=I.openableFiles;break}o(O)}}}):l("span",{});break;case"velocities":z=l(ln,{settings:N,setSettings:H,selected:_e,velocitys:_,setVelocityData:(c,y)=>{n(y?at({index:c,data:y}):ot(c))},addNewVelocity:()=>{T({label:"Click to place velocity estimate",mode:"mapClick",callback:c=>{T("normal");const y=_.length;n(st({data:{lat:c.lat,lon:c.lon}})),L.select("velocity",y)}})}});break;case"block":z=l(Jt,{settings:F,setSettings:pe,selected:xe,blocks:w,addNewBlock:()=>{T({label:"Click to place new block",mode:"mapClick",callback:c=>{const y=w.length;n(ze({data:{name:"New Block",interior_lon:c.lon,interior_lat:c.lat}})),L.select("block",y),T("normal")}})},setBlockData:(c,y)=>{n(y?Je({index:c,data:y}):qe(c))}});break;case"segment":z=l(sn,{settings:B,setSettings:ge,segments:(Ve=h.segments)!=null?Ve:[],selected:be,setSelectionMode:c=>T(c),addNewSegment:(c,y)=>{const S=h.segments.length;n(Qe({start:c,end:y})),L.select("segment",S)},setSegmentData:(c,y)=>{n(y?Ze({index:c,data:y}):Xe({index:c}))},splitSegment:c=>{n(tt(c))}});break;case"vertex":z=l(un,{settings:D,setSettings:ye,vertices:(Le=h.vertecies)!=null?Le:{},selected:Ne,setVertexData:(c,y)=>{y&&n(oe({index:c,vertex:y}))},setSelectionMode:c=>T(c),mergeVertices:(c,y)=>{n(et({a:c,b:y}))},bridgeVertices:(c,y)=>{n(Ke({a:c,b:y}))},extrudeVertex:(c,y)=>{n(Ye({index:c,targetPoint:y}))}});break}const Fe={Block:{state:F.hide,change:()=>{pe(x(u({},F),{hide:!F.hide}))}},Vertex:{state:D.hide,change:()=>{ye(x(u({},D),{hide:!D.hide}))}},Velocity:{state:N.hide,change:()=>{H(x(u({},N),{hide:!N.hide}))}},Sement:{state:B.hide,change:()=>{ge(x(u({},B),{hide:!B.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:c=>{c.key==="Escape"&&T("normal")},children:[l(an,{filesOpen:((je=d!=null?d:m)!=null?je:r)!==void 0,saveFiles:async()=>{d&&await d.save(),m&&(m.data=h,await m.save()),r&&(r.data=w,await r.save()),C&&(C.data=_,await C.save())},folder:e,openFolder:async()=>{const c=await Un();t(c),a("files")}}),R!=="normal"?l("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:v("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[l("span",{className:"text-lg font-semibold",children:R.label}),R.subtitle?l("span",{className:"text-md font-thin text-gray-500",children:R.subtitle}):l(M,{}),l("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):l(M,{}),v("div",{className:"absolute bottom-0 left-2 flex flex-col bg-white rounded-t p-2 gap-5 shadow-sm z-50",children:[v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor($e.lon*1e3)/1e3,","," ",Math.floor($e.lon*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[l("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(ft).map(c=>{const y=ft[c];return l("button",{type:"button",className:`${W===y?"bg-gray-200":"bg-white"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{yt(y)},children:c},c)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Fe).map(c=>{const y=Fe[c];return l("button",{type:"button",className:`${y.state?"bg-white":"bg-gray-200"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{y.change()},children:c},c)})]})]}),l(en,{pointSources:xt,arrowSources:bt,lineSources:wt,drawnPointSource:_t,selections:{segments:be,blocks:xe,velocities:_e,drawnPoint:Ne},click:c=>{typeof R!="string"&&R.mode==="mapClick"&&R.callback(c)},mouseMove:c=>{kt(c)}}),l(Gt,{view:z,buttons:e?Kn:void 0,active:s,setActive:c=>a(c)})]})}const Xn=Mt({reducer:{main:It(Rt({segment:Vn,block:vn,velocity:En}))}});function Zn(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:i}=n;let o;const d=async(f=!0)=>{};return"serviceWorker"in navigator&&(o=new Ot("./sw.js",{scope:"./"}),o.addEventListener("activated",f=>{f.isUpdate?window.location.reload():s==null||s()}),o.register({immediate:e}).then(f=>{a==null||a(f)}).catch(f=>{i==null||i(f)})),d}Zn();const Yn=1,es=new Bt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Yn}}});Pt.render(l(k.exports.StrictMode,{children:l(Et,{client:es,children:l(At,{store:Xn,children:l(Qn,{})})})}),document.querySelector("#root"));
