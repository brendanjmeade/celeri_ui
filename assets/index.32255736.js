var et=Object.defineProperty,tt=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var de=(o,e,s)=>e in o?et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s,h=(o,e)=>{for(var s in e||(e={}))nt.call(e,s)&&de(o,s,e[s]);if(Me)for(var s of Me(e))st.call(e,s)&&de(o,s,e[s]);return o},$=(o,e)=>tt(o,at(e));var V=(o,e,s)=>(de(o,typeof e!="symbol"?e+"":e,s),s);import{j as ue,m as Ee,r as w,a as fe,M as ot,v as it,Q as rt,R as lt,b as ct}from"./vendor.2c6bff34.js";const dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&t(f)}).observe(document,{childList:!0,subtree:!0});function s(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerpolicy&&(c.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?c.credentials="include":a.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(a){if(a.ep)return;a.ep=!0;const c=s(a);fetch(a.href,c)}};dt();const i=ue.exports.jsx,b=ue.exports.jsxs,A=ue.exports.Fragment;function ut({value:o,fieldDefinition:e,setField:s}){return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(A,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof o=="number"?"number":"text",value:o,onChange:t=>{s(typeof o=="number"?Number.parseFloat(t.target.value):t.target.value)}})})]})}function ee({title:o,item:e,setItem:s,fieldDefinitions:t,ignoreFields:a,deletable:c,controls:f}){const n=Object.keys(e).map((l,u)=>{if(a==null?void 0:a.includes(l))return{element:i("span",{style:{display:"hidden"}},l),order:u+1e4};const v=e[l],_=l in t&&t[l];return _?{element:i(ut,{value:v,fieldDefinition:_,setField:y=>s({[l]:y})},l),order:_.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${l}`,className:"text-l font-bold",children:l}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${l}`,className:"rounded w-full",type:typeof v=="number"?"number":"text",value:v,onChange:y=>{s({[l]:typeof v=="number"?Number.parseFloat(y.target.value):y.target.value})}})})]},l),order:u+1e3}}).sort((l,u)=>l.order-u.order).map(l=>l.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:o}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[f,c?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{s()},children:"Delete"}):i(A,{})]})]}),n]})}ee.defaultProps={ignoreFields:[],controls:i(A,{})};const ft={color:"#0000ff",selectedColor:"#ff0000",radius:6};var qe;const mt=JSON.parse((qe=window.localStorage.getItem("blockDisplaySettings"))!=null?qe:"false")||ft;function pt({settings:o,setSettings:e,selected:s,blocks:t,setBlockData:a,addNewBlock:c}){const f=u=>{e(u),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(u))},n=t[s],l=n?i(ee,{title:n.name,item:n,deletable:!0,setItem:u=>a(s,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(A,{});return b(A,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:u=>{f($(h({},o),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.selectedColor,onChange:u=>{f($(h({},o),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:o.radius,onChange:u=>{f($(h({},o),{radius:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:c,children:"New Block"})]}),l]})}function ht({folder:o,files:e,setFile:s}){const t=Object.keys(e).map(a=>{const c=e[a];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:c.name}),i("span",{className:"text-sm","data-testid":`file-${a}-description`,children:c.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:c.currentFilePath,onChange:async f=>{const n=f.currentTarget.value;try{const l=await o.getFile(n);s(a,l.name,l)}catch{s(a,"")}},children:[i("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),o.fileList.filter(f=>f.endsWith(c.extension)).map(f=>i("option",{value:f,"data-testid":`file-${a}-select-${f}`,children:f},f))]})})]},a)});return i("div",{className:"flex flex-col gap-2",children:t})}function gt({view:o,buttons:e,active:s,setActive:t}){if(!e)return i("span",{});const a=[];for(const c of Object.keys(e)){const f=e[c],n=c===s;a.push(i("button",{type:"button","data-testid":`tab-${c}`,className:`${n?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>t(n?"":c),children:f},c))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[s?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm",children:o}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}function me(o){const e=o.split(/\n/g),s=e[0].split(","),t=e.slice(1),a=[];for(const c of t){const f=c.split(/\s*,\s*/),n={};for(let l=0;l<s.length;l+=1){let u=f[l];const v=s[l],_=Number.parseFloat(u);u=Number.isNaN(_)?u:_,typeof u=="string"&&u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1)),n[v]=u}a.push(n)}return a}function pe(o,e){const s=[e.join(",")];for(const t of o){const a=t;s.push(e.map(c=>c in a?typeof a[c]=="string"&&/\s/.test(`${a[c]}`)?`"${a[c]}"`:`${a[c]}`:"").join(","))}return s.join(`
`)}const Ie=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],he={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Oe={lon:0,lat:0},yt=180,K=360;function Re(o){let{lon:e,lat:s}=o;for(;e<0;)e+=K;for(;e>K;)e-=K;return[e,s]}function Pe([o,e]){return{lon:o<0?o+K:o,lat:e}}function vt(o,e){const s=Re(o),t=Re(e),a=[t[0],t[1]];return t[0]-s[0]>=yt?a[0]-=K:a[0]+=K,Math.abs(s[0]-t[0])>Math.abs(s[0]-a[0])?[s,a]:[s,t]}const H=1e3;let Ae=0;function Z(o,e,s){const t=`${Math.floor(o.lon*H)},${Math.floor(o.lat*H)}`;if(t in e)return e[t];const a=Ae;return Ae+=1,s[a]=o,e[t]=a,a}class ge{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=me(e).map(n=>{const l={};for(const u of Ie)l[u]=n[u]||(u==="name"?"":0);return l}),a={},c={},f=[];for(const n of t){const l=Z({lon:n.lon1,lat:n.lat1},a,c),u=Z({lon:n.lon2,lat:n.lat2},a,c),v=$(h({},n),{start:l,end:u});f.push(v)}this.data={vertecies:c,segments:f,vertexDictionary:a}}async save(){let e=[];if(this.data){const{vertecies:t,segments:a}=this.data;e=a.map(c=>{const f=t[c.start],n=t[c.end];return $(h({},c),{lon1:f.lon,lat1:f.lat,lon2:n.lon,lat2:n.lat})})}const s=pe(e,Ie);await this.handle.setContents(s)}clone(){return new ge(this.handle)}tryRemoveVertex(e){if(this.data){let s=!1;for(const t of this.data.segments)if(t.start===e||t.end===e){s=!0;break}if(!s&&this.data.vertecies[e]){const t=this.data.vertecies[e],a=`${Math.floor(t.lon*H)},${Math.floor(t.lat*H)}`,c=h({},this.data.vertecies);delete c[e];const f=h({},this.data.vertexDictionary);delete f[a];const n=this.clone();return n.data=$(h({},this.data),{vertecies:c,vertexDictionary:f}),n}}return this}mergeVertices(e,s){if(this.data){for(const l of this.data.segments)l.start===s&&(l.start=e),l.end===s&&(l.end=e);const t=this.data.vertecies[s],a=`${Math.floor(t.lon*H)},${Math.floor(t.lat*H)}`,c=h({},this.data.vertecies);delete c[s];const f=h({},this.data.vertexDictionary);delete f[a];const n=this.clone();return n.data=$(h({},this.data),{vertecies:c,vertexDictionary:f}),n}return this}moveVertex(e,s){if(this.data){const t=h({},this.data.vertecies),a=h({},this.data.vertexDictionary),c=[...this.data.segments],f=t[e],n=`${Math.floor(s.lon*H)},${Math.floor(s.lat*H)}`,l=`${Math.floor(f.lon*H)},${Math.floor(f.lat*H)}`;if(delete a[l],n in a){const v=a[n];for(const _ of c)_.start===v&&(_.start=e),_.end===v&&(_.end=e);delete t[v]}t[e]=s;const u=this.clone();return u.data={segments:c,vertecies:t,vertexDictionary:a},u}return this}splitSegment(e){if(this.data){const s=this.data.segments[e],t=this.data.vertecies[s.start],a=this.data.vertecies[s.end],c={lon:(t.lon+a.lon)/2,lat:(t.lat+a.lat)/2},f=Z(c,this.data.vertexDictionary,this.data.vertecies),n=$(h({},s),{end:f,name:`${s.name}_a`}),l=$(h({},s),{start:f,name:`${s.name}_b`}),u=[...this.data.segments];u[e]=n,u.push(l);const v=this.clone();return v.data=$(h({},this.data),{segments:u}),v}return this}bridgeVertices(e,s){if(this.data){const t=$(h({},he),{start:e,end:s}),a=[...this.data.segments,t],c=this.clone();return c.data=$(h({},this.data),{segments:a}),c}return this}extrudeSegment(e,s){if(this.data){const t=h({},this.data.vertecies),a=h({},this.data.vertexDictionary),c=Z(s,a,t),f=$(h({},he),{start:e,end:c}),n=[...this.data.segments,f],l=this.clone();return l.data={vertecies:t,vertexDictionary:a,segments:n},l}return this}deleteSegment(e){if(this.data){const s=[...this.data.segments],t=s.splice(e,1)[0],a=this.clone();return a.data=$(h({},this.data),{segments:s}),a.tryRemoveVertex(t.start).tryRemoveVertex(t.end)}return this}createSegment(e,s){if(this.data){const t=h({},this.data.vertecies),a=h({},this.data.vertexDictionary),c=Z(e,a,t),f=Z(s,a,t),n=$(h({},he),{start:c,end:f}),l=[...this.data.segments,n],u=this.clone();return u.data={vertecies:t,vertexDictionary:a,segments:l},u}return this}}Ee.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const J=Math.PI/6,X=2*Math.PI-J,G={};function xt({pointSources:o,arrowSources:e,lineSources:s,selections:t,drawnPointSource:a,click:c}){const f=w.exports.useRef(null),[n,l]=w.exports.useState(),[u,v]=w.exports.useState(!1),[_,y]=w.exports.useState(),[I]=w.exports.useState(new fe.exports.Popup({closeButton:!1,closeOnClick:!1})),[O,te]=w.exports.useState(),[T,ae]=w.exports.useState(),[R,ne]=w.exports.useState(),[M,le]=w.exports.useState({source:void 0}),[E,W]=w.exports.useState({selectedColor:"",selectedRadius:0,color:"",radius:0}),[P,q]=w.exports.useState({}),[z,se]=w.exports.useState({click:c});return w.exports.useEffect(()=>{z.click!==c&&(z.click=c,se(z))},[c,z]),w.exports.useEffect(()=>{if(!n&&Ee.accessToken&&f.current){const L=new fe.exports.Map({container:f.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});L.addControl(new fe.exports.NavigationControl),l(L),L.on("load",()=>{v(!0)}),L.on("click",({lngLat:D})=>{z.click(Pe([D.lng,D.lat]))}),L.on("draw.selectionchange",({features:D})=>{var x;if(!((x=M.source)==null?void 0:x.select))return;const r=D[0];r&&r.type==="Feature"&&r.geometry.type==="Point"&&r.properties&&"index"in r.properties&&typeof r.properties.index=="number"&&M.source.select(r.properties.index)}),L.on("draw.modechange",({mode:D})=>{D==="simple_select"&&t.drawnPoint&&_&&_.changeMode("direct_select",{featureId:`${t.drawnPoint}`})}),L.on("draw.update",({features:D,action:r})=>{var x;if(!!((x=M.source)==null?void 0:x.update)&&r==="move"&&D.length>0)for(const S of D)S.type==="Feature"&&S.geometry.type==="Point"&&S.properties&&"index"in S.properties&&typeof S.properties.index=="number"&&M.source.update(S.properties.index,Pe(S.geometry.coordinates))})}console.log("Updating map...")},[_,z,M.source,n,t]),w.exports.useEffect(()=>{if(n&&u&&M.source!==a){console.log("Drawning Points"),M.source=a,le(M);let L=_;(a.selectedColor!==E.selectedColor||a.selectedRadius!==E.selectedRadius||a.color!==E.color||a.radius!==E.radius)&&(W({color:a.color,radius:a.radius,selectedRadius:a.selectedRadius,selectedColor:a.selectedColor}),_&&n.removeControl(_),a?(L=new ot({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":a.selectedRadius,"circle-color":a.selectedColor}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":a.radius,"circle-color":a.color}}]}),n.addControl(L),y(L)):L=void 0),L&&L.set({type:"FeatureCollection",features:a.points.map(D=>({type:"Feature",properties:{description:"",index:D.index,name:""},geometry:{type:"Point",coordinates:[D.longitude,D.latitude]}}))})}},[n,u,M,a,E,_]),w.exports.useEffect(()=>{if(n&&u&&T!==e)if(console.log("Setting arrows in map!"),T){for(const r of T){G[`arrow:${r.name}`]=r.click;const x=n.getSource(`arrow:${r.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${r.name}`),n.removeLayer(`layer:arrow:${r.name}:click`)}ae(void 0)}else{for(const r of e){G[`arrow:${r.name}`]=r.click;let x=n.getSource(`arrow:${r.name}`);const S=x===void 0;S&&(n.addSource(`arrow:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`arrow:${r.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:r.arrows.map(p=>{const m=p.scale*r.scale,N=r.scale*r.arrowHeadScale,j=[p.longitude+p.direction[0]*m,p.latitude+p.direction[1]*m],B=[j[0]+(Math.cos(J)*-p.direction[0]-Math.sin(J)*-p.direction[1])*N,j[1]+(Math.sin(J)*-p.direction[0]+Math.cos(J)*-p.direction[1])*N],Y=[j[0]+(Math.cos(X)*-p.direction[0]-Math.sin(X)*-p.direction[1])*N,j[1]+(Math.sin(X)*-p.direction[0]+Math.cos(X)*-p.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===t[r.name]},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],j,B,j,Y]}}})}),n.addLayer({id:`layer:arrow:${r.name}`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":r.width}}),n.addLayer({id:`layer:arrow:${r.name}:click`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),S&&(n.on("mouseenter",`layer:arrow:${r.name}:click`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="Point"&&m.properties&&typeof m.properties.description=="string"){const N=[...m.geometry.coordinates],{description:j}=m.properties;for(;Math.abs(p.lngLat.lng-N[0])>180;)N[0]+=p.lngLat.lng>N[0]?360:-360;I.setLngLat(N).setHTML(j).addTo(n)}}),n.on("mouseleave",`layer:arrow:${r.name}:click`,()=>{I.remove()}),n.on("click",`layer:arrow:${r.name}:click`,p=>{const m=G[`arrow:${r.name}`];if(!p.features||!m)return;const N=p.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:j}=N.properties;m(j)}}))}ae(e)}const L=h({},P);let D=!1;for(const r of Object.keys(t))if(t[r]!==P[r]){for(const x of e)if(x.name===r){D=!0,L[r]=t[r];const S=n==null?void 0:n.getSource(`arrow:${x.name}`);if(S){const p=t[r];S.setData({type:"FeatureCollection",features:x.arrows.map(m=>{const N=m.scale*x.scale,j=x.scale*x.arrowHeadScale,B=[m.longitude+m.direction[0]*N,m.latitude+m.direction[1]*N],Y=[B[0]+(Math.cos(J)*-m.direction[0]-Math.sin(J)*-m.direction[1])*j,B[1]+(Math.sin(J)*-m.direction[0]+Math.cos(J)*-m.direction[1])*j],ce=[B[0]+(Math.cos(X)*-m.direction[0]-Math.sin(X)*-m.direction[1])*j,B[1]+(Math.sin(X)*-m.direction[0]+Math.cos(X)*-m.direction[1])*j];return{type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:m.index===p},geometry:{type:"LineString",coordinates:[[m.longitude,m.latitude],B,Y,B,ce]}}})})}}}D&&q(L)},[n,T,e,u,I,t,P]),w.exports.useEffect(()=>{if(n&&u&&R!==s)if(console.log("Setting lines in map!"),R){for(const r of R){G[`line:${r.name}`]=r.click;const x=n.getSource(`line:${r.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${r.name}`),n.removeLayer(`layer:line:${r.name}:click`)}ne(void 0)}else{for(const r of s){G[`line:${r.name}`]=r.click;let x=n.getSource(`line:${r.name}`);const S=x===void 0;S&&(n.addSource(`line:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`line:${r.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:r.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===t[r.name]},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))}),n.addLayer({id:`layer:line:${r.name}`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":["case",["get","selected"],r.selectedWidth,r.width]}}),n.addLayer({id:`layer:line:${r.name}:click`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":r.width*10}}),S&&(n.on("mouseenter",`layer:line:${r.name}:click`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="LineString"&&m.properties&&typeof m.properties.description=="string"){const N=[(m.geometry.coordinates[0][0]+m.geometry.coordinates[1][0])/2,(m.geometry.coordinates[0][1]+m.geometry.coordinates[1][1])/2],{description:j}=m.properties;for(;Math.abs(p.lngLat.lng-N[0])>180;)N[0]+=p.lngLat.lng>N[0]?360:-360;I.setLngLat(N).setHTML(j).addTo(n)}}),n.on("mouseleave",`layer:line:${r.name}:click`,()=>{I.remove()}),n.on("click",`layer:line:${r.name}:click`,p=>{const m=G[`line:${r.name}`];if(!p.features||!m)return;const N=p.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:j}=N.properties;m(j)}}))}ne(s)}const L=h({},P);let D=!1;for(const r of Object.keys(t))if(t[r]!==P[r]){for(const x of s)if(x.name===r){D=!0,L[r]=t[r];const S=n==null?void 0:n.getSource(`line:${x.name}`);if(S){const p=t[r];S.setData({type:"FeatureCollection",features:x.lines.map(m=>({type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:m.index===p},geometry:{type:"LineString",coordinates:[[m.startLongitude,m.startLatitude],[m.endLongitude,m.endLatitude]]}}))})}}}D&&q(L)},[n,R,s,u,I,t,P]),w.exports.useEffect(()=>{if(!n||!u)return;if(O!==o)if(console.log("Setting points in map!"),O){for(const r of O){G[`point:${r.name}`]=r.click;const x=n.getSource(`point:${r.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${r.name}`)}te(void 0)}else{for(const r of o){G[`point:${r.name}`]=r.click;let x=n.getSource(`point:${r.name}`);const S=x===void 0;S&&(n.addSource(`point:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`point:${r.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:r.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index!==t[r.name]},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))}),n.addLayer({id:`layer:point:${r.name}`,type:"circle",source:`point:${r.name}`,paint:{"circle-color":["case",["get","selected"],r.selectedColor,r.color],"circle-radius":r.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),S&&(n.on("mouseenter",`layer:point:${r.name}`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="Point"&&m.properties&&typeof m.properties.description=="string"){const N=[...m.geometry.coordinates],{description:j}=m.properties;for(;Math.abs(p.lngLat.lng-N[0])>180;)N[0]+=p.lngLat.lng>N[0]?360:-360;I.setLngLat(N).setHTML(j).addTo(n)}}),n.on("mouseleave",`layer:point:${r.name}`,()=>{I.remove()}),n.on("click",`layer:point:${r.name}`,p=>{const m=G[`point:${r.name}`];if(!p.features||!m)return;const N=p.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:j}=N.properties;m(j)}}))}te(o)}const L=h({},P);let D=!1;for(const r of Object.keys(t))if(t[r]!==P[r]){for(const x of o)if(x.name===r){D=!0,L[r]=t[r];const S=n.getSource(`point:${x.name}`);if(S){const p=t[r];S.setData({type:"FeatureCollection",features:x.points.map(m=>({type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:m.index!==p},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}}))})}}}D&&q(L)},[n,O,o,u,I,t,P]),i("div",{"data-testid":"map",className:"w-full h-full",ref:f})}const wt={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3};var Qe;const _t=h(h({},wt),JSON.parse((Qe=window.localStorage.getItem("segmentDisplaySettings"))!=null?Qe:"{}"));function bt({settings:o,setSettings:e,segments:s,selected:t,setSegmentData:a,addNewSegment:c,splitSegment:f,setSelectionMode:n}){const l=_=>{e(_),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(_))},u=s[t],v=u?i(ee,{title:u.name,item:u,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:_=>a(t,_),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>f(t),children:"Split Segment"})}):i(A,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:_=>{l($(h({},o),{color:_.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.width,onChange:_=>{l($(h({},o),{width:Number.parseFloat(_.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.activeColor,onChange:_=>{l($(h({},o),{activeColor:_.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.activeWidth,onChange:_=>{l($(h({},o),{activeWidth:Number.parseFloat(_.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{n({mode:"mapClick",label:"Select Segment Starting Point",callback:_=>{n({mode:"mapClick",label:"Select Segment End point",callback:y=>{c(_,y),n("normal")}})}})},children:"New Segment"})]}),v]})}function Nt({folder:o,openFolder:e,filesOpen:s,saveFiles:t}){function a(){e()}return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"Celeri UI"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[o?b("span",{children:["Working in ",o.name]}):i("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),s?i("button",{type:"button",onClick:t,"data-testid":"save-file-button",children:"Save Files"}):i(A,{})]})]})}const St={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa"};var Ue;const kt=JSON.parse((Ue=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ue:"false")||St;function Ct({settings:o,setSettings:e,selected:s,velocitys:t,setVelocityData:a,addNewVelocity:c}){const f=u=>{e(u),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(u))},n=t[s],l=n?i(ee,{title:n.name,item:n,deletable:!0,setItem:u=>a(s,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(A,{});return b(A,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:u=>{f($(h({},o),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.selectedColor,onChange:u=>{f($(h({},o),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:o.scale,onChange:u=>{f($(h({},o),{scale:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.width,onChange:u=>{f($(h({},o),{width:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:o.arrowHead,onChange:u=>{f($(h({},o),{arrowHead:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:c,children:"New Velocity"})]}),l]})}const $t={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3};var Ke;const Ft=h(h({},$t),JSON.parse((Ke=window.localStorage.getItem("vertexDisplaySettings"))!=null?Ke:"{}"));function Lt({settings:o,setSettings:e,vertices:s,selected:t,setVertexData:a,setSelectionMode:c,mergeVertices:f,bridgeVertices:n,extrudeVertex:l}){const u=y=>{e(y),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(y))},v=s[t],_=v?i(ee,{title:"Selected Vertex",item:v,ignoreFields:[],deletable:!1,setItem:y=>a(t,y),fieldDefinitions:{},controls:b(A,{children:[i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({type:"vertex",mode:"override",label:"Merge Vertex",callback:y=>{f(t,y),c("normal")}})},children:"Merge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({type:"vertex",mode:"override",label:"Bridge Vertices",callback:y=>{n(t,y),c("normal")}})},children:"Bridge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Extrude Segment From Vertex",callback:y=>{l(t,y),c("normal")}})},children:"Extrude"})]})}):i(A,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:y=>{u($(h({},o),{color:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:o.radius,onChange:y=>{u($(h({},o),{radius:Number.parseFloat(y.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.activeColor,onChange:y=>{u($(h({},o),{activeColor:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:o.activeRadius,onChange:y=>{u($(h({},o),{activeRadius:Number.parseFloat(y.target.value)}))}})})]}),_]})}const Te=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Dt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Be(o){return h(h({},Dt),o)}class ye{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=me(e).map(a=>{const c={};for(const f of Te)c[f]=a[f]||(f==="name"?"":0);return c});this.data=t}async save(){var s;const e=pe((s=this.data)!=null?s:[],Te);await this.handle.setContents(e)}clone(){return new ye(this.handle)}}const jt={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Vt(o){return h(h({},jt),o)}class ve{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=JSON.parse(e);this.data=Vt(s)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new ve(this.handle)}}const He=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Mt={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function We(o){return h(h({},Mt),o)}class xe{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=me(e).map(a=>{const c={};for(const f of He)c[f]=a[f]||(f==="name"?"":0);return c});this.data=t}async save(){var s;const e=pe((s=this.data)!=null?s:[],He);await this.handle.setContents(e)}clone(){return new xe(this.handle)}}async function ze(o){const e=new ge(o);return await e.initialize(),e}async function Je(o){const e=new ye(o);return await e.initialize(),e}async function Ge(o){const e=new xe(o);return await e.initialize(),e}async function Et(o,e,s){const t=new ve(e);if(await t.initialize(),t.data){const a=await ze(await o.getFile(t.data.segment_file_name)),c=await Je(await o.getFile(t.data.block_file_name)),f=await Ge(await o.getFile(t.data.station_file_name)),n=h({},s);return"command"in n&&(n.command=$(h({},n.command),{currentFilePath:e.name})),"segment"in n&&(n.segment=$(h({},n.segment),{currentFilePath:t.data.segment_file_name})),"block"in n&&(n.block=$(h({},n.block),{currentFilePath:t.data.block_file_name})),"velocities"in n&&(n.velocities=$(h({},n.velocities),{currentFilePath:t.data.station_file_name})),{openableFiles:n,commands:t,segments:a,blocks:c,velocities:f}}throw new Error("Can't open command file")}class It{constructor(e){V(this,"name");V(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const s=await this.handle.createWritable();await s.write(e),await s.close()}}class we{constructor(e){V(this,"name");V(this,"handle");V(this,"fileList");V(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const s=await this.handle.getFileHandle(e);return new It(s)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const s=await this.handle.getDirectoryHandle(e),t=new we(s);return await t.initialize(),t}}const Ot=async()=>{const o=await window.showDirectoryPicker(),e=new we(o);return await e.initialize(),e};class Rt{constructor(e,s){V(this,"name");V(this,"parent");this.name=e,this.parent=s}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class _e{constructor(e,s){V(this,"name");V(this,"parent");V(this,"fileList");V(this,"folderList");this.name=e,this.parent=s,this.fileList=[],this.folderList=[];const t=s[e];for(const a of Object.keys(t))typeof t[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Rt(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new _e(e,this.parent[this.name])}}const Pt=async o=>new _e("root",o);let Xe=async()=>{var e;return Pt((e=window.FakeDirectory)!=null?e:{})};function At(o){Xe=o}async function Tt(){return Xe()}window.location.search.includes("fake-dir")||At(Ot);const Bt={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function Ht(){var be,Ne,Se,ke,Ce,$e,Fe;const[o,e]=w.exports.useState(),[s,t]=w.exports.useState(""),[a,c]=w.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[f,n]=w.exports.useState(),[l,u]=w.exports.useState(),[v,_]=w.exports.useState(),[y,I]=w.exports.useState(),[O,te]=w.exports.useState(kt),[T,ae]=w.exports.useState(mt),[R,ne]=w.exports.useState(_t),[M,le]=w.exports.useState(Ft),[E,W]=w.exports.useState("normal"),[P,q]=w.exports.useState(-1),[z,se]=w.exports.useState(-1),[L,D]=w.exports.useState(-1),[r,x]=w.exports.useState(-1),[S,p]=w.exports.useState({select:(d,g)=>{q(d==="block"?g:-1),se(d==="segment"?g:-1),D(d==="velocities"?g:-1),x(d==="vertex"?g:-1),t(d)}}),[m,N]=w.exports.useState([]),[j,B]=w.exports.useState([]),[Y,ce]=w.exports.useState([]),[Ze,Ye]=w.exports.useState({color:M.color,selectedColor:M.activeColor,radius:M.radius,selectedRadius:M.activeRadius,points:[]});w.exports.useEffect(()=>{E==="normal"?p({select:(d,g)=>{q(d==="block"?g:-1),se(d==="segment"?g:-1),D(d==="velocities"?g:-1),x(d==="vertex"?g:-1),t(d)}}):E.mode==="override"?p({select:(d,g)=>{d===E.type&&E.callback(g)}}):p({select:()=>{}})},[E]),w.exports.useEffect(()=>{N([{name:"blocks",color:T.color,selectedColor:T.selectedColor,radius:T.radius,points:(v==null?void 0:v.data)?v.data.map((d,g)=>({longitude:d.interior_lon,latitude:d.interior_lat,name:d.name,description:"",index:g})):[],click:d=>{S.select("block",d)}}])},[T,v,R,l,S]),w.exports.useEffect(()=>{var d;ce([{name:"segments",color:R.color,selectedColor:R.activeColor,width:R.width,selectedWidth:R.activeWidth,lines:((d=l==null?void 0:l.data)==null?void 0:d.segments)?l.data.segments.map((g,k)=>{var Le,De,je,Ve;const C=(De=(Le=l.data)==null?void 0:Le.vertecies[g.start])!=null?De:Oe,F=(Ve=(je=l.data)==null?void 0:je.vertecies[g.end])!=null?Ve:Oe,[[oe,ie],[re,U]]=vt(C,F);return{startLongitude:oe,startLatitude:ie,endLongitude:re,endLatitude:U,name:g.name,description:`${C.lon},${C.lat} to ${F.lon},${F.lat}`,index:k}}):[],click:g=>{S.select("segment",g)}}])},[l,R,S]),w.exports.useEffect(()=>{var d;Ye({color:M.color,radius:M.radius,selectedColor:M.activeColor,selectedRadius:M.activeRadius,points:((d=l==null?void 0:l.data)==null?void 0:d.vertecies)?Object.keys(l.data.vertecies).map(g=>{var F;const k=Number.parseInt(g,10),C=(F=l.data)==null?void 0:F.vertecies[k];return C?{longitude:C.lon,latitude:C.lat,index:k}:!1}).filter(g=>!!g):[],update:(g,k)=>{if(l){const C=l.moveVertex(g,k);u(C)}},select:g=>{S.select("vertex",g)}})},[M,l,S]),w.exports.useEffect(()=>{B([{name:"velocities",color:O.color,selectedColor:O.selectedColor,scale:O.scale,arrowHeadScale:O.arrowHead,width:O.width,arrows:(y==null?void 0:y.data)?y.data.map((d,g)=>{const k=Math.sqrt(d.east_vel*d.east_vel+d.north_vel*d.north_vel);return{longitude:d.lon,latitude:d.lat,direction:[d.east_vel/k,d.north_vel/k],scale:k,name:d.name,description:`north: ${d.north_vel}, east: ${d.east_vel}`,index:g}}):[],click:d=>{S.select("velocities",d)}}])},[S,O,y]);let Q=i("span",{});switch(s){case"files":Q=o?i(ht,{folder:o,files:a,setFile:async(d,g,k)=>{if(k){let C=h({},a);switch(C[d]=$(h({},C[d]),{currentFilePath:g}),d){case"segment":u(await ze(k));break;case"block":_(await Je(k));break;case"velocity":I(await Ge(k));break;case"command":const F=await Et(o,k,a);n(F.commands),u(F.segments),_(F.blocks),I(F.velocities),C=F.openableFiles;break}c(C)}}}):i("span",{});break;case"velocities":Q=i(Ct,{settings:O,setSettings:te,selected:L,velocitys:(be=y==null?void 0:y.data)!=null?be:[],setVelocityData:(d,g)=>{if(y!==void 0)if(g){const k=y.data&&y.data[d]?h(h({},y.data[d]),g):We(g),C=y.data?[...y.data]:[];C[d]=k;const F=y.clone();F.data=C,I(F)}else{const k=y.data?[...y.data]:[];k.splice(d,1);const C=y.clone();C.data=k,I(C)}},addNewVelocity:()=>{W({label:"Click to place velocity estimate",mode:"mapClick",callback:d=>{if(W("normal"),y!==void 0){const g=y.data?[...y.data]:[],k=g.length,C=We({lat:d.lat,lon:d.lon});g.push(C);const F=y.clone();F.data=g,I(F),S.select("velocity",k)}}})}});break;case"block":Q=i(pt,{settings:T,setSettings:ae,selected:P,blocks:(Ne=v==null?void 0:v.data)!=null?Ne:[],addNewBlock:()=>{W({label:"Click to place new block",mode:"mapClick",callback:d=>{if(v!==void 0){const g=v.data?[...v.data]:[],k=Be({name:"New Block",interior_lon:d.lon,interior_lat:d.lat}),C=g.length;g.push(k);const F=v.clone();F.data=g,_(F),S.select("block",C)}W("normal")}})},setBlockData:(d,g)=>{if(v!==void 0)if(g){const k=v.data&&v.data[d]?h(h({},v.data[d]),g):Be(g),C=v.data?[...v.data]:[];C[d]=k;const F=v.clone();F.data=C,_(F)}else{const k=v.data?[...v.data]:[];k.splice(d,1);const C=v.clone();C.data=k,_(C)}}});break;case"segment":Q=i(bt,{settings:R,setSettings:ne,segments:(ke=(Se=l==null?void 0:l.data)==null?void 0:Se.segments)!=null?ke:[],selected:z,setSelectionMode:d=>W(d),addNewSegment:(d,g)=>{var k,C;if(l!==void 0){const F=l.createSegment(d,g);u(F),S.select("segment",((C=(k=F.data)==null?void 0:k.segments.length)!=null?C:0)-1)}},setSegmentData:(d,g)=>{var k,C,F,oe;if(l!==void 0)if(g){const ie=l.data&&l.data.segments[d]?h(h({},l.data.segments[d]),g):void 0,re=l.data?[...l.data.segments]:[];if(ie){re[d]=ie;const U=l.clone();U.data={vertecies:(C=(k=U.data)==null?void 0:k.vertecies)!=null?C:[],vertexDictionary:(oe=(F=U.data)==null?void 0:F.vertexDictionary)!=null?oe:{},segments:re},u(U)}}else u(l.deleteSegment(d))},splitSegment:d=>{if(l){const g=l.splitSegment(d);u(g)}}});break;case"vertex":Q=i(Lt,{settings:M,setSettings:le,vertices:($e=(Ce=l==null?void 0:l.data)==null?void 0:Ce.vertecies)!=null?$e:{},selected:r,setVertexData:function(d,g){throw new Error("Function not implemented.")},setSelectionMode:d=>W(d),mergeVertices:(d,g)=>{l&&u(l.mergeVertices(d,g))},bridgeVertices:(d,g)=>{l&&u(l.bridgeVertices(d,g))},extrudeVertex:(d,g)=>{l&&u(l.extrudeSegment(d,g))}});break}return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:d=>{d.key==="Escape"&&W("normal")},children:[i(Nt,{filesOpen:((Fe=f!=null?f:l)!=null?Fe:v)!==void 0,saveFiles:async()=>{f&&await f.save(),l&&await l.save(),v&&await v.save()},folder:o,openFolder:async()=>{const d=await Tt();e(d),t("files")}}),E!=="normal"?i("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[i("span",{className:"text-lg font-semibold",children:E.label}),i("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):i(A,{}),i(xt,{pointSources:m,arrowSources:j,lineSources:Y,drawnPointSource:Ze,selections:{segments:z,blocks:P,velocities:L,drawnPoint:r},click:d=>{typeof E!="string"&&E.mode==="mapClick"&&E.callback(d)}}),i(gt,{view:Q,buttons:o?Bt:void 0,active:s,setActive:d=>t(d)})]})}function Wt(o={}){const{immediate:e=!1,onNeedRefresh:s,onOfflineReady:t,onRegistered:a,onRegisterError:c}=o;let f;const n=async(l=!0)=>{};return"serviceWorker"in navigator&&(f=new it("./sw.js",{scope:"./"}),f.addEventListener("activated",l=>{l.isUpdate?window.location.reload():t==null||t()}),f.register({immediate:e}).then(l=>{a==null||a(l)}).catch(l=>{c==null||c(l)})),n}Wt();const zt=1,Jt=new rt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:zt}}});lt.render(i(w.exports.StrictMode,{children:i(ct,{client:Jt,children:i(Ht,{})})}),document.querySelector("#root"));
