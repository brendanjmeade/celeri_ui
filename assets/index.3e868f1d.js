var ht=Object.defineProperty,gt=Object.defineProperties;var yt=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var X=(n,e,t)=>e in n?ht(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))xt.call(e,t)&&X(n,t,e[t]);if($e)for(var t of $e(e))vt.call(e,t)&&X(n,t,e[t]);return n},y=(n,e)=>gt(n,yt(e));var S=(n,e,t)=>(X(n,typeof e!="symbol"?e+"":e,t),t);import{j as l,a as w,F as V,r as N,M as wt,m as Fe,R as bt,b as Z,u as _t,c as Nt,l as Le,d as Y,e as F,f as kt,g as St,h as Ct,v as Dt,Q as $t,i as Ft,k as Lt,P as Vt}from"./vendor.6cf141b2.js";const Mt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}};Mt();function jt({value:n,fieldDefinition:e,setField:t}){const[s,a]=N.exports.useState(-1),[r,o]=N.exports.useState(n);return N.exports.useEffect(()=>{o(n)},[n]),w("div",{className:"flex flex-row justify-between items-center",children:[w("div",{className:"flex flex-col",children:[l("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?l("span",{className:"text-sm",children:e.description}):l(V,{})]}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof n=="number"?"number":"text",value:r,onChange:c=>{const d=typeof n=="number"?Number.parseFloat(c.target.value):c.target.value;o(d),s>-1&&clearTimeout(s),a(setTimeout(()=>t(d),1e3))}})})]})}function K({title:n,item:e,setItem:t,fieldDefinitions:s,ignoreFields:a,deletable:r,controls:o}){const c=Object.keys(e).map((d,u)=>{if(a==null?void 0:a.includes(d))return{element:l("span",{style:{display:"hidden"}},d),order:u+1e4};const x=e[d],i=d in s&&s[d];return i?{element:l(jt,{value:x,fieldDefinition:i,setField:h=>t({[d]:h})},d),order:i.order}:{element:w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":`input-title-${d}`,className:"text-l font-bold",children:d}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${d}`,className:"rounded w-full",type:typeof x=="number"?"number":"text",value:x,onChange:h=>{t({[d]:typeof x=="number"?Number.parseFloat(h.target.value):h.target.value})}})})]},d),order:u+1e3}}).sort((d,u)=>d.order-u.order).map(d=>d.element);return w("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),w("span",{className:"flex flex-row justify-end gap-2 grow",children:[o,r?l("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):l(V,{})]})]}),c]})}K.defaultProps={ignoreFields:[],controls:l(V,{})};const It={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var st;const Rt=JSON.parse((st=window.localStorage.getItem("blockDisplaySettings"))!=null?st:"false")||It;function Ot({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:r}){const o=u=>{e(u),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(u))},c=s[t],d=c?l(K,{title:c.name,item:c,deletable:!0,setItem:u=>a(t,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):l(V,{});return w(V,{children:[w("div",{className:"flex flex-col gap-2",children:[w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(y(f({},n),{hide:!n.hide}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:u=>{o(y(f({},n),{color:u.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:u=>{o(y(f({},n),{selectedColor:u.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:u=>{o(y(f({},n),{radius:Number.parseFloat(u.target.value)}))}})})]})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Block"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),d]})}function Et({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const r=e[a];return w("div",{className:"flex flex-row justify-between items-center",children:[w("div",{className:"flex flex-col",children:[l("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:r.name}),l("span",{className:"text-sm","data-testid":`file-${a}-description`,children:r.description})]}),l("span",{className:"w-2/5 flex-shrink-0",children:w("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:r.currentFilePath,onChange:async o=>{const c=o.currentTarget.value;try{const d=await n.getFile(c);t(a,d.name,d)}catch{t(a,"")}},children:[l("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(o=>o.endsWith(r.extension)).map(o=>l("option",{value:o,"data-testid":`file-${a}-select-${o}`,children:o},o))]})})]},a)});return l("div",{className:"flex flex-col gap-2",children:s})}function Pt({view:n,buttons:e,active:t,setActive:s}){if(!e)return l("span",{});const a=[];for(const r of Object.keys(e)){const o=e[r],c=r===t;a.push(l("button",{type:"button","data-testid":`tab-${r}`,className:`${c?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>s(c?"":r),children:o},r))}return w("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?l("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm",children:n}):"",l("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}const Ve={lon:0,lat:0},Bt=180,W=360;function Me(n){let{lon:e,lat:t}=n;for(;e<0;)e+=W;for(;e>W;)e-=W;return[e,t]}function je([n,e]){return{lon:n<0?n+W:n,lat:e}}function At(n,e){const t=Me(n),s=Me(e),a=[s[0],s[1]];return s[0]-t[0]>=Bt?a[0]-=W:a[0]+=W,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const D=1e3;function R(n,e,t,s){const a=`${Math.floor(n.lon*D)},${Math.floor(n.lat*D)}`;if(a in e)return[e[a],s];const r=s;return t[r]=n,e[a]=r,[r,s+1]}function Ie(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*D)},${Math.floor(s.lat*D)}`,r=f({},n.vertecies);delete r[e];const o=f({},n.vertexDictionary);return delete o[a],y(f({},n),{vertecies:r,vertexDictionary:o})}return n}const O=Math.PI/6,A=2*Math.PI-O;function Tt(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:r,internalSelections:o},{arrowSources:c,selections:d}){if(t&&r&&a!==c)if(console.log("Setting arrows in map!"),a){for(const i of a){const h=t.getSource(`arrow:${i.name}`);h!==void 0&&h.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${i.name}`),t.removeLayer(`layer:arrow:${i.name}:click`)}e({internalArrowSources:void 0})}else{for(const i of c){let h=t.getSource(`arrow:${i.name}`);const k=h===void 0;k&&(t.addSource(`arrow:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=t.getSource(`arrow:${i.name}`)),h!==void 0&&h.setData({type:"FeatureCollection",features:i.arrows.map(g=>{const p=g.scale*i.scale,b=i.scale*i.arrowHeadScale,_=[g.longitude+g.direction[0]*p,g.latitude+g.direction[1]*p],$=[_[0]+(Math.cos(O)*-g.direction[0]-Math.sin(O)*-g.direction[1])*b,_[1]+(Math.sin(O)*-g.direction[0]+Math.cos(O)*-g.direction[1])*b],J=[_[0]+(Math.cos(A)*-g.direction[0]-Math.sin(A)*-g.direction[1])*b,_[1]+(Math.sin(A)*-g.direction[0]+Math.cos(A)*-g.direction[1])*b];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index===d[i.name]},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],_,$,_,J]}}})}),t.addLayer({id:`layer:arrow:${i.name}`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":i.width}}),t.addLayer({id:`layer:arrow:${i.name}:click`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),k&&(t.on("mouseenter",`layer:arrow:${i.name}:click`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const b=[...p.geometry.coordinates],{description:_}=p.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;s.setLngLat(b).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:arrow:${i.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${i.name}:click`,g=>{let p;if(n.state.internalArrowSources)for(const _ of n.state.internalArrowSources)p=_.click;if(!g.features||!p)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:_}=b.properties;p(_)}}))}e({internalArrowSources:c})}const u=f({},o);let x=!1;for(const i of Object.keys(d))if(d[i]!==o[i]){for(const h of c)if(h.name===i){x=!0,u[i]=d[i];const k=t==null?void 0:t.getSource(`arrow:${h.name}`);if(k){const g=d[i];k.setData({type:"FeatureCollection",features:h.arrows.map(p=>{const b=p.scale*h.scale,_=h.scale*h.arrowHeadScale,$=[p.longitude+p.direction[0]*b,p.latitude+p.direction[1]*b],J=[$[0]+(Math.cos(O)*-p.direction[0]-Math.sin(O)*-p.direction[1])*_,$[1]+(Math.sin(O)*-p.direction[0]+Math.cos(O)*-p.direction[1])*_],E=[$[0]+(Math.cos(A)*-p.direction[0]-Math.sin(A)*-p.direction[1])*_,$[1]+(Math.sin(A)*-p.direction[0]+Math.cos(A)*-p.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===g},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],$,J,$,E]}}})})}}}x&&e({internalSelections:u})}function Ht(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:r},{drawnPointSource:o}){if(e&&a&&r!==o){console.log("Drawning Points"),n({internalDrawnPointSource:o});let c=t;if((o.selectedColor!==s.selectedColor||o.selectedRadius!==s.selectedRadius||o.color!==s.color||o.radius!==s.radius)&&(n({drawnPointSettings:{color:o.color,radius:o.radius,selectedRadius:o.selectedRadius,selectedColor:o.selectedColor}}),t&&(e.removeControl(t),c=void 0),o?(c=new wt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":o.selectedRadius,"circle-color":o.selectedColor}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":o.radius,"circle-color":o.color}}]}),e.addControl(c),n({draw:c})):c=void 0),c){const d=c.getAll(),u=o.points.length!==d.features.length?void 0:c.getSelected(),x={type:"FeatureCollection",features:o.points.map(i=>({type:"Feature",id:i.index.toString(),properties:{description:"",index:i.index,name:""},geometry:{type:"Point",coordinates:[i.longitude,i.latitude]}}))};if(c.set(x),u&&u.features.length>0&&u.features[0].properties&&typeof u.features[0].properties.index=="number"){const i=u.features[0].id;i&&c.changeMode("simple_select",{featureIds:[i]})}}}}function Wt(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:r,internalSelections:o},{lineSources:c,selections:d}){if(t&&r&&a!==c)if(console.log("Setting lines in map!"),a){for(const i of a){const h=t.getSource(`line:${i.name}`);h!==void 0&&h.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${i.name}`),t.removeLayer(`layer:line:${i.name}:click`)}e({internalLineSources:void 0})}else{for(const i of c){let h=t.getSource(`line:${i.name}`);const k=h===void 0;k&&(t.addSource(`line:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=t.getSource(`line:${i.name}`)),h!==void 0&&h.setData({type:"FeatureCollection",features:i.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index===d[i.name]},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))}),t.addLayer({id:`layer:line:${i.name}`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":["case",["get","selected"],i.selectedWidth,i.width]}}),t.addLayer({id:`layer:line:${i.name}:click`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":i.width*10}}),k&&(t.on("mouseenter",`layer:line:${i.name}:click`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="LineString"&&p.properties&&typeof p.properties.description=="string"){const b=[(p.geometry.coordinates[0][0]+p.geometry.coordinates[1][0])/2,(p.geometry.coordinates[0][1]+p.geometry.coordinates[1][1])/2],{description:_}=p.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;s.setLngLat(b).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:line:${i.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${i.name}:click`,g=>{let p;if(n.state.internalLineSources)for(const _ of n.state.internalLineSources)p=_.click;if(!g.features||!p)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:_}=b.properties;p(_)}}))}e({internalLineSources:c})}const u=f({},o);let x=!1;for(const i of Object.keys(d))if(d[i]!==o[i]){for(const h of c)if(h.name===i){x=!0,u[i]=d[i];const k=t==null?void 0:t.getSource(`line:${h.name}`);if(k){const g=d[i];k.setData({type:"FeatureCollection",features:h.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===g},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))})}}}x&&e({internalSelections:u})}function zt(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:r,internalSelections:o},{pointSources:c,selections:d}){if(!t||!r)return;if(a!==c)if(console.log("Setting points in map!"),a){for(const i of a){const h=t.getSource(`point:${i.name}`);h!==void 0&&h.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${i.name}`)}e({internalPointSources:void 0})}else{for(const i of c){let h=t.getSource(`point:${i.name}`);const k=h===void 0;k&&(t.addSource(`point:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=t.getSource(`point:${i.name}`)),h!==void 0&&h.setData({type:"FeatureCollection",features:i.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index!==d[i.name]},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),t.addLayer({id:`layer:point:${i.name}`,type:"circle",source:`point:${i.name}`,paint:{"circle-color":["case",["get","selected"],i.selectedColor,i.color],"circle-radius":i.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),k&&(t.on("mouseenter",`layer:point:${i.name}`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const b=[...p.geometry.coordinates],{description:_}=p.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;s.setLngLat(b).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:point:${i.name}`,()=>{s.remove()}),t.on("click",`layer:point:${i.name}`,g=>{let p;if(n.state.internalPointSources)for(const _ of n.state.internalPointSources)p=_.click;if(!g.features||!p)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:_}=b.properties;p(_)}}))}e({internalPointSources:c})}const u=f({},o);let x=!1;for(const i of Object.keys(d))if(d[i]!==o[i]){for(const h of c)if(h.name===i){x=!0,u[i]=d[i];const k=t.getSource(`point:${h.name}`);if(k){const g=d[i];k.setData({type:"FeatureCollection",features:h.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index!==g},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))})}}}x&&e({internalSelections:u})}Fe.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Jt extends bt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:N.exports.createRef(),popup:new Z.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Fe.accessToken&&t){const s=new Z.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new Z.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:r}=this.props;r(je([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:r}=this.state;if(!r||!(r==null?void 0:r.select))return;const o=a[0];o&&o.type==="Feature"&&o.geometry.type==="Point"&&o.properties&&"index"in o.properties&&typeof o.properties.index=="number"&&r.select(o.properties.index)}),s.on("draw.modechange",({mode:a})=>{const{selections:r}=this.props,{draw:o}=this.state;a==="simple_select"&&r.drawnPoint&&o&&o.changeMode("direct_select",{featureId:`${r.drawnPoint}`})}),s.on("draw.update",({features:a,action:r})=>{const{internalDrawnPointSource:o}=this.state;if(!!(o==null?void 0:o.update)&&r==="move"&&a.length>0)for(const c of a)c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"&&o.update(c.properties.index,je(c.geometry.coordinates))})}}componentDidUpdate(){return Wt(this,e=>this.setState(e),this.state,this.props),Tt(this,e=>this.setState(e),this.state,this.props),zt(this,e=>this.setState(e),this.state,this.props),Ht(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return l("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const qt={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var at;const Gt=f(f({},qt),JSON.parse((at=window.localStorage.getItem("segmentDisplaySettings"))!=null?at:"{}"));function Ut({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:r,splitSegment:o,setSelectionMode:c}){const d=i=>{e(i),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(i))},u=t[s],x=u?l(K,{title:u.name,item:u,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:i=>a(s,i),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>o(s),children:"Split Segment"})}):l(V,{});return w("div",{className:"flex flex-col gap-2",children:[w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(y(f({},n),{hide:!n.hide}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:i=>{d(y(f({},n),{color:i.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:i=>{d(y(f({},n),{width:Number.parseFloat(i.target.value)}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:i=>{d(y(f({},n),{activeColor:i.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:i=>{d(y(f({},n),{activeWidth:Number.parseFloat(i.target.value)}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Segment"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Select Segment Starting Point",callback:i=>{c({mode:"mapClick",label:"Select Segment End point",callback:h=>{r(i,h),c("normal")}})}})},children:"New Segment"})]}),x]})}const Re=()=>_t(),Q=Nt;function Kt({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const r=Re(),[o,c]=Q(d=>[d.main.past.length>0,d.main.future.length>0]);return w("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[l("h3",{className:"text-lg font-bold",children:"celeri_ui"}),w("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?l("button",{type:"button",onClick:()=>{r(Le.ActionCreators.undo())},"data-testid":"undo-button",disabled:!o,children:"Undo"}):l(V,{}),n?l("button",{type:"button",onClick:()=>{r(Le.ActionCreators.redo())},disabled:!c,"data-testid":"undo-button",children:"Redo"}):l(V,{}),n?w("span",{children:["Working in ",n.name]}):l("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?l("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):l(V,{})]})]})}const Qt={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var ot;const Xt=JSON.parse((ot=window.localStorage.getItem("velocityDisplaySettings"))!=null?ot:"false")||Qt;function Zt({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:r}){const o=u=>{e(u),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(u))},c=s[t],d=c?l(K,{title:c.name,item:c,deletable:!0,setItem:u=>a(t,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):l(V,{});return w(V,{children:[w("div",{className:"flex flex-col gap-2",children:[w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(y(f({},n),{hide:!n.hide}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:u=>{o(y(f({},n),{color:u.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:u=>{o(y(f({},n),{selectedColor:u.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Scale"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:u=>{o(y(f({},n),{scale:Number.parseFloat(u.target.value)}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:u=>{o(y(f({},n),{width:Number.parseFloat(u.target.value)}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Arrow Head Size"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:u=>{o(y(f({},n),{arrowHead:Number.parseFloat(u.target.value)}))}})})]})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Velocity"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),d]})}const Yt={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var it;const en=f(f({},Yt),JSON.parse((it=window.localStorage.getItem("vertexDisplaySettings"))!=null?it:"{}"));function tn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:r,mergeVertices:o,bridgeVertices:c,extrudeVertex:d}){const u=h=>{e(h),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(h))},x=t[s],i=x?l(K,{title:"Selected Vertex",item:x,ignoreFields:[],deletable:!1,setItem:h=>a(s,f(f({},x),h)),fieldDefinitions:{},controls:w(V,{children:[l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{o(s,h),r("normal")}})},children:"Merge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{c(s,h),r("normal")}})},children:"Bridge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{d(s,h),r("normal")}})},children:"Extrude"})]})}):l(V,{});return w("div",{className:"flex flex-col gap-2",children:[w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{u(y(f({},n),{hide:!n.hide}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:h=>{u(y(f({},n),{color:h.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:h=>{u(y(f({},n),{radius:Number.parseFloat(h.target.value)}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:h=>{u(y(f({},n),{activeColor:h.target.value}))}})})]}),w("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:h=>{u(y(f({},n),{activeRadius:Number.parseFloat(h.target.value)}))}})})]}),i]})}const Oe=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ee={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function nn(n){return n?f(f({},Ee),n):f({},Ee)}function sn(n,{data:e}){return[...n,nn(e)]}function an(n,e){const t=[...n];return t.splice(e,1),t}function on(n,e){const t=[...n],s=f(f({},t[e.index]),e.data);return t[e.index]=s,t}function rn(n,e){return e}const ln=[],Pe=F("createBlock"),Be=F("editBlock"),Ae=F("deleteBlock"),ee=F("loadNewBlockData"),cn=Y(ln,n=>{n.addCase(Pe,(e,t)=>sn(e,t.payload)).addCase(Be,(e,t)=>on(e,t.payload)).addCase(Ae,(e,t)=>an(e,t.payload)).addCase(ee,(e,t)=>rn(e,t.payload))}),Te=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],z={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function dn(n,{a:e,b:t}){const s=y(f({},z),{start:e,end:t}),a=[...n.segments,s];return y(f({},n),{segments:a})}function un(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),{lastIndex:a}=n,[r,o]=R(e.start,s,t,a),[c,d]=R(e.end,s,t,o),u=y(f({},z),{start:r,end:c}),x=[...n.segments,u];return{vertecies:t,vertexDictionary:s,segments:x,lastIndex:d}}function fn(n,e){const t=[...n.segments],s=t.splice(e.index,1)[0];return Ie(Ie(y(f({},n),{segments:t}),s.start),s.end)}function mn(n,e){const t=[...n.segments],s=f(f({},t[e.index]),e.data);return t[e.index]=s,y(f({},n),{segments:t})}function pn(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),[a,r]=R(e.targetPoint,s,t,n.lastIndex),o=y(f({},z),{start:e.index,end:a}),c=[...n.segments,o];return{vertecies:t,vertexDictionary:s,segments:c,lastIndex:r}}function hn(n,e){return e}function gn(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(d=>{let u=d;return u.start===t&&(u=y(f({},u),{start:e})),u.end===t&&(u=y(f({},u),{end:e})),u}).filter(d=>d.start!==d.end),a=n.vertecies[t],r=`${Math.floor(a.lon*D)},${Math.floor(a.lat*D)}`,o=f({},n.vertecies);delete o[t];const c=f({},n.vertexDictionary);return delete c[r],y(f({},n),{vertecies:o,vertexDictionary:c,segments:s})}function yn(n,{index:e,vertex:t}){const s=f({},n.vertecies),a=f({},n.vertexDictionary),r=[...n.segments],o=s[e],c=`${Math.floor(t.lon*D)},${Math.floor(t.lat*D)}`,d=`${Math.floor(o.lon*D)},${Math.floor(o.lat*D)}`;if(delete a[d],c in a){const u=a[c];for(const x of r)x.start===u&&(x.start=e),x.end===u&&(x.end=e);delete s[u]}return s[e]=t,y(f({},n),{segments:r,vertecies:s,vertexDictionary:a})}function xn(n,e){const t=n.segments[e],s=n.vertecies[t.start],a=n.vertecies[t.end],r={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},o=f({},n.vertecies),c=f({},n.vertexDictionary),[d,u]=R(r,c,o,n.lastIndex),x=y(f({},t),{end:d,name:`${t.name}_a`}),i=y(f({},t),{start:d,name:`${t.name}_b`}),h=[...n.segments];return h[e]=x,h.push(i),{vertecies:o,vertexDictionary:c,segments:h,lastIndex:u}}const vn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},He=F("bridgeVertices"),We=F("createSegmet"),ze=F("deleteSegment"),Je=F("editSegmentData"),qe=F("extrudeSegment"),te=F("loadNewSegmentData"),Ge=F("mergeVertices"),ne=F("moveVertex"),Ue=F("splitSegment"),wn=Y(vn,n=>{n.addCase(He,(e,t)=>dn(e,t.payload)).addCase(We,(e,t)=>un(e,t.payload)).addCase(ze,(e,t)=>fn(e,t.payload)).addCase(Je,(e,t)=>mn(e,t.payload)).addCase(qe,(e,t)=>pn(e,t.payload)).addCase(te,(e,t)=>hn(e,t.payload)).addCase(Ge,(e,t)=>gn(e,t.payload)).addCase(ne,(e,t)=>yn(e,t.payload)).addCase(Ue,(e,t)=>xn(e,t.payload))}),Ke=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],bn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function _n(n){return f(f({},bn),n)}function Nn(n,{data:e}){return[...n,_n(e)]}function kn(n,e){const t=[...n];return t.splice(e,1),t}function Sn(n,e){const t=[...n],s=f(f({},t[e.index]),e.data);return t[e.index]=s,t}function Cn(n,e){return e}const Dn=[],Qe=F("createVelocity"),Xe=F("editVelocity"),Ze=F("deleteVelocity"),se=F("loadNewVelocityData"),$n=Y(Dn,n=>{n.addCase(Qe,(e,t)=>Nn(e,t.payload)).addCase(Xe,(e,t)=>Sn(e,t.payload)).addCase(Ze,(e,t)=>kn(e,t.payload)).addCase(se,(e,t)=>Cn(e,t.payload))});function ae(n){const e=n.split(/\n/g),t=e[0].split(","),s=e.slice(1),a=[];for(const r of s)if(r.trim()!==""){const o=r.split(/\s*,\s*/),c={};for(let d=0;d<t.length;d+=1){let u=o[d];const x=t[d],i=Number.parseFloat(u);u=Number.isNaN(i)?u:i,typeof u=="string"&&u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1)),c[x]=u}a.push(c)}return a}function oe(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(r=>r in a?typeof a[r]=="string"&&/\s/.test(`${a[r]}`)?`"${a[r]}"`:`${a[r]}`:"").join(","))}return t.join(`
`)}class ie{constructor(e){S(this,"handle");S(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ae(e).map(a=>{const r={};for(const o of Oe)r[o]=a[o]||(o==="name"?"":0);return r});this.data=s}async save(){var t;const e=oe((t=this.data)!=null?t:[],Oe);await this.handle.setContents(e)}clone(){return new ie(this.handle)}}const Fn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Ln(n){return f(f({},Fn),n)}class re{constructor(e){S(this,"handle");S(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Ln(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new re(this.handle)}}class le{constructor(e){S(this,"handle");S(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ae(e).map(d=>{const u={};for(const x of Te)u[x]=d[x]||(x==="name"?"":0);return u}),a={},r={},o=[];let c=0;for(const d of s){const[u,x]=R({lon:d.lon1,lat:d.lat1},a,r,c),[i,h]=R({lon:d.lon2,lat:d.lat2},a,r,x),k=y(f({},d),{start:u,end:i});c=h,o.push(k)}this.data={vertecies:r,segments:o,vertexDictionary:a,lastIndex:c}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(r=>{const o=s[r.start],c=s[r.end];return y(f({},r),{lon1:o.lon,lat1:o.lat,lon2:c.lon,lat2:c.lat})})}const t=oe(e,Te);await this.handle.setContents(t)}clone(){return new le(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*D)},${Math.floor(s.lat*D)}`,r=f({},this.data.vertecies);delete r[e];const o=f({},this.data.vertexDictionary);delete o[a];const c=this.clone();return c.data=y(f({},this.data),{vertecies:r,vertexDictionary:o}),c}}return this}mergeVertices(e,t){if(this.data){for(const d of this.data.segments)d.start===t&&(d.start=e),d.end===t&&(d.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*D)},${Math.floor(s.lat*D)}`,r=f({},this.data.vertecies);delete r[t];const o=f({},this.data.vertexDictionary);delete o[a];const c=this.clone();return c.data=y(f({},this.data),{vertecies:r,vertexDictionary:o}),c}return this}moveVertex(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),r=[...this.data.segments],o=s[e],c=`${Math.floor(t.lon*D)},${Math.floor(t.lat*D)}`,d=`${Math.floor(o.lon*D)},${Math.floor(o.lat*D)}`;if(delete a[d],c in a){const x=a[c];for(const i of r)i.start===x&&(i.start=e),i.end===x&&(i.end=e);delete s[x]}s[e]=t;const u=this.clone();return u.data=y(f({},this.data),{segments:r,vertecies:s,vertexDictionary:a}),u}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],r={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[o,c]=R(r,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),d=y(f({},t),{end:o,name:`${t.name}_a`}),u=y(f({},t),{start:o,name:`${t.name}_b`}),x=[...this.data.segments];x[e]=d,x.push(u);const i=this.clone();return i.data=y(f({},this.data),{segments:x,lastIndex:c}),i}return this}bridgeVertices(e,t){if(this.data){const s=y(f({},z),{start:e,end:t}),a=[...this.data.segments,s],r=this.clone();return r.data=y(f({},this.data),{segments:a}),r}return this}extrudeSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[r,o]=R(t,a,s,this.data.lastIndex),c=y(f({},z),{start:e,end:r}),d=[...this.data.segments,c],u=this.clone();return u.data={vertecies:s,vertexDictionary:a,segments:d,lastIndex:o},u}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=y(f({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[r,o]=R(e,a,s,this.data.lastIndex),[c,d]=R(t,a,s,o),u=y(f({},z),{start:r,end:c}),x=[...this.data.segments,u],i=this.clone();return i.data={vertecies:s,vertexDictionary:a,segments:x,lastIndex:d},i}return this}}class ce{constructor(e){S(this,"handle");S(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ae(e).map(a=>{const r={};for(const o of Ke)r[o]=a[o]||(o==="name"?"":0);return r});this.data=s}async save(){var t;const e=oe((t=this.data)!=null?t:[],Ke);await this.handle.setContents(e)}clone(){return new ce(this.handle)}}async function Ye(n){const e=new le(n);return await e.initialize(),e}async function et(n){const e=new ie(n);return await e.initialize(),e}async function tt(n){const e=new ce(n);return await e.initialize(),e}async function Vn(n,e,t){const s=new re(e);if(await s.initialize(),s.data){const a=await Ye(await n.getFile(s.data.segment_file_name)),r=await et(await n.getFile(s.data.block_file_name)),o=await tt(await n.getFile(s.data.station_file_name)),c=f({},t);return"command"in c&&(c.command=y(f({},c.command),{currentFilePath:e.name})),"segment"in c&&(c.segment=y(f({},c.segment),{currentFilePath:s.data.segment_file_name})),"block"in c&&(c.block=y(f({},c.block),{currentFilePath:s.data.block_file_name})),"velocities"in c&&(c.velocities=y(f({},c.velocities),{currentFilePath:s.data.station_file_name})),{openableFiles:c,commands:s,segments:a,blocks:r,velocities:o}}throw new Error("Can't open command file")}class Mn{constructor(e){S(this,"name");S(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class de{constructor(e){S(this,"name");S(this,"handle");S(this,"fileList");S(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Mn(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new de(t);return await s.initialize(),s}}const jn=async()=>{const n=await window.showDirectoryPicker(),e=new de(n);return await e.initialize(),e};class In{constructor(e,t){S(this,"name");S(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ue{constructor(e,t){S(this,"name");S(this,"parent");S(this,"fileList");S(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new In(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ue(e,this.parent[this.name])}}const Rn=async n=>new ue("root",n);let nt=async()=>{var e;return Rn((e=window.FakeDirectory)!=null?e:{})};function On(n){nt=n}async function En(){return nt()}window.location.search.includes("fake-dir")||On(jn);const Pn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function Bn(){var Ne,ke,Se;const n=Re(),[e,t]=N.exports.useState(),[s,a]=N.exports.useState(""),[r,o]=N.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[c,d]=N.exports.useState(),[u,x]=N.exports.useState(),[i,h]=N.exports.useState(),[k,g]=N.exports.useState(),p=Q(m=>m.main.present.segment),b=Q(m=>m.main.present.block),_=Q(m=>m.main.present.velocity),[$,J]=N.exports.useState(Xt),[E,rt]=N.exports.useState(Rt),[P,lt]=N.exports.useState(Gt),[I,ct]=N.exports.useState(en),[j,T]=N.exports.useState("normal"),[fe,me]=N.exports.useState(-1),[pe,he]=N.exports.useState(-1),[ge,ye]=N.exports.useState(-1),[xe,ve]=N.exports.useState(-1),[L,zn]=N.exports.useState({select:(m,v)=>{me(m==="block"?v:-1),he(m==="segment"?v:-1),ye(m==="velocities"?v:-1),ve(m==="vertex"?v:-1),a(m)}}),[dt,we]=N.exports.useState([]),[ut,be]=N.exports.useState([]),[ft,_e]=N.exports.useState([]),[mt,pt]=N.exports.useState({color:I.color,selectedColor:I.activeColor,radius:I.radius,selectedRadius:I.activeRadius,points:[]});N.exports.useEffect(()=>{j==="normal"?L.select=(m,v)=>{me(m==="block"?v:-1),he(m==="segment"?v:-1),ye(m==="velocities"?v:-1),ve(m==="vertex"?v:-1),a(m)}:j.mode==="override"?L.select=(m,v)=>{m===j.type&&j.callback(v)}:L.select=()=>{}},[j,L]),N.exports.useEffect(()=>{E.hide?we([]):we([{name:"blocks",color:E.color,selectedColor:E.selectedColor,radius:E.radius,points:b.map((m,v)=>({longitude:m.interior_lon,latitude:m.interior_lat,name:m.name,description:"",index:v})),click:m=>{L.select("block",m)}}])},[E,b,P,L]),N.exports.useEffect(()=>{P.hide?_e([]):_e([{name:"segments",color:P.color,selectedColor:P.activeColor,width:P.width,selectedWidth:P.activeWidth,lines:p.segments.map((m,v)=>{var Ce,De;const C=(Ce=p.vertecies[m.start])!=null?Ce:Ve,B=(De=p.vertecies[m.end])!=null?De:Ve,[[q,G],[U,M]]=At(C,B);return{startLongitude:q,startLatitude:G,endLongitude:U,endLatitude:M,name:m.name,description:`${C.lon},${C.lat} to ${B.lon},${B.lat}`,index:v}}),click:m=>{L.select("segment",m)}}])},[p,P,L]),N.exports.useEffect(()=>{pt({color:I.color,radius:I.radius,selectedColor:I.activeColor,selectedRadius:I.activeRadius,points:I.hide?[]:Object.keys(p.vertecies).map(m=>{const v=Number.parseInt(m,10),C=p.vertecies[v];return C?{longitude:C.lon,latitude:C.lat,index:v}:!1}).filter(m=>!!m),update:(m,v)=>{n(ne({index:m,vertex:v}))},select:m=>{L.select("vertex",m)}})},[I,L,p.vertecies,n]),N.exports.useEffect(()=>{$.hide?be([]):be([{name:"velocities",color:$.color,selectedColor:$.selectedColor,scale:$.scale,arrowHeadScale:$.arrowHead,width:$.width,arrows:_.map((m,v)=>{const C=Math.sqrt(m.east_vel*m.east_vel+m.north_vel*m.north_vel);return{longitude:m.lon,latitude:m.lat,direction:[m.east_vel/C,m.north_vel/C],scale:C,name:m.name,description:`north: ${m.north_vel}, east: ${m.east_vel}`,index:v}}),click:m=>{L.select("velocities",m)}}])},[L,$,_]);let H=l("span",{});switch(s){case"files":H=e?l(Et,{folder:e,files:r,setFile:async(m,v,C)=>{if(C){let B=f({},r);switch(B[m]=y(f({},B[m]),{currentFilePath:v}),m){case"segment":const q=await Ye(C);x(q),q.data&&n(te(q.data));break;case"block":const G=await et(C);h(G),G.data&&n(ee(G.data));break;case"velocity":const U=await tt(C);g(U),U.data&&n(se(U.data));break;case"command":const M=await Vn(e,C,r);d(M.commands),x(M.segments),M.segments.data&&n(te(M.segments.data)),h(M.blocks),M.blocks.data&&n(ee(M.blocks.data)),g(M.velocities),M.velocities.data&&n(se(M.velocities.data)),B=M.openableFiles;break}o(B)}}}):l("span",{});break;case"velocities":H=l(Zt,{settings:$,setSettings:J,selected:ge,velocitys:_,setVelocityData:(m,v)=>{n(v?Xe({index:m,data:v}):Ze(m))},addNewVelocity:()=>{T({label:"Click to place velocity estimate",mode:"mapClick",callback:m=>{T("normal");const v=_.length;n(Qe({data:{lat:m.lat,lon:m.lon}})),L.select("velocity",v)}})}});break;case"block":H=l(Ot,{settings:E,setSettings:rt,selected:fe,blocks:b,addNewBlock:()=>{T({label:"Click to place new block",mode:"mapClick",callback:m=>{const v=b.length;n(Pe({data:{name:"New Block",interior_lon:m.lon,interior_lat:m.lat}})),L.select("block",v),T("normal")}})},setBlockData:(m,v)=>{n(v?Be({index:m,data:v}):Ae(m))}});break;case"segment":H=l(Ut,{settings:P,setSettings:lt,segments:(Ne=p.segments)!=null?Ne:[],selected:pe,setSelectionMode:m=>T(m),addNewSegment:(m,v)=>{const C=p.segments.length;n(We({start:m,end:v})),L.select("segment",C)},setSegmentData:(m,v)=>{n(v?Je({index:m,data:v}):ze({index:m}))},splitSegment:m=>{n(Ue(m))}});break;case"vertex":H=l(tn,{settings:I,setSettings:ct,vertices:(ke=p.vertecies)!=null?ke:{},selected:xe,setVertexData:(m,v)=>{v&&n(ne({index:m,vertex:v}))},setSelectionMode:m=>T(m),mergeVertices:(m,v)=>{n(Ge({a:m,b:v}))},bridgeVertices:(m,v)=>{n(He({a:m,b:v}))},extrudeVertex:(m,v)=>{n(qe({index:m,targetPoint:v}))}});break}return w("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:m=>{m.key==="Escape"&&T("normal")},children:[l(Kt,{filesOpen:((Se=c!=null?c:u)!=null?Se:i)!==void 0,saveFiles:async()=>{c&&await c.save(),u&&(u.data=p,await u.save()),i&&(i.data=b,await i.save()),k&&(k.data=_,await k.save())},folder:e,openFolder:async()=>{const m=await En();t(m),a("files")}}),j!=="normal"?l("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:w("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[l("span",{className:"text-lg font-semibold",children:j.label}),j.subtitle?l("span",{className:"text-md font-thin text-gray-500",children:j.subtitle}):l(V,{}),l("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):l(V,{}),l(Jt,{pointSources:dt,arrowSources:ut,lineSources:ft,drawnPointSource:mt,selections:{segments:pe,blocks:fe,velocities:ge,drawnPoint:xe},click:m=>{typeof j!="string"&&j.mode==="mapClick"&&j.callback(m)}}),l(Pt,{view:H,buttons:e?Pn:void 0,active:s,setActive:m=>a(m)})]})}const An=kt({reducer:{main:St(Ct({segment:wn,block:cn,velocity:$n}))}});function Tn(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:r}=n;let o;const c=async(d=!0)=>{};return"serviceWorker"in navigator&&(o=new Dt("./sw.js",{scope:"./"}),o.addEventListener("activated",d=>{d.isUpdate?window.location.reload():s==null||s()}),o.register({immediate:e}).then(d=>{a==null||a(d)}).catch(d=>{r==null||r(d)})),c}Tn();const Hn=1,Wn=new $t({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Hn}}});Ft.render(l(N.exports.StrictMode,{children:l(Lt,{client:Wn,children:l(Vt,{store:An,children:l(Bn,{})})})}),document.querySelector("#root"));
