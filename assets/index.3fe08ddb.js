var Se=Object.defineProperty,ke=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var U=(a,e,t)=>e in a?Se(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,x=(a,e)=>{for(var t in e||(e={}))Fe.call(e,t)&&U(a,t,e[t]);if(le)for(var t of le(e))$e.call(e,t)&&U(a,t,e[t]);return a},$=(a,e)=>ke(a,Ce(e));var F=(a,e,t)=>(U(a,typeof e!="symbol"?e+"":e,t),t);import{j as Z,m as ce,r as w,a as K,M as Le,v as je,Q as De,R as Pe,b as Oe}from"./vendor.2c6bff34.js";const Me=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}};Me();const i=Z.exports.jsx,N=Z.exports.jsxs,I=Z.exports.Fragment;function We({value:a,fieldDefinition:e,setField:t}){return N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(I,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof a=="number"?"number":"text",value:a,onChange:o=>{t(typeof a=="number"?Number.parseFloat(o.target.value):o.target.value)}})})]})}function de({title:a,item:e,setItem:t,fieldDefinitions:o,deletable:r}){const n=Object.keys(e).map((l,f)=>{const s=e[l],d=l in o&&o[l];return d?{element:i(We,{value:s,fieldDefinition:d,setField:g=>t({[l]:g})},l),order:d.order}:{element:N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${l}`,className:"text-l font-bold",children:l}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${l}`,className:"rounded w-full",type:typeof s=="number"?"number":"text",value:s,onChange:g=>{t({[l]:typeof s=="number"?Number.parseFloat(g.target.value):g.target.value})}})})]},l),order:f+1e3}}).sort((l,f)=>l.order-f.order).map(l=>l.element);return N("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold",children:a}),r?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):i(I,{})]}),n]})}const Ae={color:"#0000ff",selectedColor:"#ff0000",radius:6};var xe;const Ie=JSON.parse((xe=window.localStorage.getItem("blockDisplaySettings"))!=null?xe:"false")||Ae;function Ee({settings:a,setSettings:e,selected:t,blocks:o,setBlockData:r,addNewBlock:n}){const l=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},f=o[t],s=f?i(de,{title:f.name,item:f,deletable:!0,setItem:d=>r(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(I,{});return N(I,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{l($(x({},a),{color:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.selectedColor,onChange:d=>{l($(x({},a),{selectedColor:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:a.radius,onChange:d=>{l($(x({},a),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:n,children:"New Block"})]}),s]})}function Be({folder:a,files:e,setFile:t}){const o=Object.keys(e).map(r=>{const n=e[r];return N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${r}-label`,children:n.name}),i("span",{className:"text-sm","data-testid":`file-${r}-description`,children:n.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:N("select",{"data-testid":`file-${r}-select`,className:"w-full rounded",value:n.currentFilePath,onChange:async l=>{const f=l.currentTarget.value;try{const s=await a.getFile(f);t(r,s.name,s)}catch{t(r,"")}},children:[i("option",{value:"","data-testid":`file-${r}-empty`,children:"\xA0"}),a.fileList.filter(l=>l.endsWith(n.extension)).map(l=>i("option",{value:l,"data-testid":`file-${r}-select-${l}`,children:l},l))]})})]},r)});return i("div",{className:"flex flex-col gap-2",children:o})}function Re({view:a,buttons:e,active:t,setActive:o}){if(!e)return i("span",{});const r=[];for(const n of Object.keys(e)){const l=e[n],f=n===t;r.push(i("button",{type:"button","data-testid":`tab-${n}`,className:`${f?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>o(f?"":n),children:l},n))}return N("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:a}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:r})]})}ce.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const R=Math.PI/6,J=2*Math.PI-R;function Te({pointSources:a,arrowSources:e,drawnLineSource:t,selections:o}){const r=w.exports.useRef(null),[n,l]=w.exports.useState(),[f,s]=w.exports.useState(!1),[d,g]=w.exports.useState(),[L]=w.exports.useState(new K.exports.Popup({closeButton:!1,closeOnClick:!1})),[P,T]=w.exports.useState({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),[O,z]=w.exports.useState(),[W,H]=w.exports.useState(),[C,q]=w.exports.useState({}),[A,Q]=w.exports.useState({});return w.exports.useEffect(()=>{if(!n&&ce.accessToken&&r.current){const m=new K.exports.Map({container:r.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});m.addControl(new K.exports.NavigationControl),l(m),m.on("load",()=>{s(!0)}),m.on("draw.selectionchange",({features:S})=>{var p;if(!((p=C.source)==null?void 0:p.clickLine))return;let u=-1;for(const _ of S)if(_.geometry.type==="LineString"&&_.properties&&"index"in _.properties&&typeof _.properties.index=="number"){u=_.properties.index,d==null||d.changeMode("direct_select",{featureId:_.id});break}C.source.clickLine(u)}),m.on("draw.create",({features:S})=>{var p;if(console.log("CREATING LINE"),!((p=C.source)==null?void 0:p.createLine))return;const u=[];for(const _ of S)if(_.geometry.type==="LineString")for(const h of _.geometry.coordinates)u.push({lon:h[0],lat:h[1]});u.length>1&&C.source.createLine(u)}),m.on("draw.update",({features:S})=>{var _;if(console.log("UPDATING LINE"),!((_=C.source)==null?void 0:_.updateLine))return;console.log("Got the function");const u=[];let p=-1;for(const h of S)if(h.geometry.type==="LineString"&&h.properties&&"index"in h.properties&&typeof h.properties.index=="number"){console.log("Found the feature"),p=h.properties.index;for(const y of h.geometry.coordinates)u.push({lon:y[0],lat:y[1]});break}console.log("will call update function"),u.length>1&&p>-1&&(console.log("Calling update function"),C.source.updateLine(p,u))})}console.log("Updating map...")},[d,C,n]),w.exports.useEffect(()=>{if(n&&f&&C.source!==t){console.log("Drawning lines"),C.source=t,q(C);let m=d;(t.activeColor!==P.activeColor||t.activeWidth!==P.activeWidth||t.color!==P.color||t.width!==P.width)&&(T({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),d&&n.removeControl(d),t.active?(m=new Le({displayControlsDefault:!1,controls:{line_string:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":2*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth+2,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.activeColor,"line-dasharray":[.2,2],"line-width":t.activeWidth}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}}]}),n.addControl(m),g(m)):m=void 0),m&&m.set({type:"FeatureCollection",features:t.lines.flatMap(S=>[{type:"Feature",properties:{name:S.name,index:S.index,selected:o.drawnLine===S.index},id:S.index,geometry:{type:"LineString",coordinates:[[S.startLongitude,S.startLatitude],[S.endLongitude,S.endLatitude]]}}])})}},[n,f,C,t,P,d,o.drawnLine]),w.exports.useEffect(()=>{if(!n||!f)return;if(O!==a)if(console.log("Setting points in map!"),O){for(const u of O){const p=n.getSource(`point:${u.name}`);p!==void 0&&p.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${u.name}`)}z(void 0)}else{for(const u of a){let p=n.getSource(`point:${u.name}`);const _=p===void 0;_&&(n.addSource(`point:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p=n.getSource(`point:${u.name}`)),p!==void 0&&p.setData({type:"FeatureCollection",features:u.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index!==o[u.name]},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))}),n.addLayer({id:`layer:point:${u.name}`,type:"circle",source:`point:${u.name}`,paint:{"circle-color":["case",["get","selected"],u.selectedColor,u.color],"circle-radius":u.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),_&&(n.on("mouseenter",`layer:point:${u.name}`,h=>{if(!h.features)return;const y=h.features[0];if(y.geometry.type==="Point"&&y.properties&&typeof y.properties.description=="string"){const j=[...y.geometry.coordinates],{description:M}=y.properties;for(;Math.abs(h.lngLat.lng-j[0])>180;)j[0]+=h.lngLat.lng>j[0]?360:-360;L.setLngLat(j).setHTML(M).addTo(n)}}),n.on("mouseleave",`layer:point:${u.name}`,()=>{L.remove()}),n.on("click",`layer:point:${u.name}`,h=>{if(!h.features||!u.clickPoint)return;const y=h.features[0];if(y.properties&&typeof y.properties.index=="number"&&typeof y.properties.name=="string"){const{index:j,name:M}=y.properties;u.clickPoint(j,M)}}))}z(a)}const m=x({},A);let S=!1;for(const u of Object.keys(o))if(o[u]!==A[u]){for(const p of a)if(p.name===u){S=!0,m[u]=o[u];const _=n.getSource(`point:${p.name}`);if(_){const h=o[u];_.setData({type:"FeatureCollection",features:p.points.map(y=>({type:"Feature",properties:{description:`<strong>${y.name}</strong><p>${y.description}</p>`,index:y.index,name:y.name,selected:y.index!==h},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}}))})}}}S&&Q(m)},[n,O,a,f,L,o,A]),w.exports.useEffect(()=>{if(n&&f&&W!==e)if(console.log("Setting arrows in map!"),W){for(const m of W){const S=n.getSource(`arrow:${m.name}`);S!==void 0&&S.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${m.name}`)}H(void 0)}else{for(const m of e){let S=n.getSource(`arrow:${m.name}`);const u=S===void 0;u&&(n.addSource(`arrow:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),S=n.getSource(`arrow:${m.name}`)),S!==void 0&&S.setData({type:"FeatureCollection",features:m.arrows.map((p,_)=>{const h=p.scale*m.scale,y=m.scale*m.arrowHeadScale,j=[p.longitude+p.direction[0]*h,p.latitude+p.direction[1]*h],M=[j[0]+(Math.cos(R)*-p.direction[0]-Math.sin(R)*-p.direction[1])*y,j[1]+(Math.sin(R)*-p.direction[0]+Math.cos(R)*-p.direction[1])*y],V=[j[0]+(Math.cos(J)*-p.direction[0]-Math.sin(J)*-p.direction[1])*y,j[1]+(Math.sin(J)*-p.direction[0]+Math.cos(J)*-p.direction[1])*y];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:_,name:p.name},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],j,M,j,V]}}})}),n.addLayer({id:`layer:arrow:${m.name}`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":m.color,"line-width":m.width}}),u&&(n.on("mouseenter",`layer:arrow:${m.name}`,p=>{if(!p.features)return;const _=p.features[0];if(_.geometry.type==="Point"&&_.properties&&typeof _.properties.description=="string"){const h=[..._.geometry.coordinates],{description:y}=_.properties;for(;Math.abs(p.lngLat.lng-h[0])>180;)h[0]+=p.lngLat.lng>h[0]?360:-360;L.setLngLat(h).setHTML(y).addTo(n)}}),n.on("mouseleave",`layer:arrow:${m.name}`,()=>{L.remove()}),n.on("click",`layer:arrow:${m.name}`,p=>{if(!p.features||!m.clickArrow)return;const _=p.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:h,name:y}=_.properties;m.clickArrow(h,y)}}))}H(e)}},[n,W,e,f,L]),i("div",{"data-testid":"map",className:"w-full h-full",ref:r})}const ze={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2};var be;const He=JSON.parse((be=window.localStorage.getItem("segmentDisplaySettings"))!=null?be:"false")||ze;function Ve({settings:a,setSettings:e,segments:t,selected:o,setSegmentData:r,addNewSegment:n}){const l=d=>{e(d),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(d))},f=t[o],s=f?i(de,{title:f.name,item:f,deletable:!0,setItem:d=>r(o,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(I,{});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{l($(x({},a),{color:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:d=>{l($(x({},a),{width:Number.parseFloat(d.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.activeColor,onChange:d=>{l($(x({},a),{activeColor:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.activeWidth,onChange:d=>{l($(x({},a),{activeWidth:Number.parseFloat(d.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:n,children:"New Segment"})]}),s]})}function Je({folder:a,openFolder:e,filesOpen:t,saveFiles:o}){function r(){e()}return N("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"Celeri UI"}),N("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[a?N("span",{children:["Working in ",a.name]}):i("button",{type:"button",onClick:r,"data-testid":"open-folder-button",children:"Open Folder"}),t?i("button",{type:"button",onClick:o,"data-testid":"save-file-button",children:"Save Files"}):i(I,{})]})]})}const Ge={color:"#ffff00",scale:.02,width:1,arrowHead:1};var Ne;const qe=JSON.parse((Ne=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ne:"false")||Ge;function Qe({settings:a,setSettings:e}){const t=o=>{e(o),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(o))};return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:o=>{t($(x({},a),{color:o.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:a.scale,onChange:o=>{t($(x({},a),{scale:Number.parseFloat(o.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:o=>{t($(x({},a),{width:Number.parseFloat(o.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:a.arrowHead,onChange:o=>{t($(x({},a),{arrowHead:Number.parseFloat(o.target.value)}))}})})]})]})}function X(a){const e=a.split(/\n/g),t=e[0].split(","),o=e.slice(1),r=[];for(const n of o){const l=n.split(/\s*,\s*/),f={};for(let s=0;s<t.length;s+=1){let d=l[s];const g=t[s],L=Number.parseFloat(d);d=Number.isNaN(L)?d:L,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),f[g]=d}r.push(f)}return r}function Y(a,e){const t=[e.join(",")];for(const o of a){const r=o;t.push(e.map(n=>n in r?typeof r[n]=="string"&&/\s/.test(`${r[n]}`)?`"${r[n]}"`:`${r[n]}`:"").join(","))}return t.join(`
`)}const pe=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ue={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function fe(a){return x(x({},Ue),a)}class ee{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=X(e).map(r=>{const n={};for(const l of pe)n[l]=r[l]||(l==="name"?"":0);return n});this.data=o}async save(){var t;const e=Y((t=this.data)!=null?t:[],pe);await this.handle.setContents(e)}clone(){return new ee(this.handle)}}const Ze={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Ke(a){return x(x({},Ze),a)}class te{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Ke(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new te(this.handle)}}const ue=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],me={name:"unnamed segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:0,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:0,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function G(a,e){const t=e!=null?e:me;let o=a[0];const r=[];for(let n=1;n<a.length;n+=1){const l=a[n],f=$(x({},t),{lon1:o.lon,lat1:o.lat,lon2:l.lon,lat2:l.lat});r.push(f),o=l}return r}function he(a){return x(x({},me),a)}class ae{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=X(e).map(r=>{const n={};for(const l of ue)n[l]=r[l]||(l==="name"?"":0);return n});this.data=o}async save(){var t;const e=Y((t=this.data)!=null?t:[],ue);await this.handle.setContents(e)}clone(){return new ae(this.handle)}}const ge=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class ne{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=X(e).map(r=>{const n={};for(const l of ge)n[l]=r[l]||(l==="name"?"":0);return n});this.data=o}async save(){var t;const e=Y((t=this.data)!=null?t:[],ge);await this.handle.setContents(e)}clone(){return new ne(this.handle)}}async function _e(a){const e=new ae(a);return await e.initialize(),e}async function we(a){const e=new ee(a);return await e.initialize(),e}async function ye(a){const e=new ne(a);return await e.initialize(),e}async function Xe(a,e,t){const o=new te(e);if(await o.initialize(),o.data){const r=await _e(await a.getFile(o.data.segment_file_name)),n=await we(await a.getFile(o.data.block_file_name)),l=await ye(await a.getFile(o.data.station_file_name)),f=x({},t);return"command"in f&&(f.command=$(x({},f.command),{currentFilePath:e.name})),"segment"in f&&(f.segment=$(x({},f.segment),{currentFilePath:o.data.segment_file_name})),"block"in f&&(f.block=$(x({},f.block),{currentFilePath:o.data.block_file_name})),"velocities"in f&&(f.velocities=$(x({},f.velocities),{currentFilePath:o.data.station_file_name})),{openableFiles:f,commands:o,segments:r,blocks:n,velocities:l}}throw new Error("Can't open command file")}class Ye{constructor(e){F(this,"name");F(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class ie{constructor(e){F(this,"name");F(this,"handle");F(this,"fileList");F(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Ye(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),o=new ie(t);return await o.initialize(),o}}const et=async()=>{const a=await window.showDirectoryPicker(),e=new ie(a);return await e.initialize(),e};class tt{constructor(e,t){F(this,"name");F(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class oe{constructor(e,t){F(this,"name");F(this,"parent");F(this,"fileList");F(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const o=t[e];for(const r of Object.keys(o))typeof o[r]=="string"?this.fileList.push(r):this.folderList.push(r)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new tt(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new oe(e,this.parent[this.name])}}const at=async a=>new oe("root",a);let ve=async()=>{var e;return at((e=window.FakeDirectory)!=null?e:{})};function nt(a){ve=a}async function it(){return ve()}window.location.search.includes("fake-dir")||nt(et);const ot={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities"};function st(){var V,se,re;const[a,e]=w.exports.useState(),[t,o]=w.exports.useState(""),[r,n]=w.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[l,f]=w.exports.useState(),[s,d]=w.exports.useState(),[g,L]=w.exports.useState(),[P,T]=w.exports.useState(),[O,z]=w.exports.useState(qe),[W,H]=w.exports.useState(Ie),[C,q]=w.exports.useState(He),[A,Q]=w.exports.useState(-1),[m,S]=w.exports.useState(-1),[u,p]=w.exports.useState([]),[_,h]=w.exports.useState([]),[y,j]=w.exports.useState({color:C.color,activeColor:C.activeColor,activeWidth:C.activeWidth,width:C.width,active:s!==void 0,lines:[],clickLine:c=>{S(c),o("segment")},createLine:c=>{if(console.log("Creating line @",c),s==null?void 0:s.data){const b=G(c),v=[...s.data,...b],k=s.clone();k.data=v,d(k)}},updateLine:(c,b)=>{var v;if(console.log("update line @",c),(v=s==null?void 0:s.data)==null?void 0:v[c]){const k=s.data[c],D=G(b,k),E=[...s.data];E.splice(c,1,...D);const B=s.clone();B.data=E,d(B)}}});w.exports.useEffect(()=>{p([{name:"blocks",color:W.color,selectedColor:W.selectedColor,radius:W.radius,points:(g==null?void 0:g.data)?g.data.map((c,b)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:b})):[],clickPoint:(c,b)=>{Q(c),o("block")}}])},[W,g]),w.exports.useEffect(()=>{h([{name:"velocity",color:O.color,scale:O.scale,arrowHeadScale:O.arrowHead,width:O.width,arrows:(P==null?void 0:P.data)?P.data.map(c=>{const b=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/b,c.north_vel/b],scale:b,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`}}):[]}])},[O,P]),w.exports.useEffect(()=>{j({color:C.color,activeColor:C.activeColor,activeWidth:C.activeWidth,width:C.width,active:s!==void 0,lines:(s==null?void 0:s.data)?s.data.map((c,b)=>({startLongitude:c.lon1,endLongitude:c.lon2,startLatitude:c.lat1,endLatitude:c.lat2,name:c.name,index:b,description:""})):[],clickLine:c=>{S(c),o("segment")},createLine:c=>{if(s==null?void 0:s.data){const b=G(c),v=[...s.data,...b],k=s.clone();k.data=v,d(k)}},updateLine:(c,b)=>{var v;if(console.log("update line @",c),(v=s==null?void 0:s.data)==null?void 0:v[c]){const k=s.data[c],D=G(b,k),E=[...s.data];E.splice(c,1,...D);const B=s.clone();B.data=E,d(B)}}})},[C,s]);let M=i("span",{});switch(t){case"files":M=a?i(Be,{folder:a,files:r,setFile:async(c,b,v)=>{if(v){let k=x({},r);switch(k[c]=$(x({},k[c]),{currentFilePath:b}),c){case"segment":d(await _e(v));break;case"block":L(await we(v));break;case"velocity":T(await ye(v));break;case"command":const D=await Xe(a,v,r);f(D.commands),d(D.segments),L(D.blocks),T(D.velocities),k=D.openableFiles;break}n(k)}}}):i("span",{});break;case"velocities":M=i(Qe,{settings:O,setSettings:z});break;case"block":M=i(Ee,{settings:W,setSettings:H,selected:A,blocks:(V=g==null?void 0:g.data)!=null?V:[],addNewBlock:()=>{if(g!==void 0){const c=g.data?[...g.data]:[],b=fe({});c.push(b);const v=g.clone();v.data=c,L(v)}},setBlockData:(c,b)=>{if(g!==void 0)if(b){const v=g.data&&g.data[c]?x(x({},g.data[c]),b):fe(b),k=g.data?[...g.data]:[];k[c]=v;const D=g.clone();D.data=k,L(D)}else{const v=g.data?[...g.data]:[];v.splice(c,1);const k=g.clone();k.data=v,L(k)}}});break;case"segment":M=i(Ve,{settings:C,setSettings:q,segments:(se=s==null?void 0:s.data)!=null?se:[],selected:m,addNewSegment:()=>{if(s!==void 0){const c=s.data?[...s.data]:[],b=he({});c.push(b);const v=s.clone();v.data=c,d(v)}},setSegmentData:(c,b)=>{if(s!==void 0)if(b){const v=s.data&&s.data[c]?x(x({},s.data[c]),b):he(b),k=s.data?[...s.data]:[];k[c]=v;const D=s.clone();D.data=k,d(D)}else{const v=s.data?[...s.data]:[];v.splice(c,1);const k=s.clone();k.data=v,d(k)}}});break}return N("div",{className:"w-screen h-screen flex flex-col",children:[i(Je,{filesOpen:((re=l!=null?l:s)!=null?re:g)!==void 0,saveFiles:async()=>{l&&await l.save(),s&&await s.save(),g&&await g.save()},folder:a,openFolder:async()=>{const c=await it();e(c),o("files")}}),i(Te,{pointSources:u,arrowSources:_,drawnLineSource:y,selections:{drawnLine:m,blocks:A}}),i(Re,{view:M,buttons:a?ot:void 0,active:t,setActive:c=>o(c)})]})}function rt(a={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:r,onRegisterError:n}=a;let l;const f=async(s=!0)=>{};return"serviceWorker"in navigator&&(l=new je("./sw.js",{scope:"./"}),l.addEventListener("activated",s=>{s.isUpdate?window.location.reload():o==null||o()}),l.register({immediate:e}).then(s=>{r==null||r(s)}).catch(s=>{n==null||n(s)})),f}rt();const lt=1,ct=new De({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:lt}}});Pe.render(i(w.exports.StrictMode,{children:i(Oe,{client:ct,children:i(st,{})})}),document.querySelector("#root"));
