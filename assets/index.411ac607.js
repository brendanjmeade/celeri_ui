var $e=Object.defineProperty,je=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var Z=(a,e,t)=>e in a?$e(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,y=(a,e)=>{for(var t in e||(e={}))De.call(e,t)&&Z(a,t,e[t]);if(fe)for(var t of fe(e))Ae.call(e,t)&&Z(a,t,e[t]);return a},L=(a,e)=>je(a,Le(e));var $=(a,e,t)=>(Z(a,typeof e!="symbol"?e+"":e,t),t);import{j as K,m as ue,r as v,a as X,M as Pe,v as Oe,Q as Ie,R as We,b as Me}from"./vendor.2c6bff34.js";const Ee=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function t(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerpolicy&&(n.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?n.credentials="include":l.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(l){if(l.ep)return;l.ep=!0;const n=t(l);fetch(l.href,n)}};Ee();const i=K.exports.jsx,S=K.exports.jsxs,I=K.exports.Fragment;function Ve({value:a,fieldDefinition:e,setField:t}){return S("div",{className:"flex flex-row justify-between items-center",children:[S("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(I,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof a=="number"?"number":"text",value:a,onChange:c=>{t(typeof a=="number"?Number.parseFloat(c.target.value):c.target.value)}})})]})}function Y({title:a,item:e,setItem:t,fieldDefinitions:c,deletable:l}){const n=Object.keys(e).map((r,p)=>{const o=e[r],d=r in c&&c[r];return d?{element:i(Ve,{value:o,fieldDefinition:d,setField:w=>t({[r]:w})},r),order:d.order}:{element:S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${r}`,className:"text-l font-bold",children:r}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${r}`,className:"rounded w-full",type:typeof o=="number"?"number":"text",value:o,onChange:w=>{t({[r]:typeof o=="number"?Number.parseFloat(w.target.value):w.target.value})}})})]},r),order:p+1e3}}).sort((r,p)=>r.order-p.order).map(r=>r.element);return S("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold",children:a}),l?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):i(I,{})]}),n]})}const Be={color:"#0000ff",selectedColor:"#ff0000",radius:6};var ke;const Re=JSON.parse((ke=window.localStorage.getItem("blockDisplaySettings"))!=null?ke:"false")||Be;function Te({settings:a,setSettings:e,selected:t,blocks:c,setBlockData:l,addNewBlock:n}){const r=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},p=c[t],o=p?i(Y,{title:p.name,item:p,deletable:!0,setItem:d=>l(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(I,{});return S(I,{children:[S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{r(L(y({},a),{color:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.selectedColor,onChange:d=>{r(L(y({},a),{selectedColor:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:a.radius,onChange:d=>{r(L(y({},a),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:n,children:"New Block"})]}),o]})}function ze({folder:a,files:e,setFile:t}){const c=Object.keys(e).map(l=>{const n=e[l];return S("div",{className:"flex flex-row justify-between items-center",children:[S("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${l}-label`,children:n.name}),i("span",{className:"text-sm","data-testid":`file-${l}-description`,children:n.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:S("select",{"data-testid":`file-${l}-select`,className:"w-full rounded",value:n.currentFilePath,onChange:async r=>{const p=r.currentTarget.value;try{const o=await a.getFile(p);t(l,o.name,o)}catch{t(l,"")}},children:[i("option",{value:"","data-testid":`file-${l}-empty`,children:"\xA0"}),a.fileList.filter(r=>r.endsWith(n.extension)).map(r=>i("option",{value:r,"data-testid":`file-${l}-select-${r}`,children:r},r))]})})]},l)});return i("div",{className:"flex flex-col gap-2",children:c})}function He({view:a,buttons:e,active:t,setActive:c}){if(!e)return i("span",{});const l=[];for(const n of Object.keys(e)){const r=e[n],p=n===t;l.push(i("button",{type:"button","data-testid":`tab-${n}`,className:`${p?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>c(p?"":n),children:r},n))}return S("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:a}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:l})]})}ue.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const T=Math.PI/6,J=2*Math.PI-T;function Je({pointSources:a,arrowSources:e,drawnLineSource:t,selections:c}){const l=v.exports.useRef(null),[n,r]=v.exports.useState(),[p,o]=v.exports.useState(!1),[d,w]=v.exports.useState(),[D]=v.exports.useState(new X.exports.Popup({closeButton:!1,closeOnClick:!1})),[k,W]=v.exports.useState({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),[P,z]=v.exports.useState(),[O,H]=v.exports.useState(),[F,q]=v.exports.useState({}),[E,Q]=v.exports.useState({});return v.exports.useEffect(()=>{if(!n&&ue.accessToken&&l.current){const u=new X.exports.Map({container:l.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});u.addControl(new X.exports.NavigationControl),r(u),u.on("load",()=>{o(!0)}),u.on("draw.selectionchange",({features:C})=>{var f;if(!((f=F.source)==null?void 0:f.clickLine))return;let m=-1;for(const b of C)if(b.geometry.type==="LineString"&&b.properties&&"index"in b.properties&&typeof b.properties.index=="number"){m=b.properties.index,d==null||d.changeMode("direct_select",{featureId:b.id});break}F.source.clickLine(m)}),u.on("draw.create",({features:C})=>{var f;if(console.log("CREATING LINE"),!((f=F.source)==null?void 0:f.createLine))return;const m=[];for(const b of C)if(b.geometry.type==="LineString")for(const h of b.geometry.coordinates)m.push({lon:h[0],lat:h[1]});m.length>1&&F.source.createLine(m)}),u.on("draw.update",({features:C})=>{var b;if(console.log("UPDATING LINE"),!((b=F.source)==null?void 0:b.updateLine))return;console.log("Got the function");const m=[];let f=-1;for(const h of C)if(h.geometry.type==="LineString"&&h.properties&&"index"in h.properties&&typeof h.properties.index=="number"){console.log("Found the feature"),f=h.properties.index;for(const x of h.geometry.coordinates)m.push({lon:x[0],lat:x[1]});break}console.log("will call update function"),m.length>1&&f>-1&&(console.log("Calling update function"),F.source.updateLine(f,m))})}console.log("Updating map...")},[d,F,n]),v.exports.useEffect(()=>{if(n&&p&&F.source!==t){console.log("Drawning lines"),F.source=t,q(F);let u=d;(t.activeColor!==k.activeColor||t.activeWidth!==k.activeWidth||t.color!==k.color||t.width!==k.width)&&(W({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),d&&n.removeControl(d),t.active?(u=new Pe({displayControlsDefault:!1,controls:{line_string:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":2*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth+2,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.activeColor,"line-dasharray":[.2,2],"line-width":t.activeWidth}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}}]}),n.addControl(u),w(u)):u=void 0),u&&u.set({type:"FeatureCollection",features:[{type:"Feature",id:0,properties:{},geometry:{type:"MultiLineString",coordinates:t.lines.map(C=>[[C.startLongitude,C.startLatitude],[C.endLongitude,C.endLatitude]])}}]})}},[n,p,F,t,k,d,c.drawnLine]),v.exports.useEffect(()=>{if(!n||!p)return;if(P!==a)if(console.log("Setting points in map!"),P){for(const m of P){const f=n.getSource(`point:${m.name}`);f!==void 0&&f.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${m.name}`)}z(void 0)}else{for(const m of a){let f=n.getSource(`point:${m.name}`);const b=f===void 0;b&&(n.addSource(`point:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),f=n.getSource(`point:${m.name}`)),f!==void 0&&f.setData({type:"FeatureCollection",features:m.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index!==c[m.name]},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))}),n.addLayer({id:`layer:point:${m.name}`,type:"circle",source:`point:${m.name}`,paint:{"circle-color":["case",["get","selected"],m.selectedColor,m.color],"circle-radius":m.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),b&&(n.on("mouseenter",`layer:point:${m.name}`,h=>{if(!h.features)return;const x=h.features[0];if(x.geometry.type==="Point"&&x.properties&&typeof x.properties.description=="string"){const A=[...x.geometry.coordinates],{description:M}=x.properties;for(;Math.abs(h.lngLat.lng-A[0])>180;)A[0]+=h.lngLat.lng>A[0]?360:-360;D.setLngLat(A).setHTML(M).addTo(n)}}),n.on("mouseleave",`layer:point:${m.name}`,()=>{D.remove()}),n.on("click",`layer:point:${m.name}`,h=>{if(!h.features||!m.clickPoint)return;const x=h.features[0];if(x.properties&&typeof x.properties.index=="number"&&typeof x.properties.name=="string"){const{index:A,name:M}=x.properties;m.clickPoint(A,M)}}))}z(a)}const u=y({},E);let C=!1;for(const m of Object.keys(c))if(c[m]!==E[m]){for(const f of a)if(f.name===m){C=!0,u[m]=c[m];const b=n.getSource(`point:${f.name}`);if(b){const h=c[m];b.setData({type:"FeatureCollection",features:f.points.map(x=>({type:"Feature",properties:{description:`<strong>${x.name}</strong><p>${x.description}</p>`,index:x.index,name:x.name,selected:x.index!==h},geometry:{type:"Point",coordinates:[x.longitude,x.latitude]}}))})}}}C&&Q(u)},[n,P,a,p,D,c,E]),v.exports.useEffect(()=>{if(n&&p&&O!==e)if(console.log("Setting arrows in map!"),O){for(const u of O){const C=n.getSource(`arrow:${u.name}`);C!==void 0&&C.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${u.name}`),n.removeLayer(`layer:arrow:${u.name}:click`)}H(void 0)}else{for(const u of e){let C=n.getSource(`arrow:${u.name}`);const m=C===void 0;m&&(n.addSource(`arrow:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),C=n.getSource(`arrow:${u.name}`)),C!==void 0&&C.setData({type:"FeatureCollection",features:u.arrows.map((f,b)=>{const h=f.scale*u.scale,x=u.scale*u.arrowHeadScale,A=[f.longitude+f.direction[0]*h,f.latitude+f.direction[1]*h],M=[A[0]+(Math.cos(T)*-f.direction[0]-Math.sin(T)*-f.direction[1])*x,A[1]+(Math.sin(T)*-f.direction[0]+Math.cos(T)*-f.direction[1])*x],U=[A[0]+(Math.cos(J)*-f.direction[0]-Math.sin(J)*-f.direction[1])*x,A[1]+(Math.sin(J)*-f.direction[0]+Math.cos(J)*-f.direction[1])*x];return{type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:b,name:f.name},geometry:{type:"LineString",coordinates:[[f.longitude,f.latitude],A,M,A,U]}}})}),n.addLayer({id:`layer:arrow:${u.name}`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":u.color,"line-width":u.width}}),n.addLayer({id:`layer:arrow:${u.name}:click`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":u.width*10}}),m&&(n.on("mouseenter",`layer:arrow:${u.name}:click`,f=>{if(!f.features)return;const b=f.features[0];if(b.geometry.type==="Point"&&b.properties&&typeof b.properties.description=="string"){const h=[...b.geometry.coordinates],{description:x}=b.properties;for(;Math.abs(f.lngLat.lng-h[0])>180;)h[0]+=f.lngLat.lng>h[0]?360:-360;D.setLngLat(h).setHTML(x).addTo(n)}}),n.on("mouseleave",`layer:arrow:${u.name}:click`,()=>{D.remove()}),n.on("click",`layer:arrow:${u.name}:click`,f=>{if(console.log("CLICKED AN ARROW"),!f.features||!u.clickArrow)return;const b=f.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:h,name:x}=b.properties;u.clickArrow(h,x)}}))}H(e)}},[n,O,e,p,D]),i("div",{"data-testid":"map",className:"w-full h-full",ref:l})}const Ge={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2};var Ce;const qe=JSON.parse((Ce=window.localStorage.getItem("segmentDisplaySettings"))!=null?Ce:"false")||Ge;function Qe({settings:a,setSettings:e,segments:t,selected:c,setSegmentData:l,addNewSegment:n}){const r=d=>{e(d),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(d))},p=t[c],o=p?i(Y,{title:p.name,item:p,deletable:!0,setItem:d=>l(c,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(I,{});return S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{r(L(y({},a),{color:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:d=>{r(L(y({},a),{width:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.activeColor,onChange:d=>{r(L(y({},a),{activeColor:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.activeWidth,onChange:d=>{r(L(y({},a),{activeWidth:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:n,children:"New Segment"})]}),o]})}function Ue({folder:a,openFolder:e,filesOpen:t,saveFiles:c}){function l(){e()}return S("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"Celeri UI"}),S("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[a?S("span",{children:["Working in ",a.name]}):i("button",{type:"button",onClick:l,"data-testid":"open-folder-button",children:"Open Folder"}),t?i("button",{type:"button",onClick:c,"data-testid":"save-file-button",children:"Save Files"}):i(I,{})]})]})}const Ze={color:"#ffff00",scale:.02,width:1,arrowHead:1};var Fe;const Ke=JSON.parse((Fe=window.localStorage.getItem("velocityDisplaySettings"))!=null?Fe:"false")||Ze;function Xe({settings:a,setSettings:e,selected:t,velocitys:c,setVelocityData:l,addNewVelocity:n}){const r=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},p=c[t],o=p?i(Y,{title:p.name,item:p,deletable:!0,setItem:d=>l(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(I,{});return S(I,{children:[S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{r(L(y({},a),{color:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:a.scale,onChange:d=>{r(L(y({},a),{scale:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:d=>{r(L(y({},a),{width:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:a.arrowHead,onChange:d=>{r(L(y({},a),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:n,children:"New Velocity"})]}),o]})}function ee(a){const e=a.split(/\n/g),t=e[0].split(","),c=e.slice(1),l=[];for(const n of c){const r=n.split(/\s*,\s*/),p={};for(let o=0;o<t.length;o+=1){let d=r[o];const w=t[o],D=Number.parseFloat(d);d=Number.isNaN(D)?d:D,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),p[w]=d}l.push(p)}return l}function te(a,e){const t=[e.join(",")];for(const c of a){const l=c;t.push(e.map(n=>n in l?typeof l[n]=="string"&&/\s/.test(`${l[n]}`)?`"${l[n]}"`:`${l[n]}`:"").join(","))}return t.join(`
`)}const me=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ye={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function he(a){return y(y({},Ye),a)}class ae{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),c=ee(e).map(l=>{const n={};for(const r of me)n[r]=l[r]||(r==="name"?"":0);return n});this.data=c}async save(){var t;const e=te((t=this.data)!=null?t:[],me);await this.handle.setContents(e)}clone(){return new ae(this.handle)}}const et={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function tt(a){return y(y({},et),a)}class ne{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=tt(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new ne(this.handle)}}const ge=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],_e={name:"unnamed segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:0,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:0,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function G(a,e){const t=e!=null?e:_e;let c=a[0];const l=[];for(let n=1;n<a.length;n+=1){const r=a[n],p=L(y({},t),{lon1:c.lon,lat1:c.lat,lon2:r.lon,lat2:r.lat});l.push(p),c=r}return l}function ye(a){return y(y({},_e),a)}class ie{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),c=ee(e).map(l=>{const n={};for(const r of ge)n[r]=l[r]||(r==="name"?"":0);return n});this.data=c}async save(){var t;const e=te((t=this.data)!=null?t:[],ge);await this.handle.setContents(e)}clone(){return new ie(this.handle)}}const we=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],at={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function ve(a){return y(y({},at),a)}class oe{constructor(e){$(this,"handle");$(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),c=ee(e).map(l=>{const n={};for(const r of we)n[r]=l[r]||(r==="name"?"":0);return n});this.data=c}async save(){var t;const e=te((t=this.data)!=null?t:[],we);await this.handle.setContents(e)}clone(){return new oe(this.handle)}}async function be(a){const e=new ie(a);return await e.initialize(),e}async function xe(a){const e=new ae(a);return await e.initialize(),e}async function Ne(a){const e=new oe(a);return await e.initialize(),e}async function nt(a,e,t){const c=new ne(e);if(await c.initialize(),c.data){const l=await be(await a.getFile(c.data.segment_file_name)),n=await xe(await a.getFile(c.data.block_file_name)),r=await Ne(await a.getFile(c.data.station_file_name)),p=y({},t);return"command"in p&&(p.command=L(y({},p.command),{currentFilePath:e.name})),"segment"in p&&(p.segment=L(y({},p.segment),{currentFilePath:c.data.segment_file_name})),"block"in p&&(p.block=L(y({},p.block),{currentFilePath:c.data.block_file_name})),"velocities"in p&&(p.velocities=L(y({},p.velocities),{currentFilePath:c.data.station_file_name})),{openableFiles:p,commands:c,segments:l,blocks:n,velocities:r}}throw new Error("Can't open command file")}class it{constructor(e){$(this,"name");$(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class se{constructor(e){$(this,"name");$(this,"handle");$(this,"fileList");$(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new it(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),c=new se(t);return await c.initialize(),c}}const ot=async()=>{const a=await window.showDirectoryPicker(),e=new se(a);return await e.initialize(),e};class st{constructor(e,t){$(this,"name");$(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class re{constructor(e,t){$(this,"name");$(this,"parent");$(this,"fileList");$(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const c=t[e];for(const l of Object.keys(c))typeof c[l]=="string"?this.fileList.push(l):this.folderList.push(l)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new st(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new re(e,this.parent[this.name])}}const rt=async a=>new re("root",a);let Se=async()=>{var e;return rt((e=window.FakeDirectory)!=null?e:{})};function lt(a){Se=a}async function ct(){return Se()}window.location.search.includes("fake-dir")||lt(ot);const dt={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities"};function pt(){var le,ce,de,pe;const[a,e]=v.exports.useState(),[t,c]=v.exports.useState(""),[l,n]=v.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[r,p]=v.exports.useState(),[o,d]=v.exports.useState(),[w,D]=v.exports.useState(),[k,W]=v.exports.useState(),[P,z]=v.exports.useState(Ke),[O,H]=v.exports.useState(Re),[F,q]=v.exports.useState(qe),[E,Q]=v.exports.useState(-1),[u,C]=v.exports.useState(-1),[m,f]=v.exports.useState(-1),[b,h]=v.exports.useState([]),[x,A]=v.exports.useState([]),[M,U]=v.exports.useState({color:F.color,activeColor:F.activeColor,activeWidth:F.activeWidth,width:F.width,active:o!==void 0,lines:[],clickLine:s=>{C(s),c("segment")},createLine:s=>{if(console.log("Creating line @",s),o==null?void 0:o.data){const _=G(s),g=[...o.data,..._],N=o.clone();N.data=g,d(N)}},updateLine:(s,_)=>{var g;if(console.log("update line @",s),(g=o==null?void 0:o.data)==null?void 0:g[s]){const N=o.data[s],j=G(_,N),B=[...o.data];B.splice(s,1,...j);const R=o.clone();R.data=B,d(R)}}});v.exports.useEffect(()=>{h([{name:"blocks",color:O.color,selectedColor:O.selectedColor,radius:O.radius,points:(w==null?void 0:w.data)?w.data.map((s,_)=>({longitude:s.interior_lon,latitude:s.interior_lat,name:s.name,description:"",index:_})):[],clickPoint:(s,_)=>{Q(s),c("block")}}])},[O,w]),v.exports.useEffect(()=>{A([{name:"velocity",color:P.color,scale:P.scale,arrowHeadScale:P.arrowHead,width:P.width,arrows:(k==null?void 0:k.data)?k.data.map(s=>{const _=Math.sqrt(s.east_vel*s.east_vel+s.north_vel*s.north_vel);return{longitude:s.lon,latitude:s.lat,direction:[s.east_vel/_,s.north_vel/_],scale:_,name:s.name,description:`north: ${s.north_vel}, east: ${s.east_vel}`}}):[],clickArrow:s=>{f(s),c("velocities")}}])},[P,k]),v.exports.useEffect(()=>{U({color:F.color,activeColor:F.activeColor,activeWidth:F.activeWidth,width:F.width,active:o!==void 0,lines:(o==null?void 0:o.data)?o.data.map((s,_)=>({startLongitude:s.lon1,endLongitude:s.lon2,startLatitude:s.lat1,endLatitude:s.lat2,name:s.name,index:_,description:""})):[],clickLine:s=>{C(s),c("segment")},createLine:s=>{if(o==null?void 0:o.data){const _=G(s),g=[...o.data,..._],N=o.clone();N.data=g,d(N)}},updateLine:(s,_)=>{var g;if(console.log("update line @",s),(g=o==null?void 0:o.data)==null?void 0:g[s]){const N=o.data[s],j=G(_,N),B=[...o.data];B.splice(s,1,...j);const R=o.clone();R.data=B,d(R)}}})},[F,o]);let V=i("span",{});switch(t){case"files":V=a?i(ze,{folder:a,files:l,setFile:async(s,_,g)=>{if(g){let N=y({},l);switch(N[s]=L(y({},N[s]),{currentFilePath:_}),s){case"segment":d(await be(g));break;case"block":D(await xe(g));break;case"velocity":W(await Ne(g));break;case"command":const j=await nt(a,g,l);p(j.commands),d(j.segments),D(j.blocks),W(j.velocities),N=j.openableFiles;break}n(N)}}}):i("span",{});break;case"velocities":V=i(Xe,{settings:P,setSettings:z,selected:m,velocitys:(le=k==null?void 0:k.data)!=null?le:[],setVelocityData:(s,_)=>{if(k!==void 0)if(_){const g=k.data&&k.data[s]?y(y({},k.data[s]),_):ve(_),N=k.data?[...k.data]:[];N[s]=g;const j=k.clone();j.data=N,W(j)}else{const g=k.data?[...k.data]:[];g.splice(s,1);const N=k.clone();N.data=g,W(N)}},addNewVelocity:()=>{if(k!==void 0){const s=k.data?[...k.data]:[],_=ve({});s.push(_);const g=k.clone();g.data=s,W(g)}}});break;case"block":V=i(Te,{settings:O,setSettings:H,selected:E,blocks:(ce=w==null?void 0:w.data)!=null?ce:[],addNewBlock:()=>{if(w!==void 0){const s=w.data?[...w.data]:[],_=he({});s.push(_);const g=w.clone();g.data=s,D(g)}},setBlockData:(s,_)=>{if(w!==void 0)if(_){const g=w.data&&w.data[s]?y(y({},w.data[s]),_):he(_),N=w.data?[...w.data]:[];N[s]=g;const j=w.clone();j.data=N,D(j)}else{const g=w.data?[...w.data]:[];g.splice(s,1);const N=w.clone();N.data=g,D(N)}}});break;case"segment":V=i(Qe,{settings:F,setSettings:q,segments:(de=o==null?void 0:o.data)!=null?de:[],selected:u,addNewSegment:()=>{if(o!==void 0){const s=o.data?[...o.data]:[],_=ye({});s.push(_);const g=o.clone();g.data=s,d(g)}},setSegmentData:(s,_)=>{if(o!==void 0)if(_){const g=o.data&&o.data[s]?y(y({},o.data[s]),_):ye(_),N=o.data?[...o.data]:[];N[s]=g;const j=o.clone();j.data=N,d(j)}else{const g=o.data?[...o.data]:[];g.splice(s,1);const N=o.clone();N.data=g,d(N)}}});break}return S("div",{className:"w-screen h-screen flex flex-col",children:[i(Ue,{filesOpen:((pe=r!=null?r:o)!=null?pe:w)!==void 0,saveFiles:async()=>{r&&await r.save(),o&&await o.save(),w&&await w.save()},folder:a,openFolder:async()=>{const s=await ct();e(s),c("files")}}),i(Je,{pointSources:b,arrowSources:x,drawnLineSource:M,selections:{drawnLine:u,blocks:E}}),i(He,{view:V,buttons:a?dt:void 0,active:t,setActive:s=>c(s)})]})}function ft(a={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:c,onRegistered:l,onRegisterError:n}=a;let r;const p=async(o=!0)=>{};return"serviceWorker"in navigator&&(r=new Oe("./sw.js",{scope:"./"}),r.addEventListener("activated",o=>{o.isUpdate?window.location.reload():c==null||c()}),r.register({immediate:e}).then(o=>{l==null||l(o)}).catch(o=>{n==null||n(o)})),p}ft();const ut=1,mt=new Ie({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ut}}});We.render(i(v.exports.StrictMode,{children:i(Me,{client:mt,children:i(pt,{})})}),document.querySelector("#root"));
