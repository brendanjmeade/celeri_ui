var Rt=Object.defineProperty,Ot=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var re=(s,e,t)=>e in s?Rt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,m=(s,e)=>{for(var t in e||(e={}))Bt.call(e,t)&&re(s,t,e[t]);if(We)for(var t of We(e))Pt.call(e,t)&&re(s,t,e[t]);return s},v=(s,e)=>Ot(s,Et(e));var D=(s,e,t)=>(re(s,typeof e!="symbol"?e+"":e,t),t);import{j as i,a as b,F as R,r as k,M as At,m as He,R as Tt,b as le,u as Wt,c as Ht,l as ze,d as ne,e as L,f as zt,g as Jt,h as Gt,v as Ut,Q as qt,i as Kt,k as Qt,P as Xt}from"./vendor.6cf141b2.js";const Zt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}};Zt();function Yt({value:s,fieldDefinition:e,setField:t}){const[n,a]=k.exports.useState(-1),[o,r]=k.exports.useState(s);return k.exports.useEffect(()=>{r(s)},[s]),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(R,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof s=="number"?"number":"text",value:o,onChange:c=>{const f=typeof s=="number"?Number.parseFloat(c.target.value):c.target.value;r(f),n>-1&&clearTimeout(n),a(setTimeout(()=>t(f),1e3))}})})]})}function te({title:s,items:e,setItems:t,fieldDefinitions:n,ignoreFields:a,deletable:o,controls:r}){const c=e[0],f=Object.keys(c).map((d,x)=>{if(a==null?void 0:a.includes(d))return{element:i("span",{style:{display:"hidden"}},d),order:x+1e4};let l=c[d];for(const _ of e)if(_[d]!==l){l="-";break}const y=d in n&&n[d];return y?{element:i(Yt,{value:l,fieldDefinition:y,setField:_=>t({[d]:_})},d),order:y.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${d}`,className:"text-l font-bold",children:d}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${d}`,className:"rounded w-full",type:typeof l=="number"?"number":"text",value:l,onChange:_=>{t({[d]:typeof l=="number"?Number.parseFloat(_.target.value):_.target.value})}})})]},d),order:x+1e3}}).sort((d,x)=>d.order-x.order).map(d=>d.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:s}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[r,o?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):i(R,{})]})]}),f]})}te.defaultProps={ignoreFields:[],controls:i(R,{})};const es={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var wt;const ts=JSON.parse((wt=window.localStorage.getItem("blockDisplaySettings"))!=null?wt:"false")||es;function ss({settings:s,setSettings:e,selected:t,blocks:n,setBlockData:a,addNewBlock:o}){const r=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},c=t.map(d=>n[d]).filter(d=>d),f=c.length>0?i(te,{title:c.length===1?c[0].name:"Edit Selected Blocks",items:c,deletable:!0,setItems:d=>a(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(R,{});return b(R,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!s.hide,onChange:()=>{r(v(m({},s),{hide:!s.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.color,onChange:d=>{r(v(m({},s),{color:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.selectedColor,onChange:d=>{r(v(m({},s),{selectedColor:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:s.radius,onChange:d=>{r(v(m({},s),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:o,children:"New Block"})]}),f]})}function ns({folder:s,files:e,setFile:t}){const n=Object.keys(e).map(a=>{const o=e[a];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:o.name}),i("span",{className:"text-sm","data-testid":`file-${a}-description`,children:o.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:o.currentFilePath,onChange:async r=>{const c=r.currentTarget.value;try{const f=await s.getFile(c);t(a,f.name,f)}catch{t(a,"")}},children:[i("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),s.fileList.filter(r=>r.endsWith(o.extension)).map(r=>i("option",{value:r,"data-testid":`file-${a}-select-${r}`,children:r},r))]})})]},a)});return i("div",{className:"flex flex-col gap-2",children:n})}function as({view:s,buttons:e,active:t,setActive:n}){if(!e)return i("span",{});const a=[];for(const o of Object.keys(e)){const r=e[o],c=o===t;a.push(i("button",{type:"button","data-testid":`tab-${o}`,className:`${c?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>n(c?"":o),children:r},o))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm overflow-y-auto",children:s}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}const Je={lon:0,lat:0},os=180,Y=360;function Ge(s){let{lon:e,lat:t}=s;for(;e<0;)e+=Y;for(;e>Y;)e-=Y;return[e,t]}function ce([s,e]){return{lon:s<0?s+Y:s,lat:e}}function Ue(s,e){const t=Ge(s),n=Ge(e),a=[n[0],n[1]];return n[0]-t[0]>=os?a[0]-=Y:a[0]+=Y,Math.abs(t[0]-n[0])>Math.abs(t[0]-a[0])?[t,a]:[t,n]}const M=1e3;function W(s,e,t,n){const a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`;if(a in e)return[e[a],n];const o=n;return t[o]=s,e[a]=o,[o,n+1]}function qe(s,e){let t=!1;for(const n of s.segments)if(n.start===e||n.end===e){t=!0;break}if(!t&&s.vertecies[e]){const n=s.vertecies[e],a=`${Math.floor(n.lon*M)},${Math.floor(n.lat*M)}`,o=m({},s.vertecies);delete o[e];const r=m({},s.vertexDictionary);return delete r[a],v(m({},s),{vertecies:o,vertexDictionary:r})}return s}const z=Math.PI/6,J=2*Math.PI-z;function is(s,e,{map:t,popup:n,internalArrowSources:a,mapLoaded:o,internalSelections:r},{arrowSources:c,selections:f}){if(t&&o&&a!==c)if(console.log("Setting arrows in map!"),a){for(const l of a){const y=t.getSource(`arrow:${l.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${l.name}`),t.removeLayer(`layer:arrow:${l.name}:click`)}e({internalArrowSources:void 0})}else{for(const l of c){let y=t.getSource(`arrow:${l.name}`);const _=y===void 0;_&&(t.addSource(`arrow:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`arrow:${l.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:l.arrows.map(p=>{var G;const h=p.scale*l.scale,w=l.scale*l.arrowHeadScale,N=[p.longitude+p.direction[0]*h,p.latitude+p.direction[1]*h],E=[N[0]+(Math.cos(z)*-p.direction[0]-Math.sin(z)*-p.direction[1])*w,N[1]+(Math.sin(z)*-p.direction[0]+Math.cos(z)*-p.direction[1])*w],C=[N[0]+(Math.cos(J)*-p.direction[0]-Math.sin(J)*-p.direction[1])*w,N[1]+(Math.sin(J)*-p.direction[0]+Math.cos(J)*-p.direction[1])*w];return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:(G=f[l.name])==null?void 0:G.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],N,E,N,C]}}})}),t.addLayer({id:`layer:arrow:${l.name}`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":l.width}}),t.addLayer({id:`layer:arrow:${l.name}:click`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),_&&(t.on("mouseenter",`layer:arrow:${l.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;n.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:arrow:${l.name}:click`,()=>{n.remove()}),t.on("click",`layer:arrow:${l.name}:click`,p=>{let h;if(s.state.internalArrowSources)for(const N of s.state.internalArrowSources)h=N.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}}))}e({internalArrowSources:c})}const d=m({},r);let x=!1;for(const l of Object.keys(f))if(f[l]!==r[l]){for(const y of c)if(y.name===l){x=!0,d[l]=f[l];const _=t==null?void 0:t.getSource(`arrow:${y.name}`);if(_){const p=f[l];_.setData({type:"FeatureCollection",features:y.arrows.map(h=>{const w=h.scale*y.scale,N=y.scale*y.arrowHeadScale,E=[h.longitude+h.direction[0]*w,h.latitude+h.direction[1]*w],C=[E[0]+(Math.cos(z)*-h.direction[0]-Math.sin(z)*-h.direction[1])*N,E[1]+(Math.sin(z)*-h.direction[0]+Math.cos(z)*-h.direction[1])*N],G=[E[0]+(Math.cos(J)*-h.direction[0]-Math.sin(J)*-h.direction[1])*N,E[1]+(Math.sin(J)*-h.direction[0]+Math.cos(J)*-h.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:p==null?void 0:p.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],E,C,E,G]}}})})}}}x&&e({internalSelections:d})}function rs(s,{map:e,draw:t,drawnPointSettings:n,mapLoaded:a,internalDrawnPointSource:o},{drawnPointSource:r}){if(e&&a&&o!==r){console.log("Drawning Points"),s({internalDrawnPointSource:r});let c=t;if((r.selectedColor!==n.selectedColor||r.selectedRadius!==n.selectedRadius||r.color!==n.color||r.radius!==n.radius)&&(s({drawnPointSettings:{color:r.color,radius:r.radius,selectedRadius:r.selectedRadius,selectedColor:r.selectedColor}}),t&&(e.removeControl(t),c=void 0),r?(c=new At({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":r.selectedRadius,"circle-color":r.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":r.radius,"circle-color":r.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(c),s({draw:c})):c=void 0),c){const f=c.getAll(),d=r.points.length!==f.features.length?void 0:c.getSelected(),x={type:"FeatureCollection",features:r.points.map(l=>({type:"Feature",id:l.index.toString(),properties:{description:"",index:l.index,name:""},geometry:{type:"Point",coordinates:[l.longitude,l.latitude]}}))};if(c.set(x),d&&d.features.length>0&&d.features[0].properties&&typeof d.features[0].properties.index=="number"){const l=d.features[0].id;l&&c.changeMode("simple_select",{featureIds:[l]})}}}}const P="grid";function ls(s,e,{map:t,internalGridDisplay:n,popup:a,mapLoaded:o},{displayGrid:r}){if(t&&o&&n!==r){if(console.log("Drawing Grid on map!"),n&&n>0){const c=t.getSource(P);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),t.removeLayer(P),e({internalGridDisplay:void 0})}else if(r&&r>0){let c=t.getSource(P);const f=c===void 0;if(f&&(t.addSource(P,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=t.getSource(P)),c!==void 0){const d=[];for(let x=-170;x<=180;x+=r)d.push({type:"Feature",properties:{label:`Lon: ${x<0?x+360:x}`},geometry:{type:"LineString",coordinates:[[x,-90],[x,90]]}});for(let x=-90;x<=90;x+=r)d.push({type:"Feature",properties:{label:`Lat: ${x}`},geometry:{type:"LineString",coordinates:[[180,x],[-180,x]]}});c.setData({type:"FeatureCollection",features:d})}t.addLayer({id:P,type:"line",source:P,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${P}:click`,type:"line",source:P,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),f&&(t.on("mouseenter",`${P}:click`,d=>{if(!d.features)return;const x=d.features[0];x.geometry.type==="LineString"&&x.properties&&typeof x.properties.label=="string"&&a.setLngLat(d.lngLat).setHTML(`${x.properties.label}`).addTo(t)}),t.on("mouseleave",`${P}:click`,()=>{a.remove()}))}e({internalGridDisplay:r})}}function cs(s,e,{map:t,popup:n,internalLineSources:a,mapLoaded:o,internalSelections:r},{lineSources:c,selections:f}){if(t&&o&&a!==c)if(console.log("Setting lines in map!"),a){for(const l of a){const y=t.getSource(`line:${l.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${l.name}`),t.removeLayer(`layer:line:${l.name}:click`)}e({internalLineSources:void 0})}else{for(const l of c){let y=t.getSource(`line:${l.name}`);const _=y===void 0;_&&(t.addSource(`line:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`line:${l.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:l.lines.map(p=>{var h;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:((h=f[l.name])==null?void 0:h.includes(p.index))||!1},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}})}),t.addLayer({id:`layer:line:${l.name}`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":["case",["get","selected"],l.selectedWidth,l.width]}}),t.addLayer({id:`layer:line:${l.name}:click`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":l.width*10}}),_&&(t.on("mouseenter",`layer:line:${l.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="LineString"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[(h.geometry.coordinates[0][0]+h.geometry.coordinates[1][0])/2,(h.geometry.coordinates[0][1]+h.geometry.coordinates[1][1])/2],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;n.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:line:${l.name}:click`,()=>{n.remove()}),t.on("click",`layer:line:${l.name}:click`,p=>{let h;if(s.state.internalLineSources)for(const N of s.state.internalLineSources)h=N.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}}))}e({internalLineSources:c})}const d=m({},r);let x=!1;for(const l of Object.keys(f))if(f[l]!==r[l]){for(const y of c)if(y.name===l){x=!0,d[l]=f[l];const _=t==null?void 0:t.getSource(`line:${y.name}`);if(_){const p=f[l];_.setData({type:"FeatureCollection",features:y.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:p==null?void 0:p.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))})}}}x&&e({internalSelections:d})}function ds(s,e,{map:t,popup:n,internalPointSources:a,mapLoaded:o,internalSelections:r},{pointSources:c,selections:f}){if(!t||!o)return;if(a!==c)if(console.log("Setting points in map!"),a){for(const l of a){const y=t.getSource(`point:${l.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${l.name}`)}e({internalPointSources:void 0})}else{for(const l of c){let y=t.getSource(`point:${l.name}`);const _=y===void 0;_&&(t.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`point:${l.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:l.points.map(p=>{var h;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:!((h=f[l.name])==null?void 0:h.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}})}),t.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":["case",["get","selected"],l.color,l.selectedColor],"circle-radius":l.radius}}),_&&(t.on("mouseenter",`layer:point:${l.name}`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;n.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:point:${l.name}`,()=>{n.remove()}),t.on("click",`layer:point:${l.name}`,p=>{let h;if(s.state.internalPointSources)for(const N of s.state.internalPointSources)h=N.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}}))}e({internalPointSources:c})}const d=m({},r);let x=!1;for(const l of Object.keys(f))if(f[l]!==r[l]){for(const y of c)if(y.name===l){x=!0,d[l]=f[l];const _=t.getSource(`point:${y.name}`);if(_){const p=f[l];_.setData({type:"FeatureCollection",features:y.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(p==null?void 0:p.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}x&&e({internalSelections:d})}He.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class us extends Tt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:k.exports.createRef(),popup:new le.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(He.accessToken&&t){const n=new le.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});n.addControl(new le.exports.NavigationControl),this.setState({map:n}),n.on("load",()=>{this.setState({mapLoaded:!0})}),n.on("click",({lngLat:a})=>{const{click:o}=this.props;o(ce([a.lng,a.lat]))}),n.on("mousemove",({lngLat:a})=>{const{mouseMove:o}=this.props;o&&o(ce([a.lng,a.lat]))}),n.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:o}=this.state;if(!o||!(o==null?void 0:o.select))return;const r=a.map(c=>c&&c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"?c.properties.index:-1).filter(c=>c>-1);o.select(r)}),n.on("draw.update",({features:a,action:o})=>{const{internalDrawnPointSource:r}=this.state;if(!!(r==null?void 0:r.update)&&o==="move"&&a.length>0)for(const c of a)c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"&&r.update(c.properties.index,ce(c.geometry.coordinates))})}}componentDidUpdate(){return ls(this,e=>this.setState(e),this.state,this.props),cs(this,e=>this.setState(e),this.state,this.props),is(this,e=>this.setState(e),this.state,this.props),ds(this,e=>this.setState(e),this.state,this.props),rs(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return i("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const fs={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var _t;const ms=m(m({},fs),JSON.parse((_t=window.localStorage.getItem("meshDisplaySettings"))!=null?_t:"{}"));function hs({settings:s,setSettings:e}){const t=n=>{e(n),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(n))};return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!s.hide,onChange:()=>{t(v(m({},s),{hide:!s.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.color,onChange:n=>{t(v(m({},s),{color:n.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:s.width,onChange:n=>{t(v(m({},s),{width:Number.parseFloat(n.target.value)}))}})})]})]})}const ps={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Nt;const gs=m(m({},ps),JSON.parse((Nt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Nt:"{}"));function ys({settings:s,setSettings:e,segments:t,selected:n,setSegmentData:a,addNewSegment:o,splitSegment:r,setSelectionMode:c}){const f=l=>{e(l),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(l))},d=n.map(l=>t[l]).filter(l=>l),x=d.length>0?i(te,{title:d.length===1?d[0].name:"Edit Selected Segments",items:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:l=>a(n,l),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>r(n),children:"Split Segment"})}):i(R,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!s.hide,onChange:()=>{f(v(m({},s),{hide:!s.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.color,onChange:l=>{f(v(m({},s),{color:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:s.width,onChange:l=>{f(v(m({},s),{width:Number.parseFloat(l.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.activeColor,onChange:l=>{f(v(m({},s),{activeColor:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:s.activeWidth,onChange:l=>{f(v(m({},s),{activeWidth:Number.parseFloat(l.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Select Segment Starting Point",callback:l=>{c({mode:"mapClick",label:"Select Segment End point",callback:y=>{o(l,y),c("normal")}})}})},children:"New Segment"})]}),x]})}const Ke=()=>Wt(),se=Ht;function xs({folder:s,openFolder:e,filesOpen:t,saveFiles:n}){function a(){e()}const o=Ke(),[r,c]=se(f=>[f.main.past.length>0,f.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[s?i("button",{type:"button",onClick:()=>{o(ze.ActionCreators.undo())},"data-testid":"undo-button",disabled:!r,children:"Undo"}):i(R,{}),s?i("button",{type:"button",onClick:()=>{o(ze.ActionCreators.redo())},disabled:!c,"data-testid":"undo-button",children:"Redo"}):i(R,{}),s?b("span",{children:["Working in ",s.name]}):i("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?i("button",{type:"button",onClick:n,"data-testid":"save-file-button",children:"Save Files"}):i(R,{})]})]})}const vs={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var kt;const bs=JSON.parse((kt=window.localStorage.getItem("velocityDisplaySettings"))!=null?kt:"false")||vs;function ws({settings:s,setSettings:e,selected:t,velocitys:n,setVelocityData:a,addNewVelocity:o}){const r=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},c=t.map(d=>n[d]).filter(d=>d),f=c.length>0?i(te,{title:c.length===1?c[0].name:"Edit Selected Velocities",items:c,deletable:!0,setItems:d=>a(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(R,{});return b(R,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!s.hide,onChange:()=>{r(v(m({},s),{hide:!s.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.color,onChange:d=>{r(v(m({},s),{color:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.selectedColor,onChange:d=>{r(v(m({},s),{selectedColor:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:s.scale,onChange:d=>{r(v(m({},s),{scale:Number.parseFloat(d.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:s.width,onChange:d=>{r(v(m({},s),{width:Number.parseFloat(d.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:s.arrowHead,onChange:d=>{r(v(m({},s),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:o,children:"New Velocity"})]}),f]})}const _s={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var St;const Ns=m(m({},_s),JSON.parse((St=window.localStorage.getItem("vertexDisplaySettings"))!=null?St:"{}"));function ks({settings:s,setSettings:e,vertices:t,selected:n,setVertexData:a,setSelectionMode:o,mergeVertices:r,bridgeVertices:c,extrudeVertex:f}){const d=y=>{e(y),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(y))},l=n.map(y=>({selectedVertex:t[y],index:y})).filter(y=>y.selectedVertex).map(({selectedVertex:y,index:_})=>i(te,{title:"Selected Vertex",items:[y],ignoreFields:[],deletable:!1,setItems:p=>a(_,m(m({},y),p)),fieldDefinitions:{},controls:b(R,{children:[i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:p=>{r(_,p[0]),o("normal")}})},children:"Merge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:p=>{c(_,p[0]),o("normal")}})},children:"Bridge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:p=>{f(_,p),o("normal")}})},children:"Extrude"})]})},_));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!s.hide,onChange:()=>{d(v(m({},s),{hide:!s.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.color,onChange:y=>{d(v(m({},s),{color:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:s.radius,onChange:y=>{d(v(m({},s),{radius:Number.parseFloat(y.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:s.activeColor,onChange:y=>{d(v(m({},s),{activeColor:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:s.activeRadius,onChange:y=>{d(v(m({},s),{activeRadius:Number.parseFloat(y.target.value)}))}})})]}),l]})}const Qe=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Xe={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Ss(s){return s?m(m({},Xe),s):m({},Xe)}function Cs(s,{data:e}){return[...s,Ss(e)]}function Ds(s,e){const t=[];for(const[n,a]of s.entries())e.includes(n)||t.push(a);return t}function Fs(s,e){const t=[...s];for(const n of e.indices){const a=m(m({},t[n]),e.data);t[n]=a}return t}function $s(s,e){return e}function Ls(s,{index:e,position:t}){const n=[...s],a=m({},n[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,n[e]=a,n}const Vs=[],Ze=L("createBlock"),Ye=L("editBlock"),et=L("deleteBlock"),de=L("loadNewBlockData"),tt=L("moveBlock"),Ms=ne(Vs,s=>{s.addCase(Ze,(e,t)=>Cs(e,t.payload)).addCase(Ye,(e,t)=>Fs(e,t.payload)).addCase(et,(e,t)=>Ds(e,t.payload)).addCase(de,(e,t)=>$s(e,t.payload)).addCase(tt,(e,t)=>Ls(e,t.payload))});function js(s,e){return e}const Is=[],ue=L("loadMeshLineData"),Rs=ne(Is,s=>s.addCase(ue,(e,t)=>js(e,t.payload))),st=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ee={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Os(s,{a:e,b:t}){const n=v(m({},ee),{start:e,end:t}),a=[...s.segments,n];return v(m({},s),{segments:a})}function Es(s,e){const t=m({},s.vertecies),n=m({},s.vertexDictionary),{lastIndex:a}=s,[o,r]=W(e.start,n,t,a),[c,f]=W(e.end,n,t,r),d=v(m({},ee),{start:o,end:c}),x=[...s.segments,d];return{vertecies:t,vertexDictionary:n,segments:x,lastIndex:f}}function Bs(s,e){const t=[],n=[];let a=m({},s);for(const[o,r]of s.segments.entries())e.index.includes(o)?n.push(r):t.push(r);a.segments=t;for(const o of n)a=qe(qe(a,o.start),o.end);return a}function Ps(s,e){const t=[...s.segments];for(const n of e.indices){const a=m(m({},t[n]),e.data);t[n]=a}return v(m({},s),{segments:t})}function As(s,e){const t=m({},s.vertecies),n=m({},s.vertexDictionary),[a,o]=W(e.targetPoint,n,t,s.lastIndex),r=v(m({},ee),{start:e.index,end:a}),c=[...s.segments,r];return{vertecies:t,vertexDictionary:n,segments:c,lastIndex:o}}function Ts(s,e){return e}function Ws(s,{a:e,b:t}){if(e===t)return s;const n=s.segments.map(f=>{let d=f;return d.start===t&&(d=v(m({},d),{start:e})),d.end===t&&(d=v(m({},d),{end:e})),d}).filter(f=>f.start!==f.end),a=s.vertecies[t],o=`${Math.floor(a.lon*M)},${Math.floor(a.lat*M)}`,r=m({},s.vertecies);delete r[t];const c=m({},s.vertexDictionary);return delete c[o],v(m({},s),{vertecies:r,vertexDictionary:c,segments:n})}function Hs(s,{index:e,vertex:t}){const n=m({},s.vertecies),a=m({},s.vertexDictionary),o=[...s.segments],r=n[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,f=`${Math.floor(r.lon*M)},${Math.floor(r.lat*M)}`;if(delete a[f],c in a){const d=a[c];for(const x of o)x.start===d&&(x.start=e),x.end===d&&(x.end=e);delete n[d]}return n[e]=t,v(m({},s),{segments:o,vertecies:n,vertexDictionary:a})}function zs(s,e){const t=m({},s.vertecies),n=m({},s.vertexDictionary),a=[...s.segments];let{lastIndex:o}=s;for(const r of e){const c=s.segments[r],f=s.vertecies[c.start],d=s.vertecies[c.end],x={lon:(f.lon+d.lon)/2,lat:(f.lat+d.lat)/2},[l,y]=W(x,n,t,o);o=y;const _=v(m({},c),{end:l,name:`${c.name}_a`}),p=v(m({},c),{start:l,name:`${c.name}_b`});a[r]=_,a.push(p)}return{vertecies:t,vertexDictionary:n,segments:a,lastIndex:o}}const Js={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},nt=L("bridgeVertices"),at=L("createSegmet"),ot=L("deleteSegment"),it=L("editSegmentData"),rt=L("extrudeSegment"),fe=L("loadNewSegmentData"),lt=L("mergeVertices"),me=L("moveVertex"),ct=L("splitSegment"),Gs=ne(Js,s=>{s.addCase(nt,(e,t)=>Os(e,t.payload)).addCase(at,(e,t)=>Es(e,t.payload)).addCase(ot,(e,t)=>Bs(e,t.payload)).addCase(it,(e,t)=>Ps(e,t.payload)).addCase(rt,(e,t)=>As(e,t.payload)).addCase(fe,(e,t)=>Ts(e,t.payload)).addCase(lt,(e,t)=>Ws(e,t.payload)).addCase(me,(e,t)=>Hs(e,t.payload)).addCase(ct,(e,t)=>zs(e,t.payload))}),dt=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Us={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function qs(s){return m(m({},Us),s)}function Ks(s,{data:e}){return[...s,qs(e)]}function Qs(s,e){const t=[];for(const[n,a]of s.entries())e.includes(n)||t.push(a);return t}function Xs(s,e){const t=[...s];for(const n of e.indices){const a=m(m({},t[n]),e.data);t[n]=a}return t}function Zs(s,e){return e}function Ys(s,{index:e,position:t}){const n=[...s],a=m(m({},n[e]),t);return n[e]=a,n}const en=[],ut=L("createVelocity"),ft=L("editVelocity"),mt=L("deleteVelocity"),he=L("loadNewVelocityData"),ht=L("moveVelocity"),tn=ne(en,s=>{s.addCase(ut,(e,t)=>Ks(e,t.payload)).addCase(ft,(e,t)=>Xs(e,t.payload)).addCase(mt,(e,t)=>Qs(e,t.payload)).addCase(he,(e,t)=>Zs(e,t.payload)).addCase(ht,(e,t)=>Ys(e,t.payload))});function pe(s){const e=s.split(/\n/g),t=e[0].split(","),n=e.slice(1),a=[];for(const o of n)if(o.trim()!==""){const r=o.split(/\s*,\s*/),c={};for(let f=0;f<t.length;f+=1){let d=r[f];const x=t[f],l=Number.parseFloat(d);d=Number.isNaN(l)?d:l,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),c[x]=d}a.push(c)}return a}function ge(s,e){const t=[e.join(",")];for(const n of s){const a=n;t.push(e.map(o=>o in a?typeof a[o]=="string"&&/\s/.test(`${a[o]}`)?`"${a[o]}"`:`${a[o]}`:"").join(","))}return t.join(`
`)}class ye{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e).map(a=>{const o={};for(const r of Qe)o[r]=a[r]||(r==="name"?"":0);return o});this.data=n}async save(){var t;const e=ge((t=this.data)!=null?t:[],Qe);await this.handle.setContents(e)}clone(){return new ye(this.handle)}}const sn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function nn(s){return m(m({},sn),s)}class xe{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=nn(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new xe(this.handle)}}function an(s){const t=[...s.matchAll(/^\s*\d+\s+(-?\d+\.\d+)\s+(-?\d+\.\d+)/gm)].map(n=>{const a=Number.parseFloat(n[1]),o=Number.parseFloat(n[2]);return{lon:a,lat:o}});return t.splice(0,0,{lon:0,lat:0}),t}function on(s){return s.split(/\n/).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{const t=Number.parseInt(e[2],10),n=t+3,a=e.length-n;if(console.log("line:",e,a,t),e.length>=n+2){const o=[];for(let r=n+1;r<e.length;r+=1){const c=Number.parseInt(e[r-1],10),f=Number.parseInt(e[r],10);!Number.isNaN(c)&&!Number.isNaN(f)&&o.push([c,f])}if(a>2){console.log("closing stuff");const r=Number.parseInt(e[n],10),c=Number.parseInt(e[-1],10);!Number.isNaN(r)&&!Number.isNaN(c)&&o.push([r,c])}return o}return!1}).filter(e=>e).flat()}function rn(s,e){return e.map(([t,n])=>t!==n&&t>-1&&t<s.length&&n>-1&&n<s.length?[s[t],s[n]]:!1).filter(t=>t)}function ln(s){const e=s.split("$");let t=[],n=[];for(const a of e)a.startsWith("Nodes")?t=an(a):a.startsWith("Elements")&&(n=on(a));return console.log("mesh file:",t,n),rn(t,n)}class cn{constructor(e){D(this,"data");D(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents();this.data=ln(e)}async save(){console.log("Mesh files do not get saved")}}class ve{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e).map(f=>{const d={};for(const x of st)d[x]=f[x]||(x==="name"?"":0);return d}),a={},o={},r=[];let c=0;for(const f of n){const[d,x]=W({lon:f.lon1,lat:f.lat1},a,o,c),[l,y]=W({lon:f.lon2,lat:f.lat2},a,o,x),_=v(m({},f),{start:d,end:l});c=y,r.push(_)}this.data={vertecies:o,segments:r,vertexDictionary:a,lastIndex:c}}async save(){let e=[];if(this.data){const{vertecies:n,segments:a}=this.data;e=a.map(o=>{const r=n[o.start],c=n[o.end];return v(m({},o),{lon1:r.lon,lat1:r.lat,lon2:c.lon,lat2:c.lat})})}const t=ge(e,st);await this.handle.setContents(t)}clone(){return new ve(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const n of this.data.segments)if(n.start===e||n.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const n=this.data.vertecies[e],a=`${Math.floor(n.lon*M)},${Math.floor(n.lat*M)}`,o=m({},this.data.vertecies);delete o[e];const r=m({},this.data.vertexDictionary);delete r[a];const c=this.clone();return c.data=v(m({},this.data),{vertecies:o,vertexDictionary:r}),c}}return this}mergeVertices(e,t){if(this.data){for(const f of this.data.segments)f.start===t&&(f.start=e),f.end===t&&(f.end=e);const n=this.data.vertecies[t],a=`${Math.floor(n.lon*M)},${Math.floor(n.lat*M)}`,o=m({},this.data.vertecies);delete o[t];const r=m({},this.data.vertexDictionary);delete r[a];const c=this.clone();return c.data=v(m({},this.data),{vertecies:o,vertexDictionary:r}),c}return this}moveVertex(e,t){if(this.data){const n=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),o=[...this.data.segments],r=n[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,f=`${Math.floor(r.lon*M)},${Math.floor(r.lat*M)}`;if(delete a[f],c in a){const x=a[c];for(const l of o)l.start===x&&(l.start=e),l.end===x&&(l.end=e);delete n[x]}n[e]=t;const d=this.clone();return d.data=v(m({},this.data),{segments:o,vertecies:n,vertexDictionary:a}),d}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],n=this.data.vertecies[t.start],a=this.data.vertecies[t.end],o={lon:(n.lon+a.lon)/2,lat:(n.lat+a.lat)/2},[r,c]=W(o,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),f=v(m({},t),{end:r,name:`${t.name}_a`}),d=v(m({},t),{start:r,name:`${t.name}_b`}),x=[...this.data.segments];x[e]=f,x.push(d);const l=this.clone();return l.data=v(m({},this.data),{segments:x,lastIndex:c}),l}return this}bridgeVertices(e,t){if(this.data){const n=v(m({},ee),{start:e,end:t}),a=[...this.data.segments,n],o=this.clone();return o.data=v(m({},this.data),{segments:a}),o}return this}extrudeSegment(e,t){if(this.data){const n=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[o,r]=W(t,a,n,this.data.lastIndex),c=v(m({},ee),{start:e,end:o}),f=[...this.data.segments,c],d=this.clone();return d.data={vertecies:n,vertexDictionary:a,segments:f,lastIndex:r},d}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],n=t.splice(e,1)[0],a=this.clone();return a.data=v(m({},this.data),{segments:t}),a.tryRemoveVertex(n.start).tryRemoveVertex(n.end)}return this}createSegment(e,t){if(this.data){const n=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[o,r]=W(e,a,n,this.data.lastIndex),[c,f]=W(t,a,n,r),d=v(m({},ee),{start:o,end:c}),x=[...this.data.segments,d],l=this.clone();return l.data={vertecies:n,vertexDictionary:a,segments:x,lastIndex:f},l}return this}}class be{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e).map(a=>{const o={};for(const r of dt)o[r]=a[r]||(r==="name"?"":0);return o});this.data=n}async save(){var t;const e=ge((t=this.data)!=null?t:[],dt);await this.handle.setContents(e)}clone(){return new be(this.handle)}}async function pt(s){const e=new ve(s);return await e.initialize(),e}async function gt(s){const e=new ye(s);return await e.initialize(),e}async function yt(s){const e=new be(s);return await e.initialize(),e}async function xt(s){const e=new cn(s);return await e.initialize(),e}async function dn(s,e,t){const n=new xe(e);if(await n.initialize(),n.data){const a=await pt(await s.getFile(n.data.segment_file_name)),o=await gt(await s.getFile(n.data.block_file_name)),r=await yt(await s.getFile(n.data.station_file_name)),c=await xt(await s.getFile(n.data.mesh_parameters_file_name)),f=m({},t);return"command"in f&&(f.command=v(m({},f.command),{currentFilePath:e.name})),"segment"in f&&(f.segment=v(m({},f.segment),{currentFilePath:n.data.segment_file_name})),"block"in f&&(f.block=v(m({},f.block),{currentFilePath:n.data.block_file_name})),"velocities"in f&&(f.velocities=v(m({},f.velocities),{currentFilePath:n.data.station_file_name})),"mesh"in f&&(f.mesh=v(m({},f.mesh),{currentFilePath:n.data.mesh_parameters_file_name})),{openableFiles:f,commands:n,segments:a,blocks:o,velocities:r,mesh:c}}throw new Error("Can't open command file")}class un{constructor(e){D(this,"name");D(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class we{constructor(e){D(this,"name");D(this,"handle");D(this,"fileList");D(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new un(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),n=new we(t);return await n.initialize(),n}}const fn=async()=>{const s=await window.showDirectoryPicker(),e=new we(s);return await e.initialize(),e};class mn{constructor(e,t){D(this,"name");D(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class _e{constructor(e,t){D(this,"name");D(this,"parent");D(this,"fileList");D(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const n=t[e];for(const a of Object.keys(n))typeof n[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new mn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new _e(e,this.parent[this.name])}}const hn=async s=>new _e("root",s);let vt=async()=>{var e;return hn((e=window.FakeDirectory)!=null?e:{})};function pn(s){vt=s}async function gn(){return vt()}window.location.search.includes("fake-dir")||pn(fn);var A;(function(s){s.Vertex="Vertices",s.Block="Blocks",s.Velocity="Velocities"})(A||(A={}));const bt={Block:A.Block,Vertex:A.Vertex,Velocity:A.Velocity},yn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh"};function xn(){var Ee,Be,Pe;const s=Ke(),[e,t]=k.exports.useState(),[n,a]=k.exports.useState(""),[o,r]=k.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:""}}),[c,f]=k.exports.useState(),[d,x]=k.exports.useState(),[l,y]=k.exports.useState(),[_,p]=k.exports.useState(),h=se(u=>u.main.present.segment),w=se(u=>u.main.present.block),N=se(u=>u.main.present.velocity),E=se(u=>u.main.present.meshLine),[C,G]=k.exports.useState(bs),[V,Ne]=k.exports.useState(ts),[B,ke]=k.exports.useState(gs),[F,Se]=k.exports.useState(Ns),[T,Ce]=k.exports.useState(ms),[O,U]=k.exports.useState("normal"),[q,Ct]=k.exports.useState(A.Vertex),[ae,De]=k.exports.useState([]),[Fe,$e]=k.exports.useState([]),[Le,Ve]=k.exports.useState([]),[Me,je]=k.exports.useState([]),[$,Nn]=k.exports.useState({select:(u,g)=>{De(u==="block"?g:[]),$e(u==="segment"?g:[]),Ve(u==="velocities"?g:[]),je(u==="vertex"?g:[]),a(u)}}),[Dt,Ft]=k.exports.useState([]),[$t,Ie]=k.exports.useState([]),[Lt,Vt]=k.exports.useState([]),[Mt,oe]=k.exports.useState({color:F.color,selectedColor:F.activeColor,radius:F.radius,selectedRadius:F.activeRadius,points:[]}),[Re,jt]=k.exports.useState({lon:0,lat:0}),[ie,It]=k.exports.useState(!1);k.exports.useEffect(()=>{O==="normal"?$.select=(u,g)=>{De(u==="block"?g:[]),$e(u==="segment"?g:[]),Ve(u==="velocities"?g:[]),je(u==="vertex"?g:[]),a(u)}:O.mode==="override"?$.select=(u,g)=>{u===O.type&&O.callback(g)}:$.select=()=>{}},[O,$]),k.exports.useEffect(()=>{const u=[];q!==A.Block&&!V.hide&&u.push({name:"blocks",color:V.color,selectedColor:V.selectedColor,radius:V.radius,points:w.map((g,S)=>({longitude:g.interior_lon,latitude:g.interior_lat,name:g.name,description:"",index:S})),click:g=>{$.select("block",[g])}}),q!==A.Vertex&&!F.hide&&u.push({name:"vertices",color:F.color,selectedColor:F.activeColor,radius:F.radius,click:g=>{$.select("vertex",[g])},points:Object.keys(h.vertecies).map(g=>{const S=Number.parseInt(g,10),I=h.vertecies[S];return I?{longitude:I.lon,latitude:I.lat,index:S,name:"",description:""}:!1}).filter(g=>!!g)}),Ft(u)},[V,w,B,$,q,F.hide,F.color,F.activeColor,F.radius,h.vertecies]),k.exports.useEffect(()=>{const u=[];B.hide||u.push({name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:h.segments.map((g,S)=>{var Ae,Te;const I=(Ae=h.vertecies[g.start])!=null?Ae:Je,H=(Te=h.vertecies[g.end])!=null?Te:Je,[[Q,X],[Z,j]]=Ue(I,H);return{startLongitude:Q,startLatitude:X,endLongitude:Z,endLatitude:j,name:g.name,description:`${I.lon},${I.lat} to ${H.lon},${H.lat}`,index:S}}),click:g=>{$.select("segment",[g])}}),T.hide||u.push({name:"meshLines",color:T.color,selectedColor:T.activeColor,width:T.width,selectedWidth:T.activeWidth,lines:E.map((g,S)=>{const I=g[0],H=g[1],[[Q,X],[Z,j]]=Ue(I,H);return{startLongitude:Q,startLatitude:X,endLongitude:Z,endLatitude:j,name:"",description:"",index:S}})}),Vt(u)},[h,B,T,E,$]),k.exports.useEffect(()=>{switch(q){case A.Vertex:{oe({color:F.color,radius:F.radius,selectedColor:F.activeColor,selectedRadius:F.activeRadius,points:F.hide?[]:Object.keys(h.vertecies).map(u=>{const g=Number.parseInt(u,10),S=h.vertecies[g];return S?{longitude:S.lon,latitude:S.lat,index:g}:!1}).filter(u=>!!u),update:(u,g)=>{s(me({index:u,vertex:g}))},select:u=>{$.select("vertex",u)}});break}case A.Block:{oe({color:V.color,radius:V.radius,selectedColor:V.selectedColor,selectedRadius:V.radius,points:V.hide?[]:w.map((u,g)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:g})),update:(u,g)=>{s(tt({index:u,position:g}))},select:u=>{$.select("block",u)}});break}case A.Velocity:{oe({color:C.color,radius:C.width,selectedColor:C.selectedColor,selectedRadius:C.width,points:C.hide?[]:N.map((u,g)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:g})),update:(u,g)=>{s(ht({index:u,position:g}))},select:u=>{$.select("velocities",u)}});break}}},[F,$,h.vertecies,s,q,V.color,V.radius,V.selectedColor,V.hide,w,C.color,C.width,C.selectedColor,C.hide,N]),k.exports.useEffect(()=>{C.hide?Ie([]):Ie([{name:"velocities",color:C.color,selectedColor:C.selectedColor,scale:C.scale,arrowHeadScale:C.arrowHead,width:C.width,arrows:N.map((u,g)=>{const S=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/S,u.north_vel/S],scale:S,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:g}}),click:u=>{$.select("velocities",[u])}}])},[$,C,N]);let K=i("span",{});switch(n){case"files":K=e?i(ns,{folder:e,files:o,setFile:async(u,g,S)=>{if(S){let I=m({},o);switch(I[u]=v(m({},I[u]),{currentFilePath:g}),u){case"segment":const H=await pt(S);x(H),H.data&&s(fe(H.data));break;case"block":const Q=await gt(S);y(Q),Q.data&&s(de(Q.data));break;case"velocity":const X=await yt(S);p(X),X.data&&s(he(X.data));break;case"mesh":const Z=await xt(S);Z.data&&s(ue(Z.data));break;case"command":const j=await dn(e,S,o);f(j.commands),x(j.segments),j.segments.data&&s(fe(j.segments.data)),y(j.blocks),j.blocks.data&&s(de(j.blocks.data)),p(j.velocities),j.velocities.data&&s(he(j.velocities.data)),j.mesh.data&&s(ue(j.mesh.data)),I=j.openableFiles;break}r(I)}}}):i("span",{});break;case"velocities":K=i(ws,{settings:C,setSettings:G,selected:Le,velocitys:N,setVelocityData:(u,g)=>{g?s(ft({indices:u,data:g})):(s(mt(u)),$.select("velocity",[]))},addNewVelocity:()=>{U({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{U("normal");const g=N.length;s(ut({data:{lat:u.lat,lon:u.lon}})),$.select("velocity",[g])}})}});break;case"block":K=i(ss,{settings:V,setSettings:Ne,selected:ae,blocks:w,addNewBlock:()=>{U({label:"Click to place new block",mode:"mapClick",callback:u=>{const g=w.length;s(Ze({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),$.select("block",[g]),U("normal")}})},setBlockData:(u,g)=>{g?s(Ye({indices:ae,data:g})):(s(et(u)),$.select("block",[]))}});break;case"segment":K=i(ys,{settings:B,setSettings:ke,segments:(Ee=h.segments)!=null?Ee:[],selected:Fe,setSelectionMode:u=>U(u),addNewSegment:(u,g)=>{const S=h.segments.length;s(at({start:u,end:g})),$.select("segment",[S])},setSegmentData:(u,g)=>{s(g?it({indices:u,data:g}):ot({index:u}))},splitSegment:u=>{s(ct(u)),$.select("segment",[])}});break;case"vertex":K=i(ks,{settings:F,setSettings:Se,vertices:(Be=h.vertecies)!=null?Be:{},selected:Me,setVertexData:(u,g)=>{g&&s(me({index:u,vertex:g}))},setSelectionMode:u=>U(u),mergeVertices:(u,g)=>{s(lt({a:u,b:g}))},bridgeVertices:(u,g)=>{s(nt({a:u,b:g}))},extrudeVertex:(u,g)=>{s(rt({index:u,targetPoint:g}))}});break;case"mesh":K=i(hs,{settings:T,setSettings:Ce});break}const Oe={Block:{state:V.hide,change:()=>{Ne(v(m({},V),{hide:!V.hide}))}},Vertex:{state:F.hide,change:()=>{Se(v(m({},F),{hide:!F.hide}))}},Velocity:{state:C.hide,change:()=>{G(v(m({},C),{hide:!C.hide}))}},Segment:{state:B.hide,change:()=>{ke(v(m({},B),{hide:!B.hide}))}},Grid:{state:!ie,change:()=>{It(!ie)}},Mesh:{state:T.hide,change:()=>{Ce(v(m({},T),{hide:!T.hide}))}}};return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:u=>{u.key==="Escape"&&U("normal")},children:[i(xs,{filesOpen:((Pe=c!=null?c:d)!=null?Pe:l)!==void 0,saveFiles:async()=>{c&&await c.save(),d&&(d.data=h,await d.save()),l&&(l.data=w,await l.save()),_&&(_.data=N,await _.save())},folder:e,openFolder:async()=>{const u=await gn();t(u),a("files")}}),O!=="normal"?i("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[i("span",{className:"text-lg font-semibold",children:O.label}),O.subtitle?i("span",{className:"text-md font-thin text-gray-500",children:O.subtitle}):i(R,{}),i("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):i(R,{}),b("div",{className:"absolute bottom-0 left-2 flex flex-col bg-white rounded-t p-2 gap-5 shadow-sm z-50",children:[i("div",{className:"flex flex-row items-center justify-start gap-5",children:b("span",{className:"p-1 text-sm text-center",children:["Hold ",i("span",{className:"font-bold",children:"Shift"})," to box select"," ",i("span",{className:"font-bold",children:q})]})}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),b("span",{children:[Math.floor(Re.lon*1e3)/1e3,","," ",Math.floor(Re.lat*1e3)/1e3]})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[i("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(bt).map(u=>{const g=bt[u];return i("button",{type:"button",className:`${q===g?"bg-gray-200":"bg-white"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{Ct(g)},children:u},u)})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Oe).map(u=>{const g=Oe[u];return i("button",{type:"button",className:`${g.state?"bg-white":"bg-gray-200"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{g.change()},children:u},u)})]})]}),i(us,{pointSources:Dt,arrowSources:$t,lineSources:Lt,drawnPointSource:Mt,selections:{segments:Fe,blocks:ae,velocities:Le,vertices:Me},displayGrid:ie?10:-1,click:u=>{typeof O!="string"&&O.mode==="mapClick"&&O.callback(u)},mouseMove:u=>{jt(u)}}),i(as,{view:K,buttons:e?yn:void 0,active:n,setActive:u=>a(u)})]})}const vn=zt({reducer:{main:Jt(Gt({segment:Gs,block:Ms,velocity:tn,meshLine:Rs}))}});function bn(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:a,onRegisterError:o}=s;let r;const c=async(f=!0)=>{};return"serviceWorker"in navigator&&(r=new Ut("./sw.js",{scope:"./"}),r.addEventListener("activated",f=>{f.isUpdate?window.location.reload():n==null||n()}),r.register({immediate:e}).then(f=>{a==null||a(f)}).catch(f=>{o==null||o(f)})),c}bn();const wn=1,_n=new qt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:wn}}});Kt.render(i(k.exports.StrictMode,{children:i(Qt,{client:_n,children:i(Xt,{store:vn,children:i(xn,{})})})}),document.querySelector("#root"));
