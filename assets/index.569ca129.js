var et=Object.defineProperty,tt=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var le=(o,e,a)=>e in o?et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,m=(o,e)=>{for(var a in e||(e={}))st.call(e,a)&&le(o,a,e[a]);if(je)for(var a of je(e))nt.call(e,a)&&le(o,a,e[a]);return o},k=(o,e)=>tt(o,at(e));var j=(o,e,a)=>(le(o,typeof e!="symbol"?e+"":e,a),a);import{j as ce,m as Ve,r as x,a as de,M as ot,v as it,Q as rt,R as lt,b as ct}from"./vendor.2c6bff34.js";const dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function a(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerpolicy&&(l.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?l.credentials="include":t.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(t){if(t.ep)return;t.ep=!0;const l=a(t);fetch(t.href,l)}};dt();const i=ce.exports.jsx,N=ce.exports.jsxs,O=ce.exports.Fragment;function ut({value:o,fieldDefinition:e,setField:a}){return N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(O,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof o=="number"?"number":"text",value:o,onChange:n=>{a(typeof o=="number"?Number.parseFloat(n.target.value):n.target.value)}})})]})}function U({title:o,item:e,setItem:a,fieldDefinitions:n,ignoreFields:t,deletable:l,controls:u}){const s=Object.keys(e).map((r,d)=>{if(t==null?void 0:t.includes(r))return{element:i("span",{style:{display:"hidden"}},r),order:d+1e4};const _=e[r],b=r in n&&n[r];return b?{element:i(ut,{value:_,fieldDefinition:b,setField:y=>a({[r]:y})},r),order:b.order}:{element:N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${r}`,className:"text-l font-bold",children:r}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${r}`,className:"rounded w-full",type:typeof _=="number"?"number":"text",value:_,onChange:y=>{a({[r]:typeof _=="number"?Number.parseFloat(y.target.value):y.target.value})}})})]},r),order:d+1e3}}).sort((r,d)=>r.order-d.order).map(r=>r.element);return N("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:o}),N("span",{className:"flex flex-row justify-end gap-2 grow",children:[u,l?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{a()},children:"Delete"}):i(O,{})]})]}),s]})}U.defaultProps={ignoreFields:[],controls:i(O,{})};const ft={color:"#0000ff",selectedColor:"#ff0000",radius:6};var Ge;const mt=JSON.parse((Ge=window.localStorage.getItem("blockDisplaySettings"))!=null?Ge:"false")||ft;function pt({settings:o,setSettings:e,selected:a,blocks:n,setBlockData:t,addNewBlock:l}){const u=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},s=n[a],r=s?i(U,{title:s.name,item:s,deletable:!0,setItem:d=>t(a,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(O,{});return N(O,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:d=>{u(k(m({},o),{color:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.selectedColor,onChange:d=>{u(k(m({},o),{selectedColor:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:o.radius,onChange:d=>{u(k(m({},o),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:l,children:"New Block"})]}),r]})}function ht({folder:o,files:e,setFile:a}){const n=Object.keys(e).map(t=>{const l=e[t];return N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${t}-label`,children:l.name}),i("span",{className:"text-sm","data-testid":`file-${t}-description`,children:l.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:N("select",{"data-testid":`file-${t}-select`,className:"w-full rounded",value:l.currentFilePath,onChange:async u=>{const s=u.currentTarget.value;try{const r=await o.getFile(s);a(t,r.name,r)}catch{a(t,"")}},children:[i("option",{value:"","data-testid":`file-${t}-empty`,children:"\xA0"}),o.fileList.filter(u=>u.endsWith(l.extension)).map(u=>i("option",{value:u,"data-testid":`file-${t}-select-${u}`,children:u},u))]})})]},t)});return i("div",{className:"flex flex-col gap-2",children:n})}function gt({view:o,buttons:e,active:a,setActive:n}){if(!e)return i("span",{});const t=[];for(const l of Object.keys(e)){const u=e[l],s=l===a;t.push(i("button",{type:"button","data-testid":`tab-${l}`,className:`${s?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>n(s?"":l),children:u},l))}return N("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[a?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:o}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:t})]})}function ue(o){const e=o.split(/\n/g),a=e[0].split(","),n=e.slice(1),t=[];for(const l of n){const u=l.split(/\s*,\s*/),s={};for(let r=0;r<a.length;r+=1){let d=u[r];const _=a[r],b=Number.parseFloat(d);d=Number.isNaN(b)?d:b,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),s[_]=d}t.push(s)}return t}function fe(o,e){const a=[e.join(",")];for(const n of o){const t=n;a.push(e.map(l=>l in t?typeof t[l]=="string"&&/\s/.test(`${t[l]}`)?`"${t[l]}"`:`${t[l]}`:"").join(","))}return a.join(`
`)}const Ee=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],me={name:"unnamed segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:0,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:0,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Me={lon:0,lat:0},yt=180,G=360;function Ie(o){let{lon:e,lat:a}=o;for(;e<0;)e+=G;for(;e>G;)e-=G;return[e,a]}function Oe([o,e]){return{lon:o<0?o+G:o,lat:e}}function vt(o,e){const a=Ie(o),n=Ie(e),t=[n[0],n[1]];return n[0]-a[0]>=yt?t[0]-=G:t[0]+=G,Math.abs(a[0]-n[0])>Math.abs(a[0]-t[0])?[a,t]:[a,n]}const T=1e3;let Re=0;function X(o,e,a){const n=`${Math.floor(o.lon*T)},${Math.floor(o.lat*T)}`;if(n in e)return e[n];const t=Re;return Re+=1,a[t]=o,e[n]=t,t}class pe{constructor(e){j(this,"handle");j(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=ue(e).map(s=>{const r={};for(const d of Ee)r[d]=s[d]||(d==="name"?"":0);return r}),t={},l={},u=[];for(const s of n){const r=X({lon:s.lon1,lat:s.lat1},t,l),d=X({lon:s.lon2,lat:s.lat2},t,l),_=k(m({},s),{start:r,end:d});u.push(_)}this.data={vertecies:l,segments:u,vertexDictionary:t}}async save(){let e=[];if(this.data){const{vertecies:n,segments:t}=this.data;e=t.map(l=>{const u=n[l.start],s=n[l.end];return k(m({},l),{lon1:u.lon,lat1:u.lat,lon2:s.lon,lat2:s.lat})})}const a=fe(e,Ee);await this.handle.setContents(a)}clone(){return new pe(this.handle)}tryRemoveVertex(e){if(this.data){let a=!1;for(const n of this.data.segments)if(n.start===e||n.end===e){a=!0;break}if(!a&&this.data.vertecies[e]){const n=this.data.vertecies[e],t=`${Math.floor(n.lon*T)},${Math.floor(n.lat*T)}`,l=m({},this.data.vertecies);delete l[e];const u=m({},this.data.vertexDictionary);delete u[t];const s=this.clone();return s.data=k(m({},this.data),{vertecies:l,vertexDictionary:u}),s}}return this}mergeVertices(e,a){if(this.data){for(const r of this.data.segments)r.start===a&&(r.start=e),r.end===a&&(r.end=e);const n=this.data.vertecies[a],t=`${Math.floor(n.lon*T)},${Math.floor(n.lat*T)}`,l=m({},this.data.vertecies);delete l[a];const u=m({},this.data.vertexDictionary);delete u[t];const s=this.clone();return s.data=k(m({},this.data),{vertecies:l,vertexDictionary:u}),s}return this}moveVertex(e,a){if(this.data){const n=m({},this.data.vertecies),t=m({},this.data.vertexDictionary),l=[...this.data.segments],u=n[e],s=`${Math.floor(a.lon*T)},${Math.floor(a.lat*T)}`,r=`${Math.floor(u.lon*T)},${Math.floor(u.lat*T)}`;if(delete t[r],s in t){const _=t[s];for(const b of l)b.start===_&&(b.start=e),b.end===_&&(b.end=e);delete n[_]}n[e]=a;const d=this.clone();return d.data={segments:l,vertecies:n,vertexDictionary:t},d}return this}splitSegment(e){if(this.data){const a=this.data.segments[e],n=this.data.vertecies[a.start],t=this.data.vertecies[a.end],l={lon:(n.lon+t.lon)/2,lat:(n.lat+t.lat)/2},u=X(l,this.data.vertexDictionary,this.data.vertecies),s=k(m({},a),{end:u}),r=k(m({},a),{start:u}),d=[...this.data.segments];d[e]=s,d.push(r);const _=this.clone();return _.data=k(m({},this.data),{segments:d}),_}return this}bridgeVertices(e,a){if(this.data){const n=k(m({},me),{start:e,end:a}),t=[...this.data.segments,n],l=this.clone();return l.data=k(m({},this.data),{segments:t}),l}return this}extrudeSegment(e,a){if(this.data){const n=m({},this.data.vertecies),t=m({},this.data.vertexDictionary),l=X(a,t,n),u=k(m({},me),{start:e,end:l}),s=[...this.data.segments,u],r=this.clone();return r.data={vertecies:n,vertexDictionary:t,segments:s},r}return this}deleteSegment(e){if(this.data){const a=[...this.data.segments],n=a.splice(e,1)[0],t=this.clone();return t.data=k(m({},this.data),{segments:a}),t.tryRemoveVertex(n.start).tryRemoveVertex(n.end)}return this}createSegment(e,a){if(this.data){const n=m({},this.data.vertecies),t=m({},this.data.vertexDictionary),l=X(e,t,n),u=X(a,t,n),s=k(m({},me),{start:l,end:u}),r=[...this.data.segments,s],d=this.clone();return d.data={vertecies:n,vertexDictionary:t,segments:r},d}return this}}Ve.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const K=Math.PI/6,oe=2*Math.PI-K,H={};function wt({pointSources:o,arrowSources:e,lineSources:a,selections:n,drawnPointSource:t,click:l}){const u=x.exports.useRef(null),[s,r]=x.exports.useState(),[d,_]=x.exports.useState(!1),[b,y]=x.exports.useState(),[M]=x.exports.useState(new de.exports.Popup({closeButton:!1,closeOnClick:!1})),[R,Z]=x.exports.useState(),[P,Y]=x.exports.useState(),[I,ee]=x.exports.useState(),[V,ie]=x.exports.useState({source:void 0}),[E,q]=x.exports.useState({selectedColor:"",selectedRadius:0,color:"",radius:0}),[B,Q]=x.exports.useState({}),[W,te]=x.exports.useState({click:l});return x.exports.useEffect(()=>{W.click!==l&&(W.click=l,te(W))},[l,W]),x.exports.useEffect(()=>{if(!s&&Ve.accessToken&&u.current){const v=new de.exports.Map({container:u.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});v.addControl(new de.exports.NavigationControl),r(v),v.on("load",()=>{_(!0)}),v.on("click",({lngLat:L})=>{W.click(Oe([L.lng,L.lat]))}),v.on("draw.selectionchange",({features:L})=>{var p;if(!((p=V.source)==null?void 0:p.select))return;const f=L[0];f&&f.type==="Feature"&&f.geometry.type==="Point"&&f.properties&&"index"in f.properties&&typeof f.properties.index=="number"&&V.source.select(f.properties.index)}),v.on("draw.update",({features:L,action:f})=>{var p;if(!!((p=V.source)==null?void 0:p.update)&&f==="move"&&L.length>0)for(const S of L)S.type==="Feature"&&S.geometry.type==="Point"&&S.properties&&"index"in S.properties&&typeof S.properties.index=="number"&&V.source.update(S.properties.index,Oe(S.geometry.coordinates))})}console.log("Updating map...")},[b,W,V.source,s]),x.exports.useEffect(()=>{if(s&&d&&V.source!==t){console.log("Drawning Points"),V.source=t,ie(V);let v=b;(t.selectedColor!==E.selectedColor||t.selectedRadius!==E.selectedRadius||t.color!==E.color||t.radius!==E.radius)&&(q({color:t.color,radius:t.radius,selectedRadius:t.selectedRadius,selectedColor:t.selectedColor}),b&&s.removeControl(b),t?(v=new ot({displayControlsDefault:!1,controls:{point:!0},defaultMode:"simple_select"}),s.addControl(v),y(v)):v=void 0),v&&v.set({type:"FeatureCollection",features:t.points.map(L=>({type:"Feature",properties:{description:"",index:L.index,name:""},geometry:{type:"Point",coordinates:[L.longitude,L.latitude]}}))})}},[s,d,V,t,E,b]),x.exports.useEffect(()=>{if(s&&d&&P!==e)if(console.log("Setting arrows in map!"),P){for(const v of P){H[`arrow:${v.name}`]=v.click;const L=s.getSource(`arrow:${v.name}`);L!==void 0&&L.setData({type:"FeatureCollection",features:[]}),s.removeLayer(`layer:arrow:${v.name}`),s.removeLayer(`layer:arrow:${v.name}:click`)}Y(void 0)}else{for(const v of e){H[`arrow:${v.name}`]=v.click;let L=s.getSource(`arrow:${v.name}`);const f=L===void 0;f&&(s.addSource(`arrow:${v.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),L=s.getSource(`arrow:${v.name}`)),L!==void 0&&L.setData({type:"FeatureCollection",features:v.arrows.map((p,S)=>{const g=p.scale*v.scale,w=v.scale*v.arrowHeadScale,F=[p.longitude+p.direction[0]*g,p.latitude+p.direction[1]*g],A=[F[0]+(Math.cos(K)*-p.direction[0]-Math.sin(K)*-p.direction[1])*w,F[1]+(Math.sin(K)*-p.direction[0]+Math.cos(K)*-p.direction[1])*w],re=[F[0]+(Math.cos(oe)*-p.direction[0]-Math.sin(oe)*-p.direction[1])*w,F[1]+(Math.sin(oe)*-p.direction[0]+Math.cos(oe)*-p.direction[1])*w];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:S,name:p.name},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],F,A,F,re]}}})}),s.addLayer({id:`layer:arrow:${v.name}`,type:"line",source:`arrow:${v.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":v.color,"line-width":v.width}}),s.addLayer({id:`layer:arrow:${v.name}:click`,type:"line",source:`arrow:${v.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":v.width*10}}),f&&(s.on("mouseenter",`layer:arrow:${v.name}:click`,p=>{if(!p.features)return;const S=p.features[0];if(S.geometry.type==="Point"&&S.properties&&typeof S.properties.description=="string"){const g=[...S.geometry.coordinates],{description:w}=S.properties;for(;Math.abs(p.lngLat.lng-g[0])>180;)g[0]+=p.lngLat.lng>g[0]?360:-360;M.setLngLat(g).setHTML(w).addTo(s)}}),s.on("mouseleave",`layer:arrow:${v.name}:click`,()=>{M.remove()}),s.on("click",`layer:arrow:${v.name}:click`,p=>{const S=H[`arrow:${v.name}`];if(!p.features||!S)return;const g=p.features[0];if(g.properties&&typeof g.properties.index=="number"&&typeof g.properties.name=="string"){const{index:w}=g.properties;S(w)}}))}Y(e)}},[s,P,e,d,M]),x.exports.useEffect(()=>{if(s&&d&&I!==a)if(console.log("Setting lines in map!"),I){for(const f of I){H[`line:${f.name}`]=f.click;const p=s.getSource(`line:${f.name}`);p!==void 0&&p.setData({type:"FeatureCollection",features:[]}),s.removeLayer(`layer:line:${f.name}`),s.removeLayer(`layer:line:${f.name}:click`)}ee(void 0)}else{for(const f of a){H[`line:${f.name}`]=f.click;let p=s.getSource(`line:${f.name}`);const S=p===void 0;S&&(s.addSource(`line:${f.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p=s.getSource(`line:${f.name}`)),p!==void 0&&p.setData({type:"FeatureCollection",features:f.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index===n[f.name]},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))}),s.addLayer({id:`layer:line:${f.name}`,type:"line",source:`line:${f.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],f.selectedColor,f.color],"line-width":["case",["get","selected"],f.selectedWidth,f.width]}}),s.addLayer({id:`layer:line:${f.name}:click`,type:"line",source:`line:${f.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":f.width*10}}),S&&(s.on("mouseenter",`layer:line:${f.name}:click`,g=>{if(!g.features)return;const w=g.features[0];if(w.geometry.type==="LineString"&&w.properties&&typeof w.properties.description=="string"){const F=[(w.geometry.coordinates[0][0]+w.geometry.coordinates[1][0])/2,(w.geometry.coordinates[0][1]+w.geometry.coordinates[1][1])/2],{description:A}=w.properties;for(;Math.abs(g.lngLat.lng-F[0])>180;)F[0]+=g.lngLat.lng>F[0]?360:-360;M.setLngLat(F).setHTML(A).addTo(s)}}),s.on("mouseleave",`layer:line:${f.name}:click`,()=>{M.remove()}),s.on("click",`layer:line:${f.name}:click`,g=>{const w=H[`line:${f.name}`];if(!g.features||!w)return;const F=g.features[0];if(F.properties&&typeof F.properties.index=="number"&&typeof F.properties.name=="string"){const{index:A}=F.properties;w(A)}}))}ee(a)}const v=m({},B);let L=!1;for(const f of Object.keys(n))if(n[f]!==B[f]){for(const p of a)if(p.name===f){L=!0,v[f]=n[f];const S=s==null?void 0:s.getSource(`line:${p.name}`);if(S){const g=n[f];S.setData({type:"FeatureCollection",features:p.lines.map(w=>({type:"Feature",properties:{description:`<strong>${w.name}</strong><p>${w.description}</p>`,index:w.index,name:w.name,selected:w.index===g},geometry:{type:"LineString",coordinates:[[w.startLongitude,w.startLatitude],[w.endLongitude,w.endLatitude]]}}))})}}}L&&Q(v)},[s,I,a,d,M,n,B]),x.exports.useEffect(()=>{if(!s||!d)return;if(R!==o)if(console.log("Setting points in map!"),R){for(const f of R){H[`point:${f.name}`]=f.click;const p=s.getSource(`point:${f.name}`);p!==void 0&&p.setData({type:"FeatureCollection",features:[]}),s.removeLayer(`layer:point:${f.name}`)}Z(void 0)}else{for(const f of o){H[`point:${f.name}`]=f.click;let p=s.getSource(`point:${f.name}`);const S=p===void 0;S&&(s.addSource(`point:${f.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p=s.getSource(`point:${f.name}`)),p!==void 0&&p.setData({type:"FeatureCollection",features:f.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index!==n[f.name]},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),s.addLayer({id:`layer:point:${f.name}`,type:"circle",source:`point:${f.name}`,paint:{"circle-color":["case",["get","selected"],f.selectedColor,f.color],"circle-radius":f.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),S&&(s.on("mouseenter",`layer:point:${f.name}`,g=>{if(!g.features)return;const w=g.features[0];if(w.geometry.type==="Point"&&w.properties&&typeof w.properties.description=="string"){const F=[...w.geometry.coordinates],{description:A}=w.properties;for(;Math.abs(g.lngLat.lng-F[0])>180;)F[0]+=g.lngLat.lng>F[0]?360:-360;M.setLngLat(F).setHTML(A).addTo(s)}}),s.on("mouseleave",`layer:point:${f.name}`,()=>{M.remove()}),s.on("click",`layer:point:${f.name}`,g=>{const w=H[`point:${f.name}`];if(!g.features||!w)return;const F=g.features[0];if(F.properties&&typeof F.properties.index=="number"&&typeof F.properties.name=="string"){const{index:A}=F.properties;w(A)}}))}Z(o)}const v=m({},B);let L=!1;for(const f of Object.keys(n))if(n[f]!==B[f]){for(const p of o)if(p.name===f){L=!0,v[f]=n[f];const S=s.getSource(`point:${p.name}`);if(S){const g=n[f];S.setData({type:"FeatureCollection",features:p.points.map(w=>({type:"Feature",properties:{description:`<strong>${w.name}</strong><p>${w.description}</p>`,index:w.index,name:w.name,selected:w.index!==g},geometry:{type:"Point",coordinates:[w.longitude,w.latitude]}}))})}}}L&&Q(v)},[s,R,o,d,M,n,B]),i("div",{"data-testid":"map",className:"w-full h-full",ref:u})}const _t={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3};var Xe;const xt=m(m({},_t),JSON.parse((Xe=window.localStorage.getItem("segmentDisplaySettings"))!=null?Xe:"{}"));function bt({settings:o,setSettings:e,segments:a,selected:n,setSegmentData:t,addNewSegment:l,splitSegment:u,setSelectionMode:s}){const r=b=>{e(b),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(b))},d=a[n],_=d?i(U,{title:d.name,item:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:b=>t(n,b),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}},controls:i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>u(n),children:"Split Segment"})}):i(O,{});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:b=>{r(k(m({},o),{color:b.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.width,onChange:b=>{r(k(m({},o),{width:Number.parseFloat(b.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.activeColor,onChange:b=>{r(k(m({},o),{activeColor:b.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.activeWidth,onChange:b=>{r(k(m({},o),{activeWidth:Number.parseFloat(b.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{s({mode:"mapClick",label:"Select Segment Starting Point",callback:b=>{s({mode:"mapClick",label:"Select Segment End point",callback:y=>{l(b,y),s("normal")}})}})},children:"New Segment"})]}),_]})}function Nt({folder:o,openFolder:e,filesOpen:a,saveFiles:n}){function t(){e()}return N("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"Celeri UI"}),N("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[o?N("span",{children:["Working in ",o.name]}):i("button",{type:"button",onClick:t,"data-testid":"open-folder-button",children:"Open Folder"}),a?i("button",{type:"button",onClick:n,"data-testid":"save-file-button",children:"Save Files"}):i(O,{})]})]})}const St={color:"#ffff00",scale:.02,width:1,arrowHead:1};var qe;const kt=JSON.parse((qe=window.localStorage.getItem("velocityDisplaySettings"))!=null?qe:"false")||St;function Ct({settings:o,setSettings:e,selected:a,velocitys:n,setVelocityData:t,addNewVelocity:l}){const u=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},s=n[a],r=s?i(U,{title:s.name,item:s,deletable:!0,setItem:d=>t(a,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(O,{});return N(O,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:d=>{u(k(m({},o),{color:d.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:o.scale,onChange:d=>{u(k(m({},o),{scale:Number.parseFloat(d.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.width,onChange:d=>{u(k(m({},o),{width:Number.parseFloat(d.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:o.arrowHead,onChange:d=>{u(k(m({},o),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:l,children:"New Velocity"})]}),r]})}const $t={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3};var Qe;const Lt=m(m({},$t),JSON.parse((Qe=window.localStorage.getItem("vertexDisplaySettings"))!=null?Qe:"{}"));function Ft({settings:o,setSettings:e,vertices:a,selected:n,setVertexData:t,setSelectionMode:l,mergeVertices:u,bridgeVertices:s,extrudeVertex:r}){const d=y=>{e(y),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(y))},_=a[n],b=_?i(U,{title:"Selected Vertex",item:_,ignoreFields:[],deletable:!1,setItem:y=>t(n,y),fieldDefinitions:{},controls:N(O,{children:[i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Merge Vertex",callback:y=>{u(n,y),l("normal")}})},children:"Merge"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Bridge Vertices",callback:y=>{s(n,y),l("normal")}})},children:"Bridge"}),i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{l({mode:"mapClick",label:"Extrude Segment From Vertex",callback:y=>{r(n,y),l("normal")}})},children:"Extrude"})]})}):i(O,{});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.color,onChange:y=>{d(k(m({},o),{color:y.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.radius,onChange:y=>{d(k(m({},o),{radius:Number.parseFloat(y.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:o.activeColor,onChange:y=>{d(k(m({},o),{activeColor:y.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:o.activeRadius,onChange:y=>{d(k(m({},o),{activeRadius:Number.parseFloat(y.target.value)}))}})})]}),b]})}const Ae=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Dt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Pe(o){return m(m({},Dt),o)}class he{constructor(e){j(this,"handle");j(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=ue(e).map(t=>{const l={};for(const u of Ae)l[u]=t[u]||(u==="name"?"":0);return l});this.data=n}async save(){var a;const e=fe((a=this.data)!=null?a:[],Ae);await this.handle.setContents(e)}clone(){return new he(this.handle)}}const jt={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Vt(o){return m(m({},jt),o)}class ge{constructor(e){j(this,"handle");j(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=JSON.parse(e);this.data=Vt(a)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new ge(this.handle)}}const Te=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Et={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Be(o){return m(m({},Et),o)}class ye{constructor(e){j(this,"handle");j(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=ue(e).map(t=>{const l={};for(const u of Te)l[u]=t[u]||(u==="name"?"":0);return l});this.data=n}async save(){var a;const e=fe((a=this.data)!=null?a:[],Te);await this.handle.setContents(e)}clone(){return new ye(this.handle)}}async function We(o){const e=new pe(o);return await e.initialize(),e}async function He(o){const e=new he(o);return await e.initialize(),e}async function ze(o){const e=new ye(o);return await e.initialize(),e}async function Mt(o,e,a){const n=new ge(e);if(await n.initialize(),n.data){const t=await We(await o.getFile(n.data.segment_file_name)),l=await He(await o.getFile(n.data.block_file_name)),u=await ze(await o.getFile(n.data.station_file_name)),s=m({},a);return"command"in s&&(s.command=k(m({},s.command),{currentFilePath:e.name})),"segment"in s&&(s.segment=k(m({},s.segment),{currentFilePath:n.data.segment_file_name})),"block"in s&&(s.block=k(m({},s.block),{currentFilePath:n.data.block_file_name})),"velocities"in s&&(s.velocities=k(m({},s.velocities),{currentFilePath:n.data.station_file_name})),{openableFiles:s,commands:n,segments:t,blocks:l,velocities:u}}throw new Error("Can't open command file")}class It{constructor(e){j(this,"name");j(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const a=await this.handle.createWritable();await a.write(e),await a.close()}}class ve{constructor(e){j(this,"name");j(this,"handle");j(this,"fileList");j(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const a=await this.handle.getFileHandle(e);return new It(a)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const a=await this.handle.getDirectoryHandle(e),n=new ve(a);return await n.initialize(),n}}const Ot=async()=>{const o=await window.showDirectoryPicker(),e=new ve(o);return await e.initialize(),e};class Rt{constructor(e,a){j(this,"name");j(this,"parent");this.name=e,this.parent=a}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class we{constructor(e,a){j(this,"name");j(this,"parent");j(this,"fileList");j(this,"folderList");this.name=e,this.parent=a,this.fileList=[],this.folderList=[];const n=a[e];for(const t of Object.keys(n))typeof n[t]=="string"?this.fileList.push(t):this.folderList.push(t)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Rt(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new we(e,this.parent[this.name])}}const At=async o=>new we("root",o);let Je=async()=>{var e;return At((e=window.FakeDirectory)!=null?e:{})};function Pt(o){Je=o}async function Tt(){return Je()}window.location.search.includes("fake-dir")||Pt(Ot);const Bt={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function Wt(){var _e,xe,be,Ne,Se,ke,Ce;const[o,e]=x.exports.useState(),[a,n]=x.exports.useState(""),[t,l]=x.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[u,s]=x.exports.useState(),[r,d]=x.exports.useState(),[_,b]=x.exports.useState(),[y,M]=x.exports.useState(),[R,Z]=x.exports.useState(kt),[P,Y]=x.exports.useState(mt),[I,ee]=x.exports.useState(xt),[V,ie]=x.exports.useState(Lt),[E,q]=x.exports.useState("normal"),[B,Q]=x.exports.useState(-1),[W,te]=x.exports.useState(-1),[v,L]=x.exports.useState(-1),[f,p]=x.exports.useState(-1),[S,g]=x.exports.useState({select:(c,h)=>{Q(c==="block"?h:-1),te(c==="segment"?h:-1),L(c==="velocities"?h:-1),p(c==="vertex"?h:-1),n(c)}}),[w,F]=x.exports.useState([]),[A,re]=x.exports.useState([]),[Ue,Ke]=x.exports.useState([]),[Ze,Ye]=x.exports.useState({color:"",selectedColor:"",radius:0,selectedRadius:0,points:[]});x.exports.useEffect(()=>{E==="normal"?g({select:(c,h)=>{Q(c==="block"?h:-1),te(c==="segment"?h:-1),L(c==="velocities"?h:-1),p(c==="vertex"?h:-1),n(c)}}):E.mode==="override"?g({select:(c,h)=>{c===E.type&&E.callback(h)}}):g({select:()=>{}})},[E]),x.exports.useEffect(()=>{F([{name:"blocks",color:P.color,selectedColor:P.selectedColor,radius:P.radius,points:(_==null?void 0:_.data)?_.data.map((c,h)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:h})):[],click:c=>{S.select("block",c)}}])},[P,_,I,r,S]),x.exports.useEffect(()=>{var c;Ke([{name:"segments",color:I.color,selectedColor:I.activeColor,width:I.width,selectedWidth:I.activeWidth,lines:((c=r==null?void 0:r.data)==null?void 0:c.segments)?r.data.segments.map((h,C)=>{var $e,Le,Fe,De;const $=(Le=($e=r.data)==null?void 0:$e.vertecies[h.start])!=null?Le:Me,D=(De=(Fe=r.data)==null?void 0:Fe.vertecies[h.end])!=null?De:Me,[[ae,se],[ne,J]]=vt($,D);return{startLongitude:ae,startLatitude:se,endLongitude:ne,endLatitude:J,name:h.name,description:`${$.lon},${$.lat} to ${D.lon},${D.lat}`,index:C}}):[],click:h=>{S.select("segment",h)}}])},[r,I,S]),x.exports.useEffect(()=>{var c;Ye({color:V.color,radius:V.radius,selectedColor:V.activeColor,selectedRadius:V.activeRadius,points:((c=r==null?void 0:r.data)==null?void 0:c.vertecies)?Object.keys(r.data.vertecies).map(h=>{var D;const C=Number.parseInt(h,10),$=(D=r.data)==null?void 0:D.vertecies[C];return $?{longitude:$.lon,latitude:$.lat,index:C}:!1}).filter(h=>!!h):[],update:(h,C)=>{if(r){const $=r.moveVertex(h,C);d($)}},select:h=>{S.select("vertex",h)}})},[V,r,S]),x.exports.useEffect(()=>{re([{name:"velocity",color:R.color,scale:R.scale,arrowHeadScale:R.arrowHead,width:R.width,arrows:(y==null?void 0:y.data)?y.data.map(c=>{const h=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/h,c.north_vel/h],scale:h,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`}}):[],click:c=>{S.select("velocities",c)}}])},[S,R,y]);let z=i("span",{});switch(a){case"files":z=o?i(ht,{folder:o,files:t,setFile:async(c,h,C)=>{if(C){let $=m({},t);switch($[c]=k(m({},$[c]),{currentFilePath:h}),c){case"segment":d(await We(C));break;case"block":b(await He(C));break;case"velocity":M(await ze(C));break;case"command":const D=await Mt(o,C,t);s(D.commands),d(D.segments),b(D.blocks),M(D.velocities),$=D.openableFiles;break}l($)}}}):i("span",{});break;case"velocities":z=i(Ct,{settings:R,setSettings:Z,selected:v,velocitys:(_e=y==null?void 0:y.data)!=null?_e:[],setVelocityData:(c,h)=>{if(y!==void 0)if(h){const C=y.data&&y.data[c]?m(m({},y.data[c]),h):Be(h),$=y.data?[...y.data]:[];$[c]=C;const D=y.clone();D.data=$,M(D)}else{const C=y.data?[...y.data]:[];C.splice(c,1);const $=y.clone();$.data=C,M($)}},addNewVelocity:()=>{if(y!==void 0){const c=y.data?[...y.data]:[],h=Be({});c.push(h);const C=y.clone();C.data=c,M(C)}}});break;case"block":z=i(pt,{settings:P,setSettings:Y,selected:B,blocks:(xe=_==null?void 0:_.data)!=null?xe:[],addNewBlock:()=>{if(_!==void 0){const c=_.data?[..._.data]:[],h=Pe({});c.push(h);const C=_.clone();C.data=c,b(C)}},setBlockData:(c,h)=>{if(_!==void 0)if(h){const C=_.data&&_.data[c]?m(m({},_.data[c]),h):Pe(h),$=_.data?[..._.data]:[];$[c]=C;const D=_.clone();D.data=$,b(D)}else{const C=_.data?[..._.data]:[];C.splice(c,1);const $=_.clone();$.data=C,b($)}}});break;case"segment":z=i(bt,{settings:I,setSettings:ee,segments:(Ne=(be=r==null?void 0:r.data)==null?void 0:be.segments)!=null?Ne:[],selected:W,setSelectionMode:c=>q(c),addNewSegment:(c,h)=>{r!==void 0&&d(r.createSegment(c,h))},setSegmentData:(c,h)=>{var C,$,D,ae;if(r!==void 0)if(h){const se=r.data&&r.data.segments[c]?m(m({},r.data.segments[c]),h):void 0,ne=r.data?[...r.data.segments]:[];if(se){ne[c]=se;const J=r.clone();J.data={vertecies:($=(C=J.data)==null?void 0:C.vertecies)!=null?$:[],vertexDictionary:(ae=(D=J.data)==null?void 0:D.vertexDictionary)!=null?ae:{},segments:ne},d(J)}}else d(r.deleteSegment(c))},splitSegment:c=>{if(r){const h=r.splitSegment(c);d(h)}}});break;case"vertex":z=i(Ft,{settings:V,setSettings:ie,vertices:(ke=(Se=r==null?void 0:r.data)==null?void 0:Se.vertecies)!=null?ke:{},selected:f,setVertexData:function(c,h){throw new Error("Function not implemented.")},setSelectionMode:c=>q(c),mergeVertices:(c,h)=>{r&&d(r.mergeVertices(c,h))},bridgeVertices:(c,h)=>{r&&d(r.bridgeVertices(c,h))},extrudeVertex:(c,h)=>{r&&d(r.extrudeSegment(c,h))}});break}return N("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:c=>{c.key==="Escape"&&q("normal")},children:[i(Nt,{filesOpen:((Ce=u!=null?u:r)!=null?Ce:_)!==void 0,saveFiles:async()=>{u&&await u.save(),r&&await r.save(),_&&await _.save()},folder:o,openFolder:async()=>{const c=await Tt();e(c),n("files")}}),E!=="normal"?N("div",{className:"",children:[i("span",{className:"",children:E.label}),i("span",{className:"",children:"Press Escape to cancel"})]}):i(O,{}),i(wt,{pointSources:w,arrowSources:A,lineSources:Ue,drawnPointSource:Ze,selections:{segments:W,blocks:B,velocities:v},click:c=>{typeof E!="string"&&E.mode==="mapClick"&&E.callback(c)}}),i(gt,{view:z,buttons:o?Bt:void 0,active:a,setActive:c=>n(c)})]})}function Ht(o={}){const{immediate:e=!1,onNeedRefresh:a,onOfflineReady:n,onRegistered:t,onRegisterError:l}=o;let u;const s=async(r=!0)=>{};return"serviceWorker"in navigator&&(u=new it("./sw.js",{scope:"./"}),u.addEventListener("activated",r=>{r.isUpdate?window.location.reload():n==null||n()}),u.register({immediate:e}).then(r=>{t==null||t(r)}).catch(r=>{l==null||l(r)})),s}Ht();const zt=1,Jt=new rt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:zt}}});lt.render(i(x.exports.StrictMode,{children:i(ct,{client:Jt,children:i(Wt,{})})}),document.querySelector("#root"));
