var Qe=Object.defineProperty,Ue=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var se=(a,e,o)=>e in a?Qe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,g=(a,e)=>{for(var o in e||(e={}))Ke.call(e,o)&&se(a,o,e[o]);if($e)for(var o of $e(e))Ye.call(e,o)&&se(a,o,e[o]);return a},$=(a,e)=>Ue(a,Ze(e));var D=(a,e,o)=>(se(a,typeof e!="symbol"?e+"":e,o),o);import{j as oe,m as Le,r as x,a as ie,M as et,v as tt,Q as at,R as nt,b as st}from"./vendor.2c6bff34.js";const ot=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&i(t)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}};ot();const s=oe.exports.jsx,_=oe.exports.jsxs,O=oe.exports.Fragment;function it({value:a,fieldDefinition:e,setField:o}){return _("div",{className:"flex flex-row justify-between items-center",children:[_("div",{className:"flex flex-col",children:[s("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?s("span",{className:"text-sm",children:e.description}):s(O,{})]}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof a=="number"?"number":"text",value:a,onChange:i=>{o(typeof a=="number"?Number.parseFloat(i.target.value):i.target.value)}})})]})}function U({title:a,item:e,setItem:o,fieldDefinitions:i,ignoreFields:n,deletable:c,controls:t}){const u=Object.keys(e).map((r,f)=>{if(n==null?void 0:n.includes(r))return{element:s("span",{style:{display:"hidden"}},r),order:f+1e4};const d=e[r],j=r in i&&i[r];return j?{element:s(it,{value:d,fieldDefinition:j,setField:b=>o({[r]:b})},r),order:j.order}:{element:_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":`input-title-${r}`,className:"text-l font-bold",children:r}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${r}`,className:"rounded w-full",type:typeof d=="number"?"number":"text",value:d,onChange:b=>{o({[r]:typeof d=="number"?Number.parseFloat(b.target.value):b.target.value})}})})]},r),order:f+1e3}}).sort((r,f)=>r.order-f.order).map(r=>r.element);return _("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:a}),_("span",{className:"flex flex-row justify-end gap-2 grow",children:[t,c?s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{o()},children:"Delete"}):s(O,{})]})]}),u]})}U.defaultProps={ignoreFields:[],controls:s(O,{})};const rt={color:"#0000ff",selectedColor:"#ff0000",radius:6};var Be;const lt=JSON.parse((Be=window.localStorage.getItem("blockDisplaySettings"))!=null?Be:"false")||rt;function ct({settings:a,setSettings:e,selected:o,blocks:i,setBlockData:n,addNewBlock:c}){const t=f=>{e(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},u=i[o],r=u?s(U,{title:u.name,item:u,deletable:!0,setItem:f=>n(o,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(O,{});return _(O,{children:[_("div",{className:"flex flex-col gap-2",children:[_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.color,onChange:f=>{t($(g({},a),{color:f.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.selectedColor,onChange:f=>{t($(g({},a),{selectedColor:f.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:a.radius,onChange:f=>{t($(g({},a),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Block"}),s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:c,children:"New Block"})]}),r]})}function dt({folder:a,files:e,setFile:o}){const i=Object.keys(e).map(n=>{const c=e[n];return _("div",{className:"flex flex-row justify-between items-center",children:[_("div",{className:"flex flex-col",children:[s("span",{className:"text-l font-bold","data-testid":`file-${n}-label`,children:c.name}),s("span",{className:"text-sm","data-testid":`file-${n}-description`,children:c.description})]}),s("span",{className:"w-2/5 flex-shrink-0",children:_("select",{"data-testid":`file-${n}-select`,className:"w-full rounded",value:c.currentFilePath,onChange:async t=>{const u=t.currentTarget.value;try{const r=await a.getFile(u);o(n,r.name,r)}catch{o(n,"")}},children:[s("option",{value:"","data-testid":`file-${n}-empty`,children:"\xA0"}),a.fileList.filter(t=>t.endsWith(c.extension)).map(t=>s("option",{value:t,"data-testid":`file-${n}-select-${t}`,children:t},t))]})})]},n)});return s("div",{className:"flex flex-col gap-2",children:i})}function ut({view:a,buttons:e,active:o,setActive:i}){if(!e)return s("span",{});const n=[];for(const c of Object.keys(e)){const t=e[c],u=c===o;n.push(s("button",{type:"button","data-testid":`tab-${c}`,className:`${u?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>i(u?"":c),children:t},c))}return _("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[o?s("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:a}):"",s("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:n})]})}function re(a){const e=a.split(/\n/g),o=e[0].split(","),i=e.slice(1),n=[];for(const c of i){const t=c.split(/\s*,\s*/),u={};for(let r=0;r<o.length;r+=1){let f=t[r];const d=o[r],j=Number.parseFloat(f);f=Number.isNaN(j)?f:j,typeof f=="string"&&f.startsWith('"')&&f.endsWith('"')&&(f=f.slice(1,-1)),u[d]=f}n.push(u)}return n}function le(a,e){const o=[e.join(",")];for(const i of a){const n=i;o.push(e.map(c=>c in n?typeof n[c]=="string"&&/\s/.test(`${n[c]}`)?`"${n[c]}"`:`${n[c]}`:"").join(","))}return o.join(`
`)}const Fe=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],De={lon:0,lat:0},ft=180,q=360;function je(a){let{lon:e,lat:o}=a;for(;e<0;)e+=q;for(;e>q;)e-=q;return[e,o]}function pt([a,e]){return{lon:a<0?a+q:a,lat:e}}function mt(a,e){const o=je(a),i=je(e),n=[i[0],i[1]];return i[0]-o[0]>=ft?n[0]-=q:n[0]+=q,Math.abs(o[0]-i[0])>Math.abs(o[0]-n[0])?[o,n]:[o,i]}const W=1e3;let Ve=0;function ce(a,e,o){const i=`${Math.floor(a.lon*W)},${Math.floor(a.lat*W)}`;if(i in e)return e[i];const n=Ve;return Ve+=1,o[n]=a,e[i]=n,n}class de{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),i=re(e).map(u=>{const r={};for(const f of Fe)r[f]=u[f]||(f==="name"?"":0);return r}),n={},c={},t=[];for(const u of i){const r=ce({lon:u.lon1,lat:u.lat1},n,c),f=ce({lon:u.lon2,lat:u.lat2},n,c),d=$(g({},u),{start:r,end:f});t.push(d)}this.data={vertecies:c,segments:t,vertexDictionary:n}}async save(){let e=[];if(this.data){const{vertecies:i,segments:n}=this.data;e=n.map(c=>{const t=i[c.start],u=i[c.end];return $(g({},c),{lon1:t.lon,lat1:t.lat,lon2:u.lon,lat2:u.lat})})}const o=le(e,Fe);await this.handle.setContents(o)}clone(){return new de(this.handle)}tryRemoveVertex(e){if(this.data){let o=!1;for(const i of this.data.segments)if(i.start===e||i.end===e){o=!0;break}if(!o&&this.data.vertecies[e]){const i=this.data.vertecies[e],n=`${Math.floor(i.lon*W)},${Math.floor(i.lat*W)}`,c=g({},this.data.vertecies);delete c[e];const t=g({},this.data.vertexDictionary);delete t[n];const u=this.clone();return u.data=$(g({},this.data),{vertecies:c,vertexDictionary:t}),u}}return this}moveVertex(e,o){if(this.data){const i=g({},this.data.vertecies),n=g({},this.data.vertexDictionary),c=[...this.data.segments],t=i[e],u=`${Math.floor(o.lon*W)},${Math.floor(o.lat*W)}`,r=`${Math.floor(t.lon*W)},${Math.floor(t.lat*W)}`;if(delete n[r],u in n){const d=n[u];for(const j of c)j.start===d&&(j.start=e),j.end===d&&(j.end=e);delete i[d]}i[e]=o;const f=this.clone();return f.data={segments:c,vertecies:i,vertexDictionary:n},f}return this}splitSegment(e){if(this.data){const o=this.data.segments[e],i=this.data.vertecies[o.start],n=this.data.vertecies[o.end],c={lon:(i.lon+n.lon)/2,lat:(i.lat+n.lat)/2},t=ce(c,this.data.vertexDictionary,this.data.vertecies),u=$(g({},o),{end:t}),r=$(g({},o),{start:t}),f=[...this.data.segments];f[e]=u,f.push(r);const d=this.clone();return d.data=$(g({},this.data),{segments:f}),d}return this}}Le.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const Z=Math.PI/6,ae=2*Math.PI-Z,A={};function ht({pointSources:a,arrowSources:e,lineSources:o,selections:i,drawnPointSource:n}){const c=x.exports.useRef(null),[t,u]=x.exports.useState(),[r,f]=x.exports.useState(!1),[d,j]=x.exports.useState(),[b]=x.exports.useState(new ie.exports.Popup({closeButton:!1,closeOnClick:!1})),[E,R]=x.exports.useState(),[z,P]=x.exports.useState(),[J,I]=x.exports.useState(),[V,T]=x.exports.useState({source:void 0}),[H,K]=x.exports.useState({selectedColor:"",selectedRadius:0,color:"",radius:0}),[B,Q]=x.exports.useState({});return x.exports.useEffect(()=>{if(!t&&Le.accessToken&&c.current){const w=new ie.exports.Map({container:c.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});w.addControl(new ie.exports.NavigationControl),u(w),w.on("load",()=>{f(!0)}),w.on("draw.selectionchange",({features:L})=>{var m;if(!((m=V.source)==null?void 0:m.select))return;const l=L[0];l&&l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"&&V.source.select(l.properties.index)}),w.on("draw.update",({features:L,action:l})=>{var m;if(!!((m=V.source)==null?void 0:m.update)&&l==="move"&&L.length>0)for(const N of L)N.type==="Feature"&&N.geometry.type==="Point"&&N.properties&&"index"in N.properties&&typeof N.properties.index=="number"&&V.source.update(N.properties.index,pt(N.geometry.coordinates))})}console.log("Updating map...")},[d,V.source,t]),x.exports.useEffect(()=>{if(t&&r&&V.source!==n){console.log("Drawning Points"),V.source=n,T(V);let w=d;(n.selectedColor!==H.selectedColor||n.selectedRadius!==H.selectedRadius||n.color!==H.color||n.radius!==H.radius)&&(K({color:n.color,radius:n.radius,selectedRadius:n.selectedRadius,selectedColor:n.selectedColor}),d&&t.removeControl(d),n?(w=new et({displayControlsDefault:!1,controls:{point:!0},defaultMode:"simple_select"}),t.addControl(w),j(w)):w=void 0),w&&w.set({type:"FeatureCollection",features:n.points.map(L=>({type:"Feature",properties:{description:"",index:L.index,name:""},geometry:{type:"Point",coordinates:[L.longitude,L.latitude]}}))})}},[t,r,V,n,H,d]),x.exports.useEffect(()=>{if(t&&r&&z!==e)if(console.log("Setting arrows in map!"),z){for(const w of z){A[`arrow:${w.name}`]=w.click;const L=t.getSource(`arrow:${w.name}`);L!==void 0&&L.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${w.name}`),t.removeLayer(`layer:arrow:${w.name}:click`)}P(void 0)}else{for(const w of e){A[`arrow:${w.name}`]=w.click;let L=t.getSource(`arrow:${w.name}`);const l=L===void 0;l&&(t.addSource(`arrow:${w.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),L=t.getSource(`arrow:${w.name}`)),L!==void 0&&L.setData({type:"FeatureCollection",features:w.arrows.map((m,N)=>{const h=m.scale*w.scale,y=w.scale*w.arrowHeadScale,C=[m.longitude+m.direction[0]*h,m.latitude+m.direction[1]*h],M=[C[0]+(Math.cos(Z)*-m.direction[0]-Math.sin(Z)*-m.direction[1])*y,C[1]+(Math.sin(Z)*-m.direction[0]+Math.cos(Z)*-m.direction[1])*y],ne=[C[0]+(Math.cos(ae)*-m.direction[0]-Math.sin(ae)*-m.direction[1])*y,C[1]+(Math.sin(ae)*-m.direction[0]+Math.cos(ae)*-m.direction[1])*y];return{type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:N,name:m.name},geometry:{type:"LineString",coordinates:[[m.longitude,m.latitude],C,M,C,ne]}}})}),t.addLayer({id:`layer:arrow:${w.name}`,type:"line",source:`arrow:${w.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":w.color,"line-width":w.width}}),t.addLayer({id:`layer:arrow:${w.name}:click`,type:"line",source:`arrow:${w.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":w.width*10}}),l&&(t.on("mouseenter",`layer:arrow:${w.name}:click`,m=>{if(!m.features)return;const N=m.features[0];if(N.geometry.type==="Point"&&N.properties&&typeof N.properties.description=="string"){const h=[...N.geometry.coordinates],{description:y}=N.properties;for(;Math.abs(m.lngLat.lng-h[0])>180;)h[0]+=m.lngLat.lng>h[0]?360:-360;b.setLngLat(h).setHTML(y).addTo(t)}}),t.on("mouseleave",`layer:arrow:${w.name}:click`,()=>{b.remove()}),t.on("click",`layer:arrow:${w.name}:click`,m=>{const N=A[`arrow:${w.name}`];if(!m.features||!N)return;const h=m.features[0];if(h.properties&&typeof h.properties.index=="number"&&typeof h.properties.name=="string"){const{index:y}=h.properties;N(y)}}))}P(e)}},[t,z,e,r,b]),x.exports.useEffect(()=>{if(t&&r&&J!==o)if(console.log("Setting lines in map!"),J){for(const l of J){A[`line:${l.name}`]=l.click;const m=t.getSource(`line:${l.name}`);m!==void 0&&m.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${l.name}`),t.removeLayer(`layer:line:${l.name}:click`)}I(void 0)}else{for(const l of o){A[`line:${l.name}`]=l.click;let m=t.getSource(`line:${l.name}`);const N=m===void 0;N&&(t.addSource(`line:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),m=t.getSource(`line:${l.name}`)),m!==void 0&&m.setData({type:"FeatureCollection",features:l.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index===i[l.name]},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))}),t.addLayer({id:`layer:line:${l.name}`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":["case",["get","selected"],l.selectedWidth,l.width]}}),t.addLayer({id:`layer:line:${l.name}:click`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":l.width*10}}),N&&(t.on("mouseenter",`layer:line:${l.name}:click`,h=>{if(!h.features)return;const y=h.features[0];if(y.geometry.type==="LineString"&&y.properties&&typeof y.properties.description=="string"){const C=[(y.geometry.coordinates[0][0]+y.geometry.coordinates[1][0])/2,(y.geometry.coordinates[0][1]+y.geometry.coordinates[1][1])/2],{description:M}=y.properties;for(;Math.abs(h.lngLat.lng-C[0])>180;)C[0]+=h.lngLat.lng>C[0]?360:-360;b.setLngLat(C).setHTML(M).addTo(t)}}),t.on("mouseleave",`layer:line:${l.name}:click`,()=>{b.remove()}),t.on("click",`layer:line:${l.name}:click`,h=>{const y=A[`line:${l.name}`];if(!h.features||!y)return;const C=h.features[0];if(C.properties&&typeof C.properties.index=="number"&&typeof C.properties.name=="string"){const{index:M}=C.properties;y(M)}}))}I(o)}const w=g({},B);let L=!1;for(const l of Object.keys(i))if(i[l]!==B[l]){for(const m of o)if(m.name===l){L=!0,w[l]=i[l];const N=t==null?void 0:t.getSource(`line:${m.name}`);if(N){const h=i[l];N.setData({type:"FeatureCollection",features:m.lines.map(y=>({type:"Feature",properties:{description:`<strong>${y.name}</strong><p>${y.description}</p>`,index:y.index,name:y.name,selected:y.index===h},geometry:{type:"LineString",coordinates:[[y.startLongitude,y.startLatitude],[y.endLongitude,y.endLatitude]]}}))})}}}L&&Q(w)},[t,J,o,r,b,i,B]),x.exports.useEffect(()=>{if(!t||!r)return;if(E!==a)if(console.log("Setting points in map!"),E){for(const l of E){A[`point:${l.name}`]=l.click;const m=t.getSource(`point:${l.name}`);m!==void 0&&m.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${l.name}`)}R(void 0)}else{for(const l of a){A[`point:${l.name}`]=l.click;let m=t.getSource(`point:${l.name}`);const N=m===void 0;N&&(t.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),m=t.getSource(`point:${l.name}`)),m!==void 0&&m.setData({type:"FeatureCollection",features:l.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index!==i[l.name]},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))}),t.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":["case",["get","selected"],l.selectedColor,l.color],"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),N&&(t.on("mouseenter",`layer:point:${l.name}`,h=>{if(!h.features)return;const y=h.features[0];if(y.geometry.type==="Point"&&y.properties&&typeof y.properties.description=="string"){const C=[...y.geometry.coordinates],{description:M}=y.properties;for(;Math.abs(h.lngLat.lng-C[0])>180;)C[0]+=h.lngLat.lng>C[0]?360:-360;b.setLngLat(C).setHTML(M).addTo(t)}}),t.on("mouseleave",`layer:point:${l.name}`,()=>{b.remove()}),t.on("click",`layer:point:${l.name}`,h=>{const y=A[`point:${l.name}`];if(!h.features||!y)return;const C=h.features[0];if(C.properties&&typeof C.properties.index=="number"&&typeof C.properties.name=="string"){const{index:M}=C.properties;y(M)}}))}R(a)}const w=g({},B);let L=!1;for(const l of Object.keys(i))if(i[l]!==B[l]){for(const m of a)if(m.name===l){L=!0,w[l]=i[l];const N=t.getSource(`point:${m.name}`);if(N){const h=i[l];N.setData({type:"FeatureCollection",features:m.points.map(y=>({type:"Feature",properties:{description:`<strong>${y.name}</strong><p>${y.description}</p>`,index:y.index,name:y.name,selected:y.index!==h},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}}))})}}}L&&Q(w)},[t,E,a,r,b,i,B]),s("div",{"data-testid":"map",className:"w-full h-full",ref:c})}const gt={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3};var We;const yt=g(g({},gt),JSON.parse((We=window.localStorage.getItem("segmentDisplaySettings"))!=null?We:"{}"));function wt({settings:a,setSettings:e,segments:o,selected:i,setSegmentData:n,addNewSegment:c,splitSegment:t}){const u=d=>{e(d),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(d))},r=o[i],f=r?s(U,{title:r.name,item:r,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:d=>n(i,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}},controls:s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>t(i),children:"Split Segment"})}):s(O,{});return _("div",{className:"flex flex-col gap-2",children:[_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{u($(g({},a),{color:d.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:d=>{u($(g({},a),{width:Number.parseFloat(d.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.activeColor,onChange:d=>{u($(g({},a),{activeColor:d.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.activeWidth,onChange:d=>{u($(g({},a),{activeWidth:Number.parseFloat(d.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Segment"}),s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:c,children:"New Segment"})]}),f]})}function vt({folder:a,openFolder:e,filesOpen:o,saveFiles:i}){function n(){e()}return _("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[s("h3",{className:"text-lg font-bold",children:"Celeri UI"}),_("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[a?_("span",{children:["Working in ",a.name]}):s("button",{type:"button",onClick:n,"data-testid":"open-folder-button",children:"Open Folder"}),o?s("button",{type:"button",onClick:i,"data-testid":"save-file-button",children:"Save Files"}):s(O,{})]})]})}const xt={color:"#ffff00",scale:.02,width:1,arrowHead:1};var He;const _t=JSON.parse((He=window.localStorage.getItem("velocityDisplaySettings"))!=null?He:"false")||xt;function bt({settings:a,setSettings:e,selected:o,velocitys:i,setVelocityData:n,addNewVelocity:c}){const t=f=>{e(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},u=i[o],r=u?s(U,{title:u.name,item:u,deletable:!0,setItem:f=>n(o,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):s(O,{});return _(O,{children:[_("div",{className:"flex flex-col gap-2",children:[_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.color,onChange:f=>{t($(g({},a),{color:f.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Scale"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:a.scale,onChange:f=>{t($(g({},a),{scale:Number.parseFloat(f.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.width,onChange:f=>{t($(g({},a),{width:Number.parseFloat(f.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Arrow Head Size"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:a.arrowHead,onChange:f=>{t($(g({},a),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Velocity"}),s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:c,children:"New Velocity"})]}),r]})}const Nt={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3};var ze;const St=g(g({},Nt),JSON.parse((ze=window.localStorage.getItem("vertexDisplaySettings"))!=null?ze:"{}"));function kt({settings:a,setSettings:e,vertices:o,selected:i,setVertexData:n,addNewVertex:c,splitVertex:t}){const u=d=>{e(d),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(d))},r=o[i],f=r?s(U,{title:"Selected Vertex",item:r,ignoreFields:[],deletable:!1,setItem:d=>n(i,d),fieldDefinitions:{},controls:s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>t(i),children:"Split Vertex"})}):s(O,{});return _("div",{className:"flex flex-col gap-2",children:[_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.color,onChange:d=>{u($(g({},a),{color:d.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.radius,onChange:d=>{u($(g({},a),{radius:Number.parseFloat(d.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:a.activeColor,onChange:d=>{u($(g({},a),{activeColor:d.target.value}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:a.activeRadius,onChange:d=>{u($(g({},a),{activeRadius:Number.parseFloat(d.target.value)}))}})})]}),_("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Vertex"}),s("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:c,children:"New Vertex"})]}),f]})}const Me=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ct={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Ee(a){return g(g({},Ct),a)}class ue{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),i=re(e).map(n=>{const c={};for(const t of Me)c[t]=n[t]||(t==="name"?"":0);return c});this.data=i}async save(){var o;const e=le((o=this.data)!=null?o:[],Me);await this.handle.setContents(e)}clone(){return new ue(this.handle)}}const $t={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Lt(a){return g(g({},$t),a)}class fe{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=JSON.parse(e);this.data=Lt(o)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new fe(this.handle)}}const Ie=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Ft={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Oe(a){return g(g({},Ft),a)}class pe{constructor(e){D(this,"handle");D(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),i=re(e).map(n=>{const c={};for(const t of Ie)c[t]=n[t]||(t==="name"?"":0);return c});this.data=i}async save(){var o;const e=le((o=this.data)!=null?o:[],Ie);await this.handle.setContents(e)}clone(){return new pe(this.handle)}}async function Re(a){const e=new de(a);return await e.initialize(),e}async function Ae(a){const e=new ue(a);return await e.initialize(),e}async function Pe(a){const e=new pe(a);return await e.initialize(),e}async function Dt(a,e,o){const i=new fe(e);if(await i.initialize(),i.data){const n=await Re(await a.getFile(i.data.segment_file_name)),c=await Ae(await a.getFile(i.data.block_file_name)),t=await Pe(await a.getFile(i.data.station_file_name)),u=g({},o);return"command"in u&&(u.command=$(g({},u.command),{currentFilePath:e.name})),"segment"in u&&(u.segment=$(g({},u.segment),{currentFilePath:i.data.segment_file_name})),"block"in u&&(u.block=$(g({},u.block),{currentFilePath:i.data.block_file_name})),"velocities"in u&&(u.velocities=$(g({},u.velocities),{currentFilePath:i.data.station_file_name})),{openableFiles:u,commands:i,segments:n,blocks:c,velocities:t}}throw new Error("Can't open command file")}class jt{constructor(e){D(this,"name");D(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const o=await this.handle.createWritable();await o.write(e),await o.close()}}class me{constructor(e){D(this,"name");D(this,"handle");D(this,"fileList");D(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const o=await this.handle.getFileHandle(e);return new jt(o)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const o=await this.handle.getDirectoryHandle(e),i=new me(o);return await i.initialize(),i}}const Vt=async()=>{const a=await window.showDirectoryPicker(),e=new me(a);return await e.initialize(),e};class Mt{constructor(e,o){D(this,"name");D(this,"parent");this.name=e,this.parent=o}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class he{constructor(e,o){D(this,"name");D(this,"parent");D(this,"fileList");D(this,"folderList");this.name=e,this.parent=o,this.fileList=[],this.folderList=[];const i=o[e];for(const n of Object.keys(i))typeof i[n]=="string"?this.fileList.push(n):this.folderList.push(n)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Mt(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new he(e,this.parent[this.name])}}const Et=async a=>new he("root",a);let Te=async()=>{var e;return Et((e=window.FakeDirectory)!=null?e:{})};function It(a){Te=a}async function Ot(){return Te()}window.location.search.includes("fake-dir")||It(Vt);const Rt={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function At(){var ge,ye,we,ve,xe,_e,be;const[a,e]=x.exports.useState(),[o,i]=x.exports.useState(""),[n,c]=x.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[t,u]=x.exports.useState(),[r,f]=x.exports.useState(),[d,j]=x.exports.useState(),[b,E]=x.exports.useState(),[R,z]=x.exports.useState(_t),[P,J]=x.exports.useState(lt),[I,V]=x.exports.useState(yt),[T,H]=x.exports.useState(St),[K,B]=x.exports.useState(-1),[Q,w]=x.exports.useState(-1),[L,l]=x.exports.useState(-1),[m,N]=x.exports.useState(-1),h=(p,v)=>{B(p==="block"?v:-1),w(p==="segment"?v:-1),l(p==="velocities"?v:-1),N(p==="vertex"?v:-1),i(p)},[y,C]=x.exports.useState([]),[M,ne]=x.exports.useState([]),[Je,Ge]=x.exports.useState([]),[Xe,qe]=x.exports.useState({color:"",selectedColor:"",radius:0,selectedRadius:0,points:[]});x.exports.useEffect(()=>{C([{name:"blocks",color:P.color,selectedColor:P.selectedColor,radius:P.radius,points:(d==null?void 0:d.data)?d.data.map((p,v)=>({longitude:p.interior_lon,latitude:p.interior_lat,name:p.name,description:"",index:v})):[],click:p=>{h("block",p)}}])},[P,d,I,r]),x.exports.useEffect(()=>{var p;Ge([{name:"segments",color:I.color,selectedColor:I.activeColor,width:I.width,selectedWidth:I.activeWidth,lines:((p=r==null?void 0:r.data)==null?void 0:p.segments)?r.data.segments.map((v,S)=>{var Ne,Se,ke,Ce;const k=(Se=(Ne=r.data)==null?void 0:Ne.vertecies[v.start])!=null?Se:De,F=(Ce=(ke=r.data)==null?void 0:ke.vertecies[v.end])!=null?Ce:De,[[Y,ee],[te,X]]=mt(k,F);return{startLongitude:Y,startLatitude:ee,endLongitude:te,endLatitude:X,name:v.name,description:`${k.lon},${k.lat} to ${F.lon},${F.lat}`,index:S}}):[],click:v=>{h("segment",v)}}])},[r,I]),x.exports.useEffect(()=>{var p;qe({color:T.color,radius:T.radius,selectedColor:T.activeColor,selectedRadius:T.activeRadius,points:((p=r==null?void 0:r.data)==null?void 0:p.vertecies)?Object.keys(r.data.vertecies).map(v=>{var F;const S=Number.parseInt(v,10),k=(F=r.data)==null?void 0:F.vertecies[S];return k?{longitude:k.lon,latitude:k.lat,index:S}:!1}).filter(v=>!!v):[],update:(v,S)=>{if(r){const k=r.moveVertex(v,S);f(k)}},select:v=>{h("vertex",v)}})},[T,r]),x.exports.useEffect(()=>{ne([{name:"velocity",color:R.color,scale:R.scale,arrowHeadScale:R.arrowHead,width:R.width,arrows:(b==null?void 0:b.data)?b.data.map(p=>{const v=Math.sqrt(p.east_vel*p.east_vel+p.north_vel*p.north_vel);return{longitude:p.lon,latitude:p.lat,direction:[p.east_vel/v,p.north_vel/v],scale:v,name:p.name,description:`north: ${p.north_vel}, east: ${p.east_vel}`}}):[],click:p=>{h("velocities",p)}}])},[R,b]);let G=s("span",{});switch(o){case"files":G=a?s(dt,{folder:a,files:n,setFile:async(p,v,S)=>{if(S){let k=g({},n);switch(k[p]=$(g({},k[p]),{currentFilePath:v}),p){case"segment":f(await Re(S));break;case"block":j(await Ae(S));break;case"velocity":E(await Pe(S));break;case"command":const F=await Dt(a,S,n);u(F.commands),f(F.segments),j(F.blocks),E(F.velocities),k=F.openableFiles;break}c(k)}}}):s("span",{});break;case"velocities":G=s(bt,{settings:R,setSettings:z,selected:L,velocitys:(ge=b==null?void 0:b.data)!=null?ge:[],setVelocityData:(p,v)=>{if(b!==void 0)if(v){const S=b.data&&b.data[p]?g(g({},b.data[p]),v):Oe(v),k=b.data?[...b.data]:[];k[p]=S;const F=b.clone();F.data=k,E(F)}else{const S=b.data?[...b.data]:[];S.splice(p,1);const k=b.clone();k.data=S,E(k)}},addNewVelocity:()=>{if(b!==void 0){const p=b.data?[...b.data]:[],v=Oe({});p.push(v);const S=b.clone();S.data=p,E(S)}}});break;case"block":G=s(ct,{settings:P,setSettings:J,selected:K,blocks:(ye=d==null?void 0:d.data)!=null?ye:[],addNewBlock:()=>{if(d!==void 0){const p=d.data?[...d.data]:[],v=Ee({});p.push(v);const S=d.clone();S.data=p,j(S)}},setBlockData:(p,v)=>{if(d!==void 0)if(v){const S=d.data&&d.data[p]?g(g({},d.data[p]),v):Ee(v),k=d.data?[...d.data]:[];k[p]=S;const F=d.clone();F.data=k,j(F)}else{const S=d.data?[...d.data]:[];S.splice(p,1);const k=d.clone();k.data=S,j(k)}}});break;case"segment":G=s(wt,{settings:I,setSettings:V,segments:(ve=(we=r==null?void 0:r.data)==null?void 0:we.segments)!=null?ve:[],selected:Q,addNewSegment:()=>{r!==void 0&&console.log("NOT IMPLEMENTED")},setSegmentData:(p,v)=>{var S,k,F,Y;if(r!==void 0&&v){const ee=r.data&&r.data.segments[p]?g(g({},r.data.segments[p]),v):void 0,te=r.data?[...r.data.segments]:[];if(ee){te[p]=ee;const X=r.clone();X.data={vertecies:(k=(S=X.data)==null?void 0:S.vertecies)!=null?k:[],vertexDictionary:(Y=(F=X.data)==null?void 0:F.vertexDictionary)!=null?Y:{},segments:te},f(X)}}},splitSegment:p=>{if(r){const v=r.splitSegment(p);f(v)}}});break;case"vertex":G=s(kt,{settings:T,setSettings:H,vertices:(_e=(xe=r==null?void 0:r.data)==null?void 0:xe.vertecies)!=null?_e:{},selected:m,setVertexData:function(p,v){throw new Error("Function not implemented.")},addNewVertex:function(){throw new Error("Function not implemented.")},splitVertex:function(p){throw new Error("Function not implemented.")}});break}return _("div",{className:"w-screen h-screen flex flex-col",children:[s(vt,{filesOpen:((be=t!=null?t:r)!=null?be:d)!==void 0,saveFiles:async()=>{t&&await t.save(),r&&await r.save(),d&&await d.save()},folder:a,openFolder:async()=>{const p=await Ot();e(p),i("files")}}),s(ht,{pointSources:y,arrowSources:M,lineSources:Je,drawnPointSource:Xe,selections:{segments:Q,blocks:K,velocities:L}}),s(ut,{view:G,buttons:a?Rt:void 0,active:o,setActive:p=>i(p)})]})}function Pt(a={}){const{immediate:e=!1,onNeedRefresh:o,onOfflineReady:i,onRegistered:n,onRegisterError:c}=a;let t;const u=async(r=!0)=>{};return"serviceWorker"in navigator&&(t=new tt("./sw.js",{scope:"./"}),t.addEventListener("activated",r=>{r.isUpdate?window.location.reload():i==null||i()}),t.register({immediate:e}).then(r=>{n==null||n(r)}).catch(r=>{c==null||c(r)})),u}Pt();const Tt=1,Bt=new at({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Tt}}});nt.render(s(x.exports.StrictMode,{children:s(st,{client:Bt,children:s(At,{})})}),document.querySelector("#root"));
