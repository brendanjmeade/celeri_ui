var en=Object.defineProperty,tn=Object.defineProperties;var nn=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var an=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable;var xe=(n,e,t)=>e in n?en(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))an.call(e,t)&&xe(n,t,e[t]);if(at)for(var t of at(e))sn.call(e,t)&&xe(n,t,e[t]);return n},x=(n,e)=>tn(n,nn(e));var k=(n,e,t)=>(xe(n,typeof e!="symbol"?e+"":e,t),t);import{j as o,a as N,F as E,r as S,M as on,m as st,R as ln,b as we,u as rn,c as cn,l as ot,d as re,e as $,f as it,g as lt,h as dn,i as un,k as fn,v as mn,Q as pn,n as hn,o as gn,P as yn}from"./vendor.51d006dc.js";const bn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};bn();function vn({value:n,fieldDefinition:e,setField:t}){const[a,s]=S.exports.useState(-1),[i,r]=S.exports.useState(n);S.exports.useEffect(()=>{r(n)},[n]);let l=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof n=="number"?"number":"text",value:i,onChange:d=>{const c=typeof n=="number"?Number.parseFloat(d.target.value):d.target.value;r(c),a>-1&&clearTimeout(a),s(setTimeout(()=>t(c),1e3))}});return e.type==="select"&&(l=N("select",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",value:i,onChange:d=>{t(d.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(d=>o("option",{value:d.name,"data-testid":`input-editor-${e.name}-${d.name}`,children:d.name},d.name))]})),N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(E,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function se({title:n,items:e,setItems:t,fieldDefinitions:a,ignoreFields:s,deletable:i,controls:r}){const l=e[0],d=Object.keys(l).map((c,y)=>{if(s==null?void 0:s.includes(c))return{element:o("span",{style:{display:"hidden"}},c),order:y+1e4};let m=l[c];for(const v of e)if(v[c]!==m){m="-";break}const u=c in a&&a[c];return u?{element:o(vn,{value:m,fieldDefinition:u,setField:v=>t({[c]:v})},c),order:u.order}:{element:N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${c}`,className:"text-l font-bold",children:c}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${c}`,className:"bg-gray-800 w-full",type:typeof m=="number"?"number":"text",value:m,onChange:v=>{t({[c]:typeof m=="number"?Number.parseFloat(v.target.value):v.target.value})}})})]},c),order:y+1e3}}).sort((c,y)=>c.order-y.order).map(c=>c.element);return N("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),N("span",{className:"flex flex-row justify-end gap-2 grow",children:[r,i?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):o(E,{})]})]}),d]})}se.defaultProps={ignoreFields:[],controls:o(E,{})};const xn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var Bt;const wn=JSON.parse((Bt=window.localStorage.getItem("blockDisplaySettings"))!=null?Bt:"false")||xn;function Nn({settings:n,setSettings:e,selected:t,blocks:a,setBlockData:s,addNewBlock:i,save:r,fileName:l,changeFileName:d}){const c=u=>{e(u),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(u))},y=t.map(u=>a[u]).filter(u=>u),m=y.length>0?o(se,{title:y.length===1?y[0].name:"Edit Selected Blocks",items:y,deletable:!0,setItems:u=>s(t,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(E,{});return N(E,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{c(x(p({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("input",{type:"text",className:"bg-gray-800 flex-grow",value:l,onChange:u=>{d(u.target.value)}}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:r,children:"Save Blocks"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:u=>{c(x(p({},n),{color:u.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:u=>{c(x(p({},n),{selectedColor:u.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:u=>{c(x(p({},n),{radius:Number.parseFloat(u.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Block"})]}),m]})}function _n({folder:n,files:e,setFile:t}){const a=Object.keys(e).map(s=>{const i=e[s],r=Array.isArray(i.currentFilePath)?[...i.currentFilePath]:[i.currentFilePath];return i.allowMultiple&&r.push(""),N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:i.name}),o("span",{className:"text-sm","data-testid":`file-${s}-description`,children:i.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:r.map((l,d)=>N("select",{"data-testid":`file-${s}-select-${d}`,className:"bg-gray-800 w-full m-1",value:l,onChange:async c=>{const y=c.currentTarget.value;try{const m=await n.getFile(y);t(d,s,m.name,m)}catch{t(d,s,"")}},children:[o("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),n.fileList.filter(c=>c.endsWith(i.extension)).map(c=>o("option",{value:c,"data-testid":`file-${s}-select-${c}`,children:c},c))]},d))})]},s)});return o("div",{className:"flex flex-col gap-2",children:a})}const Sn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Et;const kn=p(p({},Sn),JSON.parse((Et=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Et:"{}"));function Cn({settings:n,setSettings:e,collections:t,setCollectionVertexKeys:a}){const s=r=>{e(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))},i=Object.keys(t).map(r=>{const{startLat:l,startLon:d,endLat:c,endLon:y,segments:m,plot:u}=t[r],v=Object.keys(m[0]).map((g,h)=>({name:g,value:h}));return o(se,{title:r,items:[{startLat:l,startLon:d,endLat:c,endLon:y,plot:u}],deletable:!1,setItems:g=>{a(p({collection:r,startLat:l,startLon:d,endLat:c,endLon:y,plot:u},g))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:v},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:v},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:v},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:v},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:v}}},r)});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{s(x(p({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:r=>{s(x(p({},n),{color:r.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:r=>{s(x(p({},n),{width:Number.parseFloat(r.target.value)}))}})})]}),i]})}function Ln({view:n,buttons:e,active:t,setActive:a}){if(!e)return o("span",{});const s=[];for(const i of Object.keys(e)){const r=e[i],l=i===t;s.push(o("button",{type:"button","data-testid":`tab-${i}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(l?"":i),children:r},i))}return N("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:n}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:s})]})}const rt={lon:0,lat:0},$n=180,oe=360;function ct(n){let{lon:e,lat:t}=n;for(;e<0;)e+=oe;for(;e>oe;)e-=oe;return[e,t]}function Ne([n,e]){return{lon:n<0?n+oe:n,lat:e}}function _e(n,e){const t=ct(n),a=ct(e),s=[a[0],a[1]];return a[0]-t[0]>=$n?s[0]-=oe:s[0]+=oe,Math.abs(t[0]-a[0])>Math.abs(t[0]-s[0])?[t,s]:[t,a]}const O=1e6;function q(n,e,t,a){const s=`${Math.floor(n.lon*O)},${Math.floor(n.lat*O)}`;if(s in e)return[e[s],a];const i=a;return t[i]=n,e[s]=i,[i,a+1]}function dt(n,e){let t=!1;for(const a of n.segments)if(a.start===e||a.end===e){t=!0;break}if(!t&&n.vertecies[e]){const a=n.vertecies[e],s=`${Math.floor(a.lon*O)},${Math.floor(a.lat*O)}`,i=p({},n.vertecies);delete i[e];const r=p({},n.vertexDictionary);return delete r[s],x(p({},n),{vertecies:i,vertexDictionary:r})}return n}const X=Math.PI/6,ee=2*Math.PI-X;function Dn(n,e,{map:t,popup:a,internalArrowSources:s,mapLoaded:i,internalSelections:r},{arrowSources:l,selections:d}){if(t&&i&&s!==l)if(console.log("Setting arrows in map!"),s){for(const m of s){const u=t.getSource(`arrow:${m.name}`);u!==void 0&&u.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${m.name}`),t.removeLayer(`layer:arrow:${m.name}:click`)}e({internalArrowSources:void 0})}else{for(const m of l){let u=t.getSource(`arrow:${m.name}`);const v=u===void 0;v&&(t.addSource(`arrow:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),u=t.getSource(`arrow:${m.name}`)),u!==void 0&&u.setData({type:"FeatureCollection",features:m.arrows.map(g=>{var L;const h=g.scale*m.scale,w=m.scale*m.arrowHeadScale,_=[g.longitude+g.direction[0]*h,g.latitude+g.direction[1]*h],M=[_[0]+(Math.cos(X)*-g.direction[0]-Math.sin(X)*-g.direction[1])*w,_[1]+(Math.sin(X)*-g.direction[0]+Math.cos(X)*-g.direction[1])*w],Z=[_[0]+(Math.cos(ee)*-g.direction[0]-Math.sin(ee)*-g.direction[1])*w,_[1]+(Math.sin(ee)*-g.direction[0]+Math.cos(ee)*-g.direction[1])*w];return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:(L=d[m.name])==null?void 0:L.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],_,M,_,Z]}}})}),t.addLayer({id:`layer:arrow:${m.name}`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],m.selectedColor,m.color],"line-width":m.width}}),t.addLayer({id:`layer:arrow:${m.name}:click`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),v&&(t.on("mouseenter",`layer:arrow:${m.name}:click`,g=>{if(!g.features)return;const h=g.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(g.lngLat.lng-w[0])>180;)w[0]+=g.lngLat.lng>w[0]?360:-360;a.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:arrow:${m.name}:click`,()=>{a.remove()}),t.on("click",`layer:arrow:${m.name}:click`,g=>{let h;if(n.state.internalArrowSources)for(const _ of n.state.internalArrowSources)h=_.click;if(!g.features||!h)return;const w=g.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;h(_)}}))}e({internalArrowSources:l})}const c=p({},r);let y=!1;for(const m of Object.keys(d))if(d[m]!==r[m]){for(const u of l)if(u.name===m){y=!0,c[m]=d[m];const v=t==null?void 0:t.getSource(`arrow:${u.name}`);if(v){const g=d[m];v.setData({type:"FeatureCollection",features:u.arrows.map(h=>{const w=h.scale*u.scale,_=u.scale*u.arrowHeadScale,M=[h.longitude+h.direction[0]*w,h.latitude+h.direction[1]*w],Z=[M[0]+(Math.cos(X)*-h.direction[0]-Math.sin(X)*-h.direction[1])*_,M[1]+(Math.sin(X)*-h.direction[0]+Math.cos(X)*-h.direction[1])*_],L=[M[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*_,M[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:g==null?void 0:g.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],M,Z,M,L]}}})})}}}y&&e({internalSelections:c})}function Fn(n,{map:e,draw:t,drawnPointSettings:a,mapLoaded:s,internalDrawnPointSource:i},{drawnPointSource:r}){if(e&&s&&i!==r){console.log("Drawning Points"),n({internalDrawnPointSource:r});let l=t;if((r.selectedColor!==a.selectedColor||r.selectedRadius!==a.selectedRadius||r.color!==a.color||r.radius!==a.radius)&&(n({drawnPointSettings:{color:r.color,radius:r.radius,selectedRadius:r.selectedRadius,selectedColor:r.selectedColor}}),t&&(e.removeControl(t),l=void 0),r?(l=new on({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":r.selectedRadius,"circle-color":r.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":r.radius,"circle-color":r.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(l),n({draw:l})):l=void 0),l){const d=l.getAll(),c=r.points.length!==d.features.length?void 0:l.getSelected(),y={type:"FeatureCollection",features:r.points.map(m=>({type:"Feature",id:m.index.toString(),properties:{description:"",index:m.index,name:""},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}}))};if(l.set(y),c&&c.features.length>0&&c.features[0].properties&&typeof c.features[0].properties.index=="number"){const m=c.features[0].id;m&&l.changeMode("simple_select",{featureIds:[m]})}}}}const z="grid";function jn(n,e,{map:t,internalGridDisplay:a,popup:s,mapLoaded:i},{displayGrid:r}){if(t&&i&&a!==r){if(console.log("Drawing Grid on map!"),a&&a>0){const l=t.getSource(z);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),t.removeLayer(z),e({internalGridDisplay:void 0})}else if(r&&r>0){let l=t.getSource(z);const d=l===void 0;if(d&&(t.addSource(z,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=t.getSource(z)),l!==void 0){const c=[];for(let y=-170;y<=180;y+=r)c.push({type:"Feature",properties:{label:`Lon: ${y<0?y+360:y}`},geometry:{type:"LineString",coordinates:[[y,-90],[y,90]]}});for(let y=-90;y<=90;y+=r)c.push({type:"Feature",properties:{label:`Lat: ${y}`},geometry:{type:"LineString",coordinates:[[180,y],[-180,y]]}});l.setData({type:"FeatureCollection",features:c})}t.addLayer({id:z,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${z}:click`,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),d&&(t.on("mouseenter",`${z}:click`,c=>{if(!c.features)return;const y=c.features[0];y.geometry.type==="LineString"&&y.properties&&typeof y.properties.label=="string"&&s.setLngLat(c.lngLat).setHTML(`${y.properties.label}`).addTo(t)}),t.on("mouseleave",`${z}:click`,()=>{s.remove()}))}e({internalGridDisplay:r})}}function Vn(n,e,{map:t,popup:a,internalLineSources:s,mapLoaded:i,internalSelections:r},{lineSources:l,selections:d}){var m;if(t&&i&&s!==l)if(console.log("Setting lines in map!"),s){for(const u of s){const v=t.getSource(`line:${u.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${u.name}`);try{t.getLayer(`layer:line:${u.name}:click`)&&t.removeLayer(`layer:line:${u.name}:click`)}catch{console.log("no click layer")}try{t.getLayer(`layer:line:${u.name}:labels`)&&t.removeLayer(`layer:line:${u.name}:labels`)}catch{console.log("no label layer")}}e({internalLineSources:void 0})}else{for(const u of l){let v=t.getSource(`line:${u.name}`);const g=v===void 0;if(g&&(t.addSource(`line:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addSource(`line:${u.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=t.getSource(`line:${u.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:u.lines.map(h=>{var w,_;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,label:(w=h.label)!=null?w:"",selected:((_=d[u.name])==null?void 0:_.includes(h.index))||!1},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),t.addLayer({id:`layer:line:${u.name}`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],u.selectedColor,u.color],"line-width":["case",["get","selected"],u.selectedWidth,u.width]}}),(m=u.lines[0])==null?void 0:m.label){const h=t.getSource(`line:${u.name}:points`);h&&(h.setData({type:"FeatureCollection",features:u.lines.map(w=>({type:"Feature",properties:{label:w.label},geometry:{type:"Point",coordinates:[(w.startLongitude+w.endLongitude)/2,(w.startLatitude+w.endLatitude)/2]}}))}),t.addLayer({id:`layer:line:${u.name}:labels`,type:"symbol",source:`line:${u.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}u.click&&(t.addLayer({id:`layer:line:${u.name}:click`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":u.width*10}}),g&&(t.on("mouseenter",`layer:line:${u.name}:click`,h=>{if(!h.features)return;const w=h.features[0];if(w.geometry.type==="LineString"&&w.properties&&typeof w.properties.description=="string"&&w.properties.description){const _=[(w.geometry.coordinates[0][0]+w.geometry.coordinates[1][0])/2,(w.geometry.coordinates[0][1]+w.geometry.coordinates[1][1])/2],{description:M}=w.properties;for(;Math.abs(h.lngLat.lng-_[0])>180;)_[0]+=h.lngLat.lng>_[0]?360:-360;a.setLngLat(_).setHTML(M).addTo(t)}}),t.on("mouseleave",`layer:line:${u.name}:click`,()=>{a.remove()}),t.on("click",`layer:line:${u.name}:click`,h=>{let w;if(n.state.internalLineSources)for(const M of n.state.internalLineSources)M.name===u.name&&(w=M.click);if(!h.features||!w)return;const _=h.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:M}=_.properties;w(M)}})))}e({internalLineSources:l})}const c=p({},r);let y=!1;for(const u of Object.keys(d))if(d[u]!==r[u]){for(const v of l)if(v.name===u){y=!0,c[u]=d[u];const g=t==null?void 0:t.getSource(`line:${v.name}`);if(g){const h=d[u];g.setData({type:"FeatureCollection",features:v.lines.map(w=>({type:"Feature",properties:{description:`<strong>${w.name}</strong><p>${w.description}</p>`,index:w.index,name:w.name,selected:h==null?void 0:h.includes(w.index)},geometry:{type:"LineString",coordinates:[[w.startLongitude,w.startLatitude],[w.endLongitude,w.endLatitude]]}}))})}}}y&&e({internalSelections:c})}function Mn(n,e,{map:t,popup:a,internalPointSources:s,mapLoaded:i,internalSelections:r},{pointSources:l,selections:d}){if(!t||!i)return;if(s!==l)if(console.log("Setting points in map!"),s){for(const m of s){const u=t.getSource(`point:${m.name}`);u!==void 0&&u.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${m.name}`)}e({internalPointSources:void 0})}else{for(const m of l){let u=t.getSource(`point:${m.name}`);const v=u===void 0;v&&(t.addSource(`point:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),u=t.getSource(`point:${m.name}`)),u!==void 0&&u.setData({type:"FeatureCollection",features:m.points.map(g=>{var h;return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:!((h=d[m.name])==null?void 0:h.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}})}),t.addLayer({id:`layer:point:${m.name}`,type:"circle",source:`point:${m.name}`,paint:{"circle-color":["case",["get","selected"],m.color,m.selectedColor],"circle-radius":m.radius}}),v&&(t.on("mouseenter",`layer:point:${m.name}`,g=>{if(!g.features)return;const h=g.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(g.lngLat.lng-w[0])>180;)w[0]+=g.lngLat.lng>w[0]?360:-360;a.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:point:${m.name}`,()=>{a.remove()}),t.on("click",`layer:point:${m.name}`,g=>{let h;if(n.state.internalPointSources)for(const _ of n.state.internalPointSources)h=_.click;if(!g.features||!h)return;const w=g.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;h(_)}}))}e({internalPointSources:l})}const c=p({},r);let y=!1;for(const m of Object.keys(d))if(d[m]!==r[m]){for(const u of l)if(u.name===m){y=!0,c[m]=d[m];const v=t.getSource(`point:${u.name}`);if(v){const g=d[m];v.setData({type:"FeatureCollection",features:u.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(g==null?void 0:g.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}y&&e({internalSelections:c})}function In(n,e,{map:t,internalPolygonSources:a,mapLoaded:s},{polygonSources:i,selections:r}){if(t&&s&&a!==i)if(a){for(const l of a){const d=t.getSource(`poly:${l.name}`);d!==void 0&&d.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:poly:${l.name}`),t.removeLayer(`layer:poly:${l.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const l of i){let d=t.getSource(`poly:${l.name}`);d===void 0&&(t.addSource(`poly:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),d=t.getSource(`poly:${l.name}`)),d!==void 0&&d.setData({type:"FeatureCollection",features:l.polygons.map(y=>{var m;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:((m=r[l.name])==null?void 0:m.includes(y.index))||!1},geometry:{type:"Polygon",coordinates:[y.polygon.map(u=>[u.lon,u.lat])]}}})}),t.addLayer({id:`layer:poly:${l.name}:fill`,type:"fill",source:`poly:${l.name}`,layout:{},paint:{"fill-color":l.color,"fill-opacity":.5}}),t.addLayer({id:`layer:poly:${l.name}`,type:"line",source:`poly:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.borderColor,"line-width":l.borderRadius}})}e({internalPolygonSources:i})}}st.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Pn extends ln.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new we.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(st.accessToken&&t){const a=new we.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});a.addControl(new we.exports.NavigationControl),this.setState({map:a}),a.on("load",()=>{this.setState({mapLoaded:!0})}),a.on("click",({lngLat:s})=>{const{click:i}=this.props;i(Ne([s.lng,s.lat]))}),a.on("mousemove",({lngLat:s})=>{const{mouseMove:i}=this.props;i&&i(Ne([s.lng,s.lat]))}),a.on("draw.selectionchange",({features:s})=>{const{internalDrawnPointSource:i}=this.state;if(!i||!(i==null?void 0:i.select))return;const r=s.map(l=>l&&l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"?l.properties.index:-1).filter(l=>l>-1);i.select(r)}),a.on("draw.update",({features:s,action:i})=>{const{internalDrawnPointSource:r}=this.state;if(!!(r==null?void 0:r.update)&&i==="move"&&s.length>0)for(const l of s)l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"&&r.update(l.properties.index,Ne(l.geometry.coordinates))})}}componentDidUpdate(){return jn(this,e=>this.setState(e),this.state,this.props),In(this,e=>this.setState(e),this.state,this.props),Vn(this,e=>this.setState(e),this.state,this.props),Dn(this,e=>this.setState(e),this.state,this.props),Mn(this,e=>this.setState(e),this.state,this.props),Fn(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const On={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var At;const Rn=p(p({},On),JSON.parse((At=window.localStorage.getItem("meshDisplaySettings"))!=null?At:"{}"));function Bn({settings:n,setSettings:e}){const t=a=>{e(a),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(a))};return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(x(p({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:a=>{t(x(p({},n),{color:a.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:a=>{t(x(p({},n),{width:Number.parseFloat(a.target.value)}))}})})]})]})}const Se=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ie={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},En={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Tt;const An=p(p({},En),JSON.parse((Tt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Tt:"{}")),Tn=["",...Se];function Wn({settings:n,setSettings:e,segments:t,selected:a,setSegmentData:s,addNewSegment:i,splitSegment:r,setSelectionMode:l,save:d,fileName:c,changeFileName:y}){const m=g=>{e(g),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(g))},u=a.map(g=>t[g]).filter(g=>g),v=u.length>0?o(se,{title:u.length===1?u[0].name:"Edit Selected Segments",items:u,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:g=>s(a,g),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>r(a),children:"Split Segment"})}):o(E,{});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{m(x(p({},n),{hide:!n.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hideProjection,onChange:()=>{m(x(p({},n),{hideProjection:!n.hideProjection}))}})})]}),N("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("input",{type:"text",className:"bg-gray-800 flex-grow",value:c,onChange:g=>{y(g.target.value)}}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:d,children:"Save Segments & Vertices"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:g=>{m(x(p({},n),{color:g.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:g=>{m(x(p({},n),{width:Number.parseFloat(g.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:g=>{m(x(p({},n),{activeColor:g.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:g=>{m(x(p({},n),{activeWidth:Number.parseFloat(g.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.projectionColor,onChange:g=>{m(x(p({},n),{projectionColor:g.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:n.plottableKey,onChange:g=>{m(x(p({},n),{plottableKey:g.currentTarget.value}))},children:Tn.map(g=>o("option",{value:g,children:g},g))})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:g=>{l({mode:"mapClick",label:"Select Segment End point",callback:h=>{i(g,h),l("normal")}})}})},children:"New Segment"})]}),v]})}const ut=()=>rn(),le=cn;function Gn({folder:n,openFolder:e,filesOpen:t,saveFiles:a}){function s(){e()}const i=ut(),[r,l]=le(d=>[d.main.past.length>0,d.main.future.length>0]);return N("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),N("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?o("button",{type:"button",onClick:()=>{i(ot.ActionCreators.undo())},"data-testid":"undo-button",disabled:!r,children:"Undo"}):o(E,{}),n?o("button",{type:"button",onClick:()=>{i(ot.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):o(E,{}),n?N("span",{children:["Working in ",n.name]}):o("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),t?o("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Files"}):o(E,{})]})]})}const zn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var Wt;const Hn=JSON.parse((Wt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Wt:"false")||zn;function Jn({settings:n,setSettings:e,selected:t,velocitys:a,setVelocityData:s,addNewVelocity:i,save:r,fileName:l,changeFileName:d}){const c=u=>{e(u),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(u))},y=t.map(u=>a[u]).filter(u=>u),m=y.length>0?o(se,{title:y.length===1?y[0].name:"Edit Selected Velocities",items:y,deletable:!0,setItems:u=>s(t,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(E,{});return N(E,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{c(x(p({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("input",{type:"text",className:"bg-gray-800 flex-grow",value:l,onChange:u=>{d(u.target.value)}}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:r,children:"Save Velocities"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:u=>{c(x(p({},n),{color:u.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:u=>{c(x(p({},n),{selectedColor:u.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:u=>{c(x(p({},n),{scale:Number.parseFloat(u.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:u=>{c(x(p({},n),{width:Number.parseFloat(u.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:u=>{c(x(p({},n),{arrowHead:Number.parseFloat(u.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Velocity"})]}),m]})}const Kn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Gt;const Un=p(p({},Kn),JSON.parse((Gt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Gt:"{}"));function qn({settings:n,setSettings:e,vertices:t,selected:a,setVertexData:s,setSelectionMode:i,mergeVertices:r,bridgeVertices:l,extrudeVertex:d,save:c}){const y=v=>{e(v),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(v))},u=a.map(v=>({selectedVertex:t[v],index:v})).filter(v=>v.selectedVertex).map(({selectedVertex:v,index:g})=>o(se,{title:"Selected Vertex",items:[v],ignoreFields:[],deletable:!1,setItems:h=>s(g,p(p({},v),h)),fieldDefinitions:{},controls:N(E,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{r(g,h[0]),i("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{l(g,h[0]),i("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{d(g,h),i("normal")}})},children:"Extrude"})]})},g));return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{y(x(p({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:c,children:"Save Segments & Vertices"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:v=>{y(x(p({},n),{color:v.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:v=>{y(x(p({},n),{radius:Number.parseFloat(v.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:v=>{y(x(p({},n),{activeColor:v.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:v=>{y(x(p({},n),{activeRadius:Number.parseFloat(v.target.value)}))}})})]}),u]})}const ft=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],mt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Qn(n){return n?p(p({},mt),n):p({},mt)}function Xn(n,{data:e}){return[...n,Qn(e)]}function Zn(n,e){const t=[];for(const[a,s]of n.entries())e.includes(a)||t.push(s);return t}function Yn(n,e){const t=[...n];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return t}function ea(n,e){return e}function ta(n,{index:e,position:t}){const a=[...n],s=p({},a[e]);return s.interior_lat=t.lat,s.interior_lon=t.lon,a[e]=s,a}const na=[],pt=$("createBlock"),ht=$("editBlock"),gt=$("deleteBlock"),ke=$("loadNewBlockData"),yt=$("moveBlock"),aa=re(na,n=>{n.addCase(pt,(e,t)=>Xn(e,t.payload)).addCase(ht,(e,t)=>Yn(e,t.payload)).addCase(gt,(e,t)=>Zn(e,t.payload)).addCase(ke,(e,t)=>ea(e,t.payload)).addCase(yt,(e,t)=>ta(e,t.payload))});function sa(n,e){return x(p({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:e.data}})}function oa(n,e){const t={};for(const a of Object.keys(n))a!==e&&(t[a]=n[a]);return t}function ia(n,e){const t=n[e.collection];if(!t)return n;const a=x(p({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat,plot:e.plot});return x(p({},n),{[e.collection]:a})}const la={},bt=$("loadNewGenericCollectionData"),vt=$("setGenericSegmentPositionKeys"),ra=$("removeGenericSegmentCollection"),ca=re(la,n=>n.addCase(bt,(e,t)=>sa(e,t.payload)).addCase(vt,(e,t)=>ia(e,t.payload)).addCase(ra,(e,t)=>oa(e,t.payload)));function da(n,e){return x(p({},n),{[e.mesh]:e.data})}function ua(n,e){const t={};for(const a of Object.keys(n))a!==e&&(t[a]=n[a]);return t}const fa={},Ce=$("loadMeshLineData"),ma=$("removeMesh"),pa=re(fa,n=>n.addCase(Ce,(e,t)=>da(e,t.payload)).addCase(ma,(e,t)=>ua(e,t.payload)));function ha(n,{a:e,b:t}){const a=x(p({},ie),{start:e,end:t}),s=[...n.segments,a];return x(p({},n),{segments:s})}function ga(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),{lastIndex:s}=n,[i,r]=q(e.start,a,t,s),[l,d]=q(e.end,a,t,r),c=x(p(p({},ie),e),{start:i,end:l}),y=[...n.segments,c];return{vertecies:t,vertexDictionary:a,segments:y,lastIndex:d}}function ya(n,e){const t=[],a=[];let s=p({},n);for(const[i,r]of n.segments.entries())e.index.includes(i)?a.push(r):t.push(r);s.segments=t;for(const i of a)s=dt(dt(s,i.start),i.end);return s}function ba(n,e){const t=[...n.segments];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return x(p({},n),{segments:t})}function va(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),[s,i]=q(e.targetPoint,a,t,n.lastIndex),r=x(p({},ie),{start:e.index,end:s}),l=[...n.segments,r];return{vertecies:t,vertexDictionary:a,segments:l,lastIndex:i}}function xa(n,e){return e}function wa(n,{a:e,b:t}){if(e===t)return n;const a=n.segments.map(d=>{let c=d;return c.start===t&&(c=x(p({},c),{start:e})),c.end===t&&(c=x(p({},c),{end:e})),c}).filter(d=>d.start!==d.end),s=n.vertecies[t],i=`${Math.floor(s.lon*O)},${Math.floor(s.lat*O)}`,r=p({},n.vertecies);delete r[t];const l=p({},n.vertexDictionary);return delete l[i],x(p({},n),{vertecies:r,vertexDictionary:l,segments:a})}function Na(n,{index:e,vertex:t}){const a=p({},n.vertecies),s=p({},n.vertexDictionary),i=[...n.segments],r=a[e],l=`${Math.floor(t.lon*O)},${Math.floor(t.lat*O)}`,d=`${Math.floor(r.lon*O)},${Math.floor(r.lat*O)}`;if(delete s[d],l in s){const c=s[l];for(const y of i)y.start===c&&(y.start=e),y.end===c&&(y.end=e);delete a[c]}return a[e]=t,x(p({},n),{segments:i,vertecies:a,vertexDictionary:s})}function _a(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),s=[...n.segments];let{lastIndex:i}=n;for(const r of e){const l=n.segments[r],d=n.vertecies[l.start],c=n.vertecies[l.end],y={lon:(d.lon+c.lon)/2,lat:(d.lat+c.lat)/2},[m,u]=q(y,a,t,i);i=u;const v=x(p({},l),{end:m,name:`${l.name}_a`}),g=x(p({},l),{start:m,name:`${l.name}_b`});s[r]=v,s.push(g)}return{vertecies:t,vertexDictionary:a,segments:s,lastIndex:i}}const Sa={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},xt=$("bridgeVertices"),wt=$("createSegmet"),Nt=$("deleteSegment"),_t=$("editSegmentData"),St=$("extrudeSegment"),Le=$("loadNewSegmentData"),kt=$("mergeVertices"),$e=$("moveVertex"),Ct=$("splitSegment");function ka(n,e,t){if(t.dip===90||t.locking_depth<=0)return!1;const a=t.dip<90,i=(a?90-t.dip:t.dip-90)*(Math.PI/180),r=Math.abs(Math.tan(i)*t.locking_depth),[l,d]=n.lon>=e.lon?[n,e]:[e,n],c={lon:d.lat-l.lat,lat:-(d.lon-l.lon)};a&&(c.lon*=-1,c.lat*=-1);const y=it(lt([[l.lon,l.lat],[l.lon+c.lon,l.lat+c.lat]]),r,{units:"kilometers"}),m=it(lt([[d.lon,d.lat],[d.lon+c.lon,d.lat+c.lat]]),r,{units:"kilometers"});return[l,{lon:y.geometry.coordinates[0],lat:y.geometry.coordinates[1]},{lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1]},d]}function Ca(n){return n.segments.map(e=>ka(n.vertecies[e.start],n.vertecies[e.end],e)).filter(e=>e)}const La=re(Sa,n=>{n.addCase(xt,(e,t)=>ha(e,t.payload)).addCase(wt,(e,t)=>ga(e,t.payload)).addCase(Nt,(e,t)=>ya(e,t.payload)).addCase(_t,(e,t)=>ba(e,t.payload)).addCase(St,(e,t)=>va(e,t.payload)).addCase(Le,(e,t)=>xa(e,t.payload)).addCase(kt,(e,t)=>wa(e,t.payload)).addCase($e,(e,t)=>Na(e,t.payload)).addCase(Ct,(e,t)=>_a(e,t.payload))}),Lt=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],$a={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Da(n){return p(p({},$a),n)}function Fa(n,{data:e}){return[...n,Da(e)]}function ja(n,e){const t=[];for(const[a,s]of n.entries())e.includes(a)||t.push(s);return t}function Va(n,e){const t=[...n];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return t}function Ma(n,e){return e}function Ia(n,{index:e,position:t}){const a=[...n],s=p(p({},a[e]),t);return a[e]=s,a}const Pa=[],$t=$("createVelocity"),Dt=$("editVelocity"),Ft=$("deleteVelocity"),De=$("loadNewVelocityData"),jt=$("moveVelocity"),Oa=re(Pa,n=>{n.addCase($t,(e,t)=>Fa(e,t.payload)).addCase(Dt,(e,t)=>Va(e,t.payload)).addCase(Ft,(e,t)=>ja(e,t.payload)).addCase(De,(e,t)=>Ma(e,t.payload)).addCase(jt,(e,t)=>Ia(e,t.payload))});function ce(n){const e=n.split(/\n/g),t=e[0].split(",").map(i=>i.trim()),a=e.slice(1),s=[];for(const i of a)if(i.trim()!==""){const r=i.split(/\s*,\s*/),l={};for(let d=0;d<t.length;d+=1){let c=r[d];const y=t[d],m=Number.parseFloat(c);c=Number.isNaN(m)?c:m,typeof c=="string"&&(c=c.startsWith('"')&&c.endsWith('"')?c.slice(1,-1).trim():c.trim()),l[y]=c}s.push(l)}return s}function Fe(n,e){const t=[e.join(",")];for(const a of n){const s=a;t.push(e.map(i=>{if(i in s){const r=s[i];return typeof r=="string"&&/\s/.test(`${r}`)?`"${r.trim()}"`:`${typeof r=="number"&&(i.includes("lon")||i.includes("lat"))?r.toFixed(6):r}`}return""}).join(","))}return t.join(`
`)}class pe{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ce(e).map(s=>{const i={};for(const r of ft)i[r]=s[r]||(r==="name"?"":0);return i});this.data=a}async save(){var t;const e=Fe((t=this.data)!=null?t:[],ft);await this.handle.setContents(e)}clone(){return new pe(this.handle)}}const Ra={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Ba(n){return p(p({},Ra),n)}class je{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Ba(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new je(this.handle)}}class Ea{constructor(e){k(this,"data");k(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=ce(e);this.data=t}async save(){}}function Aa(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const s=Number.parseFloat(a[1]),i=Number.parseFloat(a[2]);return{lon:s,lat:i}});return t.splice(0,0,{lon:0,lat:0}),t}const Ta={"1":n=>{var a,s;const e=Number.parseInt((a=n[n.length-2])!=null?a:"",10),t=Number.parseInt((s=n[n.length-1])!=null?s:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var s,i,r;const e=Number.parseInt((s=n[n.length-3])!=null?s:"",10),t=Number.parseInt((i=n[n.length-2])!=null?i:"",10),a=Number.parseInt((r=n[n.length-1])!=null?r:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(a)?[[e,t],[t,a],[a,e]]:!1}};function Wa(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var a;return((a=Ta[e[1]])!=null?a:()=>!1)(e)}).filter(e=>e).flat()}function Ga(n,e){return e.map(([t,a])=>t!==a&&t>-1&&t<n.length&&a>-1&&a<n.length?[n[t],n[a]]:!1).filter(t=>t)}function za(n){const e=n.split("$");let t=[],a=[];for(const s of e)s.startsWith("Nodes")?t=Aa(s):s.startsWith("Elements")&&(a=Wa(s));return Ga(t,a)}class Ha{constructor(e){k(this,"data");k(this,"handle");k(this,"startLonColumn");k(this,"endLonColumn");k(this,"startLatColumn");k(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=za(e);else{const t=ce(e);this.data=t.map(a=>{const s={lon:0,lat:0},i={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(s.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(s.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(i.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(i.lat=a[this.endLatColumn]);const r=Object.keys(a).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(r.length>0){const l={};for(const d of r)l[d]=a[d];return[s,i]}return[s,i]})}}async save(){console.log("Mesh files do not get saved")}}class he{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ce(e).map(d=>{const c={};for(const y of Se)c[y]=d[y]||(y==="name"?"":0);return c}),s={},i={},r=[];let l=0;for(const d of a){const[c,y]=q({lon:d.lon1,lat:d.lat1},s,i,l),[m,u]=q({lon:d.lon2,lat:d.lat2},s,i,y),v=x(p({},d),{start:c,end:m});l=u,r.push(v)}this.data={vertecies:i,segments:r,vertexDictionary:s,lastIndex:l}}async save(){let e=[];if(this.data){const{vertecies:a,segments:s}=this.data;e=s.map(i=>{const r=a[i.start],l=a[i.end];return x(p({},i),{lon1:r.lon,lat1:r.lat,lon2:l.lon,lat2:l.lat})})}const t=Fe(e,Se);await this.handle.setContents(t)}clone(){return new he(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*O)},${Math.floor(a.lat*O)}`,i=p({},this.data.vertecies);delete i[e];const r=p({},this.data.vertexDictionary);delete r[s];const l=this.clone();return l.data=x(p({},this.data),{vertecies:i,vertexDictionary:r}),l}}return this}mergeVertices(e,t){if(this.data){for(const d of this.data.segments)d.start===t&&(d.start=e),d.end===t&&(d.end=e);const a=this.data.vertecies[t],s=`${Math.floor(a.lon*O)},${Math.floor(a.lat*O)}`,i=p({},this.data.vertecies);delete i[t];const r=p({},this.data.vertexDictionary);delete r[s];const l=this.clone();return l.data=x(p({},this.data),{vertecies:i,vertexDictionary:r}),l}return this}moveVertex(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),i=[...this.data.segments],r=a[e],l=`${Math.floor(t.lon*O)},${Math.floor(t.lat*O)}`,d=`${Math.floor(r.lon*O)},${Math.floor(r.lat*O)}`;if(delete s[d],l in s){const y=s[l];for(const m of i)m.start===y&&(m.start=e),m.end===y&&(m.end=e);delete a[y]}a[e]=t;const c=this.clone();return c.data=x(p({},this.data),{segments:i,vertecies:a,vertexDictionary:s}),c}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],a=this.data.vertecies[t.start],s=this.data.vertecies[t.end],i={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[r,l]=q(i,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),d=x(p({},t),{end:r,name:`${t.name}_a`}),c=x(p({},t),{start:r,name:`${t.name}_b`}),y=[...this.data.segments];y[e]=d,y.push(c);const m=this.clone();return m.data=x(p({},this.data),{segments:y,lastIndex:l}),m}return this}bridgeVertices(e,t){if(this.data){const a=x(p({},ie),{start:e,end:t}),s=[...this.data.segments,a],i=this.clone();return i.data=x(p({},this.data),{segments:s}),i}return this}extrudeSegment(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),[i,r]=q(t,s,a,this.data.lastIndex),l=x(p({},ie),{start:e,end:i}),d=[...this.data.segments,l],c=this.clone();return c.data={vertecies:a,vertexDictionary:s,segments:d,lastIndex:r},c}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],a=t.splice(e,1)[0],s=this.clone();return s.data=x(p({},this.data),{segments:t}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),[i,r]=q(e,s,a,this.data.lastIndex),[l,d]=q(t,s,a,r),c=x(p({},ie),{start:i,end:l}),y=[...this.data.segments,c],m=this.clone();return m.data={vertecies:a,vertexDictionary:s,segments:y,lastIndex:d},m}return this}}class ge{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ce(e).map(s=>{const i={};for(const r of Lt)i[r]=s[r]||(r==="name"?"":0);return i});this.data=a}async save(){var t;const e=Fe((t=this.data)!=null?t:[],Lt);await this.handle.setContents(e)}clone(){return new ge(this.handle)}}async function Vt(n){const e=new he(n);return await e.initialize(),e}async function Mt(n){const e=new pe(n);return await e.initialize(),e}async function It(n){const e=new ge(n);return await e.initialize(),e}async function Pt(n){const e=new Ha(n);return await e.initialize(),e}async function Ja(n){const e=new Ea(n);return await e.initialize(),e}async function de(n,e,t){try{const a=await e.getFile(n);return await t(a)}catch{return!1}}async function Ka(n,e,t){const a=new je(e);if(await a.initialize(),a.data){const s=await de(a.data.segment_file_name,n,Vt),i=await de(a.data.block_file_name,n,Mt),r=await de(a.data.station_file_name,n,It),l=await de(a.data.mesh_parameters_file_name,n,async c=>{const y=JSON.parse(await c.getContents());return(await Promise.all(y.map(async u=>de(u.mesh_filename,n,Pt)))).filter(u=>u)}),d=p({},t);return"command"in d&&(d.command=x(p({},d.command),{currentFilePath:e.name})),s&&"segment"in d&&(d.segment=x(p({},d.segment),{currentFilePath:a.data.segment_file_name})),i&&"block"in d&&(d.block=x(p({},d.block),{currentFilePath:a.data.block_file_name})),r&&"velocities"in d&&(d.velocities=x(p({},d.velocities),{currentFilePath:a.data.station_file_name})),l&&"mesh"in d&&(d.mesh=x(p({},d.mesh),{currentFilePath:l.map(c=>c.handle.name)})),{openableFiles:d,commands:a,segments:s,blocks:i,velocities:r,mesh:l}}throw new Error("Can't open command file")}class Ua{constructor(e){k(this,"name");k(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Ve{constructor(e){k(this,"name");k(this,"handle");k(this,"fileList");k(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){const t=await this.handle.getFileHandle(e,{create:!0});return new Ua(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),a=new Ve(t);return await a.initialize(),a}}const qa=async()=>{const n=await window.showDirectoryPicker(),e=new Ve(n);return await e.initialize(),e};class Qa{constructor(e,t){k(this,"name");k(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class Me{constructor(e,t){k(this,"name");k(this,"parent");k(this,"fileList");k(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const a=t[e];for(const s of Object.keys(a))typeof a[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Qa(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new Me(e,this.parent[this.name])}}const Xa=async n=>new Me("root",n);let Ot=async()=>{var e;return Xa((e=window.FakeDirectory)!=null?e:{})};function Za(n){Ot=n}async function Ya(){return Ot()}window.location.search.includes("fake-dir")||Za(qa);var H;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(H||(H={}));const Rt={Block:H.Block,Vertex:H.Vertex,Velocity:H.Velocity},es={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments"};function ts(){var Xe,Ze,Ye,et,tt,nt;const n=ut(),[e,t]=S.exports.useState(),[a,s]=S.exports.useState(""),[i,r]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[l,d]=S.exports.useState(),[c,y]=S.exports.useState(),[m,u]=S.exports.useState(),[v,g]=S.exports.useState(),h=le(f=>f.main.present.segment),w=le(f=>f.main.present.block),_=le(f=>f.main.present.velocity),M=le(f=>f.main.present.meshLine),Z=le(f=>f.main.present.genericSegments),[L,Ie]=S.exports.useState(Hn),[I,Pe]=S.exports.useState(wn),[R,Oe]=S.exports.useState(An),[D,Re]=S.exports.useState(Un),[J,Be]=S.exports.useState(Rn),[K,Ee]=S.exports.useState(kn),[T,te]=S.exports.useState("normal"),[ne,zt]=S.exports.useState(H.Vertex),[ye,Ae]=S.exports.useState([]),[Te,We]=S.exports.useState([]),[Ge,ze]=S.exports.useState([]),[He,Je]=S.exports.useState([]),[j,is]=S.exports.useState({select:(f,b)=>{Ae(f==="block"?b:[]),We(f==="segment"?b:[]),ze(f==="velocities"?b:[]),Je(f==="vertex"?b:[]),s(f)}}),[Ht,Jt]=S.exports.useState([]),[Kt,Ke]=S.exports.useState([]),[Ut,qt]=S.exports.useState([]),[Qt,Ue]=S.exports.useState([]),[Xt,be]=S.exports.useState({color:D.color,selectedColor:D.activeColor,radius:D.radius,selectedRadius:D.activeRadius,points:[]}),[qe,Zt]=S.exports.useState({lon:0,lat:0}),[ve,Yt]=S.exports.useState(!1);S.exports.useEffect(()=>{T==="normal"?j.select=(f,b)=>{Ae(f==="block"?b:[]),We(f==="segment"?b:[]),ze(f==="velocities"?b:[]),Je(f==="vertex"?b:[]),s(f)}:T.mode==="override"?j.select=(f,b)=>{f===T.type&&T.callback(b)}:j.select=()=>{}},[T,j]),S.exports.useEffect(()=>{const f=[];ne!==H.Block&&!I.hide&&f.push({name:"blocks",color:I.color,selectedColor:I.selectedColor,radius:I.radius,points:w.map((b,C)=>({longitude:b.interior_lon,latitude:b.interior_lat,name:b.name,description:"",index:C})),click:b=>{j.select("block",[b])}}),ne!==H.Vertex&&!D.hide&&f.push({name:"vertices",color:D.color,selectedColor:D.activeColor,radius:D.radius,click:b=>{j.select("vertex",[b])},points:Object.keys(h.vertecies).map(b=>{const C=Number.parseInt(b,10),V=h.vertecies[C];return V?{longitude:V.lon,latitude:V.lat,index:C,name:"",description:""}:!1}).filter(b=>!!b)}),Jt(f)},[I,w,R,j,ne,D.hide,D.color,D.activeColor,D.radius,h.vertecies]),S.exports.useEffect(()=>{const f=[];if(R.hide||f.push({name:"segments",color:R.color,selectedColor:R.activeColor,width:R.width,selectedWidth:R.activeWidth,lines:h.segments.map((b,C)=>{var U,W;const V=(U=h.vertecies[b.start])!=null?U:rt,A=(W=h.vertecies[b.end])!=null?W:rt,[[Q,B],[G,P]]=_e(V,A);return{startLongitude:Q,startLatitude:B,endLongitude:G,endLatitude:P,name:b.name,description:`${V.lon},${V.lat} to ${A.lon},${A.lat}`,index:C,label:R.plottableKey in b?`${b[R.plottableKey]}`:""}}),click:b=>{j.select("segment",[b])}}),!J.hide)for(const b of Object.keys(M)){const C=M[b];f.push({name:`mesh:${b}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:C.map((V,A)=>{const Q=V[0],B=V[1],[[G,P],[U,W]]=_e(Q,B);return{startLongitude:G,startLatitude:P,endLongitude:U,endLatitude:W,name:"",description:"",index:A}})||[]})}if(!K.hide)for(const b of Object.keys(Z)){const{startLat:C,startLon:V,endLat:A,endLon:Q,plot:B,segments:G}=Z[b];C in G[0]&&A in G[0]&&V in G[0]&&Q in G[0]&&f.push({name:`generic_segment:${b}`,color:K.color,selectedColor:K.activeColor,width:K.width,selectedWidth:K.activeWidth,lines:G.map((P,U)=>{const W={lat:P[C],lon:P[V]},ae={lat:P[A],lon:P[Q]};if(typeof W.lat!="number"||typeof W.lon!="number"||typeof ae.lat!="number"||typeof ae.lon!="number")return!1;const[[ue,F],[fe,me]]=_e(W,ae);return{startLongitude:ue,startLatitude:F,endLongitude:fe,endLatitude:me,name:"",description:"",index:U,label:B&&B in P?`${P[B]}`:""}}).filter(P=>P)||[]})}qt(f)},[h,R,K,Z,J,M,j]),S.exports.useEffect(()=>{switch(ne){case H.Vertex:{be({color:D.color,radius:D.radius,selectedColor:D.activeColor,selectedRadius:D.activeRadius,points:D.hide?[]:Object.keys(h.vertecies).map(f=>{const b=Number.parseInt(f,10),C=h.vertecies[b];return C?{longitude:C.lon,latitude:C.lat,index:b}:!1}).filter(f=>!!f),update:(f,b)=>{n($e({index:f,vertex:b}))},select:f=>{j.select("vertex",f)}});break}case H.Block:{be({color:I.color,radius:I.radius,selectedColor:I.selectedColor,selectedRadius:I.radius,points:I.hide?[]:w.map((f,b)=>({longitude:f.interior_lon,latitude:f.interior_lat,name:f.name,description:"",index:b})),update:(f,b)=>{n(yt({index:f,position:b}))},select:f=>{j.select("block",f)}});break}case H.Velocity:{be({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:_.map((f,b)=>({longitude:f.lon,latitude:f.lat,name:f.name,description:"",index:b})),update:(f,b)=>{n(jt({index:f,position:b}))},select:f=>{j.select("velocities",f)}});break}}},[D,j,h.vertecies,n,ne,I.color,I.radius,I.selectedColor,I.hide,w,L.color,L.width,L.selectedColor,L.hide,_]),S.exports.useEffect(()=>{L.hide?Ke([]):Ke([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:_.map((f,b)=>{const C=Math.sqrt(f.east_vel*f.east_vel+f.north_vel*f.north_vel);return{longitude:f.lon,latitude:f.lat,direction:[f.east_vel/C,f.north_vel/C],scale:C,name:f.name,description:`north: ${f.north_vel}, east: ${f.east_vel}`,index:b}}),click:f=>{j.select("velocities",[f])}}])},[j,L,_]),S.exports.useEffect(()=>{R.hideProjection?Ue([]):Ue([{name:"fault_dip_projections",color:R.projectionColor,borderColor:R.projectionColor,borderRadius:.5,polygons:Ca(h).map((f,b)=>({polygon:f,index:b,name:"",description:""}))}])},[R,h]);let Y=o("span",{});switch(a){case"files":Y=e?o(_n,{folder:e,files:i,setFile:async(f,b,C,V)=>{if(V){let A=p({},i);const Q=A[b];let{currentFilePath:B,allowMultiple:G}=Q;switch(G?Array.isArray(B)?(B=B.map(P=>P),B.length>f?B[f]=C:B.push(C)):B=[C]:B=C,A[b]=x(p({},Q),{currentFilePath:B}),b){case"segment":const P=await Vt(V);y(P),P.data&&n(Le(P.data));break;case"block":const U=await Mt(V);u(U),U.data&&n(ke(U.data));break;case"velocities":const W=await It(V);g(W),W.data&&n(De(W.data));break;case"mesh":const ae=await Pt(V);ae.data&&n(Ce({mesh:`mesh_file_${f}`,data:ae.data}));break;case"csv":const ue=await Ja(V);ue.data&&n(bt({name:`generic_segment_${f}`,data:ue.data}));break;case"command":const F=await Ka(e,V,i);d(F.commands!==!1?F.commands:void 0),y(F.segments!==!1?F.segments:void 0),F.segments!==!1&&F.segments.data&&n(Le(F.segments.data)),u(F.blocks!==!1?F.blocks:void 0),F.blocks!==!1&&F.blocks.data&&n(ke(F.blocks.data)),g(F.velocities!==!1?F.velocities:void 0),F.velocities!==!1&&F.velocities.data&&n(De(F.velocities.data)),F.mesh&&F.mesh.map((fe,me)=>(fe.data&&n(Ce({mesh:`mesh_file_${me}`,data:fe.data})),me)),A=F.openableFiles;break}r(A)}}}):o("span",{});break;case"velocities":Y=o(Jn,{settings:L,setSettings:Ie,selected:Ge,velocitys:_,setVelocityData:(f,b)=>{b?n(Dt({indices:f,data:b})):(n(Ft(f)),j.select("velocity",[]))},addNewVelocity:()=>{te({label:"Click to place velocity estimate",mode:"mapClick",callback:f=>{te("normal");const b=_.length;n($t({data:{lat:f.lat,lon:f.lon}})),j.select("velocity",[b])}})},save:async()=>{v&&(v.data=_,await v.save())},fileName:(Xe=v==null?void 0:v.handle.name)!=null?Xe:"",changeFileName:async f=>{if(e){const b=await e.getFile(f);g(new ge(b))}}});break;case"block":Y=o(Nn,{settings:I,setSettings:Pe,selected:ye,blocks:w,addNewBlock:()=>{te({label:"Click to place new block",mode:"mapClick",callback:f=>{const b=w.length;n(pt({data:{name:"New Block",interior_lon:f.lon,interior_lat:f.lat}})),j.select("block",[b]),te("normal")}})},setBlockData:(f,b)=>{b?n(ht({indices:ye,data:b})):(n(gt(f)),j.select("block",[]))},save:async()=>{m&&(m.data=w,await m.save())},fileName:(Ze=m==null?void 0:m.handle.name)!=null?Ze:"",changeFileName:async f=>{if(e){const b=await e.getFile(f);u(new pe(b))}}});break;case"segment":Y=o(Wn,{settings:R,setSettings:Oe,segments:(Ye=h.segments)!=null?Ye:[],selected:Te,setSelectionMode:f=>te(f),addNewSegment:(f,b)=>{const C=h.segments.length;n(wt({start:f,end:b})),j.select("segment",[C])},setSegmentData:(f,b)=>{n(b?_t({indices:f,data:b}):Nt({index:f}))},splitSegment:f=>{n(Ct(f)),j.select("segment",[])},save:async()=>{c&&(c.data=h,await c.save())},fileName:(et=c==null?void 0:c.handle.name)!=null?et:"",changeFileName:async f=>{if(e){const b=await e.getFile(f);y(new he(b))}}});break;case"vertex":Y=o(qn,{settings:D,setSettings:Re,vertices:(tt=h.vertecies)!=null?tt:{},selected:He,setVertexData:(f,b)=>{b&&n($e({index:f,vertex:b}))},setSelectionMode:f=>te(f),mergeVertices:(f,b)=>{n(kt({a:f,b}))},bridgeVertices:(f,b)=>{n(xt({a:f,b}))},extrudeVertex:(f,b)=>{n(St({index:f,targetPoint:b}))},save:async()=>{c&&(c.data=h,await c.save())}});break;case"mesh":Y=o(Bn,{settings:J,setSettings:Be});break;case"csv":Y=o(Cn,{settings:K,setSettings:Ee,setCollectionVertexKeys:f=>{n(vt(f))},collections:Z});break}const Qe={Block:{state:I.hide,change:()=>{Pe(x(p({},I),{hide:!I.hide}))}},Vertex:{state:D.hide,change:()=>{Re(x(p({},D),{hide:!D.hide}))}},Velocity:{state:L.hide,change:()=>{Ie(x(p({},L),{hide:!L.hide}))}},Segment:{state:R.hide,change:()=>{Oe(x(p({},R),{hide:!R.hide}))}},Grid:{state:!ve,change:()=>{Yt(!ve)}},Mesh:{state:J.hide,change:()=>{Be(x(p({},J),{hide:!J.hide}))}},GenericSegments:{state:K.hide,change:()=>{Ee(x(p({},K),{hide:!K.hide}))}}};return N("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:f=>{f.key==="Escape"&&te("normal")},children:[o(Gn,{filesOpen:((nt=l!=null?l:c)!=null?nt:m)!==void 0,saveFiles:async()=>{l&&await l.save(),c&&(c.data=h,await c.save()),m&&(m.data=w,await m.save()),v&&(v.data=_,await v.save())},folder:e,openFolder:async()=>{const f=await Ya();t(f),s("files")}}),T!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:N("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:T.label}),T.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:T.subtitle}):o(E,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(E,{}),N("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-start gap-5",children:N("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ne})]})}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[N("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),N("span",{children:[Math.floor(qe.lon*1e3)/1e3,","," ",Math.floor(qe.lat*1e3)/1e3]})]}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Rt).map(f=>{const b=Rt[f];return o("button",{type:"button",className:`${ne===b?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{zt(b)},children:f},f)})]}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[N("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Qe).map(f=>{const b=Qe[f];return o("button",{type:"button",className:`${b.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{b.change()},children:f},f)})]})]}),o(Pn,{pointSources:Ht,arrowSources:Kt,lineSources:Ut,drawnPointSource:Xt,polygonSources:Qt,selections:{segments:Te,blocks:ye,velocities:Ge,vertices:He},displayGrid:ve?10:-1,click:f=>{typeof T!="string"&&T.mode==="mapClick"&&T.callback(f)},mouseMove:f=>{Zt(f)}}),o(Ln,{view:Y,buttons:e?es:void 0,active:a,setActive:f=>s(f)})]})}const ns=dn({reducer:{main:un(fn({segment:La,block:aa,velocity:Oa,meshLine:pa,genericSegments:ca}))}});function as(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:s,onRegisterError:i}=n;let r;const l=async(d=!0)=>{};return"serviceWorker"in navigator&&(r=new mn("./sw.js",{scope:"./"}),r.addEventListener("activated",d=>{d.isUpdate?window.location.reload():a==null||a()}),r.register({immediate:e}).then(d=>{s==null||s(d)}).catch(d=>{i==null||i(d)})),l}as();const ss=1,os=new pn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ss}}});hn.render(o(S.exports.StrictMode,{children:o(gn,{client:os,children:o(yn,{store:ns,children:o(ts,{})})})}),document.querySelector("#root"));
