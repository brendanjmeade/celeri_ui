var Dt=Object.defineProperty,$t=Object.defineProperties;var Ft=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var Vt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var ne=(n,e,t)=>e in n?Dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,m=(n,e)=>{for(var t in e||(e={}))Vt.call(e,t)&&ne(n,t,e[t]);if(Ee)for(var t of Ee(e))Lt.call(e,t)&&ne(n,t,e[t]);return n},v=(n,e)=>$t(n,Ft(e));var F=(n,e,t)=>(ne(n,typeof e!="symbol"?e+"":e,t),t);import{j as l,a as b,F as O,r as k,M as Mt,m as Pe,R as jt,b as se,u as It,c as Rt,l as Ae,d as ae,e as V,f as Bt,g as Ot,h as Et,v as Pt,Q as At,i as Tt,k as Ht,P as Wt}from"./vendor.6cf141b2.js";const zt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}};zt();function Jt({value:n,fieldDefinition:e,setField:t}){const[s,a]=k.exports.useState(-1),[i,r]=k.exports.useState(n);return k.exports.useEffect(()=>{r(n)},[n]),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[l("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?l("span",{className:"text-sm",children:e.description}):l(O,{})]}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof n=="number"?"number":"text",value:i,onChange:c=>{const f=typeof n=="number"?Number.parseFloat(c.target.value):c.target.value;r(f),s>-1&&clearTimeout(s),a(setTimeout(()=>t(f),1e3))}})})]})}function Z({title:n,item:e,setItem:t,fieldDefinitions:s,ignoreFields:a,deletable:i,controls:r}){const c=Object.keys(e).map((f,u)=>{if(a==null?void 0:a.includes(f))return{element:l("span",{style:{display:"hidden"}},f),order:u+1e4};const y=e[f],o=f in s&&s[f];return o?{element:l(Jt,{value:y,fieldDefinition:o,setField:g=>t({[f]:g})},f),order:o.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":`input-title-${f}`,className:"text-l font-bold",children:f}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{"data-testid":`input-editor-${f}`,className:"rounded w-full",type:typeof y=="number"?"number":"text",value:y,onChange:g=>{t({[f]:typeof y=="number"?Number.parseFloat(g.target.value):g.target.value})}})})]},f),order:u+1e3}}).sort((f,u)=>f.order-u.order).map(f=>f.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[r,i?l("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):l(O,{})]})]}),c]})}Z.defaultProps={ignoreFields:[],controls:l(O,{})};const Gt={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var ht;const Ut=JSON.parse((ht=window.localStorage.getItem("blockDisplaySettings"))!=null?ht:"false")||Gt;function qt({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:i}){const r=u=>{e(u),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(u))},f=t.map((u,y)=>({selectedBlock:s[u],index:y})).filter(u=>u.selectedBlock).map(({selectedBlock:u,index:y})=>l(Z,{title:u.name,item:u,deletable:!0,setItem:o=>a(y,o),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}},y));return b(O,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{r(v(m({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:u=>{r(v(m({},n),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:u=>{r(v(m({},n),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:u=>{r(v(m({},n),{radius:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Block"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Block"})]}),f]})}function Kt({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const i=e[a];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[l("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:i.name}),l("span",{className:"text-sm","data-testid":`file-${a}-description`,children:i.description})]}),l("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:i.currentFilePath,onChange:async r=>{const c=r.currentTarget.value;try{const f=await n.getFile(c);t(a,f.name,f)}catch{t(a,"")}},children:[l("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(r=>r.endsWith(i.extension)).map(r=>l("option",{value:r,"data-testid":`file-${a}-select-${r}`,children:r},r))]})})]},a)});return l("div",{className:"flex flex-col gap-2",children:s})}function Qt({view:n,buttons:e,active:t,setActive:s}){if(!e)return l("span",{});const a=[];for(const i of Object.keys(e)){const r=e[i],c=i===t;a.push(l("button",{type:"button","data-testid":`tab-${i}`,className:`${c?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>s(c?"":i),children:r},i))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?l("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm overflow-y-auto",children:n}):"",l("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}const Te={lon:0,lat:0},Xt=180,U=360;function He(n){let{lon:e,lat:t}=n;for(;e<0;)e+=U;for(;e>U;)e-=U;return[e,t]}function oe([n,e]){return{lon:n<0?n+U:n,lat:e}}function Zt(n,e){const t=He(n),s=He(e),a=[s[0],s[1]];return s[0]-t[0]>=Xt?a[0]-=U:a[0]+=U,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const M=1e3;function A(n,e,t,s){const a=`${Math.floor(n.lon*M)},${Math.floor(n.lat*M)}`;if(a in e)return[e[a],s];const i=s;return t[i]=n,e[a]=i,[i,s+1]}function We(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,i=m({},n.vertecies);delete i[e];const r=m({},n.vertexDictionary);return delete r[a],v(m({},n),{vertecies:i,vertexDictionary:r})}return n}const T=Math.PI/6,H=2*Math.PI-T;function Yt(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:i,internalSelections:r},{arrowSources:c,selections:f}){if(t&&i&&a!==c)if(console.log("Setting arrows in map!"),a){for(const o of a){const g=t.getSource(`arrow:${o.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${o.name}`),t.removeLayer(`layer:arrow:${o.name}:click`)}e({internalArrowSources:void 0})}else{for(const o of c){let g=t.getSource(`arrow:${o.name}`);const N=g===void 0;N&&(t.addSource(`arrow:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`arrow:${o.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:o.arrows.map(h=>{var D;const p=h.scale*o.scale,w=o.scale*o.arrowHeadScale,_=[h.longitude+h.direction[0]*p,h.latitude+h.direction[1]*p],S=[_[0]+(Math.cos(T)*-h.direction[0]-Math.sin(T)*-h.direction[1])*w,_[1]+(Math.sin(T)*-h.direction[0]+Math.cos(T)*-h.direction[1])*w],J=[_[0]+(Math.cos(H)*-h.direction[0]-Math.sin(H)*-h.direction[1])*w,_[1]+(Math.sin(H)*-h.direction[0]+Math.cos(H)*-h.direction[1])*w];return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:(D=f[o.name])==null?void 0:D.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],_,S,_,J]}}})}),t.addLayer({id:`layer:arrow:${o.name}`,type:"line",source:`arrow:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],o.selectedColor,o.color],"line-width":o.width}}),t.addLayer({id:`layer:arrow:${o.name}:click`,type:"line",source:`arrow:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),N&&(t.on("mouseenter",`layer:arrow:${o.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const w=[...p.geometry.coordinates],{description:_}=p.properties;for(;Math.abs(h.lngLat.lng-w[0])>180;)w[0]+=h.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:arrow:${o.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${o.name}:click`,h=>{let p;if(n.state.internalArrowSources)for(const _ of n.state.internalArrowSources)p=_.click;if(!h.features||!p)return;const w=h.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;p(_)}}))}e({internalArrowSources:c})}const u=m({},r);let y=!1;for(const o of Object.keys(f))if(f[o]!==r[o]){for(const g of c)if(g.name===o){y=!0,u[o]=f[o];const N=t==null?void 0:t.getSource(`arrow:${g.name}`);if(N){const h=f[o];N.setData({type:"FeatureCollection",features:g.arrows.map(p=>{const w=p.scale*g.scale,_=g.scale*g.arrowHeadScale,S=[p.longitude+p.direction[0]*w,p.latitude+p.direction[1]*w],J=[S[0]+(Math.cos(T)*-p.direction[0]-Math.sin(T)*-p.direction[1])*_,S[1]+(Math.sin(T)*-p.direction[0]+Math.cos(T)*-p.direction[1])*_],D=[S[0]+(Math.cos(H)*-p.direction[0]-Math.sin(H)*-p.direction[1])*_,S[1]+(Math.sin(H)*-p.direction[0]+Math.cos(H)*-p.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:h==null?void 0:h.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],S,J,S,D]}}})})}}}y&&e({internalSelections:u})}function en(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:i},{drawnPointSource:r}){if(e&&a&&i!==r){console.log("Drawning Points"),n({internalDrawnPointSource:r});let c=t;if((r.selectedColor!==s.selectedColor||r.selectedRadius!==s.selectedRadius||r.color!==s.color||r.radius!==s.radius)&&(n({drawnPointSettings:{color:r.color,radius:r.radius,selectedRadius:r.selectedRadius,selectedColor:r.selectedColor}}),t&&(e.removeControl(t),c=void 0),r?(c=new Mt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":r.selectedRadius,"circle-color":r.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":r.radius,"circle-color":r.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(c),n({draw:c})):c=void 0),c){const f=c.getAll(),u=r.points.length!==f.features.length?void 0:c.getSelected(),y={type:"FeatureCollection",features:r.points.map(o=>({type:"Feature",id:o.index.toString(),properties:{description:"",index:o.index,name:""},geometry:{type:"Point",coordinates:[o.longitude,o.latitude]}}))};if(c.set(y),u&&u.features.length>0&&u.features[0].properties&&typeof u.features[0].properties.index=="number"){const o=u.features[0].id;o&&c.changeMode("simple_select",{featureIds:[o]})}}}}const E="grid";function tn(n,e,{map:t,internalGridDisplay:s,popup:a,mapLoaded:i},{displayGrid:r}){if(t&&i&&s!==r){if(console.log("Drawing Grid on map!"),s&&s>0){const c=t.getSource(E);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),t.removeLayer(E),e({internalGridDisplay:void 0})}else if(r&&r>0){let c=t.getSource(E);const f=c===void 0;if(f&&(t.addSource(E,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=t.getSource(E)),c!==void 0){const u=[];for(let y=-170;y<=180;y+=r)u.push({type:"Feature",properties:{label:`Lon: ${y<0?y+360:y}`},geometry:{type:"LineString",coordinates:[[y,-90],[y,90]]}});for(let y=-90;y<=90;y+=r)u.push({type:"Feature",properties:{label:`Lat: ${y}`},geometry:{type:"LineString",coordinates:[[180,y],[-180,y]]}});c.setData({type:"FeatureCollection",features:u})}t.addLayer({id:E,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${E}:click`,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),f&&(t.on("mouseenter",`${E}:click`,u=>{if(!u.features)return;const y=u.features[0];y.geometry.type==="LineString"&&y.properties&&typeof y.properties.label=="string"&&a.setLngLat(u.lngLat).setHTML(`${y.properties.label}`).addTo(t)}),t.on("mouseleave",`${E}:click`,()=>{a.remove()}))}e({internalGridDisplay:r})}}function nn(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:i,internalSelections:r},{lineSources:c,selections:f}){if(t&&i&&a!==c)if(console.log("Setting lines in map!"),a){for(const o of a){const g=t.getSource(`line:${o.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${o.name}`),t.removeLayer(`layer:line:${o.name}:click`)}e({internalLineSources:void 0})}else{for(const o of c){let g=t.getSource(`line:${o.name}`);const N=g===void 0;N&&(t.addSource(`line:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`line:${o.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:o.lines.map(h=>{var p;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:(p=f[o.name])==null?void 0:p.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),t.addLayer({id:`layer:line:${o.name}`,type:"line",source:`line:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],o.selectedColor,o.color],"line-width":["case",["get","selected"],o.selectedWidth,o.width]}}),t.addLayer({id:`layer:line:${o.name}:click`,type:"line",source:`line:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":o.width*10}}),N&&(t.on("mouseenter",`layer:line:${o.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="LineString"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const w=[(p.geometry.coordinates[0][0]+p.geometry.coordinates[1][0])/2,(p.geometry.coordinates[0][1]+p.geometry.coordinates[1][1])/2],{description:_}=p.properties;for(;Math.abs(h.lngLat.lng-w[0])>180;)w[0]+=h.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:line:${o.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${o.name}:click`,h=>{let p;if(n.state.internalLineSources)for(const _ of n.state.internalLineSources)p=_.click;if(!h.features||!p)return;const w=h.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;p(_)}}))}e({internalLineSources:c})}const u=m({},r);let y=!1;for(const o of Object.keys(f))if(f[o]!==r[o]){for(const g of c)if(g.name===o){y=!0,u[o]=f[o];const N=t==null?void 0:t.getSource(`line:${g.name}`);if(N){const h=f[o];N.setData({type:"FeatureCollection",features:g.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:h==null?void 0:h.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))})}}}y&&e({internalSelections:u})}function sn(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:i,internalSelections:r},{pointSources:c,selections:f}){if(!t||!i)return;if(a!==c)if(console.log("Setting points in map!"),a){for(const o of a){const g=t.getSource(`point:${o.name}`);g!==void 0&&g.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${o.name}`)}e({internalPointSources:void 0})}else{for(const o of c){let g=t.getSource(`point:${o.name}`);const N=g===void 0;N&&(t.addSource(`point:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g=t.getSource(`point:${o.name}`)),g!==void 0&&g.setData({type:"FeatureCollection",features:o.points.map(h=>{var p;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:!((p=f[o.name])==null?void 0:p.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}})}),t.addLayer({id:`layer:point:${o.name}`,type:"circle",source:`point:${o.name}`,paint:{"circle-color":["case",["get","selected"],o.color,o.selectedColor],"circle-radius":o.radius}}),N&&(t.on("mouseenter",`layer:point:${o.name}`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const w=[...p.geometry.coordinates],{description:_}=p.properties;for(;Math.abs(h.lngLat.lng-w[0])>180;)w[0]+=h.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:point:${o.name}`,()=>{s.remove()}),t.on("click",`layer:point:${o.name}`,h=>{let p;if(n.state.internalPointSources)for(const _ of n.state.internalPointSources)p=_.click;if(!h.features||!p)return;const w=h.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:_}=w.properties;p(_)}}))}e({internalPointSources:c})}const u=m({},r);let y=!1;for(const o of Object.keys(f))if(f[o]!==r[o]){for(const g of c)if(g.name===o){y=!0,u[o]=f[o];const N=t.getSource(`point:${g.name}`);if(N){const h=f[o];N.setData({type:"FeatureCollection",features:g.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:!(h==null?void 0:h.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))})}}}y&&e({internalSelections:u})}Pe.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class an extends jt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:k.exports.createRef(),popup:new se.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Pe.accessToken&&t){const s=new se.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new se.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:i}=this.props;i(oe([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:i}=this.props;i&&i(oe([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:i}=this.state;if(!i||!(i==null?void 0:i.select))return;const r=a.map(c=>c&&c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"?c.properties.index:-1).filter(c=>c>-1);i.select(r)}),s.on("draw.update",({features:a,action:i})=>{const{internalDrawnPointSource:r}=this.state;if(!!(r==null?void 0:r.update)&&i==="move"&&a.length>0)for(const c of a)c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"&&r.update(c.properties.index,oe(c.geometry.coordinates))})}}componentDidUpdate(){return tn(this,e=>this.setState(e),this.state,this.props),nn(this,e=>this.setState(e),this.state,this.props),Yt(this,e=>this.setState(e),this.state,this.props),sn(this,e=>this.setState(e),this.state,this.props),en(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return l("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const on={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var gt;const rn=m(m({},on),JSON.parse((gt=window.localStorage.getItem("segmentDisplaySettings"))!=null?gt:"{}"));function ln({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:i,splitSegment:r,setSelectionMode:c}){const f=o=>{e(o),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(o))},y=s.map((o,g)=>({selectedSegment:t[o],index:g})).filter(o=>o.selectedSegment).map(({selectedSegment:o,index:g})=>l(Z,{title:o.name,item:o,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:N=>a(g,N),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>r(g),children:"Split Segment"})},g));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{f(v(m({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:o=>{f(v(m({},n),{color:o.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:o=>{f(v(m({},n),{width:Number.parseFloat(o.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:o=>{f(v(m({},n),{activeColor:o.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:o=>{f(v(m({},n),{activeWidth:Number.parseFloat(o.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Segment"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Select Segment Starting Point",callback:o=>{c({mode:"mapClick",label:"Select Segment End point",callback:g=>{i(o,g),c("normal")}})}})},children:"New Segment"})]}),y]})}const ze=()=>It(),Y=Rt;function cn({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const i=ze(),[r,c]=Y(f=>[f.main.past.length>0,f.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[l("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?l("button",{type:"button",onClick:()=>{i(Ae.ActionCreators.undo())},"data-testid":"undo-button",disabled:!r,children:"Undo"}):l(O,{}),n?l("button",{type:"button",onClick:()=>{i(Ae.ActionCreators.redo())},disabled:!c,"data-testid":"undo-button",children:"Redo"}):l(O,{}),n?b("span",{children:["Working in ",n.name]}):l("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?l("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):l(O,{})]})]})}const dn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var yt;const un=JSON.parse((yt=window.localStorage.getItem("velocityDisplaySettings"))!=null?yt:"false")||dn;function fn({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:i}){const r=u=>{e(u),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(u))},f=t.map((u,y)=>({selectedVelocity:s[u],index:y})).filter(u=>u.selectedVelocity).map(({selectedVelocity:u,index:y})=>l(Z,{title:u.name,item:u,deletable:!0,setItem:o=>a(y,o),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}},y));return b(O,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{r(v(m({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:u=>{r(v(m({},n),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Selected Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:u=>{r(v(m({},n),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Scale"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:u=>{r(v(m({},n),{scale:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Width"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:u=>{r(v(m({},n),{width:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Arrow Head Size"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:u=>{r(v(m({},n),{arrowHead:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Add New Velocity"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Velocity"})]}),f]})}const mn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var xt;const pn=m(m({},mn),JSON.parse((xt=window.localStorage.getItem("vertexDisplaySettings"))!=null?xt:"{}"));function hn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:i,mergeVertices:r,bridgeVertices:c,extrudeVertex:f}){const u=g=>{e(g),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(g))},o=s.map((g,N)=>({selectedVertex:t[g],index:N})).filter(g=>g.selectedVertex).map(({selectedVertex:g,index:N})=>l(Z,{title:"Selected Vertex",item:g,ignoreFields:[],deletable:!1,setItem:h=>a(N,m(m({},g),h)),fieldDefinitions:{},controls:b(O,{children:[l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{r(N,h[0]),i("normal")}})},children:"Merge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{c(N,h[0]),i("normal")}})},children:"Bridge"}),l("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{f(N,h),i("normal")}})},children:"Extrude"})]})},N));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Display"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{u(v(m({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.color,onChange:g=>{u(v(m({},n),{color:g.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:g=>{u(v(m({},n),{radius:Number.parseFloat(g.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Color"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:g=>{u(v(m({},n),{activeColor:g.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[l("span",{className:"text-l font-bold",children:"Active Radius"}),l("span",{className:"w-2/5 flex-shrink-0",children:l("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:g=>{u(v(m({},n),{activeRadius:Number.parseFloat(g.target.value)}))}})})]}),o]})}const Je=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ge={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function gn(n){return n?m(m({},Ge),n):m({},Ge)}function yn(n,{data:e}){return[...n,gn(e)]}function xn(n,e){const t=[...n];return t.splice(e,1),t}function vn(n,e){const t=[...n],s=m(m({},t[e.index]),e.data);return t[e.index]=s,t}function bn(n,e){return e}function wn(n,{index:e,position:t}){const s=[...n],a=m({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const _n=[],Ue=V("createBlock"),qe=V("editBlock"),Ke=V("deleteBlock"),ie=V("loadNewBlockData"),Qe=V("moveBlock"),kn=ae(_n,n=>{n.addCase(Ue,(e,t)=>yn(e,t.payload)).addCase(qe,(e,t)=>vn(e,t.payload)).addCase(Ke,(e,t)=>xn(e,t.payload)).addCase(ie,(e,t)=>bn(e,t.payload)).addCase(Qe,(e,t)=>wn(e,t.payload))}),Xe=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],q={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Nn(n,{a:e,b:t}){const s=v(m({},q),{start:e,end:t}),a=[...n.segments,s];return v(m({},n),{segments:a})}function Sn(n,e){const t=m({},n.vertecies),s=m({},n.vertexDictionary),{lastIndex:a}=n,[i,r]=A(e.start,s,t,a),[c,f]=A(e.end,s,t,r),u=v(m({},q),{start:i,end:c}),y=[...n.segments,u];return{vertecies:t,vertexDictionary:s,segments:y,lastIndex:f}}function Cn(n,e){const t=[...n.segments],s=t.splice(e.index,1)[0];return We(We(v(m({},n),{segments:t}),s.start),s.end)}function Dn(n,e){const t=[...n.segments],s=m(m({},t[e.index]),e.data);return t[e.index]=s,v(m({},n),{segments:t})}function $n(n,e){const t=m({},n.vertecies),s=m({},n.vertexDictionary),[a,i]=A(e.targetPoint,s,t,n.lastIndex),r=v(m({},q),{start:e.index,end:a}),c=[...n.segments,r];return{vertecies:t,vertexDictionary:s,segments:c,lastIndex:i}}function Fn(n,e){return e}function Vn(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(f=>{let u=f;return u.start===t&&(u=v(m({},u),{start:e})),u.end===t&&(u=v(m({},u),{end:e})),u}).filter(f=>f.start!==f.end),a=n.vertecies[t],i=`${Math.floor(a.lon*M)},${Math.floor(a.lat*M)}`,r=m({},n.vertecies);delete r[t];const c=m({},n.vertexDictionary);return delete c[i],v(m({},n),{vertecies:r,vertexDictionary:c,segments:s})}function Ln(n,{index:e,vertex:t}){const s=m({},n.vertecies),a=m({},n.vertexDictionary),i=[...n.segments],r=s[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,f=`${Math.floor(r.lon*M)},${Math.floor(r.lat*M)}`;if(delete a[f],c in a){const u=a[c];for(const y of i)y.start===u&&(y.start=e),y.end===u&&(y.end=e);delete s[u]}return s[e]=t,v(m({},n),{segments:i,vertecies:s,vertexDictionary:a})}function Mn(n,e){const t=n.segments[e],s=n.vertecies[t.start],a=n.vertecies[t.end],i={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},r=m({},n.vertecies),c=m({},n.vertexDictionary),[f,u]=A(i,c,r,n.lastIndex),y=v(m({},t),{end:f,name:`${t.name}_a`}),o=v(m({},t),{start:f,name:`${t.name}_b`}),g=[...n.segments];return g[e]=y,g.push(o),{vertecies:r,vertexDictionary:c,segments:g,lastIndex:u}}const jn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},Ze=V("bridgeVertices"),Ye=V("createSegmet"),et=V("deleteSegment"),tt=V("editSegmentData"),nt=V("extrudeSegment"),re=V("loadNewSegmentData"),st=V("mergeVertices"),le=V("moveVertex"),at=V("splitSegment"),In=ae(jn,n=>{n.addCase(Ze,(e,t)=>Nn(e,t.payload)).addCase(Ye,(e,t)=>Sn(e,t.payload)).addCase(et,(e,t)=>Cn(e,t.payload)).addCase(tt,(e,t)=>Dn(e,t.payload)).addCase(nt,(e,t)=>$n(e,t.payload)).addCase(re,(e,t)=>Fn(e,t.payload)).addCase(st,(e,t)=>Vn(e,t.payload)).addCase(le,(e,t)=>Ln(e,t.payload)).addCase(at,(e,t)=>Mn(e,t.payload))}),ot=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Rn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Bn(n){return m(m({},Rn),n)}function On(n,{data:e}){return[...n,Bn(e)]}function En(n,e){const t=[...n];return t.splice(e,1),t}function Pn(n,e){const t=[...n],s=m(m({},t[e.index]),e.data);return t[e.index]=s,t}function An(n,e){return e}function Tn(n,{index:e,position:t}){const s=[...n],a=m(m({},s[e]),t);return s[e]=a,s}const Hn=[],it=V("createVelocity"),rt=V("editVelocity"),lt=V("deleteVelocity"),ce=V("loadNewVelocityData"),ct=V("moveVelocity"),Wn=ae(Hn,n=>{n.addCase(it,(e,t)=>On(e,t.payload)).addCase(rt,(e,t)=>Pn(e,t.payload)).addCase(lt,(e,t)=>En(e,t.payload)).addCase(ce,(e,t)=>An(e,t.payload)).addCase(ct,(e,t)=>Tn(e,t.payload))});function de(n){const e=n.split(/\n/g),t=e[0].split(","),s=e.slice(1),a=[];for(const i of s)if(i.trim()!==""){const r=i.split(/\s*,\s*/),c={};for(let f=0;f<t.length;f+=1){let u=r[f];const y=t[f],o=Number.parseFloat(u);u=Number.isNaN(o)?u:o,typeof u=="string"&&u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1)),c[y]=u}a.push(c)}return a}function ue(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(i=>i in a?typeof a[i]=="string"&&/\s/.test(`${a[i]}`)?`"${a[i]}"`:`${a[i]}`:"").join(","))}return t.join(`
`)}class fe{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=de(e).map(a=>{const i={};for(const r of Je)i[r]=a[r]||(r==="name"?"":0);return i});this.data=s}async save(){var t;const e=ue((t=this.data)!=null?t:[],Je);await this.handle.setContents(e)}clone(){return new fe(this.handle)}}const zn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Jn(n){return m(m({},zn),n)}class me{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Jn(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new me(this.handle)}}class pe{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=de(e).map(f=>{const u={};for(const y of Xe)u[y]=f[y]||(y==="name"?"":0);return u}),a={},i={},r=[];let c=0;for(const f of s){const[u,y]=A({lon:f.lon1,lat:f.lat1},a,i,c),[o,g]=A({lon:f.lon2,lat:f.lat2},a,i,y),N=v(m({},f),{start:u,end:o});c=g,r.push(N)}this.data={vertecies:i,segments:r,vertexDictionary:a,lastIndex:c}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(i=>{const r=s[i.start],c=s[i.end];return v(m({},i),{lon1:r.lon,lat1:r.lat,lon2:c.lon,lat2:c.lat})})}const t=ue(e,Xe);await this.handle.setContents(t)}clone(){return new pe(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,i=m({},this.data.vertecies);delete i[e];const r=m({},this.data.vertexDictionary);delete r[a];const c=this.clone();return c.data=v(m({},this.data),{vertecies:i,vertexDictionary:r}),c}}return this}mergeVertices(e,t){if(this.data){for(const f of this.data.segments)f.start===t&&(f.start=e),f.end===t&&(f.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,i=m({},this.data.vertecies);delete i[t];const r=m({},this.data.vertexDictionary);delete r[a];const c=this.clone();return c.data=v(m({},this.data),{vertecies:i,vertexDictionary:r}),c}return this}moveVertex(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),i=[...this.data.segments],r=s[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,f=`${Math.floor(r.lon*M)},${Math.floor(r.lat*M)}`;if(delete a[f],c in a){const y=a[c];for(const o of i)o.start===y&&(o.start=e),o.end===y&&(o.end=e);delete s[y]}s[e]=t;const u=this.clone();return u.data=v(m({},this.data),{segments:i,vertecies:s,vertexDictionary:a}),u}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],i={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[r,c]=A(i,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),f=v(m({},t),{end:r,name:`${t.name}_a`}),u=v(m({},t),{start:r,name:`${t.name}_b`}),y=[...this.data.segments];y[e]=f,y.push(u);const o=this.clone();return o.data=v(m({},this.data),{segments:y,lastIndex:c}),o}return this}bridgeVertices(e,t){if(this.data){const s=v(m({},q),{start:e,end:t}),a=[...this.data.segments,s],i=this.clone();return i.data=v(m({},this.data),{segments:a}),i}return this}extrudeSegment(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[i,r]=A(t,a,s,this.data.lastIndex),c=v(m({},q),{start:e,end:i}),f=[...this.data.segments,c],u=this.clone();return u.data={vertecies:s,vertexDictionary:a,segments:f,lastIndex:r},u}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=v(m({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[i,r]=A(e,a,s,this.data.lastIndex),[c,f]=A(t,a,s,r),u=v(m({},q),{start:i,end:c}),y=[...this.data.segments,u],o=this.clone();return o.data={vertecies:s,vertexDictionary:a,segments:y,lastIndex:f},o}return this}}class he{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=de(e).map(a=>{const i={};for(const r of ot)i[r]=a[r]||(r==="name"?"":0);return i});this.data=s}async save(){var t;const e=ue((t=this.data)!=null?t:[],ot);await this.handle.setContents(e)}clone(){return new he(this.handle)}}async function dt(n){const e=new pe(n);return await e.initialize(),e}async function ut(n){const e=new fe(n);return await e.initialize(),e}async function ft(n){const e=new he(n);return await e.initialize(),e}async function Gn(n,e,t){const s=new me(e);if(await s.initialize(),s.data){const a=await dt(await n.getFile(s.data.segment_file_name)),i=await ut(await n.getFile(s.data.block_file_name)),r=await ft(await n.getFile(s.data.station_file_name)),c=m({},t);return"command"in c&&(c.command=v(m({},c.command),{currentFilePath:e.name})),"segment"in c&&(c.segment=v(m({},c.segment),{currentFilePath:s.data.segment_file_name})),"block"in c&&(c.block=v(m({},c.block),{currentFilePath:s.data.block_file_name})),"velocities"in c&&(c.velocities=v(m({},c.velocities),{currentFilePath:s.data.station_file_name})),{openableFiles:c,commands:s,segments:a,blocks:i,velocities:r}}throw new Error("Can't open command file")}class Un{constructor(e){F(this,"name");F(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class ge{constructor(e){F(this,"name");F(this,"handle");F(this,"fileList");F(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Un(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new ge(t);return await s.initialize(),s}}const qn=async()=>{const n=await window.showDirectoryPicker(),e=new ge(n);return await e.initialize(),e};class Kn{constructor(e,t){F(this,"name");F(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ye{constructor(e,t){F(this,"name");F(this,"parent");F(this,"fileList");F(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Kn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ye(e,this.parent[this.name])}}const Qn=async n=>new ye("root",n);let mt=async()=>{var e;return Qn((e=window.FakeDirectory)!=null?e:{})};function Xn(n){mt=n}async function Zn(){return mt()}window.location.search.includes("fake-dir")||Xn(qn);var P;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(P||(P={}));const pt={Block:P.Block,Vertex:P.Vertex,Velocity:P.Velocity},Yn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function es(){var je,Ie,Re;const n=ze(),[e,t]=k.exports.useState(),[s,a]=k.exports.useState(""),[i,r]=k.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[c,f]=k.exports.useState(),[u,y]=k.exports.useState(),[o,g]=k.exports.useState(),[N,h]=k.exports.useState(),p=Y(d=>d.main.present.segment),w=Y(d=>d.main.present.block),_=Y(d=>d.main.present.velocity),[S,J]=k.exports.useState(un),[D,xe]=k.exports.useState(Ut),[B,ve]=k.exports.useState(rn),[$,be]=k.exports.useState(pn),[I,W]=k.exports.useState("normal"),[z,vt]=k.exports.useState(P.Vertex),[we,_e]=k.exports.useState([]),[ke,Ne]=k.exports.useState([]),[Se,Ce]=k.exports.useState([]),[De,$e]=k.exports.useState([]),[L,os]=k.exports.useState({select:(d,x)=>{_e(d==="block"?x:[]),Ne(d==="segment"?x:[]),Ce(d==="velocities"?x:[]),$e(d==="vertex"?x:[]),a(d)}}),[bt,wt]=k.exports.useState([]),[_t,Fe]=k.exports.useState([]),[kt,Ve]=k.exports.useState([]),[Nt,ee]=k.exports.useState({color:$.color,selectedColor:$.activeColor,radius:$.radius,selectedRadius:$.activeRadius,points:[]}),[Le,St]=k.exports.useState({lon:0,lat:0}),[te,Ct]=k.exports.useState(!1);k.exports.useEffect(()=>{I==="normal"?L.select=(d,x)=>{_e(d==="block"?x:[]),Ne(d==="segment"?x:[]),Ce(d==="velocities"?x:[]),$e(d==="vertex"?x:[]),a(d)}:I.mode==="override"?L.select=(d,x)=>{d===I.type&&I.callback(x)}:L.select=()=>{}},[I,L]),k.exports.useEffect(()=>{const d=[];z!==P.Block&&!D.hide&&d.push({name:"blocks",color:D.color,selectedColor:D.selectedColor,radius:D.radius,points:w.map((x,C)=>({longitude:x.interior_lon,latitude:x.interior_lat,name:x.name,description:"",index:C})),click:x=>{L.select("block",[x])}}),z!==P.Vertex&&!$.hide&&d.push({name:"vertices",color:$.color,selectedColor:$.activeColor,radius:$.radius,click:x=>{L.select("vertex",[x])},points:Object.keys(p.vertecies).map(x=>{const C=Number.parseInt(x,10),R=p.vertecies[C];return R?{longitude:R.lon,latitude:R.lat,index:C,name:"",description:""}:!1}).filter(x=>!!x)}),wt(d)},[D,w,B,L,z,$.hide,$.color,$.activeColor,$.radius,p.vertecies]),k.exports.useEffect(()=>{B.hide?Ve([]):Ve([{name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:p.segments.map((d,x)=>{var Be,Oe;const C=(Be=p.vertecies[d.start])!=null?Be:Te,R=(Oe=p.vertecies[d.end])!=null?Oe:Te,[[K,Q],[X,j]]=Zt(C,R);return{startLongitude:K,startLatitude:Q,endLongitude:X,endLatitude:j,name:d.name,description:`${C.lon},${C.lat} to ${R.lon},${R.lat}`,index:x}}),click:d=>{L.select("segment",[d])}}])},[p,B,L]),k.exports.useEffect(()=>{switch(z){case P.Vertex:{ee({color:$.color,radius:$.radius,selectedColor:$.activeColor,selectedRadius:$.activeRadius,points:$.hide?[]:Object.keys(p.vertecies).map(d=>{const x=Number.parseInt(d,10),C=p.vertecies[x];return C?{longitude:C.lon,latitude:C.lat,index:x}:!1}).filter(d=>!!d),update:(d,x)=>{n(le({index:d,vertex:x}))},select:d=>{L.select("vertex",d)}});break}case P.Block:{ee({color:D.color,radius:D.radius,selectedColor:D.selectedColor,selectedRadius:D.radius,points:D.hide?[]:w.map((d,x)=>({longitude:d.interior_lon,latitude:d.interior_lat,name:d.name,description:"",index:x})),update:(d,x)=>{n(Qe({index:d,position:x}))},select:d=>{L.select("block",d)}});break}case P.Velocity:{ee({color:S.color,radius:S.width,selectedColor:S.selectedColor,selectedRadius:S.width,points:S.hide?[]:_.map((d,x)=>({longitude:d.lon,latitude:d.lat,name:d.name,description:"",index:x})),update:(d,x)=>{n(ct({index:d,position:x}))},select:d=>{L.select("velocities",d)}});break}}},[$,L,p.vertecies,n,z,D.color,D.radius,D.selectedColor,D.hide,w,S.color,S.width,S.selectedColor,S.hide,_]),k.exports.useEffect(()=>{S.hide?Fe([]):Fe([{name:"velocities",color:S.color,selectedColor:S.selectedColor,scale:S.scale,arrowHeadScale:S.arrowHead,width:S.width,arrows:_.map((d,x)=>{const C=Math.sqrt(d.east_vel*d.east_vel+d.north_vel*d.north_vel);return{longitude:d.lon,latitude:d.lat,direction:[d.east_vel/C,d.north_vel/C],scale:C,name:d.name,description:`north: ${d.north_vel}, east: ${d.east_vel}`,index:x}}),click:d=>{L.select("velocities",[d])}}])},[L,S,_]);let G=l("span",{});switch(s){case"files":G=e?l(Kt,{folder:e,files:i,setFile:async(d,x,C)=>{if(C){let R=m({},i);switch(R[d]=v(m({},R[d]),{currentFilePath:x}),d){case"segment":const K=await dt(C);y(K),K.data&&n(re(K.data));break;case"block":const Q=await ut(C);g(Q),Q.data&&n(ie(Q.data));break;case"velocity":const X=await ft(C);h(X),X.data&&n(ce(X.data));break;case"command":const j=await Gn(e,C,i);f(j.commands),y(j.segments),j.segments.data&&n(re(j.segments.data)),g(j.blocks),j.blocks.data&&n(ie(j.blocks.data)),h(j.velocities),j.velocities.data&&n(ce(j.velocities.data)),R=j.openableFiles;break}r(R)}}}):l("span",{});break;case"velocities":G=l(fn,{settings:S,setSettings:J,selected:Se,velocitys:_,setVelocityData:(d,x)=>{n(x?rt({index:d,data:x}):lt(d))},addNewVelocity:()=>{W({label:"Click to place velocity estimate",mode:"mapClick",callback:d=>{W("normal");const x=_.length;n(it({data:{lat:d.lat,lon:d.lon}})),L.select("velocity",[x])}})}});break;case"block":G=l(qt,{settings:D,setSettings:xe,selected:we,blocks:w,addNewBlock:()=>{W({label:"Click to place new block",mode:"mapClick",callback:d=>{const x=w.length;n(Ue({data:{name:"New Block",interior_lon:d.lon,interior_lat:d.lat}})),L.select("block",[x]),W("normal")}})},setBlockData:(d,x)=>{n(x?qe({index:d,data:x}):Ke(d))}});break;case"segment":G=l(ln,{settings:B,setSettings:ve,segments:(je=p.segments)!=null?je:[],selected:ke,setSelectionMode:d=>W(d),addNewSegment:(d,x)=>{const C=p.segments.length;n(Ye({start:d,end:x})),L.select("segment",[C])},setSegmentData:(d,x)=>{n(x?tt({index:d,data:x}):et({index:d}))},splitSegment:d=>{n(at(d))}});break;case"vertex":G=l(hn,{settings:$,setSettings:be,vertices:(Ie=p.vertecies)!=null?Ie:{},selected:De,setVertexData:(d,x)=>{x&&n(le({index:d,vertex:x}))},setSelectionMode:d=>W(d),mergeVertices:(d,x)=>{n(st({a:d,b:x}))},bridgeVertices:(d,x)=>{n(Ze({a:d,b:x}))},extrudeVertex:(d,x)=>{n(nt({index:d,targetPoint:x}))}});break}const Me={Block:{state:D.hide,change:()=>{xe(v(m({},D),{hide:!D.hide}))}},Vertex:{state:$.hide,change:()=>{be(v(m({},$),{hide:!$.hide}))}},Velocity:{state:S.hide,change:()=>{J(v(m({},S),{hide:!S.hide}))}},Sement:{state:B.hide,change:()=>{ve(v(m({},B),{hide:!B.hide}))}},Grid:{state:!te,change:()=>{Ct(!te)}}};return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:d=>{d.key==="Escape"&&W("normal")},children:[l(cn,{filesOpen:((Re=c!=null?c:u)!=null?Re:o)!==void 0,saveFiles:async()=>{c&&await c.save(),u&&(u.data=p,await u.save()),o&&(o.data=w,await o.save()),N&&(N.data=_,await N.save())},folder:e,openFolder:async()=>{const d=await Zn();t(d),a("files")}}),I!=="normal"?l("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[l("span",{className:"text-lg font-semibold",children:I.label}),I.subtitle?l("span",{className:"text-md font-thin text-gray-500",children:I.subtitle}):l(O,{}),l("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):l(O,{}),b("div",{className:"absolute bottom-0 left-2 flex flex-col bg-white rounded-t p-2 gap-5 shadow-sm z-50",children:[l("div",{className:"flex flex-row items-center justify-start gap-5",children:b("span",{className:"p-1 text-sm text-center",children:["Hold ",l("span",{className:"font-bold",children:"Shift"})," to box select"," ",l("span",{className:"font-bold",children:z})]})}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),b("span",{children:[Math.floor(Le.lon*1e3)/1e3,","," ",Math.floor(Le.lon*1e3)/1e3]})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[l("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(pt).map(d=>{const x=pt[d];return l("button",{type:"button",className:`${z===x?"bg-gray-200":"bg-white"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{vt(x)},children:d},d)})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Me).map(d=>{const x=Me[d];return l("button",{type:"button",className:`${x.state?"bg-white":"bg-gray-200"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{x.change()},children:d},d)})]})]}),l(an,{pointSources:bt,arrowSources:_t,lineSources:kt,drawnPointSource:Nt,selections:{segments:ke,blocks:we,velocities:Se,vertices:De},displayGrid:te?10:-1,click:d=>{typeof I!="string"&&I.mode==="mapClick"&&I.callback(d)},mouseMove:d=>{St(d)}}),l(Qt,{view:G,buttons:e?Yn:void 0,active:s,setActive:d=>a(d)})]})}const ts=Bt({reducer:{main:Ot(Et({segment:In,block:kn,velocity:Wn}))}});function ns(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:i}=n;let r;const c=async(f=!0)=>{};return"serviceWorker"in navigator&&(r=new Pt("./sw.js",{scope:"./"}),r.addEventListener("activated",f=>{f.isUpdate?window.location.reload():s==null||s()}),r.register({immediate:e}).then(f=>{a==null||a(f)}).catch(f=>{i==null||i(f)})),c}ns();const ss=1,as=new At({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ss}}});Tt.render(l(k.exports.StrictMode,{children:l(Ht,{client:as,children:l(Wt,{store:ts,children:l(es,{})})})}),document.querySelector("#root"));
