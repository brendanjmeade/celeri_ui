var Jt=Object.defineProperty,Kt=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var Xe=Object.getOwnPropertySymbols;var qt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var pe=(n,e,t)=>e in n?Jt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))qt.call(e,t)&&pe(n,t,e[t]);if(Xe)for(var t of Xe(e))Qt.call(e,t)&&pe(n,t,e[t]);return n},v=(n,e)=>Kt(n,Ut(e));var k=(n,e,t)=>(pe(n,typeof e!="symbol"?e+"":e,t),t);import{j as o,a as x,F as R,r as S,M as Xt,m as Ze,R as Zt,b as ge,u as Yt,c as en,l as Ye,d as re,e as F,f as tn,g as nn,h as sn,v as an,Q as on,i as rn,k as ln,P as cn}from"./vendor.6cf141b2.js";const dn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}};dn();function un({value:n,fieldDefinition:e,setField:t}){const[s,a]=S.exports.useState(-1),[i,r]=S.exports.useState(n);S.exports.useEffect(()=>{r(n)},[n]);let l=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof n=="number"?"number":"text",value:i,onChange:h=>{const m=typeof n=="number"?Number.parseFloat(h.target.value):h.target.value;r(m),s>-1&&clearTimeout(s),a(setTimeout(()=>t(m),1e3))}});return e.type==="select"&&(l=x("select",{"data-testid":`input-editor-${e.name}`,className:" w-full",value:i,onChange:h=>{t(h.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(h=>o("option",{value:h.name,"data-testid":`input-editor-${e.name}-${h.name}`,children:h.name},h.name))]})),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(R,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function se({title:n,items:e,setItems:t,fieldDefinitions:s,ignoreFields:a,deletable:i,controls:r}){const l=e[0],h=Object.keys(l).map((m,d)=>{if(a==null?void 0:a.includes(m))return{element:o("span",{style:{display:"hidden"}},m),order:d+1e4};let c=l[m];for(const w of e)if(w[m]!==c){c="-";break}const b=m in s&&s[m];return b?{element:o(un,{value:c,fieldDefinition:b,setField:w=>t({[m]:w})},m),order:b.order}:{element:x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${m}`,className:"text-l font-bold",children:m}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${m}`,className:"bg-gray-800 w-full",type:typeof c=="number"?"number":"text",value:c,onChange:w=>{t({[m]:typeof c=="number"?Number.parseFloat(w.target.value):w.target.value})}})})]},m),order:d+1e3}}).sort((m,d)=>m.order-d.order).map(m=>m.element);return x("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),x("span",{className:"flex flex-row justify-end gap-2 grow",children:[r,i?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):o(R,{})]})]}),h]})}se.defaultProps={ignoreFields:[],controls:o(R,{})};const fn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var Vt;const mn=JSON.parse((Vt=window.localStorage.getItem("blockDisplaySettings"))!=null?Vt:"false")||fn;function hn({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:i,save:r}){const l=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},h=t.map(d=>s[d]).filter(d=>d),m=h.length>0?o(se,{title:h.length===1?h[0].name:"Edit Selected Blocks",items:h,deletable:!0,setItems:d=>a(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(R,{});return x(R,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{l(v(f({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:r,children:"Save Blocks"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:d=>{l(v(f({},n),{color:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:d=>{l(v(f({},n),{selectedColor:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:d=>{l(v(f({},n),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Block"})]}),m]})}function pn({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const i=e[a],r=Array.isArray(i.currentFilePath)?[...i.currentFilePath]:[i.currentFilePath];return i.allowMultiple&&r.push(""),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:i.name}),o("span",{className:"text-sm","data-testid":`file-${a}-description`,children:i.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:r.map((l,h)=>x("select",{"data-testid":`file-${a}-select-${h}`,className:"bg-gray-800 flex-grow m-1",value:l,onChange:async m=>{const d=m.currentTarget.value;try{const c=await n.getFile(d);t(h,a,c.name,c)}catch{t(h,a,"")}},children:[o("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(m=>m.endsWith(i.extension)).map(m=>o("option",{value:m,"data-testid":`file-${a}-select-${m}`,children:m},m))]},h))})]},a)});return o("div",{className:"flex flex-col gap-2",children:s})}const gn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Mt;const yn=f(f({},gn),JSON.parse((Mt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Mt:"{}"));function bn({settings:n,setSettings:e,collections:t,setCollectionVertexKeys:s}){const a=r=>{e(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))},i=Object.keys(t).map(r=>{const{startLat:l,startLon:h,endLat:m,endLon:d,segments:c}=t[r],b=Object.keys(c[0]).map((w,g)=>({name:w,value:g}));return o(se,{title:r,items:[{startLat:l,startLon:h,endLat:m,endLon:d}],deletable:!1,setItems:w=>{s(f({collection:r,startLat:l,startLon:h,endLat:m,endLon:d},w))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:b},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:b},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:b},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:b}}},r)});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{a(v(f({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:r=>{a(v(f({},n),{color:r.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:r=>{a(v(f({},n),{width:Number.parseFloat(r.target.value)}))}})})]}),i]})}function vn({view:n,buttons:e,active:t,setActive:s}){if(!e)return o("span",{});const a=[];for(const i of Object.keys(e)){const r=e[i],l=i===t;a.push(o("button",{type:"button","data-testid":`tab-${i}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>s(l?"":i),children:r},i))}return x("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow r p-2 shadow-sm overflow-y-auto",children:n}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:a})]})}const et={lon:0,lat:0},xn=180,ae=360;function tt(n){let{lon:e,lat:t}=n;for(;e<0;)e+=ae;for(;e>ae;)e-=ae;return[e,t]}function ye([n,e]){return{lon:n<0?n+ae:n,lat:e}}function be(n,e){const t=tt(n),s=tt(e),a=[s[0],s[1]];return s[0]-t[0]>=xn?a[0]-=ae:a[0]+=ae,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const I=1e6;function q(n,e,t,s){const a=`${Math.floor(n.lon*I)},${Math.floor(n.lat*I)}`;if(a in e)return[e[a],s];const i=s;return t[i]=n,e[a]=i,[i,s+1]}function nt(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*I)},${Math.floor(s.lat*I)}`,i=f({},n.vertecies);delete i[e];const r=f({},n.vertexDictionary);return delete r[a],v(f({},n),{vertecies:i,vertexDictionary:r})}return n}const X=Math.PI/6,ee=2*Math.PI-X;function wn(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:i,internalSelections:r},{arrowSources:l,selections:h}){if(t&&i&&a!==l)if(console.log("Setting arrows in map!"),a){for(const c of a){const b=t.getSource(`arrow:${c.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${c.name}`),t.removeLayer(`layer:arrow:${c.name}:click`)}e({internalArrowSources:void 0})}else{for(const c of l){let b=t.getSource(`arrow:${c.name}`);const w=b===void 0;w&&(t.addSource(`arrow:${c.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`arrow:${c.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:c.arrows.map(g=>{var L;const p=g.scale*c.scale,_=c.scale*c.arrowHeadScale,N=[g.longitude+g.direction[0]*p,g.latitude+g.direction[1]*p],E=[N[0]+(Math.cos(X)*-g.direction[0]-Math.sin(X)*-g.direction[1])*_,N[1]+(Math.sin(X)*-g.direction[0]+Math.cos(X)*-g.direction[1])*_],Z=[N[0]+(Math.cos(ee)*-g.direction[0]-Math.sin(ee)*-g.direction[1])*_,N[1]+(Math.sin(ee)*-g.direction[0]+Math.cos(ee)*-g.direction[1])*_];return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:(L=h[c.name])==null?void 0:L.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],N,E,N,Z]}}})}),t.addLayer({id:`layer:arrow:${c.name}`,type:"line",source:`arrow:${c.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],c.selectedColor,c.color],"line-width":c.width}}),t.addLayer({id:`layer:arrow:${c.name}:click`,type:"line",source:`arrow:${c.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),w&&(t.on("mouseenter",`layer:arrow:${c.name}:click`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const _=[...p.geometry.coordinates],{description:N}=p.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:arrow:${c.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${c.name}:click`,g=>{let p;if(n.state.internalArrowSources)for(const N of n.state.internalArrowSources)p=N.click;if(!g.features||!p)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;p(N)}}))}e({internalArrowSources:l})}const m=f({},r);let d=!1;for(const c of Object.keys(h))if(h[c]!==r[c]){for(const b of l)if(b.name===c){d=!0,m[c]=h[c];const w=t==null?void 0:t.getSource(`arrow:${b.name}`);if(w){const g=h[c];w.setData({type:"FeatureCollection",features:b.arrows.map(p=>{const _=p.scale*b.scale,N=b.scale*b.arrowHeadScale,E=[p.longitude+p.direction[0]*_,p.latitude+p.direction[1]*_],Z=[E[0]+(Math.cos(X)*-p.direction[0]-Math.sin(X)*-p.direction[1])*N,E[1]+(Math.sin(X)*-p.direction[0]+Math.cos(X)*-p.direction[1])*N],L=[E[0]+(Math.cos(ee)*-p.direction[0]-Math.sin(ee)*-p.direction[1])*N,E[1]+(Math.sin(ee)*-p.direction[0]+Math.cos(ee)*-p.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:g==null?void 0:g.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],E,Z,E,L]}}})})}}}d&&e({internalSelections:m})}function _n(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:i},{drawnPointSource:r}){if(e&&a&&i!==r){console.log("Drawning Points"),n({internalDrawnPointSource:r});let l=t;if((r.selectedColor!==s.selectedColor||r.selectedRadius!==s.selectedRadius||r.color!==s.color||r.radius!==s.radius)&&(n({drawnPointSettings:{color:r.color,radius:r.radius,selectedRadius:r.selectedRadius,selectedColor:r.selectedColor}}),t&&(e.removeControl(t),l=void 0),r?(l=new Xt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":r.selectedRadius,"circle-color":r.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":r.radius,"circle-color":r.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(l),n({draw:l})):l=void 0),l){const h=l.getAll(),m=r.points.length!==h.features.length?void 0:l.getSelected(),d={type:"FeatureCollection",features:r.points.map(c=>({type:"Feature",id:c.index.toString(),properties:{description:"",index:c.index,name:""},geometry:{type:"Point",coordinates:[c.longitude,c.latitude]}}))};if(l.set(d),m&&m.features.length>0&&m.features[0].properties&&typeof m.features[0].properties.index=="number"){const c=m.features[0].id;c&&l.changeMode("simple_select",{featureIds:[c]})}}}}const H="grid";function Nn(n,e,{map:t,internalGridDisplay:s,popup:a,mapLoaded:i},{displayGrid:r}){if(t&&i&&s!==r){if(console.log("Drawing Grid on map!"),s&&s>0){const l=t.getSource(H);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),t.removeLayer(H),e({internalGridDisplay:void 0})}else if(r&&r>0){let l=t.getSource(H);const h=l===void 0;if(h&&(t.addSource(H,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=t.getSource(H)),l!==void 0){const m=[];for(let d=-170;d<=180;d+=r)m.push({type:"Feature",properties:{label:`Lon: ${d<0?d+360:d}`},geometry:{type:"LineString",coordinates:[[d,-90],[d,90]]}});for(let d=-90;d<=90;d+=r)m.push({type:"Feature",properties:{label:`Lat: ${d}`},geometry:{type:"LineString",coordinates:[[180,d],[-180,d]]}});l.setData({type:"FeatureCollection",features:m})}t.addLayer({id:H,type:"line",source:H,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${H}:click`,type:"line",source:H,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),h&&(t.on("mouseenter",`${H}:click`,m=>{if(!m.features)return;const d=m.features[0];d.geometry.type==="LineString"&&d.properties&&typeof d.properties.label=="string"&&a.setLngLat(m.lngLat).setHTML(`${d.properties.label}`).addTo(t)}),t.on("mouseleave",`${H}:click`,()=>{a.remove()}))}e({internalGridDisplay:r})}}function Sn(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:i,internalSelections:r},{lineSources:l,selections:h}){if(t&&i&&a!==l)if(console.log("Setting lines in map!"),a){for(const c of a){const b=t.getSource(`line:${c.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${c.name}`),t.removeLayer(`layer:line:${c.name}:click`)}e({internalLineSources:void 0})}else{for(const c of l){let b=t.getSource(`line:${c.name}`);const w=b===void 0;w&&(t.addSource(`line:${c.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`line:${c.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:c.lines.map(g=>{var p;return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:((p=h[c.name])==null?void 0:p.includes(g.index))||!1},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}})}),t.addLayer({id:`layer:line:${c.name}`,type:"line",source:`line:${c.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],c.selectedColor,c.color],"line-width":["case",["get","selected"],c.selectedWidth,c.width]}}),c.click&&(t.addLayer({id:`layer:line:${c.name}:click`,type:"line",source:`line:${c.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":c.width*10}}),w&&(t.on("mouseenter",`layer:line:${c.name}:click`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="LineString"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const _=[(p.geometry.coordinates[0][0]+p.geometry.coordinates[1][0])/2,(p.geometry.coordinates[0][1]+p.geometry.coordinates[1][1])/2],{description:N}=p.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:line:${c.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${c.name}:click`,g=>{let p;if(n.state.internalLineSources)for(const N of n.state.internalLineSources)N.name===c.name&&(p=N.click);if(!g.features||!p)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;p(N)}})))}e({internalLineSources:l})}const m=f({},r);let d=!1;for(const c of Object.keys(h))if(h[c]!==r[c]){for(const b of l)if(b.name===c){d=!0,m[c]=h[c];const w=t==null?void 0:t.getSource(`line:${b.name}`);if(w){const g=h[c];w.setData({type:"FeatureCollection",features:b.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:g==null?void 0:g.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))})}}}d&&e({internalSelections:m})}function kn(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:i,internalSelections:r},{pointSources:l,selections:h}){if(!t||!i)return;if(a!==l)if(console.log("Setting points in map!"),a){for(const c of a){const b=t.getSource(`point:${c.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${c.name}`)}e({internalPointSources:void 0})}else{for(const c of l){let b=t.getSource(`point:${c.name}`);const w=b===void 0;w&&(t.addSource(`point:${c.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`point:${c.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:c.points.map(g=>{var p;return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:!((p=h[c.name])==null?void 0:p.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}})}),t.addLayer({id:`layer:point:${c.name}`,type:"circle",source:`point:${c.name}`,paint:{"circle-color":["case",["get","selected"],c.color,c.selectedColor],"circle-radius":c.radius}}),w&&(t.on("mouseenter",`layer:point:${c.name}`,g=>{if(!g.features)return;const p=g.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const _=[...p.geometry.coordinates],{description:N}=p.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:point:${c.name}`,()=>{s.remove()}),t.on("click",`layer:point:${c.name}`,g=>{let p;if(n.state.internalPointSources)for(const N of n.state.internalPointSources)p=N.click;if(!g.features||!p)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;p(N)}}))}e({internalPointSources:l})}const m=f({},r);let d=!1;for(const c of Object.keys(h))if(h[c]!==r[c]){for(const b of l)if(b.name===c){d=!0,m[c]=h[c];const w=t.getSource(`point:${b.name}`);if(w){const g=h[c];w.setData({type:"FeatureCollection",features:b.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:!(g==null?void 0:g.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))})}}}d&&e({internalSelections:m})}Ze.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Cn extends Zt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new ge.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Ze.accessToken&&t){const s=new ge.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new ge.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:i}=this.props;i(ye([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:i}=this.props;i&&i(ye([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:i}=this.state;if(!i||!(i==null?void 0:i.select))return;const r=a.map(l=>l&&l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"?l.properties.index:-1).filter(l=>l>-1);i.select(r)}),s.on("draw.update",({features:a,action:i})=>{const{internalDrawnPointSource:r}=this.state;if(!!(r==null?void 0:r.update)&&i==="move"&&a.length>0)for(const l of a)l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"&&r.update(l.properties.index,ye(l.geometry.coordinates))})}}componentDidUpdate(){return Nn(this,e=>this.setState(e),this.state,this.props),Sn(this,e=>this.setState(e),this.state,this.props),wn(this,e=>this.setState(e),this.state,this.props),kn(this,e=>this.setState(e),this.state,this.props),_n(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const Ln={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var jt;const Fn=f(f({},Ln),JSON.parse((jt=window.localStorage.getItem("meshDisplaySettings"))!=null?jt:"{}"));function $n({settings:n,setSettings:e}){const t=s=>{e(s),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(s))};return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(v(f({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:s=>{t(v(f({},n),{color:s.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:s=>{t(v(f({},n),{width:Number.parseFloat(s.target.value)}))}})})]})]})}const Dn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var It;const Vn=f(f({},Dn),JSON.parse((It=window.localStorage.getItem("segmentDisplaySettings"))!=null?It:"{}"));function Mn({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:i,splitSegment:r,setSelectionMode:l,save:h}){const m=b=>{e(b),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(b))},d=s.map(b=>t[b]).filter(b=>b),c=d.length>0?o(se,{title:d.length===1?d[0].name:"Edit Selected Segments",items:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:b=>a(s,b),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>r(s),children:"Split Segment"})}):o(R,{});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{m(v(f({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:h,children:"Save Segments & Vertices"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:b=>{m(v(f({},n),{color:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:b=>{m(v(f({},n),{width:Number.parseFloat(b.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:b=>{m(v(f({},n),{activeColor:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:b=>{m(v(f({},n),{activeWidth:Number.parseFloat(b.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:b=>{l({mode:"mapClick",label:"Select Segment End point",callback:w=>{i(b,w),l("normal")}})}})},children:"New Segment"})]}),c]})}const st=()=>Yt(),oe=en;function jn({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const i=st(),[r,l]=oe(h=>[h.main.past.length>0,h.main.future.length>0]);return x("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),x("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?o("button",{type:"button",onClick:()=>{i(Ye.ActionCreators.undo())},"data-testid":"undo-button",disabled:!r,children:"Undo"}):o(R,{}),n?o("button",{type:"button",onClick:()=>{i(Ye.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):o(R,{}),n?x("span",{children:["Working in ",n.name]}):o("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?o("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):o(R,{})]})]})}const In={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var Ot;const On=JSON.parse((Ot=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ot:"false")||In;function Rn({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:i,save:r}){const l=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},h=t.map(d=>s[d]).filter(d=>d),m=h.length>0?o(se,{title:h.length===1?h[0].name:"Edit Selected Velocities",items:h,deletable:!0,setItems:d=>a(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(R,{});return x(R,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{l(v(f({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:r,children:"Save Velocities"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:d=>{l(v(f({},n),{color:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:d=>{l(v(f({},n),{selectedColor:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:d=>{l(v(f({},n),{scale:Number.parseFloat(d.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:d=>{l(v(f({},n),{width:Number.parseFloat(d.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:d=>{l(v(f({},n),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Velocity"})]}),m]})}const Pn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Rt;const En=f(f({},Pn),JSON.parse((Rt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Rt:"{}"));function Bn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:i,mergeVertices:r,bridgeVertices:l,extrudeVertex:h,save:m}){const d=w=>{e(w),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(w))},b=s.map(w=>({selectedVertex:t[w],index:w})).filter(w=>w.selectedVertex).map(({selectedVertex:w,index:g})=>o(se,{title:"Selected Vertex",items:[w],ignoreFields:[],deletable:!1,setItems:p=>a(g,f(f({},w),p)),fieldDefinitions:{},controls:x(R,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:p=>{r(g,p[0]),i("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:p=>{l(g,p[0]),i("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:p=>{h(g,p),i("normal")}})},children:"Extrude"})]})},g));return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(v(f({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:m,children:"Save Segments & Vertices"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:w=>{d(v(f({},n),{color:w.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:w=>{d(v(f({},n),{radius:Number.parseFloat(w.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:w=>{d(v(f({},n),{activeColor:w.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:w=>{d(v(f({},n),{activeRadius:Number.parseFloat(w.target.value)}))}})})]}),b]})}const at=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],ot={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function An(n){return n?f(f({},ot),n):f({},ot)}function Tn(n,{data:e}){return[...n,An(e)]}function Wn(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function Gn(n,e){const t=[...n];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return t}function zn(n,e){return e}function Hn(n,{index:e,position:t}){const s=[...n],a=f({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const Jn=[],it=F("createBlock"),rt=F("editBlock"),lt=F("deleteBlock"),ve=F("loadNewBlockData"),ct=F("moveBlock"),Kn=re(Jn,n=>{n.addCase(it,(e,t)=>Tn(e,t.payload)).addCase(rt,(e,t)=>Gn(e,t.payload)).addCase(lt,(e,t)=>Wn(e,t.payload)).addCase(ve,(e,t)=>zn(e,t.payload)).addCase(ct,(e,t)=>Hn(e,t.payload))});function Un(n,e){return v(f({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",segments:e.data}})}function qn(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}function Qn(n,e){const t=n[e.collection];if(!t)return n;const s=v(f({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat});return v(f({},n),{[e.collection]:s})}const Xn={},dt=F("loadNewGenericCollectionData"),ut=F("setGenericSegmentPositionKeys"),Zn=F("removeGenericSegmentCollection"),Yn=re(Xn,n=>n.addCase(dt,(e,t)=>Un(e,t.payload)).addCase(ut,(e,t)=>Qn(e,t.payload)).addCase(Zn,(e,t)=>qn(e,t.payload)));function es(n,e){return v(f({},n),{[e.mesh]:e.data})}function ts(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}const ns={},xe=F("loadMeshLineData"),ss=F("removeMesh"),as=re(ns,n=>n.addCase(xe,(e,t)=>es(e,t.payload)).addCase(ss,(e,t)=>ts(e,t.payload))),ft=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ie={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function os(n,{a:e,b:t}){const s=v(f({},ie),{start:e,end:t}),a=[...n.segments,s];return v(f({},n),{segments:a})}function is(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),{lastIndex:a}=n,[i,r]=q(e.start,s,t,a),[l,h]=q(e.end,s,t,r),m=v(f({},ie),{start:i,end:l}),d=[...n.segments,m];return{vertecies:t,vertexDictionary:s,segments:d,lastIndex:h}}function rs(n,e){const t=[],s=[];let a=f({},n);for(const[i,r]of n.segments.entries())e.index.includes(i)?s.push(r):t.push(r);a.segments=t;for(const i of s)a=nt(nt(a,i.start),i.end);return a}function ls(n,e){const t=[...n.segments];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return v(f({},n),{segments:t})}function cs(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),[a,i]=q(e.targetPoint,s,t,n.lastIndex),r=v(f({},ie),{start:e.index,end:a}),l=[...n.segments,r];return{vertecies:t,vertexDictionary:s,segments:l,lastIndex:i}}function ds(n,e){return e}function us(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(h=>{let m=h;return m.start===t&&(m=v(f({},m),{start:e})),m.end===t&&(m=v(f({},m),{end:e})),m}).filter(h=>h.start!==h.end),a=n.vertecies[t],i=`${Math.floor(a.lon*I)},${Math.floor(a.lat*I)}`,r=f({},n.vertecies);delete r[t];const l=f({},n.vertexDictionary);return delete l[i],v(f({},n),{vertecies:r,vertexDictionary:l,segments:s})}function fs(n,{index:e,vertex:t}){const s=f({},n.vertecies),a=f({},n.vertexDictionary),i=[...n.segments],r=s[e],l=`${Math.floor(t.lon*I)},${Math.floor(t.lat*I)}`,h=`${Math.floor(r.lon*I)},${Math.floor(r.lat*I)}`;if(delete a[h],l in a){const m=a[l];for(const d of i)d.start===m&&(d.start=e),d.end===m&&(d.end=e);delete s[m]}return s[e]=t,v(f({},n),{segments:i,vertecies:s,vertexDictionary:a})}function ms(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),a=[...n.segments];let{lastIndex:i}=n;for(const r of e){const l=n.segments[r],h=n.vertecies[l.start],m=n.vertecies[l.end],d={lon:(h.lon+m.lon)/2,lat:(h.lat+m.lat)/2},[c,b]=q(d,s,t,i);i=b;const w=v(f({},l),{end:c,name:`${l.name}_a`}),g=v(f({},l),{start:c,name:`${l.name}_b`});a[r]=w,a.push(g)}return{vertecies:t,vertexDictionary:s,segments:a,lastIndex:i}}const hs={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},mt=F("bridgeVertices"),ht=F("createSegmet"),pt=F("deleteSegment"),gt=F("editSegmentData"),yt=F("extrudeSegment"),we=F("loadNewSegmentData"),bt=F("mergeVertices"),_e=F("moveVertex"),vt=F("splitSegment"),ps=re(hs,n=>{n.addCase(mt,(e,t)=>os(e,t.payload)).addCase(ht,(e,t)=>is(e,t.payload)).addCase(pt,(e,t)=>rs(e,t.payload)).addCase(gt,(e,t)=>ls(e,t.payload)).addCase(yt,(e,t)=>cs(e,t.payload)).addCase(we,(e,t)=>ds(e,t.payload)).addCase(bt,(e,t)=>us(e,t.payload)).addCase(_e,(e,t)=>fs(e,t.payload)).addCase(vt,(e,t)=>ms(e,t.payload))}),xt=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],gs={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function ys(n){return f(f({},gs),n)}function bs(n,{data:e}){return[...n,ys(e)]}function vs(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function xs(n,e){const t=[...n];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return t}function ws(n,e){return e}function _s(n,{index:e,position:t}){const s=[...n],a=f(f({},s[e]),t);return s[e]=a,s}const Ns=[],wt=F("createVelocity"),_t=F("editVelocity"),Nt=F("deleteVelocity"),Ne=F("loadNewVelocityData"),St=F("moveVelocity"),Ss=re(Ns,n=>{n.addCase(wt,(e,t)=>bs(e,t.payload)).addCase(_t,(e,t)=>xs(e,t.payload)).addCase(Nt,(e,t)=>vs(e,t.payload)).addCase(Ne,(e,t)=>ws(e,t.payload)).addCase(St,(e,t)=>_s(e,t.payload))});function le(n){const e=n.split(/\n/g),t=e[0].split(",").map(i=>i.trim()),s=e.slice(1),a=[];for(const i of s)if(i.trim()!==""){const r=i.split(/\s*,\s*/),l={};for(let h=0;h<t.length;h+=1){let m=r[h];const d=t[h],c=Number.parseFloat(m);m=Number.isNaN(c)?m:c,typeof m=="string"&&m.startsWith('"')&&m.endsWith('"')&&(m=m.slice(1,-1)),l[d]=m}a.push(l)}return a}function Se(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(i=>{if(i in a){const r=a[i];return typeof r=="string"&&/\s/.test(`${r}`)?`"${r}"`:`${typeof r=="number"&&(i.includes("lon")||i.includes("lat"))?r.toFixed(6):r}`}return""}).join(","))}return t.join(`
`)}class ke{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(a=>{const i={};for(const r of at)i[r]=a[r]||(r==="name"?"":0);return i});this.data=s}async save(){var t;const e=Se((t=this.data)!=null?t:[],at);await this.handle.setContents(e)}clone(){return new ke(this.handle)}}const ks={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Cs(n){return f(f({},ks),n)}class Ce{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Cs(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new Ce(this.handle)}}class Ls{constructor(e){k(this,"data");k(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=le(e);this.data=t}async save(){}}function Fs(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(s=>{const a=Number.parseFloat(s[1]),i=Number.parseFloat(s[2]);return{lon:a,lat:i}});return t.splice(0,0,{lon:0,lat:0}),t}const $s={"1":n=>{var s,a;const e=Number.parseInt((s=n[n.length-2])!=null?s:"",10),t=Number.parseInt((a=n[n.length-1])!=null?a:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var a,i,r;const e=Number.parseInt((a=n[n.length-3])!=null?a:"",10),t=Number.parseInt((i=n[n.length-2])!=null?i:"",10),s=Number.parseInt((r=n[n.length-1])!=null?r:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(s)?[[e,t],[t,s],[s,e]]:!1}};function Ds(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var s;return((s=$s[e[1]])!=null?s:()=>!1)(e)}).filter(e=>e).flat()}function Vs(n,e){return e.map(([t,s])=>t!==s&&t>-1&&t<n.length&&s>-1&&s<n.length?[n[t],n[s]]:!1).filter(t=>t)}function Ms(n){const e=n.split("$");let t=[],s=[];for(const a of e)a.startsWith("Nodes")?t=Fs(a):a.startsWith("Elements")&&(s=Ds(a));return console.log("mesh file:",t,s),Vs(t,s)}class js{constructor(e){k(this,"data");k(this,"handle");k(this,"startLonColumn");k(this,"endLonColumn");k(this,"startLatColumn");k(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=Ms(e);else{const t=le(e);this.data=t.map(s=>{const a={lon:0,lat:0},i={lon:0,lat:0};console.log("parsing row",s),typeof s[this.startLonColumn]=="number"&&(a.lon=s[this.startLonColumn]),typeof s[this.startLatColumn]=="number"&&(a.lat=s[this.startLatColumn]),typeof s[this.endLonColumn]=="number"&&(i.lon=s[this.endLonColumn]),typeof s[this.endLatColumn]=="number"&&(i.lat=s[this.endLatColumn]);const r=Object.keys(s).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(r.length>0){const l={};for(const h of r)l[h]=s[h];return[a,i]}return[a,i]})}}async save(){console.log("Mesh files do not get saved")}}class Le{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(h=>{const m={};for(const d of ft)m[d]=h[d]||(d==="name"?"":0);return m}),a={},i={},r=[];let l=0;for(const h of s){const[m,d]=q({lon:h.lon1,lat:h.lat1},a,i,l),[c,b]=q({lon:h.lon2,lat:h.lat2},a,i,d),w=v(f({},h),{start:m,end:c});l=b,r.push(w)}this.data={vertecies:i,segments:r,vertexDictionary:a,lastIndex:l}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(i=>{const r=s[i.start],l=s[i.end];return v(f({},i),{lon1:r.lon,lat1:r.lat,lon2:l.lon,lat2:l.lat})})}const t=Se(e,ft);await this.handle.setContents(t)}clone(){return new Le(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*I)},${Math.floor(s.lat*I)}`,i=f({},this.data.vertecies);delete i[e];const r=f({},this.data.vertexDictionary);delete r[a];const l=this.clone();return l.data=v(f({},this.data),{vertecies:i,vertexDictionary:r}),l}}return this}mergeVertices(e,t){if(this.data){for(const h of this.data.segments)h.start===t&&(h.start=e),h.end===t&&(h.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*I)},${Math.floor(s.lat*I)}`,i=f({},this.data.vertecies);delete i[t];const r=f({},this.data.vertexDictionary);delete r[a];const l=this.clone();return l.data=v(f({},this.data),{vertecies:i,vertexDictionary:r}),l}return this}moveVertex(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),i=[...this.data.segments],r=s[e],l=`${Math.floor(t.lon*I)},${Math.floor(t.lat*I)}`,h=`${Math.floor(r.lon*I)},${Math.floor(r.lat*I)}`;if(delete a[h],l in a){const d=a[l];for(const c of i)c.start===d&&(c.start=e),c.end===d&&(c.end=e);delete s[d]}s[e]=t;const m=this.clone();return m.data=v(f({},this.data),{segments:i,vertecies:s,vertexDictionary:a}),m}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],i={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[r,l]=q(i,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),h=v(f({},t),{end:r,name:`${t.name}_a`}),m=v(f({},t),{start:r,name:`${t.name}_b`}),d=[...this.data.segments];d[e]=h,d.push(m);const c=this.clone();return c.data=v(f({},this.data),{segments:d,lastIndex:l}),c}return this}bridgeVertices(e,t){if(this.data){const s=v(f({},ie),{start:e,end:t}),a=[...this.data.segments,s],i=this.clone();return i.data=v(f({},this.data),{segments:a}),i}return this}extrudeSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[i,r]=q(t,a,s,this.data.lastIndex),l=v(f({},ie),{start:e,end:i}),h=[...this.data.segments,l],m=this.clone();return m.data={vertecies:s,vertexDictionary:a,segments:h,lastIndex:r},m}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=v(f({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[i,r]=q(e,a,s,this.data.lastIndex),[l,h]=q(t,a,s,r),m=v(f({},ie),{start:i,end:l}),d=[...this.data.segments,m],c=this.clone();return c.data={vertecies:s,vertexDictionary:a,segments:d,lastIndex:h},c}return this}}class Fe{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(a=>{const i={};for(const r of xt)i[r]=a[r]||(r==="name"?"":0);return i});this.data=s}async save(){var t;const e=Se((t=this.data)!=null?t:[],xt);await this.handle.setContents(e)}clone(){return new Fe(this.handle)}}async function kt(n){const e=new Le(n);return await e.initialize(),e}async function Ct(n){const e=new ke(n);return await e.initialize(),e}async function Lt(n){const e=new Fe(n);return await e.initialize(),e}async function Ft(n){const e=new js(n);return await e.initialize(),e}async function Is(n){const e=new Ls(n);return await e.initialize(),e}async function Os(n,e,t){const s=new Ce(e);if(await s.initialize(),s.data){const a=await kt(await n.getFile(s.data.segment_file_name)),i=await Ct(await n.getFile(s.data.block_file_name)),r=await Lt(await n.getFile(s.data.station_file_name)),l=await n.getFile(s.data.mesh_parameters_file_name),h=JSON.parse(await l.getContents()),m=await Promise.all(h.map(async c=>Ft(await n.getFile(c.mesh_filename)))),d=f({},t);return"command"in d&&(d.command=v(f({},d.command),{currentFilePath:e.name})),"segment"in d&&(d.segment=v(f({},d.segment),{currentFilePath:s.data.segment_file_name})),"block"in d&&(d.block=v(f({},d.block),{currentFilePath:s.data.block_file_name})),"velocities"in d&&(d.velocities=v(f({},d.velocities),{currentFilePath:s.data.station_file_name})),"mesh"in d&&(d.mesh=v(f({},d.mesh),{currentFilePath:h.map(c=>c.mesh_filename)})),{openableFiles:d,commands:s,segments:a,blocks:i,velocities:r,mesh:m}}throw new Error("Can't open command file")}class Rs{constructor(e){k(this,"name");k(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class $e{constructor(e){k(this,"name");k(this,"handle");k(this,"fileList");k(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Rs(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new $e(t);return await s.initialize(),s}}const Ps=async()=>{const n=await window.showDirectoryPicker(),e=new $e(n);return await e.initialize(),e};class Es{constructor(e,t){k(this,"name");k(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class De{constructor(e,t){k(this,"name");k(this,"parent");k(this,"fileList");k(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Es(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new De(e,this.parent[this.name])}}const Bs=async n=>new De("root",n);let $t=async()=>{var e;return Bs((e=window.FakeDirectory)!=null?e:{})};function As(n){$t=n}async function Ts(){return $t()}window.location.search.includes("fake-dir")||As(Ps);var J;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(J||(J={}));const Dt={Block:J.Block,Vertex:J.Vertex,Velocity:J.Velocity},Ws={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments"};function Gs(){var Ke,Ue,qe;const n=st(),[e,t]=S.exports.useState(),[s,a]=S.exports.useState(""),[i,r]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[l,h]=S.exports.useState(),[m,d]=S.exports.useState(),[c,b]=S.exports.useState(),[w,g]=S.exports.useState(),p=oe(u=>u.main.present.segment),_=oe(u=>u.main.present.block),N=oe(u=>u.main.present.velocity),E=oe(u=>u.main.present.meshLine),Z=oe(u=>u.main.present.genericSegments),[L,Ve]=S.exports.useState(On),[j,Me]=S.exports.useState(mn),[G,je]=S.exports.useState(Vn),[$,Ie]=S.exports.useState(En),[K,Oe]=S.exports.useState(Fn),[U,Re]=S.exports.useState(yn),[B,te]=S.exports.useState("normal"),[ne,Pt]=S.exports.useState(J.Vertex),[fe,Pe]=S.exports.useState([]),[Ee,Be]=S.exports.useState([]),[Ae,Te]=S.exports.useState([]),[We,Ge]=S.exports.useState([]),[D,Us]=S.exports.useState({select:(u,y)=>{Pe(u==="block"?y:[]),Be(u==="segment"?y:[]),Te(u==="velocities"?y:[]),Ge(u==="vertex"?y:[]),a(u)}}),[Et,Bt]=S.exports.useState([]),[At,ze]=S.exports.useState([]),[Tt,Wt]=S.exports.useState([]),[Gt,me]=S.exports.useState({color:$.color,selectedColor:$.activeColor,radius:$.radius,selectedRadius:$.activeRadius,points:[]}),[He,zt]=S.exports.useState({lon:0,lat:0}),[he,Ht]=S.exports.useState(!1);S.exports.useEffect(()=>{B==="normal"?D.select=(u,y)=>{Pe(u==="block"?y:[]),Be(u==="segment"?y:[]),Te(u==="velocities"?y:[]),Ge(u==="vertex"?y:[]),a(u)}:B.mode==="override"?D.select=(u,y)=>{u===B.type&&B.callback(y)}:D.select=()=>{}},[B,D]),S.exports.useEffect(()=>{const u=[];ne!==J.Block&&!j.hide&&u.push({name:"blocks",color:j.color,selectedColor:j.selectedColor,radius:j.radius,points:_.map((y,C)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:C})),click:y=>{D.select("block",[y])}}),ne!==J.Vertex&&!$.hide&&u.push({name:"vertices",color:$.color,selectedColor:$.activeColor,radius:$.radius,click:y=>{D.select("vertex",[y])},points:Object.keys(p.vertecies).map(y=>{const C=Number.parseInt(y,10),V=p.vertecies[C];return V?{longitude:V.lon,latitude:V.lat,index:C,name:"",description:""}:!1}).filter(y=>!!y)}),Bt(u)},[j,_,G,D,ne,$.hide,$.color,$.activeColor,$.radius,p.vertecies]),S.exports.useEffect(()=>{const u=[];if(G.hide||u.push({name:"segments",color:G.color,selectedColor:G.activeColor,width:G.width,selectedWidth:G.activeWidth,lines:p.segments.map((y,C)=>{var T,W;const V=(T=p.vertecies[y.start])!=null?T:et,P=(W=p.vertecies[y.end])!=null?W:et,[[Q,M],[A,z]]=be(V,P);return{startLongitude:Q,startLatitude:M,endLongitude:A,endLatitude:z,name:y.name,description:`${V.lon},${V.lat} to ${P.lon},${P.lat}`,index:C}}),click:y=>{D.select("segment",[y])}}),!K.hide)for(const y of Object.keys(E)){const C=E[y];u.push({name:`mesh:${y}`,color:K.color,selectedColor:K.activeColor,width:K.width,selectedWidth:K.activeWidth,lines:C.map((V,P)=>{const Q=V[0],M=V[1],[[A,z],[T,W]]=be(Q,M);return{startLongitude:A,startLatitude:z,endLongitude:T,endLatitude:W,name:"",description:"",index:P}})||[]})}if(!U.hide)for(const y of Object.keys(Z)){const{startLat:C,startLon:V,endLat:P,endLon:Q,segments:M}=Z[y];C in M[0]&&P in M[0]&&V in M[0]&&Q in M[0]&&u.push({name:`generic_segment:${y}`,color:U.color,selectedColor:U.activeColor,width:U.width,selectedWidth:U.activeWidth,lines:M.map((A,z)=>{const T={lat:A[C],lon:A[V]},W={lat:A[P],lon:A[Q]};if(typeof T.lat!="number"||typeof T.lon!="number"||typeof W.lat!="number"||typeof W.lon!="number")return!1;const[[ce,de],[O,ue]]=be(T,W);return{startLongitude:ce,startLatitude:de,endLongitude:O,endLatitude:ue,name:"",description:"",index:z}}).filter(A=>A)||[]})}Wt(u)},[p,G,U,Z,K,E,D]),S.exports.useEffect(()=>{switch(ne){case J.Vertex:{me({color:$.color,radius:$.radius,selectedColor:$.activeColor,selectedRadius:$.activeRadius,points:$.hide?[]:Object.keys(p.vertecies).map(u=>{const y=Number.parseInt(u,10),C=p.vertecies[y];return C?{longitude:C.lon,latitude:C.lat,index:y}:!1}).filter(u=>!!u),update:(u,y)=>{n(_e({index:u,vertex:y}))},select:u=>{D.select("vertex",u)}});break}case J.Block:{me({color:j.color,radius:j.radius,selectedColor:j.selectedColor,selectedRadius:j.radius,points:j.hide?[]:_.map((u,y)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(ct({index:u,position:y}))},select:u=>{D.select("block",u)}});break}case J.Velocity:{me({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:N.map((u,y)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(St({index:u,position:y}))},select:u=>{D.select("velocities",u)}});break}}},[$,D,p.vertecies,n,ne,j.color,j.radius,j.selectedColor,j.hide,_,L.color,L.width,L.selectedColor,L.hide,N]),S.exports.useEffect(()=>{L.hide?ze([]):ze([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:N.map((u,y)=>{const C=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/C,u.north_vel/C],scale:C,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:y}}),click:u=>{D.select("velocities",[u])}}])},[D,L,N]);let Y=o("span",{});switch(s){case"files":Y=e?o(pn,{folder:e,files:i,setFile:async(u,y,C,V)=>{if(V){let P=f({},i);const Q=P[y];let{currentFilePath:M,allowMultiple:A}=Q;switch(A?Array.isArray(M)?(M=M.map(z=>z),M.length>u?M[u]=C:M.push(C)):M=[C]:M=C,P[y]=v(f({},Q),{currentFilePath:M}),y){case"segment":const z=await kt(V);d(z),z.data&&n(we(z.data));break;case"block":const T=await Ct(V);b(T),T.data&&n(ve(T.data));break;case"velocity":const W=await Lt(V);g(W),W.data&&n(Ne(W.data));break;case"mesh":const ce=await Ft(V);ce.data&&n(xe({mesh:`mesh_file_${u}`,data:ce.data}));break;case"csv":const de=await Is(V);de.data&&n(dt({name:`generic_segment_${u}`,data:de.data}));break;case"command":const O=await Os(e,V,i);h(O.commands),d(O.segments),O.segments.data&&n(we(O.segments.data)),b(O.blocks),O.blocks.data&&n(ve(O.blocks.data)),g(O.velocities),O.velocities.data&&n(Ne(O.velocities.data)),O.mesh&&O.mesh.map((ue,Qe)=>(ue.data&&n(xe({mesh:`mesh_file_${Qe}`,data:ue.data})),Qe)),P=O.openableFiles;break}r(P)}}}):o("span",{});break;case"velocities":Y=o(Rn,{settings:L,setSettings:Ve,selected:Ae,velocitys:N,setVelocityData:(u,y)=>{y?n(_t({indices:u,data:y})):(n(Nt(u)),D.select("velocity",[]))},addNewVelocity:()=>{te({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{te("normal");const y=N.length;n(wt({data:{lat:u.lat,lon:u.lon}})),D.select("velocity",[y])}})},save:async()=>{w&&(w.data=N,await w.save())}});break;case"block":Y=o(hn,{settings:j,setSettings:Me,selected:fe,blocks:_,addNewBlock:()=>{te({label:"Click to place new block",mode:"mapClick",callback:u=>{const y=_.length;n(it({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),D.select("block",[y]),te("normal")}})},setBlockData:(u,y)=>{y?n(rt({indices:fe,data:y})):(n(lt(u)),D.select("block",[]))},save:async()=>{c&&(c.data=_,await c.save())}});break;case"segment":Y=o(Mn,{settings:G,setSettings:je,segments:(Ke=p.segments)!=null?Ke:[],selected:Ee,setSelectionMode:u=>te(u),addNewSegment:(u,y)=>{const C=p.segments.length;n(ht({start:u,end:y})),D.select("segment",[C])},setSegmentData:(u,y)=>{n(y?gt({indices:u,data:y}):pt({index:u}))},splitSegment:u=>{n(vt(u)),D.select("segment",[])},save:async()=>{m&&(m.data=p,await m.save())}});break;case"vertex":Y=o(Bn,{settings:$,setSettings:Ie,vertices:(Ue=p.vertecies)!=null?Ue:{},selected:We,setVertexData:(u,y)=>{y&&n(_e({index:u,vertex:y}))},setSelectionMode:u=>te(u),mergeVertices:(u,y)=>{n(bt({a:u,b:y}))},bridgeVertices:(u,y)=>{n(mt({a:u,b:y}))},extrudeVertex:(u,y)=>{n(yt({index:u,targetPoint:y}))},save:async()=>{m&&(m.data=p,await m.save())}});break;case"mesh":Y=o($n,{settings:K,setSettings:Oe});break;case"csv":Y=o(bn,{settings:U,setSettings:Re,setCollectionVertexKeys:u=>{n(ut(u))},collections:Z});break}const Je={Block:{state:j.hide,change:()=>{Me(v(f({},j),{hide:!j.hide}))}},Vertex:{state:$.hide,change:()=>{Ie(v(f({},$),{hide:!$.hide}))}},Velocity:{state:L.hide,change:()=>{Ve(v(f({},L),{hide:!L.hide}))}},Segment:{state:G.hide,change:()=>{je(v(f({},G),{hide:!G.hide}))}},Grid:{state:!he,change:()=>{Ht(!he)}},Mesh:{state:K.hide,change:()=>{Oe(v(f({},K),{hide:!K.hide}))}},GenericSegments:{state:U.hide,change:()=>{Re(v(f({},U),{hide:!U.hide}))}}};return x("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:u=>{u.key==="Escape"&&te("normal")},children:[o(jn,{filesOpen:((qe=l!=null?l:m)!=null?qe:c)!==void 0,saveFiles:async()=>{l&&await l.save(),m&&(m.data=p,await m.save()),c&&(c.data=_,await c.save()),w&&(w.data=N,await w.save())},folder:e,openFolder:async()=>{const u=await Ts();t(u),a("files")}}),B!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:x("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:B.label}),B.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:B.subtitle}):o(R,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(R,{}),x("div",{className:"absolute bottom-0 left-2 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-start gap-5",children:x("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ne})]})}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),x("span",{children:[Math.floor(He.lon*1e3)/1e3,","," ",Math.floor(He.lat*1e3)/1e3]})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Dt).map(u=>{const y=Dt[u];return o("button",{type:"button",className:`${ne===y?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Pt(y)},children:u},u)})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Je).map(u=>{const y=Je[u];return o("button",{type:"button",className:`${y.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{y.change()},children:u},u)})]})]}),o(Cn,{pointSources:Et,arrowSources:At,lineSources:Tt,drawnPointSource:Gt,selections:{segments:Ee,blocks:fe,velocities:Ae,vertices:We},displayGrid:he?10:-1,click:u=>{typeof B!="string"&&B.mode==="mapClick"&&B.callback(u)},mouseMove:u=>{zt(u)}}),o(vn,{view:Y,buttons:e?Ws:void 0,active:s,setActive:u=>a(u)})]})}const zs=tn({reducer:{main:nn(sn({segment:ps,block:Kn,velocity:Ss,meshLine:as,genericSegments:Yn}))}});function Hs(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:i}=n;let r;const l=async(h=!0)=>{};return"serviceWorker"in navigator&&(r=new an("./sw.js",{scope:"./"}),r.addEventListener("activated",h=>{h.isUpdate?window.location.reload():s==null||s()}),r.register({immediate:e}).then(h=>{a==null||a(h)}).catch(h=>{i==null||i(h)})),l}Hs();const Js=1,Ks=new on({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Js}}});rn.render(o(S.exports.StrictMode,{children:o(ln,{client:Ks,children:o(cn,{store:zs,children:o(Gs,{})})})}),document.querySelector("#root"));
