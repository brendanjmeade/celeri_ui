var Xt=Object.defineProperty,Zt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var en=Object.prototype.hasOwnProperty,tn=Object.prototype.propertyIsEnumerable;var ge=(n,e,t)=>e in n?Xt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))en.call(e,t)&&ge(n,t,e[t]);if(Ye)for(var t of Ye(e))tn.call(e,t)&&ge(n,t,e[t]);return n},v=(n,e)=>Zt(n,Yt(e));var k=(n,e,t)=>(ge(n,typeof e!="symbol"?e+"":e,t),t);import{j as i,a as x,F as R,r as S,M as nn,m as et,R as sn,b as ye,u as an,c as on,l as tt,d as re,e as $,f as nt,g as st,h as rn,i as ln,k as cn,v as dn,Q as un,n as fn,o as mn,P as pn}from"./vendor.51d006dc.js";const hn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}};hn();function gn({value:n,fieldDefinition:e,setField:t}){const[s,a]=S.exports.useState(-1),[r,l]=S.exports.useState(n);S.exports.useEffect(()=>{l(n)},[n]);let o=i("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof n=="number"?"number":"text",value:r,onChange:c=>{const u=typeof n=="number"?Number.parseFloat(c.target.value):c.target.value;l(u),s>-1&&clearTimeout(s),a(setTimeout(()=>t(u),1e3))}});return e.type==="select"&&(o=x("select",{"data-testid":`input-editor-${e.name}`,className:" w-full",value:r,onChange:c=>{t(c.currentTarget.value)},children:[i("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(c=>i("option",{value:c.name,"data-testid":`input-editor-${e.name}-${c.name}`,children:c.name},c.name))]})),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(R,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:o})]})}function se({title:n,items:e,setItems:t,fieldDefinitions:s,ignoreFields:a,deletable:r,controls:l}){const o=e[0],c=Object.keys(o).map((u,f)=>{if(a==null?void 0:a.includes(u))return{element:i("span",{style:{display:"hidden"}},u),order:f+1e4};let d=o[u];for(const w of e)if(w[u]!==d){d="-";break}const b=u in s&&s[u];return b?{element:i(gn,{value:d,fieldDefinition:b,setField:w=>t({[u]:w})},u),order:b.order}:{element:x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${u}`,className:"text-l font-bold",children:u}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${u}`,className:"bg-gray-800 w-full",type:typeof d=="number"?"number":"text",value:d,onChange:w=>{t({[u]:typeof d=="number"?Number.parseFloat(w.target.value):w.target.value})}})})]},u),order:f+1e3}}).sort((u,f)=>u.order-f.order).map(u=>u.element);return x("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),x("span",{className:"flex flex-row justify-end gap-2 grow",children:[l,r?i("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):i(R,{})]})]}),c]})}se.defaultProps={ignoreFields:[],controls:i(R,{})};const yn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var Pt;const bn=JSON.parse((Pt=window.localStorage.getItem("blockDisplaySettings"))!=null?Pt:"false")||yn;function vn({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:r,save:l}){const o=f=>{e(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},c=t.map(f=>s[f]).filter(f=>f),u=c.length>0?i(se,{title:c.length===1?c[0].name:"Edit Selected Blocks",items:c,deletable:!0,setItems:f=>a(t,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(R,{});return x(R,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold flex-grow",children:"Display"}),i("span",{className:"w-2/5 flex-shrink",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(v(p({},n),{hide:!n.hide}))}})}),i("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:l,children:"Save Blocks"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:f=>{o(v(p({},n),{color:f.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:f=>{o(v(p({},n),{selectedColor:f.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:f=>{o(v(p({},n),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),u]})}function xn({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const r=e[a],l=Array.isArray(r.currentFilePath)?[...r.currentFilePath]:[r.currentFilePath];return r.allowMultiple&&l.push(""),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:r.name}),i("span",{className:"text-sm","data-testid":`file-${a}-description`,children:r.description})]}),i("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:l.map((o,c)=>x("select",{"data-testid":`file-${a}-select-${c}`,className:"bg-gray-800 w-full m-1",value:o,onChange:async u=>{const f=u.currentTarget.value;try{const d=await n.getFile(f);t(c,a,d.name,d)}catch{t(c,a,"")}},children:[i("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(u=>u.endsWith(r.extension)).map(u=>i("option",{value:u,"data-testid":`file-${a}-select-${u}`,children:u},u))]},c))})]},a)});return i("div",{className:"flex flex-col gap-2",children:s})}const wn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Ot;const _n=p(p({},wn),JSON.parse((Ot=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Ot:"{}"));function Nn({settings:n,setSettings:e,collections:t,setCollectionVertexKeys:s}){const a=l=>{e(l),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(l))},r=Object.keys(t).map(l=>{const{startLat:o,startLon:c,endLat:u,endLon:f,segments:d}=t[l],b=Object.keys(d[0]).map((w,g)=>({name:w,value:g}));return i(se,{title:l,items:[{startLat:o,startLon:c,endLat:u,endLon:f}],deletable:!1,setItems:w=>{s(p({collection:l,startLat:o,startLon:c,endLat:u,endLon:f},w))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:b},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:b},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:b},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:b}}},l)});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{a(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:l=>{a(v(p({},n),{color:l.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:l=>{a(v(p({},n),{width:Number.parseFloat(l.target.value)}))}})})]}),r]})}function Sn({view:n,buttons:e,active:t,setActive:s}){if(!e)return i("span",{});const a=[];for(const r of Object.keys(e)){const l=e[r],o=r===t;a.push(i("button",{type:"button","data-testid":`tab-${r}`,className:`${o?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>s(o?"":r),children:l},r))}return x("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:n}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:a})]})}const at={lon:0,lat:0},kn=180,ae=360;function ot(n){let{lon:e,lat:t}=n;for(;e<0;)e+=ae;for(;e>ae;)e-=ae;return[e,t]}function be([n,e]){return{lon:n<0?n+ae:n,lat:e}}function ve(n,e){const t=ot(n),s=ot(e),a=[s[0],s[1]];return s[0]-t[0]>=kn?a[0]-=ae:a[0]+=ae,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const P=1e6;function q(n,e,t,s){const a=`${Math.floor(n.lon*P)},${Math.floor(n.lat*P)}`;if(a in e)return[e[a],s];const r=s;return t[r]=n,e[a]=r,[r,s+1]}function it(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*P)},${Math.floor(s.lat*P)}`,r=p({},n.vertecies);delete r[e];const l=p({},n.vertexDictionary);return delete l[a],v(p({},n),{vertecies:r,vertexDictionary:l})}return n}const X=Math.PI/6,ee=2*Math.PI-X;function Cn(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:r,internalSelections:l},{arrowSources:o,selections:c}){if(t&&r&&a!==o)if(console.log("Setting arrows in map!"),a){for(const d of a){const b=t.getSource(`arrow:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${d.name}`),t.removeLayer(`layer:arrow:${d.name}:click`)}e({internalArrowSources:void 0})}else{for(const d of o){let b=t.getSource(`arrow:${d.name}`);const w=b===void 0;w&&(t.addSource(`arrow:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`arrow:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.arrows.map(g=>{var L;const h=g.scale*d.scale,_=d.scale*d.arrowHeadScale,N=[g.longitude+g.direction[0]*h,g.latitude+g.direction[1]*h],B=[N[0]+(Math.cos(X)*-g.direction[0]-Math.sin(X)*-g.direction[1])*_,N[1]+(Math.sin(X)*-g.direction[0]+Math.cos(X)*-g.direction[1])*_],Z=[N[0]+(Math.cos(ee)*-g.direction[0]-Math.sin(ee)*-g.direction[1])*_,N[1]+(Math.sin(ee)*-g.direction[0]+Math.cos(ee)*-g.direction[1])*_];return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:(L=c[d.name])==null?void 0:L.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],N,B,N,Z]}}})}),t.addLayer({id:`layer:arrow:${d.name}`,type:"line",source:`arrow:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],d.selectedColor,d.color],"line-width":d.width}}),t.addLayer({id:`layer:arrow:${d.name}:click`,type:"line",source:`arrow:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),w&&(t.on("mouseenter",`layer:arrow:${d.name}:click`,g=>{if(!g.features)return;const h=g.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const _=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:arrow:${d.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${d.name}:click`,g=>{let h;if(n.state.internalArrowSources)for(const N of n.state.internalArrowSources)h=N.click;if(!g.features||!h)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;h(N)}}))}e({internalArrowSources:o})}const u=p({},l);let f=!1;for(const d of Object.keys(c))if(c[d]!==l[d]){for(const b of o)if(b.name===d){f=!0,u[d]=c[d];const w=t==null?void 0:t.getSource(`arrow:${b.name}`);if(w){const g=c[d];w.setData({type:"FeatureCollection",features:b.arrows.map(h=>{const _=h.scale*b.scale,N=b.scale*b.arrowHeadScale,B=[h.longitude+h.direction[0]*_,h.latitude+h.direction[1]*_],Z=[B[0]+(Math.cos(X)*-h.direction[0]-Math.sin(X)*-h.direction[1])*N,B[1]+(Math.sin(X)*-h.direction[0]+Math.cos(X)*-h.direction[1])*N],L=[B[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*N,B[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:g==null?void 0:g.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],B,Z,B,L]}}})})}}}f&&e({internalSelections:u})}function Ln(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:r},{drawnPointSource:l}){if(e&&a&&r!==l){console.log("Drawning Points"),n({internalDrawnPointSource:l});let o=t;if((l.selectedColor!==s.selectedColor||l.selectedRadius!==s.selectedRadius||l.color!==s.color||l.radius!==s.radius)&&(n({drawnPointSettings:{color:l.color,radius:l.radius,selectedRadius:l.selectedRadius,selectedColor:l.selectedColor}}),t&&(e.removeControl(t),o=void 0),l?(o=new nn({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":l.selectedRadius,"circle-color":l.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":l.radius,"circle-color":l.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(o),n({draw:o})):o=void 0),o){const c=o.getAll(),u=l.points.length!==c.features.length?void 0:o.getSelected(),f={type:"FeatureCollection",features:l.points.map(d=>({type:"Feature",id:d.index.toString(),properties:{description:"",index:d.index,name:""},geometry:{type:"Point",coordinates:[d.longitude,d.latitude]}}))};if(o.set(f),u&&u.features.length>0&&u.features[0].properties&&typeof u.features[0].properties.index=="number"){const d=u.features[0].id;d&&o.changeMode("simple_select",{featureIds:[d]})}}}}const H="grid";function $n(n,e,{map:t,internalGridDisplay:s,popup:a,mapLoaded:r},{displayGrid:l}){if(t&&r&&s!==l){if(console.log("Drawing Grid on map!"),s&&s>0){const o=t.getSource(H);o!==void 0&&o.setData({type:"FeatureCollection",features:[]}),t.removeLayer(H),e({internalGridDisplay:void 0})}else if(l&&l>0){let o=t.getSource(H);const c=o===void 0;if(c&&(t.addSource(H,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),o=t.getSource(H)),o!==void 0){const u=[];for(let f=-170;f<=180;f+=l)u.push({type:"Feature",properties:{label:`Lon: ${f<0?f+360:f}`},geometry:{type:"LineString",coordinates:[[f,-90],[f,90]]}});for(let f=-90;f<=90;f+=l)u.push({type:"Feature",properties:{label:`Lat: ${f}`},geometry:{type:"LineString",coordinates:[[180,f],[-180,f]]}});o.setData({type:"FeatureCollection",features:u})}t.addLayer({id:H,type:"line",source:H,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${H}:click`,type:"line",source:H,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),c&&(t.on("mouseenter",`${H}:click`,u=>{if(!u.features)return;const f=u.features[0];f.geometry.type==="LineString"&&f.properties&&typeof f.properties.label=="string"&&a.setLngLat(u.lngLat).setHTML(`${f.properties.label}`).addTo(t)}),t.on("mouseleave",`${H}:click`,()=>{a.remove()}))}e({internalGridDisplay:l})}}function Dn(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:r,internalSelections:l},{lineSources:o,selections:c}){if(t&&r&&a!==o)if(console.log("Setting lines in map!"),a){for(const d of a){const b=t.getSource(`line:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${d.name}`),t.removeLayer(`layer:line:${d.name}:click`)}e({internalLineSources:void 0})}else{for(const d of o){let b=t.getSource(`line:${d.name}`);const w=b===void 0;w&&(t.addSource(`line:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`line:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.lines.map(g=>{var h;return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:((h=c[d.name])==null?void 0:h.includes(g.index))||!1},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}})}),t.addLayer({id:`layer:line:${d.name}`,type:"line",source:`line:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],d.selectedColor,d.color],"line-width":["case",["get","selected"],d.selectedWidth,d.width]}}),d.click&&(t.addLayer({id:`layer:line:${d.name}:click`,type:"line",source:`line:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":d.width*10}}),w&&(t.on("mouseenter",`layer:line:${d.name}:click`,g=>{if(!g.features)return;const h=g.features[0];if(h.geometry.type==="LineString"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const _=[(h.geometry.coordinates[0][0]+h.geometry.coordinates[1][0])/2,(h.geometry.coordinates[0][1]+h.geometry.coordinates[1][1])/2],{description:N}=h.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:line:${d.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${d.name}:click`,g=>{let h;if(n.state.internalLineSources)for(const N of n.state.internalLineSources)N.name===d.name&&(h=N.click);if(!g.features||!h)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;h(N)}})))}e({internalLineSources:o})}const u=p({},l);let f=!1;for(const d of Object.keys(c))if(c[d]!==l[d]){for(const b of o)if(b.name===d){f=!0,u[d]=c[d];const w=t==null?void 0:t.getSource(`line:${b.name}`);if(w){const g=c[d];w.setData({type:"FeatureCollection",features:b.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:g==null?void 0:g.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))})}}}f&&e({internalSelections:u})}function Fn(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:r,internalSelections:l},{pointSources:o,selections:c}){if(!t||!r)return;if(a!==o)if(console.log("Setting points in map!"),a){for(const d of a){const b=t.getSource(`point:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${d.name}`)}e({internalPointSources:void 0})}else{for(const d of o){let b=t.getSource(`point:${d.name}`);const w=b===void 0;w&&(t.addSource(`point:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`point:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.points.map(g=>{var h;return{type:"Feature",properties:{description:g.name||g.description?`<strong>${g.name}</strong><p>${g.description}</p>`:"",index:g.index,name:g.name,selected:!((h=c[d.name])==null?void 0:h.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}})}),t.addLayer({id:`layer:point:${d.name}`,type:"circle",source:`point:${d.name}`,paint:{"circle-color":["case",["get","selected"],d.color,d.selectedColor],"circle-radius":d.radius}}),w&&(t.on("mouseenter",`layer:point:${d.name}`,g=>{if(!g.features)return;const h=g.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const _=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(g.lngLat.lng-_[0])>180;)_[0]+=g.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:point:${d.name}`,()=>{s.remove()}),t.on("click",`layer:point:${d.name}`,g=>{let h;if(n.state.internalPointSources)for(const N of n.state.internalPointSources)h=N.click;if(!g.features||!h)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:N}=_.properties;h(N)}}))}e({internalPointSources:o})}const u=p({},l);let f=!1;for(const d of Object.keys(c))if(c[d]!==l[d]){for(const b of o)if(b.name===d){f=!0,u[d]=c[d];const w=t.getSource(`point:${b.name}`);if(w){const g=c[d];w.setData({type:"FeatureCollection",features:b.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(g==null?void 0:g.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}f&&e({internalSelections:u})}function jn(n,e,{map:t,internalPolygonSources:s,mapLoaded:a},{polygonSources:r,selections:l}){if(t&&a&&s!==r)if(s){for(const o of s){const c=t.getSource(`poly:${o.name}`);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:poly:${o.name}`),t.removeLayer(`layer:poly:${o.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const o of r){let c=t.getSource(`poly:${o.name}`);c===void 0&&(t.addSource(`poly:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=t.getSource(`poly:${o.name}`)),c!==void 0&&c.setData({type:"FeatureCollection",features:o.polygons.map(f=>{var d;return{type:"Feature",properties:{description:f.name||f.description?`<strong>${f.name}</strong><p>${f.description}</p>`:"",index:f.index,name:f.name,selected:((d=l[o.name])==null?void 0:d.includes(f.index))||!1},geometry:{type:"Polygon",coordinates:[f.polygon.map(b=>[b.lon,b.lat])]}}})}),t.addLayer({id:`layer:poly:${o.name}:fill`,type:"fill",source:`poly:${o.name}`,layout:{},paint:{"fill-color":o.color,"fill-opacity":.5}}),t.addLayer({id:`layer:poly:${o.name}`,type:"line",source:`poly:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":o.borderColor,"line-width":o.borderRadius}})}e({internalPolygonSources:r})}}et.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Vn extends sn.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new ye.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(et.accessToken&&t){const s=new ye.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new ye.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:r}=this.props;r(be([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:r}=this.props;r&&r(be([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:r}=this.state;if(!r||!(r==null?void 0:r.select))return;const l=a.map(o=>o&&o.type==="Feature"&&o.geometry.type==="Point"&&o.properties&&"index"in o.properties&&typeof o.properties.index=="number"?o.properties.index:-1).filter(o=>o>-1);r.select(l)}),s.on("draw.update",({features:a,action:r})=>{const{internalDrawnPointSource:l}=this.state;if(!!(l==null?void 0:l.update)&&r==="move"&&a.length>0)for(const o of a)o.type==="Feature"&&o.geometry.type==="Point"&&o.properties&&"index"in o.properties&&typeof o.properties.index=="number"&&l.update(o.properties.index,be(o.geometry.coordinates))})}}componentDidUpdate(){return $n(this,e=>this.setState(e),this.state,this.props),jn(this,e=>this.setState(e),this.state,this.props),Dn(this,e=>this.setState(e),this.state,this.props),Cn(this,e=>this.setState(e),this.state,this.props),Fn(this,e=>this.setState(e),this.state,this.props),Ln(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return i("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const Mn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Rt;const In=p(p({},Mn),JSON.parse((Rt=window.localStorage.getItem("meshDisplaySettings"))!=null?Rt:"{}"));function Pn({settings:n,setSettings:e}){const t=s=>{e(s),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(s))};return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Display"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:s=>{t(v(p({},n),{color:s.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:s=>{t(v(p({},n),{width:Number.parseFloat(s.target.value)}))}})})]})]})}const On={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00"};var Et;const Rn=p(p({},On),JSON.parse((Et=window.localStorage.getItem("segmentDisplaySettings"))!=null?Et:"{}"));function En({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:r,splitSegment:l,setSelectionMode:o,save:c}){const u=b=>{e(b),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(b))},f=s.map(b=>t[b]).filter(b=>b),d=f.length>0?i(se,{title:f.length===1?f[0].name:"Edit Selected Segments",items:f,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:b=>a(s,b),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>l(s),children:"Split Segment"})}):i(R,{});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center gap-1",children:[i("span",{className:"text-l font-bold flex-grow",children:"Display"}),i("span",{className:"w-2/5 flex-shrink",children:i("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{u(v(p({},n),{hide:!n.hide}))}})}),i("span",{className:"text-l font-bold flex-grow",children:"Projection"}),i("span",{className:"w-2/5 flex-shrink",children:i("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hideProjection,onChange:()=>{u(v(p({},n),{hideProjection:!n.hideProjection}))}})}),i("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:c,children:"Save Segments & Vertices"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:b=>{u(v(p({},n),{color:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:b=>{u(v(p({},n),{width:Number.parseFloat(b.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:b=>{u(v(p({},n),{activeColor:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:b=>{u(v(p({},n),{activeWidth:Number.parseFloat(b.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Projection Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.projectionColor,onChange:b=>{u(v(p({},n),{projectionColor:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({mode:"mapClick",label:"Select Segment Starting Point",callback:b=>{o({mode:"mapClick",label:"Select Segment End point",callback:w=>{r(b,w),o("normal")}})}})},children:"New Segment"})]}),d]})}const rt=()=>an(),oe=on;function Bn({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const r=rt(),[l,o]=oe(c=>[c.main.past.length>0,c.main.future.length>0]);return x("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"celeri_ui"}),x("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?i("button",{type:"button",onClick:()=>{r(tt.ActionCreators.undo())},"data-testid":"undo-button",disabled:!l,children:"Undo"}):i(R,{}),n?i("button",{type:"button",onClick:()=>{r(tt.ActionCreators.redo())},disabled:!o,"data-testid":"undo-button",children:"Redo"}):i(R,{}),n?x("span",{children:["Working in ",n.name]}):i("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?i("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):i(R,{})]})]})}const An={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var Bt;const Tn=JSON.parse((Bt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Bt:"false")||An;function Wn({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:r,save:l}){const o=f=>{e(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},c=t.map(f=>s[f]).filter(f=>f),u=c.length>0?i(se,{title:c.length===1?c[0].name:"Edit Selected Velocities",items:c,deletable:!0,setItems:f=>a(t,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(R,{});return x(R,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold flex-grow",children:"Display"}),i("span",{className:"w-2/5 flex-shrink",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{o(v(p({},n),{hide:!n.hide}))}})}),i("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:l,children:"Save Velocities"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:f=>{o(v(p({},n),{color:f.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:f=>{o(v(p({},n),{selectedColor:f.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:f=>{o(v(p({},n),{scale:Number.parseFloat(f.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:f=>{o(v(p({},n),{width:Number.parseFloat(f.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:f=>{o(v(p({},n),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),u]})}const Gn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var At;const zn=p(p({},Gn),JSON.parse((At=window.localStorage.getItem("vertexDisplaySettings"))!=null?At:"{}"));function Hn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:r,mergeVertices:l,bridgeVertices:o,extrudeVertex:c,save:u}){const f=w=>{e(w),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(w))},b=s.map(w=>({selectedVertex:t[w],index:w})).filter(w=>w.selectedVertex).map(({selectedVertex:w,index:g})=>i(se,{title:"Selected Vertex",items:[w],ignoreFields:[],deletable:!1,setItems:h=>a(g,p(p({},w),h)),fieldDefinitions:{},controls:x(R,{children:[i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{l(g,h[0]),r("normal")}})},children:"Merge"}),i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{o(g,h[0]),r("normal")}})},children:"Bridge"}),i("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{c(g,h),r("normal")}})},children:"Extrude"})]})},g));return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold flex-grow",children:"Display"}),i("span",{className:"w-2/5 flex-shrink",children:i("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{f(v(p({},n),{hide:!n.hide}))}})}),i("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:u,children:"Save Segments & Vertices"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:w=>{f(v(p({},n),{color:w.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:w=>{f(v(p({},n),{radius:Number.parseFloat(w.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:w=>{f(v(p({},n),{activeColor:w.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:w=>{f(v(p({},n),{activeRadius:Number.parseFloat(w.target.value)}))}})})]}),b]})}const lt=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],ct={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Jn(n){return n?p(p({},ct),n):p({},ct)}function Kn(n,{data:e}){return[...n,Jn(e)]}function Un(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function qn(n,e){const t=[...n];for(const s of e.indices){const a=p(p({},t[s]),e.data);t[s]=a}return t}function Qn(n,e){return e}function Xn(n,{index:e,position:t}){const s=[...n],a=p({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const Zn=[],dt=$("createBlock"),ut=$("editBlock"),ft=$("deleteBlock"),xe=$("loadNewBlockData"),mt=$("moveBlock"),Yn=re(Zn,n=>{n.addCase(dt,(e,t)=>Kn(e,t.payload)).addCase(ut,(e,t)=>qn(e,t.payload)).addCase(ft,(e,t)=>Un(e,t.payload)).addCase(xe,(e,t)=>Qn(e,t.payload)).addCase(mt,(e,t)=>Xn(e,t.payload))});function es(n,e){return v(p({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",segments:e.data}})}function ts(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}function ns(n,e){const t=n[e.collection];if(!t)return n;const s=v(p({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat});return v(p({},n),{[e.collection]:s})}const ss={},pt=$("loadNewGenericCollectionData"),ht=$("setGenericSegmentPositionKeys"),as=$("removeGenericSegmentCollection"),os=re(ss,n=>n.addCase(pt,(e,t)=>es(e,t.payload)).addCase(ht,(e,t)=>ns(e,t.payload)).addCase(as,(e,t)=>ts(e,t.payload)));function is(n,e){return v(p({},n),{[e.mesh]:e.data})}function rs(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}const ls={},we=$("loadMeshLineData"),cs=$("removeMesh"),ds=re(ls,n=>n.addCase(we,(e,t)=>is(e,t.payload)).addCase(cs,(e,t)=>rs(e,t.payload))),gt=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ie={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function us(n,{a:e,b:t}){const s=v(p({},ie),{start:e,end:t}),a=[...n.segments,s];return v(p({},n),{segments:a})}function fs(n,e){const t=p({},n.vertecies),s=p({},n.vertexDictionary),{lastIndex:a}=n,[r,l]=q(e.start,s,t,a),[o,c]=q(e.end,s,t,l),u=v(p(p({},ie),e),{start:r,end:o}),f=[...n.segments,u];return{vertecies:t,vertexDictionary:s,segments:f,lastIndex:c}}function ms(n,e){const t=[],s=[];let a=p({},n);for(const[r,l]of n.segments.entries())e.index.includes(r)?s.push(l):t.push(l);a.segments=t;for(const r of s)a=it(it(a,r.start),r.end);return a}function ps(n,e){const t=[...n.segments];for(const s of e.indices){const a=p(p({},t[s]),e.data);t[s]=a}return v(p({},n),{segments:t})}function hs(n,e){const t=p({},n.vertecies),s=p({},n.vertexDictionary),[a,r]=q(e.targetPoint,s,t,n.lastIndex),l=v(p({},ie),{start:e.index,end:a}),o=[...n.segments,l];return{vertecies:t,vertexDictionary:s,segments:o,lastIndex:r}}function gs(n,e){return e}function ys(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(c=>{let u=c;return u.start===t&&(u=v(p({},u),{start:e})),u.end===t&&(u=v(p({},u),{end:e})),u}).filter(c=>c.start!==c.end),a=n.vertecies[t],r=`${Math.floor(a.lon*P)},${Math.floor(a.lat*P)}`,l=p({},n.vertecies);delete l[t];const o=p({},n.vertexDictionary);return delete o[r],v(p({},n),{vertecies:l,vertexDictionary:o,segments:s})}function bs(n,{index:e,vertex:t}){const s=p({},n.vertecies),a=p({},n.vertexDictionary),r=[...n.segments],l=s[e],o=`${Math.floor(t.lon*P)},${Math.floor(t.lat*P)}`,c=`${Math.floor(l.lon*P)},${Math.floor(l.lat*P)}`;if(delete a[c],o in a){const u=a[o];for(const f of r)f.start===u&&(f.start=e),f.end===u&&(f.end=e);delete s[u]}return s[e]=t,v(p({},n),{segments:r,vertecies:s,vertexDictionary:a})}function vs(n,e){const t=p({},n.vertecies),s=p({},n.vertexDictionary),a=[...n.segments];let{lastIndex:r}=n;for(const l of e){const o=n.segments[l],c=n.vertecies[o.start],u=n.vertecies[o.end],f={lon:(c.lon+u.lon)/2,lat:(c.lat+u.lat)/2},[d,b]=q(f,s,t,r);r=b;const w=v(p({},o),{end:d,name:`${o.name}_a`}),g=v(p({},o),{start:d,name:`${o.name}_b`});a[l]=w,a.push(g)}return{vertecies:t,vertexDictionary:s,segments:a,lastIndex:r}}const xs={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},yt=$("bridgeVertices"),bt=$("createSegmet"),vt=$("deleteSegment"),xt=$("editSegmentData"),wt=$("extrudeSegment"),_e=$("loadNewSegmentData"),_t=$("mergeVertices"),Ne=$("moveVertex"),Nt=$("splitSegment");function ws(n,e,t){if(t.dip===90||t.locking_depth<=0)return!1;const s=t.dip<90,r=(s?90-t.dip:t.dip-90)*(Math.PI/180),l=Math.abs(Math.tan(r)*t.locking_depth),[o,c]=n.lon>=e.lon?[n,e]:[e,n],u={lon:c.lat-o.lat,lat:-(c.lon-o.lon)};s&&(u.lon*=-1,u.lat*=-1);const f=nt(st([[o.lon,o.lat],[o.lon+u.lon,o.lat+u.lat]]),l,{units:"kilometers"}),d=nt(st([[c.lon,c.lat],[c.lon+u.lon,c.lat+u.lat]]),l,{units:"kilometers"});return[o,{lon:f.geometry.coordinates[0],lat:f.geometry.coordinates[1]},{lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1]},c]}function _s(n){return n.segments.map(e=>ws(n.vertecies[e.start],n.vertecies[e.end],e)).filter(e=>e)}const Ns=re(xs,n=>{n.addCase(yt,(e,t)=>us(e,t.payload)).addCase(bt,(e,t)=>fs(e,t.payload)).addCase(vt,(e,t)=>ms(e,t.payload)).addCase(xt,(e,t)=>ps(e,t.payload)).addCase(wt,(e,t)=>hs(e,t.payload)).addCase(_e,(e,t)=>gs(e,t.payload)).addCase(_t,(e,t)=>ys(e,t.payload)).addCase(Ne,(e,t)=>bs(e,t.payload)).addCase(Nt,(e,t)=>vs(e,t.payload))}),St=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Ss={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function ks(n){return p(p({},Ss),n)}function Cs(n,{data:e}){return[...n,ks(e)]}function Ls(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function $s(n,e){const t=[...n];for(const s of e.indices){const a=p(p({},t[s]),e.data);t[s]=a}return t}function Ds(n,e){return e}function Fs(n,{index:e,position:t}){const s=[...n],a=p(p({},s[e]),t);return s[e]=a,s}const js=[],kt=$("createVelocity"),Ct=$("editVelocity"),Lt=$("deleteVelocity"),Se=$("loadNewVelocityData"),$t=$("moveVelocity"),Vs=re(js,n=>{n.addCase(kt,(e,t)=>Cs(e,t.payload)).addCase(Ct,(e,t)=>$s(e,t.payload)).addCase(Lt,(e,t)=>Ls(e,t.payload)).addCase(Se,(e,t)=>Ds(e,t.payload)).addCase($t,(e,t)=>Fs(e,t.payload))});function le(n){const e=n.split(/\n/g),t=e[0].split(",").map(r=>r.trim()),s=e.slice(1),a=[];for(const r of s)if(r.trim()!==""){const l=r.split(/\s*,\s*/),o={};for(let c=0;c<t.length;c+=1){let u=l[c];const f=t[c],d=Number.parseFloat(u);u=Number.isNaN(d)?u:d,typeof u=="string"&&(u=u.startsWith('"')&&u.endsWith('"')?u.slice(1,-1).trim():u.trim()),o[f]=u}a.push(o)}return a}function ke(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(r=>{if(r in a){const l=a[r];return typeof l=="string"&&/\s/.test(`${l}`)?`"${l.trim()}"`:`${typeof l=="number"&&(r.includes("lon")||r.includes("lat"))?l.toFixed(6):l}`}return""}).join(","))}return t.join(`
`)}class Ce{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(a=>{const r={};for(const l of lt)r[l]=a[l]||(l==="name"?"":0);return r});this.data=s}async save(){var t;const e=ke((t=this.data)!=null?t:[],lt);await this.handle.setContents(e)}clone(){return new Ce(this.handle)}}const Ms={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Is(n){return p(p({},Ms),n)}class Le{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Is(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new Le(this.handle)}}class Ps{constructor(e){k(this,"data");k(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=le(e);this.data=t}async save(){}}function Os(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(s=>{const a=Number.parseFloat(s[1]),r=Number.parseFloat(s[2]);return{lon:a,lat:r}});return t.splice(0,0,{lon:0,lat:0}),t}const Rs={"1":n=>{var s,a;const e=Number.parseInt((s=n[n.length-2])!=null?s:"",10),t=Number.parseInt((a=n[n.length-1])!=null?a:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var a,r,l;const e=Number.parseInt((a=n[n.length-3])!=null?a:"",10),t=Number.parseInt((r=n[n.length-2])!=null?r:"",10),s=Number.parseInt((l=n[n.length-1])!=null?l:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(s)?[[e,t],[t,s],[s,e]]:!1}};function Es(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var s;return((s=Rs[e[1]])!=null?s:()=>!1)(e)}).filter(e=>e).flat()}function Bs(n,e){return e.map(([t,s])=>t!==s&&t>-1&&t<n.length&&s>-1&&s<n.length?[n[t],n[s]]:!1).filter(t=>t)}function As(n){const e=n.split("$");let t=[],s=[];for(const a of e)a.startsWith("Nodes")?t=Os(a):a.startsWith("Elements")&&(s=Es(a));return Bs(t,s)}class Ts{constructor(e){k(this,"data");k(this,"handle");k(this,"startLonColumn");k(this,"endLonColumn");k(this,"startLatColumn");k(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=As(e);else{const t=le(e);this.data=t.map(s=>{const a={lon:0,lat:0},r={lon:0,lat:0};console.log("parsing row",s),typeof s[this.startLonColumn]=="number"&&(a.lon=s[this.startLonColumn]),typeof s[this.startLatColumn]=="number"&&(a.lat=s[this.startLatColumn]),typeof s[this.endLonColumn]=="number"&&(r.lon=s[this.endLonColumn]),typeof s[this.endLatColumn]=="number"&&(r.lat=s[this.endLatColumn]);const l=Object.keys(s).filter(o=>o!==this.startLatColumn&&o!==this.endLatColumn&&o!==this.startLonColumn&&o!==this.endLonColumn);if(l.length>0){const o={};for(const c of l)o[c]=s[c];return[a,r]}return[a,r]})}}async save(){console.log("Mesh files do not get saved")}}class $e{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(c=>{const u={};for(const f of gt)u[f]=c[f]||(f==="name"?"":0);return u}),a={},r={},l=[];let o=0;for(const c of s){const[u,f]=q({lon:c.lon1,lat:c.lat1},a,r,o),[d,b]=q({lon:c.lon2,lat:c.lat2},a,r,f),w=v(p({},c),{start:u,end:d});o=b,l.push(w)}this.data={vertecies:r,segments:l,vertexDictionary:a,lastIndex:o}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(r=>{const l=s[r.start],o=s[r.end];return v(p({},r),{lon1:l.lon,lat1:l.lat,lon2:o.lon,lat2:o.lat})})}const t=ke(e,gt);await this.handle.setContents(t)}clone(){return new $e(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*P)},${Math.floor(s.lat*P)}`,r=p({},this.data.vertecies);delete r[e];const l=p({},this.data.vertexDictionary);delete l[a];const o=this.clone();return o.data=v(p({},this.data),{vertecies:r,vertexDictionary:l}),o}}return this}mergeVertices(e,t){if(this.data){for(const c of this.data.segments)c.start===t&&(c.start=e),c.end===t&&(c.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*P)},${Math.floor(s.lat*P)}`,r=p({},this.data.vertecies);delete r[t];const l=p({},this.data.vertexDictionary);delete l[a];const o=this.clone();return o.data=v(p({},this.data),{vertecies:r,vertexDictionary:l}),o}return this}moveVertex(e,t){if(this.data){const s=p({},this.data.vertecies),a=p({},this.data.vertexDictionary),r=[...this.data.segments],l=s[e],o=`${Math.floor(t.lon*P)},${Math.floor(t.lat*P)}`,c=`${Math.floor(l.lon*P)},${Math.floor(l.lat*P)}`;if(delete a[c],o in a){const f=a[o];for(const d of r)d.start===f&&(d.start=e),d.end===f&&(d.end=e);delete s[f]}s[e]=t;const u=this.clone();return u.data=v(p({},this.data),{segments:r,vertecies:s,vertexDictionary:a}),u}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],r={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[l,o]=q(r,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),c=v(p({},t),{end:l,name:`${t.name}_a`}),u=v(p({},t),{start:l,name:`${t.name}_b`}),f=[...this.data.segments];f[e]=c,f.push(u);const d=this.clone();return d.data=v(p({},this.data),{segments:f,lastIndex:o}),d}return this}bridgeVertices(e,t){if(this.data){const s=v(p({},ie),{start:e,end:t}),a=[...this.data.segments,s],r=this.clone();return r.data=v(p({},this.data),{segments:a}),r}return this}extrudeSegment(e,t){if(this.data){const s=p({},this.data.vertecies),a=p({},this.data.vertexDictionary),[r,l]=q(t,a,s,this.data.lastIndex),o=v(p({},ie),{start:e,end:r}),c=[...this.data.segments,o],u=this.clone();return u.data={vertecies:s,vertexDictionary:a,segments:c,lastIndex:l},u}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=v(p({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=p({},this.data.vertecies),a=p({},this.data.vertexDictionary),[r,l]=q(e,a,s,this.data.lastIndex),[o,c]=q(t,a,s,l),u=v(p({},ie),{start:r,end:o}),f=[...this.data.segments,u],d=this.clone();return d.data={vertecies:s,vertexDictionary:a,segments:f,lastIndex:c},d}return this}}class De{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=le(e).map(a=>{const r={};for(const l of St)r[l]=a[l]||(l==="name"?"":0);return r});this.data=s}async save(){var t;const e=ke((t=this.data)!=null?t:[],St);await this.handle.setContents(e)}clone(){return new De(this.handle)}}async function Dt(n){const e=new $e(n);return await e.initialize(),e}async function Ft(n){const e=new Ce(n);return await e.initialize(),e}async function jt(n){const e=new De(n);return await e.initialize(),e}async function Vt(n){const e=new Ts(n);return await e.initialize(),e}async function Ws(n){const e=new Ps(n);return await e.initialize(),e}async function ce(n,e,t){try{const s=await e.getFile(n);return await t(s)}catch{return!1}}async function Gs(n,e,t){const s=new Le(e);if(await s.initialize(),s.data){const a=await ce(s.data.segment_file_name,n,Dt),r=await ce(s.data.block_file_name,n,Ft),l=await ce(s.data.station_file_name,n,jt),o=await ce(s.data.mesh_parameters_file_name,n,async u=>{const f=JSON.parse(await u.getContents());return(await Promise.all(f.map(async b=>ce(b.mesh_filename,n,Vt)))).filter(b=>b)}),c=p({},t);return"command"in c&&(c.command=v(p({},c.command),{currentFilePath:e.name})),a&&"segment"in c&&(c.segment=v(p({},c.segment),{currentFilePath:s.data.segment_file_name})),r&&"block"in c&&(c.block=v(p({},c.block),{currentFilePath:s.data.block_file_name})),l&&"velocities"in c&&(c.velocities=v(p({},c.velocities),{currentFilePath:s.data.station_file_name})),o&&"mesh"in c&&(c.mesh=v(p({},c.mesh),{currentFilePath:o.map(u=>u.handle.name)})),{openableFiles:c,commands:s,segments:a,blocks:r,velocities:l,mesh:o}}throw new Error("Can't open command file")}class zs{constructor(e){k(this,"name");k(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Fe{constructor(e){k(this,"name");k(this,"handle");k(this,"fileList");k(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new zs(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new Fe(t);return await s.initialize(),s}}const Hs=async()=>{const n=await window.showDirectoryPicker(),e=new Fe(n);return await e.initialize(),e};class Js{constructor(e,t){k(this,"name");k(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class je{constructor(e,t){k(this,"name");k(this,"parent");k(this,"fileList");k(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Js(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new je(e,this.parent[this.name])}}const Ks=async n=>new je("root",n);let Mt=async()=>{var e;return Ks((e=window.FakeDirectory)!=null?e:{})};function Us(n){Mt=n}async function qs(){return Mt()}window.location.search.includes("fake-dir")||Us(Hs);var J;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(J||(J={}));const It={Block:J.Block,Vertex:J.Vertex,Velocity:J.Velocity},Qs={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments"};function Xs(){var qe,Qe,Xe;const n=rt(),[e,t]=S.exports.useState(),[s,a]=S.exports.useState(""),[r,l]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[o,c]=S.exports.useState(),[u,f]=S.exports.useState(),[d,b]=S.exports.useState(),[w,g]=S.exports.useState(),h=oe(m=>m.main.present.segment),_=oe(m=>m.main.present.block),N=oe(m=>m.main.present.velocity),B=oe(m=>m.main.present.meshLine),Z=oe(m=>m.main.present.genericSegments),[L,Ve]=S.exports.useState(Tn),[I,Me]=S.exports.useState(bn),[O,Ie]=S.exports.useState(Rn),[D,Pe]=S.exports.useState(zn),[K,Oe]=S.exports.useState(In),[U,Re]=S.exports.useState(_n),[A,te]=S.exports.useState("normal"),[ne,Tt]=S.exports.useState(J.Vertex),[me,Ee]=S.exports.useState([]),[Be,Ae]=S.exports.useState([]),[Te,We]=S.exports.useState([]),[Ge,ze]=S.exports.useState([]),[j,na]=S.exports.useState({select:(m,y)=>{Ee(m==="block"?y:[]),Ae(m==="segment"?y:[]),We(m==="velocities"?y:[]),ze(m==="vertex"?y:[]),a(m)}}),[Wt,Gt]=S.exports.useState([]),[zt,He]=S.exports.useState([]),[Ht,Jt]=S.exports.useState([]),[Kt,Je]=S.exports.useState([]),[Ut,pe]=S.exports.useState({color:D.color,selectedColor:D.activeColor,radius:D.radius,selectedRadius:D.activeRadius,points:[]}),[Ke,qt]=S.exports.useState({lon:0,lat:0}),[he,Qt]=S.exports.useState(!1);S.exports.useEffect(()=>{A==="normal"?j.select=(m,y)=>{Ee(m==="block"?y:[]),Ae(m==="segment"?y:[]),We(m==="velocities"?y:[]),ze(m==="vertex"?y:[]),a(m)}:A.mode==="override"?j.select=(m,y)=>{m===A.type&&A.callback(y)}:j.select=()=>{}},[A,j]),S.exports.useEffect(()=>{const m=[];ne!==J.Block&&!I.hide&&m.push({name:"blocks",color:I.color,selectedColor:I.selectedColor,radius:I.radius,points:_.map((y,C)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:C})),click:y=>{j.select("block",[y])}}),ne!==J.Vertex&&!D.hide&&m.push({name:"vertices",color:D.color,selectedColor:D.activeColor,radius:D.radius,click:y=>{j.select("vertex",[y])},points:Object.keys(h.vertecies).map(y=>{const C=Number.parseInt(y,10),V=h.vertecies[C];return V?{longitude:V.lon,latitude:V.lat,index:C,name:"",description:""}:!1}).filter(y=>!!y)}),Gt(m)},[I,_,O,j,ne,D.hide,D.color,D.activeColor,D.radius,h.vertecies]),S.exports.useEffect(()=>{const m=[];if(O.hide||m.push({name:"segments",color:O.color,selectedColor:O.activeColor,width:O.width,selectedWidth:O.activeWidth,lines:h.segments.map((y,C)=>{var W,G;const V=(W=h.vertecies[y.start])!=null?W:at,E=(G=h.vertecies[y.end])!=null?G:at,[[Q,M],[T,z]]=ve(V,E);return{startLongitude:Q,startLatitude:M,endLongitude:T,endLatitude:z,name:y.name,description:`${V.lon},${V.lat} to ${E.lon},${E.lat}`,index:C}}),click:y=>{j.select("segment",[y])}}),!K.hide)for(const y of Object.keys(B)){const C=B[y];m.push({name:`mesh:${y}`,color:K.color,selectedColor:K.activeColor,width:K.width,selectedWidth:K.activeWidth,lines:C.map((V,E)=>{const Q=V[0],M=V[1],[[T,z],[W,G]]=ve(Q,M);return{startLongitude:T,startLatitude:z,endLongitude:W,endLatitude:G,name:"",description:"",index:E}})||[]})}if(!U.hide)for(const y of Object.keys(Z)){const{startLat:C,startLon:V,endLat:E,endLon:Q,segments:M}=Z[y];C in M[0]&&E in M[0]&&V in M[0]&&Q in M[0]&&m.push({name:`generic_segment:${y}`,color:U.color,selectedColor:U.activeColor,width:U.width,selectedWidth:U.activeWidth,lines:M.map((T,z)=>{const W={lat:T[C],lon:T[V]},G={lat:T[E],lon:T[Q]};if(typeof W.lat!="number"||typeof W.lon!="number"||typeof G.lat!="number"||typeof G.lon!="number")return!1;const[[de,ue],[F,fe]]=ve(W,G);return{startLongitude:de,startLatitude:ue,endLongitude:F,endLatitude:fe,name:"",description:"",index:z}}).filter(T=>T)||[]})}Jt(m)},[h,O,U,Z,K,B,j]),S.exports.useEffect(()=>{switch(ne){case J.Vertex:{pe({color:D.color,radius:D.radius,selectedColor:D.activeColor,selectedRadius:D.activeRadius,points:D.hide?[]:Object.keys(h.vertecies).map(m=>{const y=Number.parseInt(m,10),C=h.vertecies[y];return C?{longitude:C.lon,latitude:C.lat,index:y}:!1}).filter(m=>!!m),update:(m,y)=>{n(Ne({index:m,vertex:y}))},select:m=>{j.select("vertex",m)}});break}case J.Block:{pe({color:I.color,radius:I.radius,selectedColor:I.selectedColor,selectedRadius:I.radius,points:I.hide?[]:_.map((m,y)=>({longitude:m.interior_lon,latitude:m.interior_lat,name:m.name,description:"",index:y})),update:(m,y)=>{n(mt({index:m,position:y}))},select:m=>{j.select("block",m)}});break}case J.Velocity:{pe({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:N.map((m,y)=>({longitude:m.lon,latitude:m.lat,name:m.name,description:"",index:y})),update:(m,y)=>{n($t({index:m,position:y}))},select:m=>{j.select("velocities",m)}});break}}},[D,j,h.vertecies,n,ne,I.color,I.radius,I.selectedColor,I.hide,_,L.color,L.width,L.selectedColor,L.hide,N]),S.exports.useEffect(()=>{L.hide?He([]):He([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:N.map((m,y)=>{const C=Math.sqrt(m.east_vel*m.east_vel+m.north_vel*m.north_vel);return{longitude:m.lon,latitude:m.lat,direction:[m.east_vel/C,m.north_vel/C],scale:C,name:m.name,description:`north: ${m.north_vel}, east: ${m.east_vel}`,index:y}}),click:m=>{j.select("velocities",[m])}}])},[j,L,N]),S.exports.useEffect(()=>{O.hideProjection?Je([]):Je([{name:"fault_dip_projections",color:O.projectionColor,borderColor:O.projectionColor,borderRadius:.5,polygons:_s(h).map((m,y)=>({polygon:m,index:y,name:"",description:""}))}])},[O,h]);let Y=i("span",{});switch(s){case"files":Y=e?i(xn,{folder:e,files:r,setFile:async(m,y,C,V)=>{if(V){let E=p({},r);const Q=E[y];let{currentFilePath:M,allowMultiple:T}=Q;switch(T?Array.isArray(M)?(M=M.map(z=>z),M.length>m?M[m]=C:M.push(C)):M=[C]:M=C,E[y]=v(p({},Q),{currentFilePath:M}),y){case"segment":const z=await Dt(V);f(z),z.data&&n(_e(z.data));break;case"block":const W=await Ft(V);b(W),W.data&&n(xe(W.data));break;case"velocity":const G=await jt(V);g(G),G.data&&n(Se(G.data));break;case"mesh":const de=await Vt(V);de.data&&n(we({mesh:`mesh_file_${m}`,data:de.data}));break;case"csv":const ue=await Ws(V);ue.data&&n(pt({name:`generic_segment_${m}`,data:ue.data}));break;case"command":const F=await Gs(e,V,r);c(F.commands!==!1?F.commands:void 0),f(F.segments!==!1?F.segments:void 0),F.segments!==!1&&F.segments.data&&n(_e(F.segments.data)),b(F.blocks!==!1?F.blocks:void 0),F.blocks!==!1&&F.blocks.data&&n(xe(F.blocks.data)),g(F.velocities!==!1?F.velocities:void 0),F.velocities!==!1&&F.velocities.data&&n(Se(F.velocities.data)),F.mesh&&F.mesh.map((fe,Ze)=>(fe.data&&n(we({mesh:`mesh_file_${Ze}`,data:fe.data})),Ze)),E=F.openableFiles;break}l(E)}}}):i("span",{});break;case"velocities":Y=i(Wn,{settings:L,setSettings:Ve,selected:Te,velocitys:N,setVelocityData:(m,y)=>{y?n(Ct({indices:m,data:y})):(n(Lt(m)),j.select("velocity",[]))},addNewVelocity:()=>{te({label:"Click to place velocity estimate",mode:"mapClick",callback:m=>{te("normal");const y=N.length;n(kt({data:{lat:m.lat,lon:m.lon}})),j.select("velocity",[y])}})},save:async()=>{w&&(w.data=N,await w.save())}});break;case"block":Y=i(vn,{settings:I,setSettings:Me,selected:me,blocks:_,addNewBlock:()=>{te({label:"Click to place new block",mode:"mapClick",callback:m=>{const y=_.length;n(dt({data:{name:"New Block",interior_lon:m.lon,interior_lat:m.lat}})),j.select("block",[y]),te("normal")}})},setBlockData:(m,y)=>{y?n(ut({indices:me,data:y})):(n(ft(m)),j.select("block",[]))},save:async()=>{d&&(d.data=_,await d.save())}});break;case"segment":Y=i(En,{settings:O,setSettings:Ie,segments:(qe=h.segments)!=null?qe:[],selected:Be,setSelectionMode:m=>te(m),addNewSegment:(m,y)=>{const C=h.segments.length;n(bt({start:m,end:y})),j.select("segment",[C])},setSegmentData:(m,y)=>{n(y?xt({indices:m,data:y}):vt({index:m}))},splitSegment:m=>{n(Nt(m)),j.select("segment",[])},save:async()=>{u&&(u.data=h,await u.save())}});break;case"vertex":Y=i(Hn,{settings:D,setSettings:Pe,vertices:(Qe=h.vertecies)!=null?Qe:{},selected:Ge,setVertexData:(m,y)=>{y&&n(Ne({index:m,vertex:y}))},setSelectionMode:m=>te(m),mergeVertices:(m,y)=>{n(_t({a:m,b:y}))},bridgeVertices:(m,y)=>{n(yt({a:m,b:y}))},extrudeVertex:(m,y)=>{n(wt({index:m,targetPoint:y}))},save:async()=>{u&&(u.data=h,await u.save())}});break;case"mesh":Y=i(Pn,{settings:K,setSettings:Oe});break;case"csv":Y=i(Nn,{settings:U,setSettings:Re,setCollectionVertexKeys:m=>{n(ht(m))},collections:Z});break}const Ue={Block:{state:I.hide,change:()=>{Me(v(p({},I),{hide:!I.hide}))}},Vertex:{state:D.hide,change:()=>{Pe(v(p({},D),{hide:!D.hide}))}},Velocity:{state:L.hide,change:()=>{Ve(v(p({},L),{hide:!L.hide}))}},Segment:{state:O.hide,change:()=>{Ie(v(p({},O),{hide:!O.hide}))}},Grid:{state:!he,change:()=>{Qt(!he)}},Mesh:{state:K.hide,change:()=>{Oe(v(p({},K),{hide:!K.hide}))}},GenericSegments:{state:U.hide,change:()=>{Re(v(p({},U),{hide:!U.hide}))}}};return x("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:m=>{m.key==="Escape"&&te("normal")},children:[i(Bn,{filesOpen:((Xe=o!=null?o:u)!=null?Xe:d)!==void 0,saveFiles:async()=>{o&&await o.save(),u&&(u.data=h,await u.save()),d&&(d.data=_,await d.save()),w&&(w.data=N,await w.save())},folder:e,openFolder:async()=>{const m=await qs();t(m),a("files")}}),A!=="normal"?i("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:x("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[i("span",{className:"text-lg font-semibold",children:A.label}),A.subtitle?i("span",{className:"text-md font-thin text-gray-500",children:A.subtitle}):i(R,{}),i("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):i(R,{}),x("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[i("div",{className:"flex flex-row items-center justify-start gap-5",children:x("span",{className:"p-1 text-sm text-center",children:["Hold ",i("span",{className:"font-bold",children:"Shift"})," to box select"," ",i("span",{className:"font-bold",children:ne})]})}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),x("span",{children:[Math.floor(Ke.lon*1e3)/1e3,","," ",Math.floor(Ke.lat*1e3)/1e3]})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[i("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(It).map(m=>{const y=It[m];return i("button",{type:"button",className:`${ne===y?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Tt(y)},children:m},m)})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Ue).map(m=>{const y=Ue[m];return i("button",{type:"button",className:`${y.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{y.change()},children:m},m)})]})]}),i(Vn,{pointSources:Wt,arrowSources:zt,lineSources:Ht,drawnPointSource:Ut,polygonSources:Kt,selections:{segments:Be,blocks:me,velocities:Te,vertices:Ge},displayGrid:he?10:-1,click:m=>{typeof A!="string"&&A.mode==="mapClick"&&A.callback(m)},mouseMove:m=>{qt(m)}}),i(Sn,{view:Y,buttons:e?Qs:void 0,active:s,setActive:m=>a(m)})]})}const Zs=rn({reducer:{main:ln(cn({segment:Ns,block:Yn,velocity:Vs,meshLine:ds,genericSegments:os}))}});function Ys(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:r}=n;let l;const o=async(c=!0)=>{};return"serviceWorker"in navigator&&(l=new dn("./sw.js",{scope:"./"}),l.addEventListener("activated",c=>{c.isUpdate?window.location.reload():s==null||s()}),l.register({immediate:e}).then(c=>{a==null||a(c)}).catch(c=>{r==null||r(c)})),o}Ys();const ea=1,ta=new un({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ea}}});fn.render(i(S.exports.StrictMode,{children:i(mn,{client:ta,children:i(pn,{store:Zs,children:i(Xs,{})})})}),document.querySelector("#root"));
