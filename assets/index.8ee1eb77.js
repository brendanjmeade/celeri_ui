var Yt=Object.defineProperty,en=Object.defineProperties;var tn=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var nn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var we=(n,e,t)=>e in n?Yt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))nn.call(e,t)&&we(n,t,e[t]);if(at)for(var t of at(e))an.call(e,t)&&we(n,t,e[t]);return n},v=(n,e)=>en(n,tn(e));var C=(n,e,t)=>(we(n,typeof e!="symbol"?e+"":e,t),t);import{j as o,a as x,F as E,r as S,M as sn,m as st,R as on,b as Ne,u as ln,c as rn,l as ot,d as ce,e as F,f as it,g as lt,h as cn,i as dn,k as un,v as fn,Q as mn,n as pn,o as hn,P as gn}from"./vendor.51d006dc.js";const yn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}};yn();const _e=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],rt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function bn(n){return n?p(p({},rt),n):p({},rt)}class ct{constructor(e){C(this,"name");C(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Se{constructor(e){C(this,"name");C(this,"handle");C(this,"fileList");C(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){const t=await this.handle.getFileHandle(e,{create:!0});return new ct(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),a=new Se(t);return await a.initialize(),a}}const vn=async()=>{const n=await window.showDirectoryPicker(),e=new Se(n);return await e.initialize(),e};class xn{constructor(e,t){C(this,"name");C(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ke{constructor(e,t){C(this,"name");C(this,"parent");C(this,"fileList");C(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const a=t[e];for(const s of Object.keys(a))typeof a[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new xn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ke(e,this.parent[this.name])}}const wn=async n=>new ke("root",n);let dt=async()=>{var e;return wn((e=window.FakeDirectory)!=null?e:{})};function Nn(n){dt=n}async function _n(){return dt()}async function Ce(n){const e={types:[{description:"CSV Files",accept:{"text/plain":n}}]},t=await window.showSaveFilePicker(e);return new ct(t)}function Sn({value:n,fieldDefinition:e,setField:t}){const[a,s]=S.exports.useState(-1),[l,c]=S.exports.useState(n);S.exports.useEffect(()=>{c(n)},[n]);let i=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof n=="number"?"number":"text",value:l,onChange:u=>{const m=typeof n=="number"?Number.parseFloat(u.target.value):u.target.value;c(m),a>-1&&clearTimeout(a),s(setTimeout(()=>t(m),1e3))}});return e.type==="select"&&(i=x("select",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",value:l,onChange:u=>{t(u.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(u=>o("option",{value:u.name,"data-testid":`input-editor-${e.name}-${u.name}`,children:u.name},u.name))]})),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(E,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:i})]})}function oe({title:n,items:e,setItems:t,fieldDefinitions:a,ignoreFields:s,deletable:l,controls:c}){const i=e[0],u=Object.keys(i).map((m,d)=>{if(s==null?void 0:s.includes(m))return{element:o("span",{style:{display:"hidden"}},m),order:d+1e4};let w=i[m];for(const b of e)if(b[m]!==w){w="-";break}const r=m in a&&a[m];return r?{element:o(Sn,{value:w,fieldDefinition:r,setField:b=>t({[m]:b})},m),order:r.order}:{element:x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${m}`,className:"text-l font-bold",children:m}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${m}`,className:"bg-gray-800 w-full",type:typeof w=="number"?"number":"text",value:w,onChange:b=>{t({[m]:typeof w=="number"?Number.parseFloat(b.target.value):b.target.value})}})})]},m),order:d+1e3}}).sort((m,d)=>m.order-d.order).map(m=>m.element);return x("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),x("span",{className:"flex flex-row justify-end gap-2 grow",children:[c,l?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):o(E,{})]})]}),u]})}oe.defaultProps={ignoreFields:[],controls:o(E,{})};const kn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},Cn=["",..._e];var Rt;const Ln=JSON.parse((Rt=window.localStorage.getItem("blockDisplaySettings"))!=null?Rt:"false")||kn;function $n({settings:n,setSettings:e,selected:t,blocks:a,setBlockData:s,addNewBlock:l,save:c}){const i=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},u=t.map(d=>a[d]).filter(d=>d),m=u.length>0?o(oe,{title:u.length===1?u[0].name:"Edit Selected Blocks",items:u,deletable:!0,setItems:d=>s(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(E,{});return x(E,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{i(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const d=await Ce([".csv"]);c(d)},children:"Save As"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:d=>{i(v(p({},n),{color:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:d=>{i(v(p({},n),{selectedColor:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:d=>{i(v(p({},n),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:n.plottableKey,onChange:d=>{i(v(p({},n),{plottableKey:d.currentTarget.value}))},children:Cn.map(d=>o("option",{value:d,children:d},d))})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:l,children:"New Block"})]}),m]})}function Fn({folder:n,files:e,setFile:t}){const a=Object.keys(e).map(s=>{const l=e[s],c=Array.isArray(l.currentFilePath)?[...l.currentFilePath]:[l.currentFilePath];return l.allowMultiple&&c.push(""),x("div",{className:"flex flex-row justify-between items-center",children:[x("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:l.name}),o("span",{className:"text-sm","data-testid":`file-${s}-description`,children:l.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:c.map((i,u)=>x("select",{"data-testid":`file-${s}-select-${u}`,className:"bg-gray-800 w-full m-1",value:i,onChange:async m=>{const d=m.currentTarget.value;try{const w=await n.getFile(d);t(u,s,w.name,w)}catch{t(u,s,"")}},children:[o("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),n.fileList.filter(m=>m.endsWith(l.extension)).map(m=>o("option",{value:m,"data-testid":`file-${s}-select-${m}`,children:m},m))]},u))})]},s)});return o("div",{className:"flex flex-col gap-2",children:a})}const Dn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Bt;const jn=p(p({},Dn),JSON.parse((Bt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Bt:"{}"));function Vn({settings:n,setSettings:e,collections:t,setCollectionVertexKeys:a}){const s=c=>{e(c),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(c))},l=Object.keys(t).map(c=>{const{startLat:i,startLon:u,endLat:m,endLon:d,segments:w,plot:r}=t[c],b=Object.keys(w[0]).map((_,h)=>({name:_,value:h}));return o(oe,{title:c,items:[{startLat:i,startLon:u,endLat:m,endLon:d,plot:r}],deletable:!1,setItems:_=>{a(p({collection:c,startLat:i,startLon:u,endLat:m,endLon:d,plot:r},_))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:b},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:b},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:b},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:b},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:b}}},c)});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{s(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:c=>{s(v(p({},n),{color:c.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:c=>{s(v(p({},n),{width:Number.parseFloat(c.target.value)}))}})})]}),l]})}function Mn({view:n,buttons:e,active:t,setActive:a}){if(!e)return o("span",{});const s=[];for(const l of Object.keys(e)){const c=e[l],i=l===t;s.push(o("button",{type:"button","data-testid":`tab-${l}`,className:`${i?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(i?"":l),children:c},l))}return x("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:n}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:s})]})}const ut={lon:0,lat:0},In=180,ie=360;function ft(n){let{lon:e,lat:t}=n;for(;e<0;)e+=ie;for(;e>ie;)e-=ie;return[e,t]}function Le([n,e]){return{lon:n<0?n+ie:n,lat:e}}function $e(n,e){const t=ft(n),a=ft(e),s=[a[0],a[1]];return a[0]-t[0]>=In?s[0]-=ie:s[0]+=ie,Math.abs(t[0]-a[0])>Math.abs(t[0]-s[0])?[t,s]:[t,a]}const R=1e6;function Q(n,e,t,a){const s=`${Math.floor(n.lon*R)},${Math.floor(n.lat*R)}`;if(s in e)return[e[s],a];const l=a;return t[l]=n,e[s]=l,[l,a+1]}function mt(n,e){let t=!1;for(const a of n.segments)if(a.start===e||a.end===e){t=!0;break}if(!t&&n.vertecies[e]){const a=n.vertecies[e],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,l=p({},n.vertecies);delete l[e];const c=p({},n.vertexDictionary);return delete c[s],v(p({},n),{vertecies:l,vertexDictionary:c})}return n}const Z=Math.PI/6,ee=2*Math.PI-Z;function Pn(n,e,{map:t,popup:a,internalArrowSources:s,mapLoaded:l,internalSelections:c},{arrowSources:i,selections:u}){var w;if(t&&l&&s!==i)if(console.log("Setting arrows in map!"),s){for(const r of s){const b=t.getSource(`arrow:${r.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${r.name}`),t.removeLayer(`layer:arrow:${r.name}:click`);try{t.getLayer(`layer:arrow:${r.name}:labels`)&&t.removeLayer(`layer:arrow:${r.name}:labels`)}catch{console.log("no label layer")}}e({internalArrowSources:void 0})}else{for(const r of i){let b=t.getSource(`arrow:${r.name}`);const _=b===void 0;if(_&&(t.addSource(`arrow:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addSource(`arrow:${r.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`arrow:${r.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:r.arrows.map(h=>{var te;const g=h.scale*r.scale,N=r.scale*r.arrowHeadScale,k=[h.longitude+h.direction[0]*g,h.latitude+h.direction[1]*g],A=[k[0]+(Math.cos(Z)*-h.direction[0]-Math.sin(Z)*-h.direction[1])*N,k[1]+(Math.sin(Z)*-h.direction[0]+Math.cos(Z)*-h.direction[1])*N],L=[k[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*N,k[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*N];return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:(te=u[r.name])==null?void 0:te.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],k,A,k,L]}}})}),t.addLayer({id:`layer:arrow:${r.name}`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":r.width}}),t.addLayer({id:`layer:arrow:${r.name}:click`,type:"line",source:`arrow:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(w=r.arrows[0])==null?void 0:w.label){const h=t.getSource(`arrow:${r.name}:points`);h&&(h.setData({type:"FeatureCollection",features:r.arrows.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),t.addLayer({id:`layer:arrow:${r.name}:labels`,type:"symbol",source:`arrow:${r.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}_&&(t.on("mouseenter",`layer:arrow:${r.name}:click`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const N=[...g.geometry.coordinates],{description:k}=g.properties;for(;Math.abs(h.lngLat.lng-N[0])>180;)N[0]+=h.lngLat.lng>N[0]?360:-360;a.setLngLat(N).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:arrow:${r.name}:click`,()=>{a.remove()}),t.on("click",`layer:arrow:${r.name}:click`,h=>{let g;if(n.state.internalArrowSources)for(const k of n.state.internalArrowSources)g=k.click;if(!h.features||!g)return;const N=h.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:k}=N.properties;g(k)}}))}e({internalArrowSources:i})}const m=p({},c);let d=!1;for(const r of Object.keys(u))if(u[r]!==c[r]){for(const b of i)if(b.name===r){d=!0,m[r]=u[r];const _=t==null?void 0:t.getSource(`arrow:${b.name}`);if(_){const h=u[r];_.setData({type:"FeatureCollection",features:b.arrows.map(g=>{const N=g.scale*b.scale,k=b.scale*b.arrowHeadScale,A=[g.longitude+g.direction[0]*N,g.latitude+g.direction[1]*N],L=[A[0]+(Math.cos(Z)*-g.direction[0]-Math.sin(Z)*-g.direction[1])*k,A[1]+(Math.sin(Z)*-g.direction[0]+Math.cos(Z)*-g.direction[1])*k],te=[A[0]+(Math.cos(ee)*-g.direction[0]-Math.sin(ee)*-g.direction[1])*k,A[1]+(Math.sin(ee)*-g.direction[0]+Math.cos(ee)*-g.direction[1])*k];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:h==null?void 0:h.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],A,L,A,te]}}})})}}}d&&e({internalSelections:m})}function On(n,{map:e,draw:t,drawnPointSettings:a,mapLoaded:s,internalDrawnPointSource:l},{drawnPointSource:c}){if(e&&s&&l!==c){console.log("Drawning Points"),n({internalDrawnPointSource:c});let i=t;if((c.selectedColor!==a.selectedColor||c.selectedRadius!==a.selectedRadius||c.color!==a.color||c.radius!==a.radius)&&(n({drawnPointSettings:{color:c.color,radius:c.radius,selectedRadius:c.selectedRadius,selectedColor:c.selectedColor}}),t&&(e.removeControl(t),i=void 0),c?(i=new sn({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":c.selectedRadius,"circle-color":c.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":c.radius,"circle-color":c.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(i),n({draw:i})):i=void 0),i){const u=i.getAll(),m=c.points.length!==u.features.length?void 0:i.getSelected(),d={type:"FeatureCollection",features:c.points.map(w=>({type:"Feature",id:w.index.toString(),properties:{description:"",index:w.index,name:""},geometry:{type:"Point",coordinates:[w.longitude,w.latitude]}}))};if(i.set(d),m&&m.features.length>0&&m.features[0].properties&&typeof m.features[0].properties.index=="number"){const w=m.features[0].id;w&&i.changeMode("simple_select",{featureIds:[w]})}}}}const G="grid";function Rn(n,e,{map:t,internalGridDisplay:a,popup:s,mapLoaded:l},{displayGrid:c}){if(t&&l&&a!==c){if(console.log("Drawing Grid on map!"),a&&a>0){const i=t.getSource(G);i!==void 0&&i.setData({type:"FeatureCollection",features:[]}),t.removeLayer(G),e({internalGridDisplay:void 0})}else if(c&&c>0){let i=t.getSource(G);const u=i===void 0;if(u&&(t.addSource(G,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i=t.getSource(G)),i!==void 0){const m=[];for(let d=-170;d<=180;d+=c)m.push({type:"Feature",properties:{label:`Lon: ${d<0?d+360:d}`},geometry:{type:"LineString",coordinates:[[d,-90],[d,90]]}});for(let d=-90;d<=90;d+=c)m.push({type:"Feature",properties:{label:`Lat: ${d}`},geometry:{type:"LineString",coordinates:[[180,d],[-180,d]]}});i.setData({type:"FeatureCollection",features:m})}t.addLayer({id:G,type:"line",source:G,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${G}:click`,type:"line",source:G,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),u&&(t.on("mouseenter",`${G}:click`,m=>{if(!m.features)return;const d=m.features[0];d.geometry.type==="LineString"&&d.properties&&typeof d.properties.label=="string"&&s.setLngLat(m.lngLat).setHTML(`${d.properties.label}`).addTo(t)}),t.on("mouseleave",`${G}:click`,()=>{s.remove()}))}e({internalGridDisplay:c})}}function Bn(n,e,{map:t,popup:a,internalLineSources:s,mapLoaded:l,internalSelections:c},{lineSources:i,selections:u}){var w;if(t&&l&&s!==i)if(console.log("Setting lines in map!"),s){for(const r of s){const b=t.getSource(`line:${r.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${r.name}`);try{t.getLayer(`layer:line:${r.name}:click`)&&t.removeLayer(`layer:line:${r.name}:click`)}catch{console.log("no click layer")}try{t.getLayer(`layer:line:${r.name}:labels`)&&t.removeLayer(`layer:line:${r.name}:labels`)}catch{console.log("no label layer")}}e({internalLineSources:void 0})}else{for(const r of i){let b=t.getSource(`line:${r.name}`);const _=b===void 0;if(_&&(t.addSource(`line:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addSource(`line:${r.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`line:${r.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:r.lines.map(h=>{var g,N;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,label:(g=h.label)!=null?g:"",selected:((N=u[r.name])==null?void 0:N.includes(h.index))||!1},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),t.addLayer({id:`layer:line:${r.name}`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],r.selectedColor,r.color],"line-width":["case",["get","selected"],r.selectedWidth,r.width]}}),(w=r.lines[0])==null?void 0:w.label){const h=t.getSource(`line:${r.name}:points`);h&&(h.setData({type:"FeatureCollection",features:r.lines.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[(g.startLongitude+g.endLongitude)/2,(g.startLatitude+g.endLatitude)/2]}}))}),t.addLayer({id:`layer:line:${r.name}:labels`,type:"symbol",source:`line:${r.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}r.click&&(t.addLayer({id:`layer:line:${r.name}:click`,type:"line",source:`line:${r.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":r.width*10}}),_&&(t.on("mouseenter",`layer:line:${r.name}:click`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="LineString"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const N=[(g.geometry.coordinates[0][0]+g.geometry.coordinates[1][0])/2,(g.geometry.coordinates[0][1]+g.geometry.coordinates[1][1])/2],{description:k}=g.properties;for(;Math.abs(h.lngLat.lng-N[0])>180;)N[0]+=h.lngLat.lng>N[0]?360:-360;a.setLngLat(N).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:line:${r.name}:click`,()=>{a.remove()}),t.on("click",`layer:line:${r.name}:click`,h=>{let g;if(n.state.internalLineSources)for(const k of n.state.internalLineSources)k.name===r.name&&(g=k.click);if(!h.features||!g)return;const N=h.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:k}=N.properties;g(k)}})))}e({internalLineSources:i})}const m=p({},c);let d=!1;for(const r of Object.keys(u))if(u[r]!==c[r]){for(const b of i)if(b.name===r){d=!0,m[r]=u[r];const _=t==null?void 0:t.getSource(`line:${b.name}`);if(_){const h=u[r];_.setData({type:"FeatureCollection",features:b.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:h==null?void 0:h.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))})}}}d&&e({internalSelections:m})}function En(n,e,{map:t,popup:a,internalPointSources:s,mapLoaded:l,internalSelections:c},{pointSources:i,selections:u}){var w;if(!t||!l)return;if(s!==i)if(console.log("Setting points in map!"),s){for(const r of s){const b=t.getSource(`point:${r.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${r.name}`);try{t.getLayer(`layer:point:${r.name}:labels`)&&t.removeLayer(`layer:point:${r.name}:labels`)}catch{console.log("no label layer")}}e({internalPointSources:void 0})}else{for(const r of i){let b=t.getSource(`point:${r.name}`);const _=b===void 0;_&&(t.addSource(`point:${r.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=t.getSource(`point:${r.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:r.points.map(h=>{var g;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:!((g=u[r.name])==null?void 0:g.includes(h.index)),label:h.label},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}})}),t.addLayer({id:`layer:point:${r.name}`,type:"circle",source:`point:${r.name}`,paint:{"circle-color":["case",["get","selected"],r.color,r.selectedColor],"circle-radius":r.radius}}),((w=r.points[0])==null?void 0:w.label)&&t.addLayer({id:`layer:point:${r.name}:labels`,type:"symbol",source:`point:${r.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),_&&(t.on("mouseenter",`layer:point:${r.name}`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const N=[...g.geometry.coordinates],{description:k}=g.properties;for(;Math.abs(h.lngLat.lng-N[0])>180;)N[0]+=h.lngLat.lng>N[0]?360:-360;a.setLngLat(N).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:point:${r.name}`,()=>{a.remove()}),t.on("click",`layer:point:${r.name}`,h=>{let g;if(n.state.internalPointSources)for(const k of n.state.internalPointSources)g=k.click;if(!h.features||!g)return;const N=h.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:k}=N.properties;g(k)}}))}e({internalPointSources:i})}const m=p({},c);let d=!1;for(const r of Object.keys(u))if(u[r]!==c[r]){for(const b of i)if(b.name===r){d=!0,m[r]=u[r];const _=t.getSource(`point:${b.name}`);if(_){const h=u[r];_.setData({type:"FeatureCollection",features:b.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:!(h==null?void 0:h.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))})}}}d&&e({internalSelections:m})}function An(n,e,{map:t,internalPolygonSources:a,mapLoaded:s},{polygonSources:l,selections:c}){if(t&&s&&a!==l)if(a){for(const i of a){const u=t.getSource(`poly:${i.name}`);u!==void 0&&u.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:poly:${i.name}`),t.removeLayer(`layer:poly:${i.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const i of l){let u=t.getSource(`poly:${i.name}`);u===void 0&&(t.addSource(`poly:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),u=t.getSource(`poly:${i.name}`)),u!==void 0&&u.setData({type:"FeatureCollection",features:i.polygons.map(d=>{var w;return{type:"Feature",properties:{description:d.name||d.description?`<strong>${d.name}</strong><p>${d.description}</p>`:"",index:d.index,name:d.name,selected:((w=c[i.name])==null?void 0:w.includes(d.index))||!1},geometry:{type:"Polygon",coordinates:[d.polygon.map(r=>[r.lon,r.lat])]}}})}),t.addLayer({id:`layer:poly:${i.name}:fill`,type:"fill",source:`poly:${i.name}`,layout:{},paint:{"fill-color":i.color,"fill-opacity":.5}}),t.addLayer({id:`layer:poly:${i.name}`,type:"line",source:`poly:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":i.borderColor,"line-width":i.borderRadius}})}e({internalPolygonSources:l})}}st.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Tn extends on.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new Ne.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(st.accessToken&&t){const a=new Ne.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});a.addControl(new Ne.exports.NavigationControl),this.setState({map:a}),a.on("load",()=>{this.setState({mapLoaded:!0})}),a.on("click",({lngLat:s})=>{const{click:l}=this.props;l(Le([s.lng,s.lat]))}),a.on("mousemove",({lngLat:s})=>{const{mouseMove:l}=this.props;l&&l(Le([s.lng,s.lat]))}),a.on("draw.selectionchange",({features:s})=>{const{internalDrawnPointSource:l}=this.state;if(!l||!(l==null?void 0:l.select))return;const c=s.map(i=>i&&i.type==="Feature"&&i.geometry.type==="Point"&&i.properties&&"index"in i.properties&&typeof i.properties.index=="number"?i.properties.index:-1).filter(i=>i>-1);l.select(c)}),a.on("draw.update",({features:s,action:l})=>{const{internalDrawnPointSource:c}=this.state;if(!!(c==null?void 0:c.update)&&l==="move"&&s.length>0)for(const i of s)i.type==="Feature"&&i.geometry.type==="Point"&&i.properties&&"index"in i.properties&&typeof i.properties.index=="number"&&c.update(i.properties.index,Le(i.geometry.coordinates))})}}componentDidUpdate(){return Rn(this,e=>this.setState(e),this.state,this.props),An(this,e=>this.setState(e),this.state,this.props),Bn(this,e=>this.setState(e),this.state,this.props),Pn(this,e=>this.setState(e),this.state,this.props),En(this,e=>this.setState(e),this.state,this.props),On(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const Wn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Et;const Kn=p(p({},Wn),JSON.parse((Et=window.localStorage.getItem("meshDisplaySettings"))!=null?Et:"{}"));function zn({settings:n,setSettings:e}){const t=a=>{e(a),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(a))};return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:a=>{t(v(p({},n),{color:a.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:a=>{t(v(p({},n),{width:Number.parseFloat(a.target.value)}))}})})]})]})}const Fe=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],le={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Gn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var At;const Hn=p(p({},Gn),JSON.parse((At=window.localStorage.getItem("segmentDisplaySettings"))!=null?At:"{}")),Jn=["",...Fe];function Un({settings:n,setSettings:e,segments:t,selected:a,setSegmentData:s,addNewSegment:l,splitSegment:c,setSelectionMode:i,save:u}){const m=r=>{e(r),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(r))},d=a.map(r=>t[r]).filter(r=>r),w=d.length>0?o(oe,{title:d.length===1?d[0].name:"Edit Selected Segments",items:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:r=>s(a,r),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>c(a),children:"Split Segment"})}):o(E,{});return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{m(v(p({},n),{hide:!n.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hideProjection,onChange:()=>{m(v(p({},n),{hideProjection:!n.hideProjection}))}})})]}),x("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Save Segments & Vertices"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const r=await Ce([".csv"]);u(r)},children:"Save As"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:r=>{m(v(p({},n),{color:r.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:r=>{m(v(p({},n),{width:Number.parseFloat(r.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:r=>{m(v(p({},n),{activeColor:r.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:r=>{m(v(p({},n),{activeWidth:Number.parseFloat(r.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.projectionColor,onChange:r=>{m(v(p({},n),{projectionColor:r.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:n.plottableKey,onChange:r=>{m(v(p({},n),{plottableKey:r.currentTarget.value}))},children:Jn.map(r=>o("option",{value:r,children:r},r))})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Select Segment Starting Point",callback:r=>{i({mode:"mapClick",label:"Select Segment End point",callback:b=>{l(r,b),i("normal")}})}})},children:"New Segment"})]}),w]})}const pt=()=>ln(),re=rn;function qn({folder:n,openFolder:e,filesOpen:t,saveFiles:a}){function s(){e()}const l=pt(),[c,i]=re(u=>[u.main.past.length>0,u.main.future.length>0]);return x("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),x("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?o("button",{type:"button",onClick:()=>{l(ot.ActionCreators.undo())},"data-testid":"undo-button",disabled:!c,children:"Undo"}):o(E,{}),n?o("button",{type:"button",onClick:()=>{l(ot.ActionCreators.redo())},disabled:!i,"data-testid":"undo-button",children:"Redo"}):o(E,{}),n?x("span",{children:["Working in ",n.name]}):o("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),t?o("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Files"}):o(E,{})]})]})}const De=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Qn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Xn(n){return p(p({},Qn),n)}const Zn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},Yn=["",...De];var Tt;const ea=JSON.parse((Tt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Tt:"false")||Zn;function ta({settings:n,setSettings:e,selected:t,velocitys:a,setVelocityData:s,addNewVelocity:l,save:c}){const i=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},u=t.map(d=>a[d]).filter(d=>d),m=u.length>0?o(oe,{title:u.length===1?u[0].name:"Edit Selected Velocities",items:u,deletable:!0,setItems:d=>s(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(E,{});return x(E,{children:[x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{i(v(p({},n),{hide:!n.hide}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const d=await Ce([".csv"]);c(d)},children:"Save As"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:d=>{i(v(p({},n),{color:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:d=>{i(v(p({},n),{selectedColor:d.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:d=>{i(v(p({},n),{scale:Number.parseFloat(d.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:d=>{i(v(p({},n),{width:Number.parseFloat(d.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:d=>{i(v(p({},n),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:n.plottableKey,onChange:d=>{i(v(p({},n),{plottableKey:d.currentTarget.value}))},children:Yn.map(d=>o("option",{value:d,children:d},d))})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:l,children:"New Velocity"})]}),m]})}const na={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Wt;const aa=p(p({},na),JSON.parse((Wt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Wt:"{}"));function sa({settings:n,setSettings:e,vertices:t,selected:a,setVertexData:s,setSelectionMode:l,mergeVertices:c,bridgeVertices:i,extrudeVertex:u,save:m}){const d=b=>{e(b),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(b))},r=a.map(b=>({selectedVertex:t[b],index:b})).filter(b=>b.selectedVertex).map(({selectedVertex:b,index:_})=>o(oe,{title:"Selected Vertex",items:[b],ignoreFields:[],deletable:!1,setItems:h=>s(_,p(p({},b),h)),fieldDefinitions:{},controls:x(E,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{c(_,h[0]),l("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{i(_,h[0]),l("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{u(_,h),l("normal")}})},children:"Extrude"})]})},_));return x("div",{className:"flex flex-col gap-2",children:[x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(v(p({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>m(),children:"Save Segments & Vertices"})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:b=>{d(v(p({},n),{color:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:b=>{d(v(p({},n),{radius:Number.parseFloat(b.target.value)}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:b=>{d(v(p({},n),{activeColor:b.target.value}))}})})]}),x("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:b=>{d(v(p({},n),{activeRadius:Number.parseFloat(b.target.value)}))}})})]}),r]})}function oa(n,{data:e}){return[...n,bn(e)]}function ia(n,e){const t=[];for(const[a,s]of n.entries())e.includes(a)||t.push(s);return t}function la(n,e){const t=[...n];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return t}function ra(n,e){return e}function ca(n,{index:e,position:t}){const a=[...n],s=p({},a[e]);return s.interior_lat=t.lat,s.interior_lon=t.lon,a[e]=s,a}const da=[],ht=F("createBlock"),gt=F("editBlock"),yt=F("deleteBlock"),je=F("loadNewBlockData"),bt=F("moveBlock"),ua=ce(da,n=>{n.addCase(ht,(e,t)=>oa(e,t.payload)).addCase(gt,(e,t)=>la(e,t.payload)).addCase(yt,(e,t)=>ia(e,t.payload)).addCase(je,(e,t)=>ra(e,t.payload)).addCase(bt,(e,t)=>ca(e,t.payload))});function fa(n,e){return v(p({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:e.data}})}function ma(n,e){const t={};for(const a of Object.keys(n))a!==e&&(t[a]=n[a]);return t}function pa(n,e){const t=n[e.collection];if(!t)return n;const a=v(p({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat,plot:e.plot});return v(p({},n),{[e.collection]:a})}const ha={},vt=F("loadNewGenericCollectionData"),xt=F("setGenericSegmentPositionKeys"),ga=F("removeGenericSegmentCollection"),ya=ce(ha,n=>n.addCase(vt,(e,t)=>fa(e,t.payload)).addCase(xt,(e,t)=>pa(e,t.payload)).addCase(ga,(e,t)=>ma(e,t.payload)));function ba(n,e){return v(p({},n),{[e.mesh]:e.data})}function va(n,e){const t={};for(const a of Object.keys(n))a!==e&&(t[a]=n[a]);return t}const xa={},Ve=F("loadMeshLineData"),wa=F("removeMesh"),Na=ce(xa,n=>n.addCase(Ve,(e,t)=>ba(e,t.payload)).addCase(wa,(e,t)=>va(e,t.payload)));function _a(n,{a:e,b:t}){const a=v(p({},le),{start:e,end:t}),s=[...n.segments,a];return v(p({},n),{segments:s})}function Sa(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),{lastIndex:s}=n,[l,c]=Q(e.start,a,t,s),[i,u]=Q(e.end,a,t,c),m=v(p(p({},le),e),{start:l,end:i}),d=[...n.segments,m];return{vertecies:t,vertexDictionary:a,segments:d,lastIndex:u}}function ka(n,e){const t=[],a=[];let s=p({},n);for(const[l,c]of n.segments.entries())e.index.includes(l)?a.push(c):t.push(c);s.segments=t;for(const l of a)s=mt(mt(s,l.start),l.end);return s}function Ca(n,e){const t=[...n.segments];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return v(p({},n),{segments:t})}function La(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),[s,l]=Q(e.targetPoint,a,t,n.lastIndex),c=v(p({},le),{start:e.index,end:s}),i=[...n.segments,c];return{vertecies:t,vertexDictionary:a,segments:i,lastIndex:l}}function $a(n,e){return e}function Fa(n,{a:e,b:t}){if(e===t)return n;const a=n.segments.map(u=>{let m=u;return m.start===t&&(m=v(p({},m),{start:e})),m.end===t&&(m=v(p({},m),{end:e})),m}).filter(u=>u.start!==u.end),s=n.vertecies[t],l=`${Math.floor(s.lon*R)},${Math.floor(s.lat*R)}`,c=p({},n.vertecies);delete c[t];const i=p({},n.vertexDictionary);return delete i[l],v(p({},n),{vertecies:c,vertexDictionary:i,segments:a})}function Da(n,{index:e,vertex:t}){const a=p({},n.vertecies),s=p({},n.vertexDictionary),l=[...n.segments],c=a[e],i=`${Math.floor(t.lon*R)},${Math.floor(t.lat*R)}`,u=`${Math.floor(c.lon*R)},${Math.floor(c.lat*R)}`;if(delete s[u],i in s){const m=s[i];for(const d of l)d.start===m&&(d.start=e),d.end===m&&(d.end=e);delete a[m]}return a[e]=t,v(p({},n),{segments:l,vertecies:a,vertexDictionary:s})}function ja(n,e){const t=p({},n.vertecies),a=p({},n.vertexDictionary),s=[...n.segments];let{lastIndex:l}=n;for(const c of e){const i=n.segments[c],u=n.vertecies[i.start],m=n.vertecies[i.end],d={lon:(u.lon+m.lon)/2,lat:(u.lat+m.lat)/2},[w,r]=Q(d,a,t,l);l=r;const b=v(p({},i),{end:w,name:`${i.name}_a`}),_=v(p({},i),{start:w,name:`${i.name}_b`});s[c]=b,s.push(_)}return{vertecies:t,vertexDictionary:a,segments:s,lastIndex:l}}const Va={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},wt=F("bridgeVertices"),Nt=F("createSegmet"),_t=F("deleteSegment"),St=F("editSegmentData"),kt=F("extrudeSegment"),Me=F("loadNewSegmentData"),Ct=F("mergeVertices"),Ie=F("moveVertex"),Lt=F("splitSegment");function Ma(n,e,t){if(t.dip===90||t.locking_depth<=0)return!1;const a=t.dip<90,l=(a?90-t.dip:t.dip-90)*(Math.PI/180),c=Math.abs(Math.tan(l)*t.locking_depth),[i,u]=n.lon>=e.lon?[n,e]:[e,n],m={lon:u.lat-i.lat,lat:-(u.lon-i.lon)};a&&(m.lon*=-1,m.lat*=-1);const d=it(lt([[i.lon,i.lat],[i.lon+m.lon,i.lat+m.lat]]),c,{units:"kilometers"}),w=it(lt([[u.lon,u.lat],[u.lon+m.lon,u.lat+m.lat]]),c,{units:"kilometers"});return[i,{lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1]},{lon:w.geometry.coordinates[0],lat:w.geometry.coordinates[1]},u]}function Ia(n){return n.segments.map(e=>Ma(n.vertecies[e.start],n.vertecies[e.end],e)).filter(e=>e)}const Pa=ce(Va,n=>{n.addCase(wt,(e,t)=>_a(e,t.payload)).addCase(Nt,(e,t)=>Sa(e,t.payload)).addCase(_t,(e,t)=>ka(e,t.payload)).addCase(St,(e,t)=>Ca(e,t.payload)).addCase(kt,(e,t)=>La(e,t.payload)).addCase(Me,(e,t)=>$a(e,t.payload)).addCase(Ct,(e,t)=>Fa(e,t.payload)).addCase(Ie,(e,t)=>Da(e,t.payload)).addCase(Lt,(e,t)=>ja(e,t.payload))});function Oa(n,{data:e}){return[...n,Xn(e)]}function Ra(n,e){const t=[];for(const[a,s]of n.entries())e.includes(a)||t.push(s);return t}function Ba(n,e){const t=[...n];for(const a of e.indices){const s=p(p({},t[a]),e.data);t[a]=s}return t}function Ea(n,e){return e}function Aa(n,{index:e,position:t}){const a=[...n],s=p(p({},a[e]),t);return a[e]=s,a}const Ta=[],$t=F("createVelocity"),Ft=F("editVelocity"),Dt=F("deleteVelocity"),Pe=F("loadNewVelocityData"),jt=F("moveVelocity"),Wa=ce(Ta,n=>{n.addCase($t,(e,t)=>Oa(e,t.payload)).addCase(Ft,(e,t)=>Ba(e,t.payload)).addCase(Dt,(e,t)=>Ra(e,t.payload)).addCase(Pe,(e,t)=>Ea(e,t.payload)).addCase(jt,(e,t)=>Aa(e,t.payload))});function de(n){const e=n.split(/\n/g),t=e[0].split(",").map(l=>l.trim()),a=e.slice(1),s=[];for(const l of a)if(l.trim()!==""){const c=l.split(/\s*,\s*/),i={};for(let u=0;u<t.length;u+=1){let m=c[u];const d=t[u],w=Number.parseFloat(m);m=Number.isNaN(w)?m:w,typeof m=="string"&&(m=m.startsWith('"')&&m.endsWith('"')?m.slice(1,-1).trim():m.trim()),i[d]=m}s.push(i)}return s}function Oe(n,e){const t=[e.join(",")];for(const a of n){const s=a;t.push(e.map(l=>{if(l in s){const c=s[l];return typeof c=="string"&&/\s/.test(`${c}`)?`"${c.trim()}"`:`${typeof c=="number"&&(l.includes("lon")||l.includes("lat"))?c.toFixed(6):c}`}return""}).join(","))}return t.join(`
`)}class he{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=de(e).map(s=>{const l={};for(const c of _e)l[c]=s[c]||(c==="name"?"":0);return l});this.data=a}async save(){var t;const e=Oe((t=this.data)!=null?t:[],_e);await this.handle.setContents(e)}clone(){return new he(this.handle)}}const Ka={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function za(n){return p(p({},Ka),n)}class Re{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=za(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new Re(this.handle)}}class Ga{constructor(e){C(this,"data");C(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=de(e);this.data=t}async save(){}}function Ha(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const s=Number.parseFloat(a[1]),l=Number.parseFloat(a[2]);return{lon:s,lat:l}});return t.splice(0,0,{lon:0,lat:0}),t}const Ja={"1":n=>{var a,s;const e=Number.parseInt((a=n[n.length-2])!=null?a:"",10),t=Number.parseInt((s=n[n.length-1])!=null?s:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var s,l,c;const e=Number.parseInt((s=n[n.length-3])!=null?s:"",10),t=Number.parseInt((l=n[n.length-2])!=null?l:"",10),a=Number.parseInt((c=n[n.length-1])!=null?c:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(a)?[[e,t],[t,a],[a,e]]:!1}};function Ua(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var a;return((a=Ja[e[1]])!=null?a:()=>!1)(e)}).filter(e=>e).flat()}function qa(n,e){return e.map(([t,a])=>t!==a&&t>-1&&t<n.length&&a>-1&&a<n.length?[n[t],n[a]]:!1).filter(t=>t)}function Qa(n){const e=n.split("$");let t=[],a=[];for(const s of e)s.startsWith("Nodes")?t=Ha(s):s.startsWith("Elements")&&(a=Ua(s));return qa(t,a)}class Xa{constructor(e){C(this,"data");C(this,"handle");C(this,"startLonColumn");C(this,"endLonColumn");C(this,"startLatColumn");C(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=Qa(e);else{const t=de(e);this.data=t.map(a=>{const s={lon:0,lat:0},l={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(s.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(s.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(l.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(l.lat=a[this.endLatColumn]);const c=Object.keys(a).filter(i=>i!==this.startLatColumn&&i!==this.endLatColumn&&i!==this.startLonColumn&&i!==this.endLonColumn);if(c.length>0){const i={};for(const u of c)i[u]=a[u];return[s,l]}return[s,l]})}}async save(){console.log("Mesh files do not get saved")}}class ge{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=de(e).map(u=>{const m={};for(const d of Fe)m[d]=u[d]||(d==="name"?"":0);return m}),s={},l={},c=[];let i=0;for(const u of a){const[m,d]=Q({lon:u.lon1,lat:u.lat1},s,l,i),[w,r]=Q({lon:u.lon2,lat:u.lat2},s,l,d),b=v(p({},u),{start:m,end:w});i=r,c.push(b)}this.data={vertecies:l,segments:c,vertexDictionary:s,lastIndex:i}}async save(){let e=[];if(this.data){const{vertecies:a,segments:s}=this.data;e=s.map(l=>{const c=a[l.start],i=a[l.end];return v(p({},l),{lon1:c.lon,lat1:c.lat,lon2:i.lon,lat2:i.lat})})}const t=Oe(e,Fe);await this.handle.setContents(t)}clone(){return new ge(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,l=p({},this.data.vertecies);delete l[e];const c=p({},this.data.vertexDictionary);delete c[s];const i=this.clone();return i.data=v(p({},this.data),{vertecies:l,vertexDictionary:c}),i}}return this}mergeVertices(e,t){if(this.data){for(const u of this.data.segments)u.start===t&&(u.start=e),u.end===t&&(u.end=e);const a=this.data.vertecies[t],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,l=p({},this.data.vertecies);delete l[t];const c=p({},this.data.vertexDictionary);delete c[s];const i=this.clone();return i.data=v(p({},this.data),{vertecies:l,vertexDictionary:c}),i}return this}moveVertex(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),l=[...this.data.segments],c=a[e],i=`${Math.floor(t.lon*R)},${Math.floor(t.lat*R)}`,u=`${Math.floor(c.lon*R)},${Math.floor(c.lat*R)}`;if(delete s[u],i in s){const d=s[i];for(const w of l)w.start===d&&(w.start=e),w.end===d&&(w.end=e);delete a[d]}a[e]=t;const m=this.clone();return m.data=v(p({},this.data),{segments:l,vertecies:a,vertexDictionary:s}),m}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],a=this.data.vertecies[t.start],s=this.data.vertecies[t.end],l={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[c,i]=Q(l,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),u=v(p({},t),{end:c,name:`${t.name}_a`}),m=v(p({},t),{start:c,name:`${t.name}_b`}),d=[...this.data.segments];d[e]=u,d.push(m);const w=this.clone();return w.data=v(p({},this.data),{segments:d,lastIndex:i}),w}return this}bridgeVertices(e,t){if(this.data){const a=v(p({},le),{start:e,end:t}),s=[...this.data.segments,a],l=this.clone();return l.data=v(p({},this.data),{segments:s}),l}return this}extrudeSegment(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),[l,c]=Q(t,s,a,this.data.lastIndex),i=v(p({},le),{start:e,end:l}),u=[...this.data.segments,i],m=this.clone();return m.data={vertecies:a,vertexDictionary:s,segments:u,lastIndex:c},m}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],a=t.splice(e,1)[0],s=this.clone();return s.data=v(p({},this.data),{segments:t}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,t){if(this.data){const a=p({},this.data.vertecies),s=p({},this.data.vertexDictionary),[l,c]=Q(e,s,a,this.data.lastIndex),[i,u]=Q(t,s,a,c),m=v(p({},le),{start:l,end:i}),d=[...this.data.segments,m],w=this.clone();return w.data={vertecies:a,vertexDictionary:s,segments:d,lastIndex:u},w}return this}}class ye{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=de(e).map(s=>{const l={};for(const c of De)l[c]=s[c]||(c==="name"?"":0);return l});this.data=a}async save(){var t;const e=Oe((t=this.data)!=null?t:[],De);await this.handle.setContents(e)}clone(){return new ye(this.handle)}}async function Vt(n){const e=new ge(n);return await e.initialize(),e}async function Mt(n){const e=new he(n);return await e.initialize(),e}async function It(n){const e=new ye(n);return await e.initialize(),e}async function Pt(n){const e=new Xa(n);return await e.initialize(),e}async function Za(n){const e=new Ga(n);return await e.initialize(),e}async function ue(n,e,t){try{const a=await e.getFile(n);return await t(a)}catch{return!1}}async function Ya(n,e,t){const a=new Re(e);if(await a.initialize(),a.data){const s=await ue(a.data.segment_file_name,n,Vt),l=await ue(a.data.block_file_name,n,Mt),c=await ue(a.data.station_file_name,n,It),i=await ue(a.data.mesh_parameters_file_name,n,async m=>{const d=JSON.parse(await m.getContents());return(await Promise.all(d.map(async r=>ue(r.mesh_filename,n,Pt)))).filter(r=>r)}),u=p({},t);return"command"in u&&(u.command=v(p({},u.command),{currentFilePath:e.name})),s&&"segment"in u&&(u.segment=v(p({},u.segment),{currentFilePath:a.data.segment_file_name})),l&&"block"in u&&(u.block=v(p({},u.block),{currentFilePath:a.data.block_file_name})),c&&"velocities"in u&&(u.velocities=v(p({},u.velocities),{currentFilePath:a.data.station_file_name})),i&&"mesh"in u&&(u.mesh=v(p({},u.mesh),{currentFilePath:i.map(m=>m.handle.name)})),{openableFiles:u,commands:a,segments:s,blocks:l,velocities:c,mesh:i}}throw new Error("Can't open command file")}window.location.search.includes("fake-dir")||Nn(vn);var H;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(H||(H={}));const Ot={Block:H.Block,Vertex:H.Vertex,Velocity:H.Velocity},es={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments"};function ts(){var et,tt,nt;const n=pt(),[e,t]=S.exports.useState(),[a,s]=S.exports.useState(""),[l,c]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[i,u]=S.exports.useState(),[m,d]=S.exports.useState(),[w,r]=S.exports.useState(),[b,_]=S.exports.useState(),h=re(f=>f.main.present.segment),g=re(f=>f.main.present.block),N=re(f=>f.main.present.velocity),k=re(f=>f.main.present.meshLine),A=re(f=>f.main.present.genericSegments),[L,te]=S.exports.useState(ea),[D,Be]=S.exports.useState(Ln),[P,Ee]=S.exports.useState(Hn),[j,Ae]=S.exports.useState(aa),[J,Te]=S.exports.useState(Kn),[U,We]=S.exports.useState(jn),[W,ne]=S.exports.useState("normal"),[ae,Kt]=S.exports.useState(H.Vertex),[be,Ke]=S.exports.useState([]),[ze,Ge]=S.exports.useState([]),[He,Je]=S.exports.useState([]),[Ue,qe]=S.exports.useState([]),[M,is]=S.exports.useState({select:(f,y)=>{Ke(f==="block"?y:[]),Ge(f==="segment"?y:[]),Je(f==="velocities"?y:[]),qe(f==="vertex"?y:[]),s(f)}}),[zt,Gt]=S.exports.useState([]),[Ht,Qe]=S.exports.useState([]),[Jt,Ut]=S.exports.useState([]),[qt,Xe]=S.exports.useState([]),[Qt,ve]=S.exports.useState({color:j.color,selectedColor:j.activeColor,radius:j.radius,selectedRadius:j.activeRadius,points:[]}),[Ze,Xt]=S.exports.useState({lon:0,lat:0}),[xe,Zt]=S.exports.useState(!1);S.exports.useEffect(()=>{W==="normal"?M.select=(f,y)=>{Ke(f==="block"?y:[]),Ge(f==="segment"?y:[]),Je(f==="velocities"?y:[]),qe(f==="vertex"?y:[]),s(f)}:W.mode==="override"?M.select=(f,y)=>{f===W.type&&W.callback(y)}:M.select=()=>{}},[W,M]),S.exports.useEffect(()=>{const f=[];ae!==H.Block&&!D.hide&&f.push({name:"blocks",color:D.color,selectedColor:D.selectedColor,radius:D.radius,points:g.map((y,$)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:$,label:D.plottableKey in y?`${y[D.plottableKey]}`:""})),click:y=>{M.select("block",[y])}}),ae!==H.Vertex&&!j.hide&&f.push({name:"vertices",color:j.color,selectedColor:j.activeColor,radius:j.radius,click:y=>{M.select("vertex",[y])},points:Object.keys(h.vertecies).map(y=>{const $=Number.parseInt(y,10),I=h.vertecies[$];return I?{longitude:I.lon,latitude:I.lat,index:$,name:"",description:""}:!1}).filter(y=>!!y)}),Gt(f)},[D,g,P,M,ae,j.hide,j.color,j.activeColor,j.radius,h.vertecies]),S.exports.useEffect(()=>{const f=[];if(P.hide||f.push({name:"segments",color:P.color,selectedColor:P.activeColor,width:P.width,selectedWidth:P.activeWidth,lines:h.segments.map((y,$)=>{var q,K;const I=(q=h.vertecies[y.start])!=null?q:ut,T=(K=h.vertecies[y.end])!=null?K:ut,[[X,B],[z,O]]=$e(I,T);return{startLongitude:X,startLatitude:B,endLongitude:z,endLatitude:O,name:y.name,description:`${I.lon},${I.lat} to ${T.lon},${T.lat}`,index:$,label:P.plottableKey in y?`${y[P.plottableKey]}`:""}}),click:y=>{M.select("segment",[y])}}),!J.hide)for(const y of Object.keys(k)){const $=k[y];f.push({name:`mesh:${y}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:$.map((I,T)=>{const X=I[0],B=I[1],[[z,O],[q,K]]=$e(X,B);return{startLongitude:z,startLatitude:O,endLongitude:q,endLatitude:K,name:"",description:"",index:T}})||[]})}if(!U.hide)for(const y of Object.keys(A)){const{startLat:$,startLon:I,endLat:T,endLon:X,plot:B,segments:z}=A[y];$ in z[0]&&T in z[0]&&I in z[0]&&X in z[0]&&f.push({name:`generic_segment:${y}`,color:U.color,selectedColor:U.activeColor,width:U.width,selectedWidth:U.activeWidth,lines:z.map((O,q)=>{const K={lat:O[$],lon:O[I]},se={lat:O[T],lon:O[X]};if(typeof K.lat!="number"||typeof K.lon!="number"||typeof se.lat!="number"||typeof se.lon!="number")return!1;const[[fe,V],[me,pe]]=$e(K,se);return{startLongitude:fe,startLatitude:V,endLongitude:me,endLatitude:pe,name:"",description:"",index:q,label:B&&B in O?`${O[B]}`:""}}).filter(O=>O)||[]})}Ut(f)},[h,P,U,A,J,k,M]),S.exports.useEffect(()=>{switch(ae){case H.Vertex:{ve({color:j.color,radius:j.radius,selectedColor:j.activeColor,selectedRadius:j.activeRadius,points:j.hide?[]:Object.keys(h.vertecies).map(f=>{const y=Number.parseInt(f,10),$=h.vertecies[y];return $?{longitude:$.lon,latitude:$.lat,index:y}:!1}).filter(f=>!!f),update:(f,y)=>{n(Ie({index:f,vertex:y}))},select:f=>{M.select("vertex",f)}});break}case H.Block:{ve({color:D.color,radius:D.radius,selectedColor:D.selectedColor,selectedRadius:D.radius,points:D.hide?[]:g.map((f,y)=>({longitude:f.interior_lon,latitude:f.interior_lat,name:f.name,description:"",index:y,label:D.plottableKey in f?`${f[D.plottableKey]}`:""})),update:(f,y)=>{n(bt({index:f,position:y}))},select:f=>{M.select("block",f)}});break}case H.Velocity:{ve({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:N.map((f,y)=>({longitude:f.lon,latitude:f.lat,name:f.name,description:"",index:y})),update:(f,y)=>{n(jt({index:f,position:y}))},select:f=>{M.select("velocities",f)}});break}}},[j,M,h.vertecies,n,ae,D.color,D.radius,D.selectedColor,D.hide,g,L.color,L.width,L.selectedColor,L.hide,N,D.plottableKey]),S.exports.useEffect(()=>{L.hide?Qe([]):Qe([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:N.map((f,y)=>{const $=Math.sqrt(f.east_vel*f.east_vel+f.north_vel*f.north_vel);return{longitude:f.lon,latitude:f.lat,direction:[f.east_vel/$,f.north_vel/$],scale:$,name:f.name,description:`north: ${f.north_vel}, east: ${f.east_vel}`,index:y,label:L.plottableKey in f?`${f[L.plottableKey]}`:""}}),click:f=>{M.select("velocities",[f])}}])},[M,L,N]),S.exports.useEffect(()=>{P.hideProjection||P.hide?Xe([]):Xe([{name:"fault_dip_projections",color:P.projectionColor,borderColor:P.projectionColor,borderRadius:.5,polygons:Ia(h).map((f,y)=>({polygon:f,index:y,name:"",description:""}))}])},[P,h]);let Y=o("span",{});switch(a){case"files":Y=e?o(Fn,{folder:e,files:l,setFile:async(f,y,$,I)=>{if(I){let T=p({},l);const X=T[y];let{currentFilePath:B,allowMultiple:z}=X;switch(z?Array.isArray(B)?(B=B.map(O=>O),B.length>f?B[f]=$:B.push($)):B=[$]:B=$,T[y]=v(p({},X),{currentFilePath:B}),y){case"segment":const O=await Vt(I);d(O),O.data&&n(Me(O.data));break;case"block":const q=await Mt(I);r(q),q.data&&n(je(q.data));break;case"velocities":const K=await It(I);_(K),K.data&&n(Pe(K.data));break;case"mesh":const se=await Pt(I);se.data&&n(Ve({mesh:`mesh_file_${f}`,data:se.data}));break;case"csv":const fe=await Za(I);fe.data&&n(vt({name:`generic_segment_${f}`,data:fe.data}));break;case"command":const V=await Ya(e,I,l);u(V.commands!==!1?V.commands:void 0),d(V.segments!==!1?V.segments:void 0),V.segments!==!1&&V.segments.data&&n(Me(V.segments.data)),r(V.blocks!==!1?V.blocks:void 0),V.blocks!==!1&&V.blocks.data&&n(je(V.blocks.data)),_(V.velocities!==!1?V.velocities:void 0),V.velocities!==!1&&V.velocities.data&&n(Pe(V.velocities.data)),V.mesh&&V.mesh.map((me,pe)=>(me.data&&n(Ve({mesh:`mesh_file_${pe}`,data:me.data})),pe)),T=V.openableFiles;break}c(T)}}}):o("span",{});break;case"velocities":Y=o(ta,{settings:L,setSettings:te,selected:He,velocitys:N,setVelocityData:(f,y)=>{y?n(Ft({indices:f,data:y})):(n(Dt(f)),M.select("velocity",[]))},addNewVelocity:()=>{ne({label:"Click to place velocity estimate",mode:"mapClick",callback:f=>{ne("normal");const y=N.length;n($t({data:{lat:f.lat,lon:f.lon}})),M.select("velocity",[y])}})},save:async f=>{if(f){const y=new ye(f);y.data=N,_(y),await y.save()}else b&&(b.data=N,await b.save())}});break;case"block":Y=o($n,{settings:D,setSettings:Be,selected:be,blocks:g,addNewBlock:()=>{ne({label:"Click to place new block",mode:"mapClick",callback:f=>{const y=g.length;n(ht({data:{name:"New Block",interior_lon:f.lon,interior_lat:f.lat}})),M.select("block",[y]),ne("normal")}})},setBlockData:(f,y)=>{y?n(gt({indices:be,data:y})):(n(yt(f)),M.select("block",[]))},save:async f=>{if(f){const y=new he(f);y.data=g,r(y),await y.save()}else w&&(w.data=g,await w.save())}});break;case"segment":Y=o(Un,{settings:P,setSettings:Ee,segments:(et=h.segments)!=null?et:[],selected:ze,setSelectionMode:f=>ne(f),addNewSegment:(f,y)=>{const $=h.segments.length;n(Nt({start:f,end:y})),M.select("segment",[$])},setSegmentData:(f,y)=>{n(y?St({indices:f,data:y}):_t({index:f}))},splitSegment:f=>{n(Lt(f)),M.select("segment",[])},save:async f=>{if(f){const y=new ge(f);y.data=h,d(y),await y.save()}else m&&(m.data=h,await m.save())}});break;case"vertex":Y=o(sa,{settings:j,setSettings:Ae,vertices:(tt=h.vertecies)!=null?tt:{},selected:Ue,setVertexData:(f,y)=>{y&&n(Ie({index:f,vertex:y}))},setSelectionMode:f=>ne(f),mergeVertices:(f,y)=>{n(Ct({a:f,b:y}))},bridgeVertices:(f,y)=>{n(wt({a:f,b:y}))},extrudeVertex:(f,y)=>{n(kt({index:f,targetPoint:y}))},save:async()=>{m&&(m.data=h,await m.save())}});break;case"mesh":Y=o(zn,{settings:J,setSettings:Te});break;case"csv":Y=o(Vn,{settings:U,setSettings:We,setCollectionVertexKeys:f=>{n(xt(f))},collections:A});break}const Ye={Block:{state:D.hide,change:()=>{Be(v(p({},D),{hide:!D.hide}))}},Vertex:{state:j.hide,change:()=>{Ae(v(p({},j),{hide:!j.hide}))}},Velocity:{state:L.hide,change:()=>{te(v(p({},L),{hide:!L.hide}))}},Segment:{state:P.hide,change:()=>{Ee(v(p({},P),{hide:!P.hide}))}},Grid:{state:!xe,change:()=>{Zt(!xe)}},Mesh:{state:J.hide,change:()=>{Te(v(p({},J),{hide:!J.hide}))}},GenericSegments:{state:U.hide,change:()=>{We(v(p({},U),{hide:!U.hide}))}}};return x("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:f=>{f.key==="Escape"&&ne("normal")},children:[o(qn,{filesOpen:((nt=i!=null?i:m)!=null?nt:w)!==void 0,saveFiles:async()=>{i&&await i.save(),m&&(m.data=h,await m.save()),w&&(w.data=g,await w.save()),b&&(b.data=N,await b.save())},folder:e,openFolder:async()=>{const f=await _n();t(f),s("files")}}),W!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:x("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:W.label}),W.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:W.subtitle}):o(E,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(E,{}),x("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-start gap-5",children:x("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ae})]})}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),x("span",{children:[Math.floor(Ze.lon*1e3)/1e3,","," ",Math.floor(Ze.lat*1e3)/1e3]})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Ot).map(f=>{const y=Ot[f];return o("button",{type:"button",className:`${ae===y?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Kt(y)},children:f},f)})]}),x("div",{className:"flex flex-row items-center justify-start gap-5",children:[x("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Ye).map(f=>{const y=Ye[f];return o("button",{type:"button",className:`${y.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{y.change()},children:f},f)})]})]}),o(Tn,{pointSources:zt,arrowSources:Ht,lineSources:Jt,drawnPointSource:Qt,polygonSources:qt,selections:{segments:ze,blocks:be,velocities:He,vertices:Ue},displayGrid:xe?10:-1,click:f=>{typeof W!="string"&&W.mode==="mapClick"&&W.callback(f)},mouseMove:f=>{Xt(f)}}),o(Mn,{view:Y,buttons:e?es:void 0,active:a,setActive:f=>s(f)})]})}const ns=cn({reducer:{main:dn(un({segment:Pa,block:ua,velocity:Wa,meshLine:Na,genericSegments:ya}))}});function as(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:s,onRegisterError:l}=n;let c;const i=async(u=!0)=>{};return"serviceWorker"in navigator&&(c=new fn("./sw.js",{scope:"./"}),c.addEventListener("activated",u=>{u.isUpdate?window.location.reload():a==null||a()}),c.register({immediate:e}).then(u=>{s==null||s(u)}).catch(u=>{l==null||l(u)})),i}as();const ss=1,os=new mn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ss}}});pn.render(o(S.exports.StrictMode,{children:o(hn,{client:os,children:o(gn,{store:ns,children:o(ts,{})})})}),document.querySelector("#root"));
