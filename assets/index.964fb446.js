var Yt=Object.defineProperty,en=Object.defineProperties;var tn=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var nn=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable;var xe=(n,e,t)=>e in n?Yt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,m=(n,e)=>{for(var t in e||(e={}))nn.call(e,t)&&xe(n,t,e[t]);if(tt)for(var t of tt(e))sn.call(e,t)&&xe(n,t,e[t]);return n},v=(n,e)=>en(n,tn(e));var k=(n,e,t)=>(xe(n,typeof e!="symbol"?e+"":e,t),t);import{j as o,a as N,F as E,r as S,M as an,m as nt,R as on,b as we,u as ln,c as rn,l as st,d as re,e as $,f as at,g as ot,h as cn,i as dn,k as un,v as fn,Q as mn,n as pn,o as hn,P as gn}from"./vendor.51d006dc.js";const yn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}};yn();class it{constructor(e){k(this,"name");k(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Ne{constructor(e){k(this,"name");k(this,"handle");k(this,"fileList");k(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){const t=await this.handle.getFileHandle(e,{create:!0});return new it(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new Ne(t);return await s.initialize(),s}}const bn=async()=>{const n=await window.showDirectoryPicker(),e=new Ne(n);return await e.initialize(),e};class vn{constructor(e,t){k(this,"name");k(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class _e{constructor(e,t){k(this,"name");k(this,"parent");k(this,"fileList");k(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new vn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new _e(e,this.parent[this.name])}}const xn=async n=>new _e("root",n);let lt=async()=>{var e;return xn((e=window.FakeDirectory)!=null?e:{})};function wn(n){lt=n}async function Nn(){return lt()}async function Se(n){const e={types:[{description:"CSV Files",accept:{"text/plain":n}}]},t=await window.showSaveFilePicker(e);return new it(t)}function _n({value:n,fieldDefinition:e,setField:t}){const[s,a]=S.exports.useState(-1),[l,r]=S.exports.useState(n);S.exports.useEffect(()=>{r(n)},[n]);let i=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof n=="number"?"number":"text",value:l,onChange:c=>{const d=typeof n=="number"?Number.parseFloat(c.target.value):c.target.value;r(d),s>-1&&clearTimeout(s),a(setTimeout(()=>t(d),1e3))}});return e.type==="select"&&(i=N("select",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",value:l,onChange:c=>{t(c.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(c=>o("option",{value:c.name,"data-testid":`input-editor-${e.name}-${c.name}`,children:c.name},c.name))]})),N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(E,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:i})]})}function ae({title:n,items:e,setItems:t,fieldDefinitions:s,ignoreFields:a,deletable:l,controls:r}){const i=e[0],c=Object.keys(i).map((d,f)=>{if(a==null?void 0:a.includes(d))return{element:o("span",{style:{display:"hidden"}},d),order:f+1e4};let g=i[d];for(const w of e)if(w[d]!==g){g="-";break}const p=d in s&&s[d];return p?{element:o(_n,{value:g,fieldDefinition:p,setField:w=>t({[d]:w})},d),order:p.order}:{element:N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${d}`,className:"text-l font-bold",children:d}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${d}`,className:"bg-gray-800 w-full",type:typeof g=="number"?"number":"text",value:g,onChange:w=>{t({[d]:typeof g=="number"?Number.parseFloat(w.target.value):w.target.value})}})})]},d),order:f+1e3}}).sort((d,f)=>d.order-f.order).map(d=>d.element);return N("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),N("span",{className:"flex flex-row justify-end gap-2 grow",children:[r,l?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):o(E,{})]})]}),c]})}ae.defaultProps={ignoreFields:[],controls:o(E,{})};const Sn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var Rt;const kn=JSON.parse((Rt=window.localStorage.getItem("blockDisplaySettings"))!=null?Rt:"false")||Sn;function Cn({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:l,save:r}){const i=f=>{e(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},c=t.map(f=>s[f]).filter(f=>f),d=c.length>0?o(ae,{title:c.length===1?c[0].name:"Edit Selected Blocks",items:c,deletable:!0,setItems:f=>a(t,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(E,{});return N(E,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{i(v(m({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>r(),children:"Save Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const f=await Se([".csv"]);r(f)},children:"Save As"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:f=>{i(v(m({},n),{color:f.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:f=>{i(v(m({},n),{selectedColor:f.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:f=>{i(v(m({},n),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:l,children:"New Block"})]}),d]})}function Ln({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const l=e[a],r=Array.isArray(l.currentFilePath)?[...l.currentFilePath]:[l.currentFilePath];return l.allowMultiple&&r.push(""),N("div",{className:"flex flex-row justify-between items-center",children:[N("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:l.name}),o("span",{className:"text-sm","data-testid":`file-${a}-description`,children:l.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:r.map((i,c)=>N("select",{"data-testid":`file-${a}-select-${c}`,className:"bg-gray-800 w-full m-1",value:i,onChange:async d=>{const f=d.currentTarget.value;try{const g=await n.getFile(f);t(c,a,g.name,g)}catch{t(c,a,"")}},children:[o("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(d=>d.endsWith(l.extension)).map(d=>o("option",{value:d,"data-testid":`file-${a}-select-${d}`,children:d},d))]},c))})]},a)});return o("div",{className:"flex flex-col gap-2",children:s})}const $n={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Bt;const Fn=m(m({},$n),JSON.parse((Bt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Bt:"{}"));function Dn({settings:n,setSettings:e,collections:t,setCollectionVertexKeys:s}){const a=r=>{e(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))},l=Object.keys(t).map(r=>{const{startLat:i,startLon:c,endLat:d,endLon:f,segments:g,plot:p}=t[r],w=Object.keys(g[0]).map((b,h)=>({name:b,value:h}));return o(ae,{title:r,items:[{startLat:i,startLon:c,endLat:d,endLon:f,plot:p}],deletable:!1,setItems:b=>{s(m({collection:r,startLat:i,startLon:c,endLat:d,endLon:f,plot:p},b))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:w},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:w},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:w},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:w},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:w}}},r)});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{a(v(m({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:r=>{a(v(m({},n),{color:r.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:r=>{a(v(m({},n),{width:Number.parseFloat(r.target.value)}))}})})]}),l]})}function jn({view:n,buttons:e,active:t,setActive:s}){if(!e)return o("span",{});const a=[];for(const l of Object.keys(e)){const r=e[l],i=l===t;a.push(o("button",{type:"button","data-testid":`tab-${l}`,className:`${i?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>s(i?"":l),children:r},l))}return N("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:n}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:a})]})}const rt={lon:0,lat:0},Vn=180,oe=360;function ct(n){let{lon:e,lat:t}=n;for(;e<0;)e+=oe;for(;e>oe;)e-=oe;return[e,t]}function ke([n,e]){return{lon:n<0?n+oe:n,lat:e}}function Ce(n,e){const t=ct(n),s=ct(e),a=[s[0],s[1]];return s[0]-t[0]>=Vn?a[0]-=oe:a[0]+=oe,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const O=1e6;function q(n,e,t,s){const a=`${Math.floor(n.lon*O)},${Math.floor(n.lat*O)}`;if(a in e)return[e[a],s];const l=s;return t[l]=n,e[a]=l,[l,s+1]}function dt(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*O)},${Math.floor(s.lat*O)}`,l=m({},n.vertecies);delete l[e];const r=m({},n.vertexDictionary);return delete r[a],v(m({},n),{vertecies:l,vertexDictionary:r})}return n}const X=Math.PI/6,ee=2*Math.PI-X;function Mn(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:l,internalSelections:r},{arrowSources:i,selections:c}){if(t&&l&&a!==i)if(console.log("Setting arrows in map!"),a){for(const g of a){const p=t.getSource(`arrow:${g.name}`);p!==void 0&&p.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${g.name}`),t.removeLayer(`layer:arrow:${g.name}:click`)}e({internalArrowSources:void 0})}else{for(const g of i){let p=t.getSource(`arrow:${g.name}`);const w=p===void 0;w&&(t.addSource(`arrow:${g.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p=t.getSource(`arrow:${g.name}`)),p!==void 0&&p.setData({type:"FeatureCollection",features:g.arrows.map(b=>{var L;const h=b.scale*g.scale,x=g.scale*g.arrowHeadScale,_=[b.longitude+b.direction[0]*h,b.latitude+b.direction[1]*h],M=[_[0]+(Math.cos(X)*-b.direction[0]-Math.sin(X)*-b.direction[1])*x,_[1]+(Math.sin(X)*-b.direction[0]+Math.cos(X)*-b.direction[1])*x],Z=[_[0]+(Math.cos(ee)*-b.direction[0]-Math.sin(ee)*-b.direction[1])*x,_[1]+(Math.sin(ee)*-b.direction[0]+Math.cos(ee)*-b.direction[1])*x];return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:(L=c[g.name])==null?void 0:L.includes(b.index)},geometry:{type:"LineString",coordinates:[[b.longitude,b.latitude],_,M,_,Z]}}})}),t.addLayer({id:`layer:arrow:${g.name}`,type:"line",source:`arrow:${g.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],g.selectedColor,g.color],"line-width":g.width}}),t.addLayer({id:`layer:arrow:${g.name}:click`,type:"line",source:`arrow:${g.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),w&&(t.on("mouseenter",`layer:arrow:${g.name}:click`,b=>{if(!b.features)return;const h=b.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const x=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(b.lngLat.lng-x[0])>180;)x[0]+=b.lngLat.lng>x[0]?360:-360;s.setLngLat(x).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:arrow:${g.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${g.name}:click`,b=>{let h;if(n.state.internalArrowSources)for(const _ of n.state.internalArrowSources)h=_.click;if(!b.features||!h)return;const x=b.features[0];if(x.properties&&typeof x.properties.index=="number"&&typeof x.properties.name=="string"){const{index:_}=x.properties;h(_)}}))}e({internalArrowSources:i})}const d=m({},r);let f=!1;for(const g of Object.keys(c))if(c[g]!==r[g]){for(const p of i)if(p.name===g){f=!0,d[g]=c[g];const w=t==null?void 0:t.getSource(`arrow:${p.name}`);if(w){const b=c[g];w.setData({type:"FeatureCollection",features:p.arrows.map(h=>{const x=h.scale*p.scale,_=p.scale*p.arrowHeadScale,M=[h.longitude+h.direction[0]*x,h.latitude+h.direction[1]*x],Z=[M[0]+(Math.cos(X)*-h.direction[0]-Math.sin(X)*-h.direction[1])*_,M[1]+(Math.sin(X)*-h.direction[0]+Math.cos(X)*-h.direction[1])*_],L=[M[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*_,M[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:b==null?void 0:b.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],M,Z,M,L]}}})})}}}f&&e({internalSelections:d})}function In(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:l},{drawnPointSource:r}){if(e&&a&&l!==r){console.log("Drawning Points"),n({internalDrawnPointSource:r});let i=t;if((r.selectedColor!==s.selectedColor||r.selectedRadius!==s.selectedRadius||r.color!==s.color||r.radius!==s.radius)&&(n({drawnPointSettings:{color:r.color,radius:r.radius,selectedRadius:r.selectedRadius,selectedColor:r.selectedColor}}),t&&(e.removeControl(t),i=void 0),r?(i=new an({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":r.selectedRadius,"circle-color":r.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":r.radius,"circle-color":r.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(i),n({draw:i})):i=void 0),i){const c=i.getAll(),d=r.points.length!==c.features.length?void 0:i.getSelected(),f={type:"FeatureCollection",features:r.points.map(g=>({type:"Feature",id:g.index.toString(),properties:{description:"",index:g.index,name:""},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))};if(i.set(f),d&&d.features.length>0&&d.features[0].properties&&typeof d.features[0].properties.index=="number"){const g=d.features[0].id;g&&i.changeMode("simple_select",{featureIds:[g]})}}}}const z="grid";function Pn(n,e,{map:t,internalGridDisplay:s,popup:a,mapLoaded:l},{displayGrid:r}){if(t&&l&&s!==r){if(console.log("Drawing Grid on map!"),s&&s>0){const i=t.getSource(z);i!==void 0&&i.setData({type:"FeatureCollection",features:[]}),t.removeLayer(z),e({internalGridDisplay:void 0})}else if(r&&r>0){let i=t.getSource(z);const c=i===void 0;if(c&&(t.addSource(z,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i=t.getSource(z)),i!==void 0){const d=[];for(let f=-170;f<=180;f+=r)d.push({type:"Feature",properties:{label:`Lon: ${f<0?f+360:f}`},geometry:{type:"LineString",coordinates:[[f,-90],[f,90]]}});for(let f=-90;f<=90;f+=r)d.push({type:"Feature",properties:{label:`Lat: ${f}`},geometry:{type:"LineString",coordinates:[[180,f],[-180,f]]}});i.setData({type:"FeatureCollection",features:d})}t.addLayer({id:z,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${z}:click`,type:"line",source:z,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),c&&(t.on("mouseenter",`${z}:click`,d=>{if(!d.features)return;const f=d.features[0];f.geometry.type==="LineString"&&f.properties&&typeof f.properties.label=="string"&&a.setLngLat(d.lngLat).setHTML(`${f.properties.label}`).addTo(t)}),t.on("mouseleave",`${z}:click`,()=>{a.remove()}))}e({internalGridDisplay:r})}}function On(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:l,internalSelections:r},{lineSources:i,selections:c}){var g;if(t&&l&&a!==i)if(console.log("Setting lines in map!"),a){for(const p of a){const w=t.getSource(`line:${p.name}`);w!==void 0&&w.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${p.name}`);try{t.getLayer(`layer:line:${p.name}:click`)&&t.removeLayer(`layer:line:${p.name}:click`)}catch{console.log("no click layer")}try{t.getLayer(`layer:line:${p.name}:labels`)&&t.removeLayer(`layer:line:${p.name}:labels`)}catch{console.log("no label layer")}}e({internalLineSources:void 0})}else{for(const p of i){let w=t.getSource(`line:${p.name}`);const b=w===void 0;if(b&&(t.addSource(`line:${p.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addSource(`line:${p.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),w=t.getSource(`line:${p.name}`)),w!==void 0&&w.setData({type:"FeatureCollection",features:p.lines.map(h=>{var x,_;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,label:(x=h.label)!=null?x:"",selected:((_=c[p.name])==null?void 0:_.includes(h.index))||!1},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),t.addLayer({id:`layer:line:${p.name}`,type:"line",source:`line:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],p.selectedColor,p.color],"line-width":["case",["get","selected"],p.selectedWidth,p.width]}}),(g=p.lines[0])==null?void 0:g.label){const h=t.getSource(`line:${p.name}:points`);h&&(h.setData({type:"FeatureCollection",features:p.lines.map(x=>({type:"Feature",properties:{label:x.label},geometry:{type:"Point",coordinates:[(x.startLongitude+x.endLongitude)/2,(x.startLatitude+x.endLatitude)/2]}}))}),t.addLayer({id:`layer:line:${p.name}:labels`,type:"symbol",source:`line:${p.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}p.click&&(t.addLayer({id:`layer:line:${p.name}:click`,type:"line",source:`line:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":p.width*10}}),b&&(t.on("mouseenter",`layer:line:${p.name}:click`,h=>{if(!h.features)return;const x=h.features[0];if(x.geometry.type==="LineString"&&x.properties&&typeof x.properties.description=="string"&&x.properties.description){const _=[(x.geometry.coordinates[0][0]+x.geometry.coordinates[1][0])/2,(x.geometry.coordinates[0][1]+x.geometry.coordinates[1][1])/2],{description:M}=x.properties;for(;Math.abs(h.lngLat.lng-_[0])>180;)_[0]+=h.lngLat.lng>_[0]?360:-360;s.setLngLat(_).setHTML(M).addTo(t)}}),t.on("mouseleave",`layer:line:${p.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${p.name}:click`,h=>{let x;if(n.state.internalLineSources)for(const M of n.state.internalLineSources)M.name===p.name&&(x=M.click);if(!h.features||!x)return;const _=h.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:M}=_.properties;x(M)}})))}e({internalLineSources:i})}const d=m({},r);let f=!1;for(const p of Object.keys(c))if(c[p]!==r[p]){for(const w of i)if(w.name===p){f=!0,d[p]=c[p];const b=t==null?void 0:t.getSource(`line:${w.name}`);if(b){const h=c[p];b.setData({type:"FeatureCollection",features:w.lines.map(x=>({type:"Feature",properties:{description:`<strong>${x.name}</strong><p>${x.description}</p>`,index:x.index,name:x.name,selected:h==null?void 0:h.includes(x.index)},geometry:{type:"LineString",coordinates:[[x.startLongitude,x.startLatitude],[x.endLongitude,x.endLatitude]]}}))})}}}f&&e({internalSelections:d})}function Rn(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:l,internalSelections:r},{pointSources:i,selections:c}){if(!t||!l)return;if(a!==i)if(console.log("Setting points in map!"),a){for(const g of a){const p=t.getSource(`point:${g.name}`);p!==void 0&&p.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${g.name}`)}e({internalPointSources:void 0})}else{for(const g of i){let p=t.getSource(`point:${g.name}`);const w=p===void 0;w&&(t.addSource(`point:${g.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),p=t.getSource(`point:${g.name}`)),p!==void 0&&p.setData({type:"FeatureCollection",features:g.points.map(b=>{var h;return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:!((h=c[g.name])==null?void 0:h.includes(b.index))},geometry:{type:"Point",coordinates:[b.longitude,b.latitude]}}})}),t.addLayer({id:`layer:point:${g.name}`,type:"circle",source:`point:${g.name}`,paint:{"circle-color":["case",["get","selected"],g.color,g.selectedColor],"circle-radius":g.radius}}),w&&(t.on("mouseenter",`layer:point:${g.name}`,b=>{if(!b.features)return;const h=b.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const x=[...h.geometry.coordinates],{description:_}=h.properties;for(;Math.abs(b.lngLat.lng-x[0])>180;)x[0]+=b.lngLat.lng>x[0]?360:-360;s.setLngLat(x).setHTML(_).addTo(t)}}),t.on("mouseleave",`layer:point:${g.name}`,()=>{s.remove()}),t.on("click",`layer:point:${g.name}`,b=>{let h;if(n.state.internalPointSources)for(const _ of n.state.internalPointSources)h=_.click;if(!b.features||!h)return;const x=b.features[0];if(x.properties&&typeof x.properties.index=="number"&&typeof x.properties.name=="string"){const{index:_}=x.properties;h(_)}}))}e({internalPointSources:i})}const d=m({},r);let f=!1;for(const g of Object.keys(c))if(c[g]!==r[g]){for(const p of i)if(p.name===g){f=!0,d[g]=c[g];const w=t.getSource(`point:${p.name}`);if(w){const b=c[g];w.setData({type:"FeatureCollection",features:p.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(b==null?void 0:b.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}f&&e({internalSelections:d})}function Bn(n,e,{map:t,internalPolygonSources:s,mapLoaded:a},{polygonSources:l,selections:r}){if(t&&a&&s!==l)if(s){for(const i of s){const c=t.getSource(`poly:${i.name}`);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:poly:${i.name}`),t.removeLayer(`layer:poly:${i.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const i of l){let c=t.getSource(`poly:${i.name}`);c===void 0&&(t.addSource(`poly:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=t.getSource(`poly:${i.name}`)),c!==void 0&&c.setData({type:"FeatureCollection",features:i.polygons.map(f=>{var g;return{type:"Feature",properties:{description:f.name||f.description?`<strong>${f.name}</strong><p>${f.description}</p>`:"",index:f.index,name:f.name,selected:((g=r[i.name])==null?void 0:g.includes(f.index))||!1},geometry:{type:"Polygon",coordinates:[f.polygon.map(p=>[p.lon,p.lat])]}}})}),t.addLayer({id:`layer:poly:${i.name}:fill`,type:"fill",source:`poly:${i.name}`,layout:{},paint:{"fill-color":i.color,"fill-opacity":.5}}),t.addLayer({id:`layer:poly:${i.name}`,type:"line",source:`poly:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":i.borderColor,"line-width":i.borderRadius}})}e({internalPolygonSources:l})}}nt.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class En extends on.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new we.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(nt.accessToken&&t){const s=new we.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new we.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:l}=this.props;l(ke([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:l}=this.props;l&&l(ke([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:l}=this.state;if(!l||!(l==null?void 0:l.select))return;const r=a.map(i=>i&&i.type==="Feature"&&i.geometry.type==="Point"&&i.properties&&"index"in i.properties&&typeof i.properties.index=="number"?i.properties.index:-1).filter(i=>i>-1);l.select(r)}),s.on("draw.update",({features:a,action:l})=>{const{internalDrawnPointSource:r}=this.state;if(!!(r==null?void 0:r.update)&&l==="move"&&a.length>0)for(const i of a)i.type==="Feature"&&i.geometry.type==="Point"&&i.properties&&"index"in i.properties&&typeof i.properties.index=="number"&&r.update(i.properties.index,ke(i.geometry.coordinates))})}}componentDidUpdate(){return Pn(this,e=>this.setState(e),this.state,this.props),Bn(this,e=>this.setState(e),this.state,this.props),On(this,e=>this.setState(e),this.state,this.props),Mn(this,e=>this.setState(e),this.state,this.props),Rn(this,e=>this.setState(e),this.state,this.props),In(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const An={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Et;const Tn=m(m({},An),JSON.parse((Et=window.localStorage.getItem("meshDisplaySettings"))!=null?Et:"{}"));function Wn({settings:n,setSettings:e}){const t=s=>{e(s),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(s))};return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(v(m({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:s=>{t(v(m({},n),{color:s.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:s=>{t(v(m({},n),{width:Number.parseFloat(s.target.value)}))}})})]})]})}const Le=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ie={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Gn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var At;const zn=m(m({},Gn),JSON.parse((At=window.localStorage.getItem("segmentDisplaySettings"))!=null?At:"{}")),Hn=["",...Le];function Jn({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:l,splitSegment:r,setSelectionMode:i,save:c}){const d=p=>{e(p),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(p))},f=s.map(p=>t[p]).filter(p=>p),g=f.length>0?o(ae,{title:f.length===1?f[0].name:"Edit Selected Segments",items:f,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:p=>a(s,p),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>r(s),children:"Split Segment"})}):o(E,{});return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(v(m({},n),{hide:!n.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hideProjection,onChange:()=>{d(v(m({},n),{hideProjection:!n.hideProjection}))}})})]}),N("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Segments & Vertices"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const p=await Se([".csv"]);c(p)},children:"Save As"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:p=>{d(v(m({},n),{color:p.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:p=>{d(v(m({},n),{width:Number.parseFloat(p.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:p=>{d(v(m({},n),{activeColor:p.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:p=>{d(v(m({},n),{activeWidth:Number.parseFloat(p.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.projectionColor,onChange:p=>{d(v(m({},n),{projectionColor:p.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:n.plottableKey,onChange:p=>{d(v(m({},n),{plottableKey:p.currentTarget.value}))},children:Hn.map(p=>o("option",{value:p,children:p},p))})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Select Segment Starting Point",callback:p=>{i({mode:"mapClick",label:"Select Segment End point",callback:w=>{l(p,w),i("normal")}})}})},children:"New Segment"})]}),g]})}const ut=()=>ln(),le=rn;function Kn({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const l=ut(),[r,i]=le(c=>[c.main.past.length>0,c.main.future.length>0]);return N("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),N("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?o("button",{type:"button",onClick:()=>{l(st.ActionCreators.undo())},"data-testid":"undo-button",disabled:!r,children:"Undo"}):o(E,{}),n?o("button",{type:"button",onClick:()=>{l(st.ActionCreators.redo())},disabled:!i,"data-testid":"undo-button",children:"Redo"}):o(E,{}),n?N("span",{children:["Working in ",n.name]}):o("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?o("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):o(E,{})]})]})}const Un={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var Tt;const qn=JSON.parse((Tt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Tt:"false")||Un;function Qn({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:l,save:r}){const i=f=>{e(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},c=t.map(f=>s[f]).filter(f=>f),d=c.length>0?o(ae,{title:c.length===1?c[0].name:"Edit Selected Velocities",items:c,deletable:!0,setItems:f=>a(t,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(E,{});return N(E,{children:[N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{i(v(m({},n),{hide:!n.hide}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>r(),children:"Save Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const f=await Se([".csv"]);r(f)},children:"Save As"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:f=>{i(v(m({},n),{color:f.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.selectedColor,onChange:f=>{i(v(m({},n),{selectedColor:f.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:f=>{i(v(m({},n),{scale:Number.parseFloat(f.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:f=>{i(v(m({},n),{width:Number.parseFloat(f.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:f=>{i(v(m({},n),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:l,children:"New Velocity"})]}),d]})}const Xn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Wt;const Zn=m(m({},Xn),JSON.parse((Wt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Wt:"{}"));function Yn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:l,mergeVertices:r,bridgeVertices:i,extrudeVertex:c,save:d}){const f=w=>{e(w),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(w))},p=s.map(w=>({selectedVertex:t[w],index:w})).filter(w=>w.selectedVertex).map(({selectedVertex:w,index:b})=>o(ae,{title:"Selected Vertex",items:[w],ignoreFields:[],deletable:!1,setItems:h=>a(b,m(m({},w),h)),fieldDefinitions:{},controls:N(E,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{r(b,h[0]),l("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{i(b,h[0]),l("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{c(b,h),l("normal")}})},children:"Extrude"})]})},b));return N("div",{className:"flex flex-col gap-2",children:[N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{f(v(m({},n),{hide:!n.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Segments & Vertices"})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.color,onChange:w=>{f(v(m({},n),{color:w.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:w=>{f(v(m({},n),{radius:Number.parseFloat(w.target.value)}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:n.activeColor,onChange:w=>{f(v(m({},n),{activeColor:w.target.value}))}})})]}),N("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:w=>{f(v(m({},n),{activeRadius:Number.parseFloat(w.target.value)}))}})})]}),p]})}const ft=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],mt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function es(n){return n?m(m({},mt),n):m({},mt)}function ts(n,{data:e}){return[...n,es(e)]}function ns(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function ss(n,e){const t=[...n];for(const s of e.indices){const a=m(m({},t[s]),e.data);t[s]=a}return t}function as(n,e){return e}function os(n,{index:e,position:t}){const s=[...n],a=m({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const is=[],pt=$("createBlock"),ht=$("editBlock"),gt=$("deleteBlock"),$e=$("loadNewBlockData"),yt=$("moveBlock"),ls=re(is,n=>{n.addCase(pt,(e,t)=>ts(e,t.payload)).addCase(ht,(e,t)=>ss(e,t.payload)).addCase(gt,(e,t)=>ns(e,t.payload)).addCase($e,(e,t)=>as(e,t.payload)).addCase(yt,(e,t)=>os(e,t.payload))});function rs(n,e){return v(m({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:e.data}})}function cs(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}function ds(n,e){const t=n[e.collection];if(!t)return n;const s=v(m({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat,plot:e.plot});return v(m({},n),{[e.collection]:s})}const us={},bt=$("loadNewGenericCollectionData"),vt=$("setGenericSegmentPositionKeys"),fs=$("removeGenericSegmentCollection"),ms=re(us,n=>n.addCase(bt,(e,t)=>rs(e,t.payload)).addCase(vt,(e,t)=>ds(e,t.payload)).addCase(fs,(e,t)=>cs(e,t.payload)));function ps(n,e){return v(m({},n),{[e.mesh]:e.data})}function hs(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}const gs={},Fe=$("loadMeshLineData"),ys=$("removeMesh"),bs=re(gs,n=>n.addCase(Fe,(e,t)=>ps(e,t.payload)).addCase(ys,(e,t)=>hs(e,t.payload)));function vs(n,{a:e,b:t}){const s=v(m({},ie),{start:e,end:t}),a=[...n.segments,s];return v(m({},n),{segments:a})}function xs(n,e){const t=m({},n.vertecies),s=m({},n.vertexDictionary),{lastIndex:a}=n,[l,r]=q(e.start,s,t,a),[i,c]=q(e.end,s,t,r),d=v(m(m({},ie),e),{start:l,end:i}),f=[...n.segments,d];return{vertecies:t,vertexDictionary:s,segments:f,lastIndex:c}}function ws(n,e){const t=[],s=[];let a=m({},n);for(const[l,r]of n.segments.entries())e.index.includes(l)?s.push(r):t.push(r);a.segments=t;for(const l of s)a=dt(dt(a,l.start),l.end);return a}function Ns(n,e){const t=[...n.segments];for(const s of e.indices){const a=m(m({},t[s]),e.data);t[s]=a}return v(m({},n),{segments:t})}function _s(n,e){const t=m({},n.vertecies),s=m({},n.vertexDictionary),[a,l]=q(e.targetPoint,s,t,n.lastIndex),r=v(m({},ie),{start:e.index,end:a}),i=[...n.segments,r];return{vertecies:t,vertexDictionary:s,segments:i,lastIndex:l}}function Ss(n,e){return e}function ks(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(c=>{let d=c;return d.start===t&&(d=v(m({},d),{start:e})),d.end===t&&(d=v(m({},d),{end:e})),d}).filter(c=>c.start!==c.end),a=n.vertecies[t],l=`${Math.floor(a.lon*O)},${Math.floor(a.lat*O)}`,r=m({},n.vertecies);delete r[t];const i=m({},n.vertexDictionary);return delete i[l],v(m({},n),{vertecies:r,vertexDictionary:i,segments:s})}function Cs(n,{index:e,vertex:t}){const s=m({},n.vertecies),a=m({},n.vertexDictionary),l=[...n.segments],r=s[e],i=`${Math.floor(t.lon*O)},${Math.floor(t.lat*O)}`,c=`${Math.floor(r.lon*O)},${Math.floor(r.lat*O)}`;if(delete a[c],i in a){const d=a[i];for(const f of l)f.start===d&&(f.start=e),f.end===d&&(f.end=e);delete s[d]}return s[e]=t,v(m({},n),{segments:l,vertecies:s,vertexDictionary:a})}function Ls(n,e){const t=m({},n.vertecies),s=m({},n.vertexDictionary),a=[...n.segments];let{lastIndex:l}=n;for(const r of e){const i=n.segments[r],c=n.vertecies[i.start],d=n.vertecies[i.end],f={lon:(c.lon+d.lon)/2,lat:(c.lat+d.lat)/2},[g,p]=q(f,s,t,l);l=p;const w=v(m({},i),{end:g,name:`${i.name}_a`}),b=v(m({},i),{start:g,name:`${i.name}_b`});a[r]=w,a.push(b)}return{vertecies:t,vertexDictionary:s,segments:a,lastIndex:l}}const $s={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},xt=$("bridgeVertices"),wt=$("createSegmet"),Nt=$("deleteSegment"),_t=$("editSegmentData"),St=$("extrudeSegment"),De=$("loadNewSegmentData"),kt=$("mergeVertices"),je=$("moveVertex"),Ct=$("splitSegment");function Fs(n,e,t){if(t.dip===90||t.locking_depth<=0)return!1;const s=t.dip<90,l=(s?90-t.dip:t.dip-90)*(Math.PI/180),r=Math.abs(Math.tan(l)*t.locking_depth),[i,c]=n.lon>=e.lon?[n,e]:[e,n],d={lon:c.lat-i.lat,lat:-(c.lon-i.lon)};s&&(d.lon*=-1,d.lat*=-1);const f=at(ot([[i.lon,i.lat],[i.lon+d.lon,i.lat+d.lat]]),r,{units:"kilometers"}),g=at(ot([[c.lon,c.lat],[c.lon+d.lon,c.lat+d.lat]]),r,{units:"kilometers"});return[i,{lon:f.geometry.coordinates[0],lat:f.geometry.coordinates[1]},{lon:g.geometry.coordinates[0],lat:g.geometry.coordinates[1]},c]}function Ds(n){return n.segments.map(e=>Fs(n.vertecies[e.start],n.vertecies[e.end],e)).filter(e=>e)}const js=re($s,n=>{n.addCase(xt,(e,t)=>vs(e,t.payload)).addCase(wt,(e,t)=>xs(e,t.payload)).addCase(Nt,(e,t)=>ws(e,t.payload)).addCase(_t,(e,t)=>Ns(e,t.payload)).addCase(St,(e,t)=>_s(e,t.payload)).addCase(De,(e,t)=>Ss(e,t.payload)).addCase(kt,(e,t)=>ks(e,t.payload)).addCase(je,(e,t)=>Cs(e,t.payload)).addCase(Ct,(e,t)=>Ls(e,t.payload))}),Lt=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Vs={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Ms(n){return m(m({},Vs),n)}function Is(n,{data:e}){return[...n,Ms(e)]}function Ps(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function Os(n,e){const t=[...n];for(const s of e.indices){const a=m(m({},t[s]),e.data);t[s]=a}return t}function Rs(n,e){return e}function Bs(n,{index:e,position:t}){const s=[...n],a=m(m({},s[e]),t);return s[e]=a,s}const Es=[],$t=$("createVelocity"),Ft=$("editVelocity"),Dt=$("deleteVelocity"),Ve=$("loadNewVelocityData"),jt=$("moveVelocity"),As=re(Es,n=>{n.addCase($t,(e,t)=>Is(e,t.payload)).addCase(Ft,(e,t)=>Os(e,t.payload)).addCase(Dt,(e,t)=>Ps(e,t.payload)).addCase(Ve,(e,t)=>Rs(e,t.payload)).addCase(jt,(e,t)=>Bs(e,t.payload))});function ce(n){const e=n.split(/\n/g),t=e[0].split(",").map(l=>l.trim()),s=e.slice(1),a=[];for(const l of s)if(l.trim()!==""){const r=l.split(/\s*,\s*/),i={};for(let c=0;c<t.length;c+=1){let d=r[c];const f=t[c],g=Number.parseFloat(d);d=Number.isNaN(g)?d:g,typeof d=="string"&&(d=d.startsWith('"')&&d.endsWith('"')?d.slice(1,-1).trim():d.trim()),i[f]=d}a.push(i)}return a}function Me(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(l=>{if(l in a){const r=a[l];return typeof r=="string"&&/\s/.test(`${r}`)?`"${r.trim()}"`:`${typeof r=="number"&&(l.includes("lon")||l.includes("lat"))?r.toFixed(6):r}`}return""}).join(","))}return t.join(`
`)}class pe{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ce(e).map(a=>{const l={};for(const r of ft)l[r]=a[r]||(r==="name"?"":0);return l});this.data=s}async save(){var t;const e=Me((t=this.data)!=null?t:[],ft);await this.handle.setContents(e)}clone(){return new pe(this.handle)}}const Ts={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Ws(n){return m(m({},Ts),n)}class Ie{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Ws(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new Ie(this.handle)}}class Gs{constructor(e){k(this,"data");k(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=ce(e);this.data=t}async save(){}}function zs(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(s=>{const a=Number.parseFloat(s[1]),l=Number.parseFloat(s[2]);return{lon:a,lat:l}});return t.splice(0,0,{lon:0,lat:0}),t}const Hs={"1":n=>{var s,a;const e=Number.parseInt((s=n[n.length-2])!=null?s:"",10),t=Number.parseInt((a=n[n.length-1])!=null?a:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var a,l,r;const e=Number.parseInt((a=n[n.length-3])!=null?a:"",10),t=Number.parseInt((l=n[n.length-2])!=null?l:"",10),s=Number.parseInt((r=n[n.length-1])!=null?r:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(s)?[[e,t],[t,s],[s,e]]:!1}};function Js(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var s;return((s=Hs[e[1]])!=null?s:()=>!1)(e)}).filter(e=>e).flat()}function Ks(n,e){return e.map(([t,s])=>t!==s&&t>-1&&t<n.length&&s>-1&&s<n.length?[n[t],n[s]]:!1).filter(t=>t)}function Us(n){const e=n.split("$");let t=[],s=[];for(const a of e)a.startsWith("Nodes")?t=zs(a):a.startsWith("Elements")&&(s=Js(a));return Ks(t,s)}class qs{constructor(e){k(this,"data");k(this,"handle");k(this,"startLonColumn");k(this,"endLonColumn");k(this,"startLatColumn");k(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=Us(e);else{const t=ce(e);this.data=t.map(s=>{const a={lon:0,lat:0},l={lon:0,lat:0};console.log("parsing row",s),typeof s[this.startLonColumn]=="number"&&(a.lon=s[this.startLonColumn]),typeof s[this.startLatColumn]=="number"&&(a.lat=s[this.startLatColumn]),typeof s[this.endLonColumn]=="number"&&(l.lon=s[this.endLonColumn]),typeof s[this.endLatColumn]=="number"&&(l.lat=s[this.endLatColumn]);const r=Object.keys(s).filter(i=>i!==this.startLatColumn&&i!==this.endLatColumn&&i!==this.startLonColumn&&i!==this.endLonColumn);if(r.length>0){const i={};for(const c of r)i[c]=s[c];return[a,l]}return[a,l]})}}async save(){console.log("Mesh files do not get saved")}}class he{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ce(e).map(c=>{const d={};for(const f of Le)d[f]=c[f]||(f==="name"?"":0);return d}),a={},l={},r=[];let i=0;for(const c of s){const[d,f]=q({lon:c.lon1,lat:c.lat1},a,l,i),[g,p]=q({lon:c.lon2,lat:c.lat2},a,l,f),w=v(m({},c),{start:d,end:g});i=p,r.push(w)}this.data={vertecies:l,segments:r,vertexDictionary:a,lastIndex:i}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(l=>{const r=s[l.start],i=s[l.end];return v(m({},l),{lon1:r.lon,lat1:r.lat,lon2:i.lon,lat2:i.lat})})}const t=Me(e,Le);await this.handle.setContents(t)}clone(){return new he(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*O)},${Math.floor(s.lat*O)}`,l=m({},this.data.vertecies);delete l[e];const r=m({},this.data.vertexDictionary);delete r[a];const i=this.clone();return i.data=v(m({},this.data),{vertecies:l,vertexDictionary:r}),i}}return this}mergeVertices(e,t){if(this.data){for(const c of this.data.segments)c.start===t&&(c.start=e),c.end===t&&(c.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*O)},${Math.floor(s.lat*O)}`,l=m({},this.data.vertecies);delete l[t];const r=m({},this.data.vertexDictionary);delete r[a];const i=this.clone();return i.data=v(m({},this.data),{vertecies:l,vertexDictionary:r}),i}return this}moveVertex(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),l=[...this.data.segments],r=s[e],i=`${Math.floor(t.lon*O)},${Math.floor(t.lat*O)}`,c=`${Math.floor(r.lon*O)},${Math.floor(r.lat*O)}`;if(delete a[c],i in a){const f=a[i];for(const g of l)g.start===f&&(g.start=e),g.end===f&&(g.end=e);delete s[f]}s[e]=t;const d=this.clone();return d.data=v(m({},this.data),{segments:l,vertecies:s,vertexDictionary:a}),d}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],l={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[r,i]=q(l,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),c=v(m({},t),{end:r,name:`${t.name}_a`}),d=v(m({},t),{start:r,name:`${t.name}_b`}),f=[...this.data.segments];f[e]=c,f.push(d);const g=this.clone();return g.data=v(m({},this.data),{segments:f,lastIndex:i}),g}return this}bridgeVertices(e,t){if(this.data){const s=v(m({},ie),{start:e,end:t}),a=[...this.data.segments,s],l=this.clone();return l.data=v(m({},this.data),{segments:a}),l}return this}extrudeSegment(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[l,r]=q(t,a,s,this.data.lastIndex),i=v(m({},ie),{start:e,end:l}),c=[...this.data.segments,i],d=this.clone();return d.data={vertecies:s,vertexDictionary:a,segments:c,lastIndex:r},d}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=v(m({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=m({},this.data.vertecies),a=m({},this.data.vertexDictionary),[l,r]=q(e,a,s,this.data.lastIndex),[i,c]=q(t,a,s,r),d=v(m({},ie),{start:l,end:i}),f=[...this.data.segments,d],g=this.clone();return g.data={vertecies:s,vertexDictionary:a,segments:f,lastIndex:c},g}return this}}class ge{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=ce(e).map(a=>{const l={};for(const r of Lt)l[r]=a[r]||(r==="name"?"":0);return l});this.data=s}async save(){var t;const e=Me((t=this.data)!=null?t:[],Lt);await this.handle.setContents(e)}clone(){return new ge(this.handle)}}async function Vt(n){const e=new he(n);return await e.initialize(),e}async function Mt(n){const e=new pe(n);return await e.initialize(),e}async function It(n){const e=new ge(n);return await e.initialize(),e}async function Pt(n){const e=new qs(n);return await e.initialize(),e}async function Qs(n){const e=new Gs(n);return await e.initialize(),e}async function de(n,e,t){try{const s=await e.getFile(n);return await t(s)}catch{return!1}}async function Xs(n,e,t){const s=new Ie(e);if(await s.initialize(),s.data){const a=await de(s.data.segment_file_name,n,Vt),l=await de(s.data.block_file_name,n,Mt),r=await de(s.data.station_file_name,n,It),i=await de(s.data.mesh_parameters_file_name,n,async d=>{const f=JSON.parse(await d.getContents());return(await Promise.all(f.map(async p=>de(p.mesh_filename,n,Pt)))).filter(p=>p)}),c=m({},t);return"command"in c&&(c.command=v(m({},c.command),{currentFilePath:e.name})),a&&"segment"in c&&(c.segment=v(m({},c.segment),{currentFilePath:s.data.segment_file_name})),l&&"block"in c&&(c.block=v(m({},c.block),{currentFilePath:s.data.block_file_name})),r&&"velocities"in c&&(c.velocities=v(m({},c.velocities),{currentFilePath:s.data.station_file_name})),i&&"mesh"in c&&(c.mesh=v(m({},c.mesh),{currentFilePath:i.map(d=>d.handle.name)})),{openableFiles:c,commands:s,segments:a,blocks:l,velocities:r,mesh:i}}throw new Error("Can't open command file")}window.location.search.includes("fake-dir")||wn(bn);var H;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(H||(H={}));const Ot={Block:H.Block,Vertex:H.Vertex,Velocity:H.Velocity},Zs={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments"};function Ys(){var Ze,Ye,et;const n=ut(),[e,t]=S.exports.useState(),[s,a]=S.exports.useState(""),[l,r]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[i,c]=S.exports.useState(),[d,f]=S.exports.useState(),[g,p]=S.exports.useState(),[w,b]=S.exports.useState(),h=le(u=>u.main.present.segment),x=le(u=>u.main.present.block),_=le(u=>u.main.present.velocity),M=le(u=>u.main.present.meshLine),Z=le(u=>u.main.present.genericSegments),[L,Pe]=S.exports.useState(qn),[I,Oe]=S.exports.useState(kn),[R,Re]=S.exports.useState(zn),[F,Be]=S.exports.useState(Zn),[J,Ee]=S.exports.useState(Tn),[K,Ae]=S.exports.useState(Fn),[T,te]=S.exports.useState("normal"),[ne,Gt]=S.exports.useState(H.Vertex),[ye,Te]=S.exports.useState([]),[We,Ge]=S.exports.useState([]),[ze,He]=S.exports.useState([]),[Je,Ke]=S.exports.useState([]),[j,aa]=S.exports.useState({select:(u,y)=>{Te(u==="block"?y:[]),Ge(u==="segment"?y:[]),He(u==="velocities"?y:[]),Ke(u==="vertex"?y:[]),a(u)}}),[zt,Ht]=S.exports.useState([]),[Jt,Ue]=S.exports.useState([]),[Kt,Ut]=S.exports.useState([]),[qt,qe]=S.exports.useState([]),[Qt,be]=S.exports.useState({color:F.color,selectedColor:F.activeColor,radius:F.radius,selectedRadius:F.activeRadius,points:[]}),[Qe,Xt]=S.exports.useState({lon:0,lat:0}),[ve,Zt]=S.exports.useState(!1);S.exports.useEffect(()=>{T==="normal"?j.select=(u,y)=>{Te(u==="block"?y:[]),Ge(u==="segment"?y:[]),He(u==="velocities"?y:[]),Ke(u==="vertex"?y:[]),a(u)}:T.mode==="override"?j.select=(u,y)=>{u===T.type&&T.callback(y)}:j.select=()=>{}},[T,j]),S.exports.useEffect(()=>{const u=[];ne!==H.Block&&!I.hide&&u.push({name:"blocks",color:I.color,selectedColor:I.selectedColor,radius:I.radius,points:x.map((y,C)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:C})),click:y=>{j.select("block",[y])}}),ne!==H.Vertex&&!F.hide&&u.push({name:"vertices",color:F.color,selectedColor:F.activeColor,radius:F.radius,click:y=>{j.select("vertex",[y])},points:Object.keys(h.vertecies).map(y=>{const C=Number.parseInt(y,10),V=h.vertecies[C];return V?{longitude:V.lon,latitude:V.lat,index:C,name:"",description:""}:!1}).filter(y=>!!y)}),Ht(u)},[I,x,R,j,ne,F.hide,F.color,F.activeColor,F.radius,h.vertecies]),S.exports.useEffect(()=>{const u=[];if(R.hide||u.push({name:"segments",color:R.color,selectedColor:R.activeColor,width:R.width,selectedWidth:R.activeWidth,lines:h.segments.map((y,C)=>{var U,W;const V=(U=h.vertecies[y.start])!=null?U:rt,A=(W=h.vertecies[y.end])!=null?W:rt,[[Q,B],[G,P]]=Ce(V,A);return{startLongitude:Q,startLatitude:B,endLongitude:G,endLatitude:P,name:y.name,description:`${V.lon},${V.lat} to ${A.lon},${A.lat}`,index:C,label:R.plottableKey in y?`${y[R.plottableKey]}`:""}}),click:y=>{j.select("segment",[y])}}),!J.hide)for(const y of Object.keys(M)){const C=M[y];u.push({name:`mesh:${y}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:C.map((V,A)=>{const Q=V[0],B=V[1],[[G,P],[U,W]]=Ce(Q,B);return{startLongitude:G,startLatitude:P,endLongitude:U,endLatitude:W,name:"",description:"",index:A}})||[]})}if(!K.hide)for(const y of Object.keys(Z)){const{startLat:C,startLon:V,endLat:A,endLon:Q,plot:B,segments:G}=Z[y];C in G[0]&&A in G[0]&&V in G[0]&&Q in G[0]&&u.push({name:`generic_segment:${y}`,color:K.color,selectedColor:K.activeColor,width:K.width,selectedWidth:K.activeWidth,lines:G.map((P,U)=>{const W={lat:P[C],lon:P[V]},se={lat:P[A],lon:P[Q]};if(typeof W.lat!="number"||typeof W.lon!="number"||typeof se.lat!="number"||typeof se.lon!="number")return!1;const[[ue,D],[fe,me]]=Ce(W,se);return{startLongitude:ue,startLatitude:D,endLongitude:fe,endLatitude:me,name:"",description:"",index:U,label:B&&B in P?`${P[B]}`:""}}).filter(P=>P)||[]})}Ut(u)},[h,R,K,Z,J,M,j]),S.exports.useEffect(()=>{switch(ne){case H.Vertex:{be({color:F.color,radius:F.radius,selectedColor:F.activeColor,selectedRadius:F.activeRadius,points:F.hide?[]:Object.keys(h.vertecies).map(u=>{const y=Number.parseInt(u,10),C=h.vertecies[y];return C?{longitude:C.lon,latitude:C.lat,index:y}:!1}).filter(u=>!!u),update:(u,y)=>{n(je({index:u,vertex:y}))},select:u=>{j.select("vertex",u)}});break}case H.Block:{be({color:I.color,radius:I.radius,selectedColor:I.selectedColor,selectedRadius:I.radius,points:I.hide?[]:x.map((u,y)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(yt({index:u,position:y}))},select:u=>{j.select("block",u)}});break}case H.Velocity:{be({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:_.map((u,y)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(jt({index:u,position:y}))},select:u=>{j.select("velocities",u)}});break}}},[F,j,h.vertecies,n,ne,I.color,I.radius,I.selectedColor,I.hide,x,L.color,L.width,L.selectedColor,L.hide,_]),S.exports.useEffect(()=>{L.hide?Ue([]):Ue([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:_.map((u,y)=>{const C=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/C,u.north_vel/C],scale:C,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:y}}),click:u=>{j.select("velocities",[u])}}])},[j,L,_]),S.exports.useEffect(()=>{R.hideProjection?qe([]):qe([{name:"fault_dip_projections",color:R.projectionColor,borderColor:R.projectionColor,borderRadius:.5,polygons:Ds(h).map((u,y)=>({polygon:u,index:y,name:"",description:""}))}])},[R,h]);let Y=o("span",{});switch(s){case"files":Y=e?o(Ln,{folder:e,files:l,setFile:async(u,y,C,V)=>{if(V){let A=m({},l);const Q=A[y];let{currentFilePath:B,allowMultiple:G}=Q;switch(G?Array.isArray(B)?(B=B.map(P=>P),B.length>u?B[u]=C:B.push(C)):B=[C]:B=C,A[y]=v(m({},Q),{currentFilePath:B}),y){case"segment":const P=await Vt(V);f(P),P.data&&n(De(P.data));break;case"block":const U=await Mt(V);p(U),U.data&&n($e(U.data));break;case"velocities":const W=await It(V);b(W),W.data&&n(Ve(W.data));break;case"mesh":const se=await Pt(V);se.data&&n(Fe({mesh:`mesh_file_${u}`,data:se.data}));break;case"csv":const ue=await Qs(V);ue.data&&n(bt({name:`generic_segment_${u}`,data:ue.data}));break;case"command":const D=await Xs(e,V,l);c(D.commands!==!1?D.commands:void 0),f(D.segments!==!1?D.segments:void 0),D.segments!==!1&&D.segments.data&&n(De(D.segments.data)),p(D.blocks!==!1?D.blocks:void 0),D.blocks!==!1&&D.blocks.data&&n($e(D.blocks.data)),b(D.velocities!==!1?D.velocities:void 0),D.velocities!==!1&&D.velocities.data&&n(Ve(D.velocities.data)),D.mesh&&D.mesh.map((fe,me)=>(fe.data&&n(Fe({mesh:`mesh_file_${me}`,data:fe.data})),me)),A=D.openableFiles;break}r(A)}}}):o("span",{});break;case"velocities":Y=o(Qn,{settings:L,setSettings:Pe,selected:ze,velocitys:_,setVelocityData:(u,y)=>{y?n(Ft({indices:u,data:y})):(n(Dt(u)),j.select("velocity",[]))},addNewVelocity:()=>{te({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{te("normal");const y=_.length;n($t({data:{lat:u.lat,lon:u.lon}})),j.select("velocity",[y])}})},save:async u=>{if(u){const y=new ge(u);y.data=_,b(y),await y.save()}else w&&(w.data=_,await w.save())}});break;case"block":Y=o(Cn,{settings:I,setSettings:Oe,selected:ye,blocks:x,addNewBlock:()=>{te({label:"Click to place new block",mode:"mapClick",callback:u=>{const y=x.length;n(pt({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),j.select("block",[y]),te("normal")}})},setBlockData:(u,y)=>{y?n(ht({indices:ye,data:y})):(n(gt(u)),j.select("block",[]))},save:async u=>{if(u){const y=new pe(u);y.data=x,p(y),await y.save()}else g&&(g.data=x,await g.save())}});break;case"segment":Y=o(Jn,{settings:R,setSettings:Re,segments:(Ze=h.segments)!=null?Ze:[],selected:We,setSelectionMode:u=>te(u),addNewSegment:(u,y)=>{const C=h.segments.length;n(wt({start:u,end:y})),j.select("segment",[C])},setSegmentData:(u,y)=>{n(y?_t({indices:u,data:y}):Nt({index:u}))},splitSegment:u=>{n(Ct(u)),j.select("segment",[])},save:async u=>{if(u){const y=new he(u);y.data=h,f(y),await y.save()}else d&&(d.data=h,await d.save())}});break;case"vertex":Y=o(Yn,{settings:F,setSettings:Be,vertices:(Ye=h.vertecies)!=null?Ye:{},selected:Je,setVertexData:(u,y)=>{y&&n(je({index:u,vertex:y}))},setSelectionMode:u=>te(u),mergeVertices:(u,y)=>{n(kt({a:u,b:y}))},bridgeVertices:(u,y)=>{n(xt({a:u,b:y}))},extrudeVertex:(u,y)=>{n(St({index:u,targetPoint:y}))},save:async()=>{d&&(d.data=h,await d.save())}});break;case"mesh":Y=o(Wn,{settings:J,setSettings:Ee});break;case"csv":Y=o(Dn,{settings:K,setSettings:Ae,setCollectionVertexKeys:u=>{n(vt(u))},collections:Z});break}const Xe={Block:{state:I.hide,change:()=>{Oe(v(m({},I),{hide:!I.hide}))}},Vertex:{state:F.hide,change:()=>{Be(v(m({},F),{hide:!F.hide}))}},Velocity:{state:L.hide,change:()=>{Pe(v(m({},L),{hide:!L.hide}))}},Segment:{state:R.hide,change:()=>{Re(v(m({},R),{hide:!R.hide}))}},Grid:{state:!ve,change:()=>{Zt(!ve)}},Mesh:{state:J.hide,change:()=>{Ee(v(m({},J),{hide:!J.hide}))}},GenericSegments:{state:K.hide,change:()=>{Ae(v(m({},K),{hide:!K.hide}))}}};return N("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:u=>{u.key==="Escape"&&te("normal")},children:[o(Kn,{filesOpen:((et=i!=null?i:d)!=null?et:g)!==void 0,saveFiles:async()=>{i&&await i.save(),d&&(d.data=h,await d.save()),g&&(g.data=x,await g.save()),w&&(w.data=_,await w.save())},folder:e,openFolder:async()=>{const u=await Nn();t(u),a("files")}}),T!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:N("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:T.label}),T.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:T.subtitle}):o(E,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(E,{}),N("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-start gap-5",children:N("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ne})]})}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[N("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),N("span",{children:[Math.floor(Qe.lon*1e3)/1e3,","," ",Math.floor(Qe.lat*1e3)/1e3]})]}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Ot).map(u=>{const y=Ot[u];return o("button",{type:"button",className:`${ne===y?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Gt(y)},children:u},u)})]}),N("div",{className:"flex flex-row items-center justify-start gap-5",children:[N("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Xe).map(u=>{const y=Xe[u];return o("button",{type:"button",className:`${y.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{y.change()},children:u},u)})]})]}),o(En,{pointSources:zt,arrowSources:Jt,lineSources:Kt,drawnPointSource:Qt,polygonSources:qt,selections:{segments:We,blocks:ye,velocities:ze,vertices:Je},displayGrid:ve?10:-1,click:u=>{typeof T!="string"&&T.mode==="mapClick"&&T.callback(u)},mouseMove:u=>{Xt(u)}}),o(jn,{view:Y,buttons:e?Zs:void 0,active:s,setActive:u=>a(u)})]})}const ea=cn({reducer:{main:dn(un({segment:js,block:ls,velocity:As,meshLine:bs,genericSegments:ms}))}});function ta(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:l}=n;let r;const i=async(c=!0)=>{};return"serviceWorker"in navigator&&(r=new fn("./sw.js",{scope:"./"}),r.addEventListener("activated",c=>{c.isUpdate?window.location.reload():s==null||s()}),r.register({immediate:e}).then(c=>{a==null||a(c)}).catch(c=>{l==null||l(c)})),i}ta();const na=1,sa=new mn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:na}}});pn.render(o(S.exports.StrictMode,{children:o(hn,{client:sa,children:o(gn,{store:ea,children:o(Ys,{})})})}),document.querySelector("#root"));
