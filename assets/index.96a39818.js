var Ut=Object.defineProperty,qt=Object.defineProperties;var Qt=Object.getOwnPropertyDescriptors;var Ge=Object.getOwnPropertySymbols;var Xt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var he=(e,t,n)=>t in e?Ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))Xt.call(t,n)&&he(e,n,t[n]);if(Ge)for(var n of Ge(t))Zt.call(t,n)&&he(e,n,t[n]);return e},N=(e,t)=>qt(e,Qt(t));var j=(e,t,n)=>(he(e,typeof t!="symbol"?t+"":t,n),n);import{j as s,a as v,F,r as C,M as Yt,m as Ke,R as en,b as ge,u as tn,c as nn,l as ze,d as on,e as te,f as _,g as Je,h as Ue,i as sn,k as an,n as ln,v as rn,Q as cn,o as dn,p as un,P as fn}from"./vendor.da2b9cb6.js";const pn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};pn();const ye=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],qe={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function mn(e){return e?h(h({},qe),e):h({},qe)}function hn({value:e,fieldDefinition:t,setField:n}){const[o,a]=C.exports.useState(-1),[r,c]=C.exports.useState(e);C.exports.useEffect(()=>{c(e)},[e]);let l=s("input",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",type:typeof e=="number"?"number":"text",value:r,onChange:d=>{const u=typeof e=="number"?Number.parseFloat(d.target.value):d.target.value;c(u),o>-1&&clearTimeout(o),a(setTimeout(()=>n(u),1e3))}});return t.type==="select"&&(l=v("select",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",value:r,onChange:d=>{n(d.currentTarget.value)},children:[s("option",{value:"","data-testid":`input-editor-${t.name}-empty`,children:"\xA0"}),t.items.map(d=>s("option",{value:d.name,"data-testid":`input-editor-${t.name}-${d.name}`,children:d.name},d.name))]})),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[s("span",{"data-testid":`input-title-${t.name}`,className:"text-l font-bold",children:t.name}),t.description?s("span",{className:"text-sm",children:t.description}):s(F,{})]}),s("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function ne({title:e,items:t,setItems:n,fieldDefinitions:o,ignoreFields:a,deletable:r,controls:c}){const l=t[0],d=Object.keys(l).map((u,b)=>{if(a==null?void 0:a.includes(u))return{element:s("span",{style:{display:"hidden"}},u),order:b+1e4};let m=l[u];for(const x of t)if(x[u]!==m){m="-";break}const p=u in o&&o[u];return p?{element:s(hn,{value:m,fieldDefinition:p,setField:x=>n({[u]:x})},u),order:p.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":`input-title-${u}`,className:"text-l font-bold",children:u}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${u}`,className:"bg-gray-800 w-full",type:typeof m=="number"?"number":"text",value:m,onChange:x=>{n({[u]:typeof m=="number"?Number.parseFloat(x.target.value):x.target.value})}})})]},u),order:b+1e3}}).sort((u,b)=>u.order-b.order).map(u=>u.element);return v("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:e}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[c,r?s("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):s(F,{})]})]}),d]})}ne.defaultProps={ignoreFields:[],controls:s(F,{})};const gn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},yn=["",...ye];var _t;const bn=JSON.parse((_t=window.localStorage.getItem("blockDisplaySettings"))!=null?_t:"false")||gn;function xn({settings:e,setSettings:t,selected:n,blocks:o,setBlockData:a,addNewBlock:r,save:c,open:l}){const d=m=>{t(m),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(m))},u=n.map(m=>o[m]).filter(m=>m),b=u.length>0?s(ne,{title:u.length===1?u[0].name:"Edit Selected Blocks",items:u,deletable:!0,setItems:m=>a(n,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(F,{});return v(F,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{d(N(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:m=>{d(N(h({},e),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:m=>{d(N(h({},e),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:e.radius,onChange:m=>{d(N(h({},e),{radius:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:m=>{d(N(h({},e),{plottableKey:m.currentTarget.value}))},children:yn.map(m=>s("option",{value:m,children:m},m))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Block"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),b]})}function vn(e){let t="..";for(let n=2;n<e;n+=1)t=`${t}/..`;return t}function wn({root:e,chooseFile:t,close:n,extension:o,isSaveDialog:a}){var f,k;const[r,c]=C.exports.useState(""),[l,d]=C.exports.useState(),[u,b]=C.exports.useState(""),[m,p]=C.exports.useState([e]),x=(f=m.at(-1))!=null?f:e,w=[...m.filter(S=>S!==e).map((S,D)=>s("button",{type:"button","data-testid":`back-${D}`,onClick:async()=>{p(m.slice(0,D+1))},children:vn(m.length-D)},D)),...x.folderList.map(S=>s("button",{type:"button","data-testid":`folder-${S}`,onClick:async()=>{p([...m,await x.getDirectory(S)])},children:S},S))],y=x.fileList.filter(S=>S.endsWith(o)).map(S=>s("button",{type:"button","data-testid":`file-${S}`,className:(l==null?void 0:l.name)===S?"font-bold":"",onClick:async()=>{const D=await x.getFile(S);d(D),c(D.name),b(await D.getContents())},children:S},S));return s("div",{role:"none","data-testid":"explorer-backdrop",className:"fixed w-full h-full flex flex-col justify-center items-center z-50 bg-black/50",onClick:()=>n(),children:v("div",{role:"none",className:"bg-black p-5 flex flex-col gap-2",onClick:S=>S.stopPropagation(),children:[s("span",{children:"Open File"}),v("div",{className:"flex flex-row gap-2 pointer-events-auto",children:[v("div",{className:"border-gray-800 border p-2 flex flex-col gap-1 min-w-[20rem] max-w-[30rem] max-h-40 overflow-auto items-start",children:[w,y]}),l?v("div",{className:"border-gray-800 border p-2 max-w-[30rem] max-h-40 overflow-auto whitespace-pre",children:[s("span",{"data-testid":"selected-file-name",className:"text-xl font-bold",children:l.name}),s("p",{"data-testid":"selected-file-content",children:u})]}):s(F,{})]}),v("div",{className:"flex flex-row",children:[s("div",{"data-testid":"file-path",className:"flex-grow p-1",children:a?x.path.join("/"):(k=l==null?void 0:l.path.join("/"))!=null?k:""}),a?s("input",{"data-testid":"file-path-input",className:"flex-grow p-1 bg-gray-800",value:r,onChange:S=>c(S.target.value)}):s(F,{})]}),v("div",{className:"flex flex-row-reverse gap-2 pointer-events-auto",children:[s("button",{"data-testid":"select-button",type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2 disabled:bg-gray-900",disabled:!l&&!r,onClick:async()=>{let S=l;if(a&&(S=await x.getFile(r.endsWith(o)?r:`${r}${o}`)),S){const D=m.filter(L=>L!==e).map(L=>L.name);D.push(S.name),t(S,D)}},children:a?"Save":"Select"}),s("button",{"data-testid":"close-button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",type:"button",onClick:()=>n(),children:"Close"})]})]})})}const Sn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var $t;const Nn=h(h({},Sn),JSON.parse(($t=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?$t:"{}"));function kn({settings:e,setSettings:t,collections:n,setCollectionVertexKeys:o,open:a}){const r=l=>{t(l),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(l))},c=Object.keys(n).map(l=>{const{startLat:d,startLon:u,endLat:b,endLon:m,segments:p,plot:x}=n[l],w=Object.keys(p[0]).map((y,f)=>({name:y,value:f}));return s(ne,{title:l,items:[{startLat:d,startLon:u,endLat:b,endLon:m,plot:x}],deletable:!1,setItems:y=>{o(h({collection:l,startLat:d,startLon:u,endLat:b,endLon:m,plot:x},y))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:w},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:w},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:w},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:w},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:w}}},l)});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{r(N(h({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>a(),children:"Open Segments"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:l=>{r(N(h({},e),{color:l.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:l=>{r(N(h({},e),{width:Number.parseFloat(l.target.value)}))}})})]}),c]})}function Cn({view:e,buttons:t,active:n,setActive:o}){if(!t)return s("span",{});const a=[];for(const r of Object.keys(t)){const c=t[r],l=r===n;a.push(s("button",{type:"button","data-testid":`tab-${r}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>o(l?"":r),children:c},r))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?s("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:e}):"",s("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:a})]})}const Qe={lon:0,lat:0},Ln=180,oe=360;function Xe(e){let{lon:t,lat:n}=e;for(;t<0;)t+=oe;for(;t>oe;)t-=oe;return[t,n]}function be([e,t]){return{lon:e<0?e+oe:e,lat:t}}function xe(e,t){const n=Xe(e),o=Xe(t),a=[o[0],o[1]];return o[0]-n[0]>=Ln?a[0]-=oe:a[0]+=oe,Math.abs(n[0]-o[0])>Math.abs(n[0]-a[0])?[n,a]:[n,o]}const A=1e6;function se(e,t,n,o){const a=`${Math.floor(e.lon*A)},${Math.floor(e.lat*A)}`;if(a in t)return[t[a],o];const r=o;return n[r]=e,t[a]=r,[r,o+1]}function Ze(e,t){let n=!1;for(const o of e.segments)if(o.start===t||o.end===t){n=!0;break}if(!n&&e.vertecies[t]){const o=e.vertecies[t],a=`${Math.floor(o.lon*A)},${Math.floor(o.lat*A)}`,r=h({},e.vertecies);delete r[t];const c=h({},e.vertexDictionary);return delete c[a],N(h({},e),{vertecies:r,vertexDictionary:c})}return e}const H=Math.PI/6,U=2*Math.PI-H;function _n(e,t,{map:n,popup:o,internalArrowSources:a,mapLoaded:r,internalSelections:c},{arrowSources:l,selections:d}){var m;if(n&&r&&a!==l)if(console.log("Setting arrows in map!"),a){for(const p of a){const x=n.getSource(`arrow:${p.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${p.name}`),n.removeLayer(`layer:arrow:${p.name}:click`);try{n.getLayer(`layer:arrow:${p.name}:labels`)&&n.removeLayer(`layer:arrow:${p.name}:labels`)}catch{console.log("no label layer")}}t({internalArrowSources:void 0})}else{for(const p of l){let x=n.getSource(`arrow:${p.name}`);const w=x===void 0;if(w&&(n.addSource(`arrow:${p.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${p.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`arrow:${p.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:p.arrows.map(y=>{var q;const f=y.scale*p.scale,k=p.scale*p.arrowHeadScale,S=[y.longitude+y.direction[0]*f,y.latitude+y.direction[1]*f],D=[S[0]+(Math.cos(H)*-y.direction[0]-Math.sin(H)*-y.direction[1])*k,S[1]+(Math.sin(H)*-y.direction[0]+Math.cos(H)*-y.direction[1])*k],L=[S[0]+(Math.cos(U)*-y.direction[0]-Math.sin(U)*-y.direction[1])*k,S[1]+(Math.sin(U)*-y.direction[0]+Math.cos(U)*-y.direction[1])*k];return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:(q=d[p.name])==null?void 0:q.includes(y.index)},geometry:{type:"LineString",coordinates:[[y.longitude,y.latitude],S,D,S,L]}}})}),n.addLayer({id:`layer:arrow:${p.name}`,type:"line",source:`arrow:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],p.selectedColor,p.color],"line-width":p.width}}),n.addLayer({id:`layer:arrow:${p.name}:click`,type:"line",source:`arrow:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(m=p.arrows[0])==null?void 0:m.label){const y=n.getSource(`arrow:${p.name}:points`);y&&(y.setData({type:"FeatureCollection",features:p.arrows.map(f=>({type:"Feature",properties:{label:f.label},geometry:{type:"Point",coordinates:[f.longitude,f.latitude]}}))}),n.addLayer({id:`layer:arrow:${p.name}:labels`,type:"symbol",source:`arrow:${p.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}w&&(n.on("mouseenter",`layer:arrow:${p.name}:click`,y=>{if(!y.features)return;const f=y.features[0];if(f.geometry.type==="Point"&&f.properties&&typeof f.properties.description=="string"&&f.properties.description){const k=[...f.geometry.coordinates],{description:S}=f.properties;for(;Math.abs(y.lngLat.lng-k[0])>180;)k[0]+=y.lngLat.lng>k[0]?360:-360;o.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:arrow:${p.name}:click`,()=>{o.remove()}),n.on("click",`layer:arrow:${p.name}:click`,y=>{let f;if(e.state.internalArrowSources)for(const S of e.state.internalArrowSources)f=S.click;if(!y.features||!f)return;const k=y.features[0];if(k.properties&&typeof k.properties.index=="number"){const{index:S}=k.properties;f(S)}}))}t({internalArrowSources:l})}const u=h({},c);let b=!1;for(const p of Object.keys(d))if(d[p]!==c[p]){for(const x of l)if(x.name===p){b=!0,u[p]=d[p];const w=n==null?void 0:n.getSource(`arrow:${x.name}`);if(w){const y=d[p];w.setData({type:"FeatureCollection",features:x.arrows.map(f=>{const k=f.scale*x.scale,S=x.scale*x.arrowHeadScale,D=[f.longitude+f.direction[0]*k,f.latitude+f.direction[1]*k],L=[D[0]+(Math.cos(H)*-f.direction[0]-Math.sin(H)*-f.direction[1])*S,D[1]+(Math.sin(H)*-f.direction[0]+Math.cos(H)*-f.direction[1])*S],q=[D[0]+(Math.cos(U)*-f.direction[0]-Math.sin(U)*-f.direction[1])*S,D[1]+(Math.sin(U)*-f.direction[0]+Math.cos(U)*-f.direction[1])*S];return{type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:y==null?void 0:y.includes(f.index)},geometry:{type:"LineString",coordinates:[[f.longitude,f.latitude],D,L,D,q]}}})})}}}b&&t({internalSelections:u})}function $n(e,{map:t,draw:n,drawnPointSettings:o,mapLoaded:a,internalDrawnPointSource:r},{drawnPointSource:c}){if(t&&a&&r!==c){console.log("Drawning Points"),e({internalDrawnPointSource:c});let l=n;if((c.selectedColor!==o.selectedColor||c.selectedRadius!==o.selectedRadius||c.color!==o.color||c.radius!==o.radius)&&(e({drawnPointSettings:{color:c.color,radius:c.radius,selectedRadius:c.selectedRadius,selectedColor:c.selectedColor}}),n&&(t.removeControl(n),l=void 0),c?(l=new Yt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":c.selectedRadius,"circle-color":c.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":c.radius,"circle-color":c.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),t.addControl(l),e({draw:l})):l=void 0),l){const d=l.getAll(),u=c.points.length!==d.features.length?void 0:l.getSelected(),b={type:"FeatureCollection",features:c.points.map(m=>({type:"Feature",id:m.index.toString(),properties:{description:"",index:m.index,name:""},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}}))};if(l.set(b),u&&u.features.length>0&&u.features[0].properties&&typeof u.features[0].properties.index=="number"){const m=u.features[0].id;m&&l.changeMode("simple_select",{featureIds:[m]})}}}}const O="grid";function jn(e,t,{map:n,internalGridDisplay:o,popup:a,mapLoaded:r},{displayGrid:c}){if(n&&r&&o!==c){if(console.log("Drawing Grid on map!"),o&&o>0){const l=n.getSource(O);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),n.removeLayer(O),t({internalGridDisplay:void 0})}else if(c&&c>0){let l=n.getSource(O);const d=l===void 0;if(d&&(n.addSource(O,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=n.getSource(O)),l!==void 0){const u=[];for(let b=-170;b<=180;b+=c)u.push({type:"Feature",properties:{label:`Lon: ${b<0?b+360:b}`},geometry:{type:"LineString",coordinates:[[b,-90],[b,90]]}});for(let b=-90;b<=90;b+=c)u.push({type:"Feature",properties:{label:`Lat: ${b}`},geometry:{type:"LineString",coordinates:[[180,b],[-180,b]]}});l.setData({type:"FeatureCollection",features:u})}n.addLayer({id:O,type:"line",source:O,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${O}:click`,type:"line",source:O,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),d&&(n.on("mouseenter",`${O}:click`,u=>{if(!u.features)return;const b=u.features[0];b.geometry.type==="LineString"&&b.properties&&typeof b.properties.label=="string"&&a.setLngLat(u.lngLat).setHTML(`${b.properties.label}`).addTo(n)}),n.on("mouseleave",`${O}:click`,()=>{a.remove()}))}t({internalGridDisplay:c})}}function Dn(e,t,{map:n,popup:o,internalLineSources:a,mapLoaded:r,internalSelections:c},{lineSources:l,selections:d}){var m;if(n&&r&&a!==l)if(console.log("Setting lines in map!"),a){for(const p of a){const x=n.getSource(`line:${p.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${p.name}`);try{n.getLayer(`layer:line:${p.name}:click`)&&n.removeLayer(`layer:line:${p.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${p.name}:labels`)&&n.removeLayer(`layer:line:${p.name}:labels`)}catch{console.log("no label layer")}}t({internalLineSources:void 0})}else{for(const p of l){let x=n.getSource(`line:${p.name}`);const w=x===void 0;if(w&&(n.addSource(`line:${p.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${p.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`line:${p.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:p.lines.map(y=>{var f,k;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,label:(f=y.label)!=null?f:"",selected:((k=d[p.name])==null?void 0:k.includes(y.index))||!1},geometry:{type:"LineString",coordinates:[[y.startLongitude,y.startLatitude],[y.endLongitude,y.endLatitude]]}}})}),n.addLayer({id:`layer:line:${p.name}`,type:"line",source:`line:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],p.selectedColor,p.color],"line-width":["case",["get","selected"],p.selectedWidth,p.width]}}),(m=p.lines[0])==null?void 0:m.label){const y=n.getSource(`line:${p.name}:points`);y&&(y.setData({type:"FeatureCollection",features:p.lines.map(f=>({type:"Feature",properties:{label:f.label},geometry:{type:"Point",coordinates:[(f.startLongitude+f.endLongitude)/2,(f.startLatitude+f.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${p.name}:labels`,type:"symbol",source:`line:${p.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}p.click&&(n.addLayer({id:`layer:line:${p.name}:click`,type:"line",source:`line:${p.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":p.width*10}}),w&&(n.on("mouseenter",`layer:line:${p.name}:click`,y=>{if(!y.features)return;const f=y.features[0];if(f.geometry.type==="LineString"&&f.properties&&typeof f.properties.description=="string"&&f.properties.description){const k=[(f.geometry.coordinates[0][0]+f.geometry.coordinates[1][0])/2,(f.geometry.coordinates[0][1]+f.geometry.coordinates[1][1])/2],{description:S}=f.properties;for(;Math.abs(y.lngLat.lng-k[0])>180;)k[0]+=y.lngLat.lng>k[0]?360:-360;o.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:line:${p.name}:click`,()=>{o.remove()}),n.on("click",`layer:line:${p.name}:click`,y=>{let f;if(e.state.internalLineSources)for(const S of e.state.internalLineSources)S.name===p.name&&(f=S.click);if(!y.features||!f)return;const k=y.features[0];if(k.properties&&typeof k.properties.index=="number"){const{index:S}=k.properties;f(S)}})))}t({internalLineSources:l})}const u=h({},c);let b=!1;for(const p of Object.keys(d))if(d[p]!==c[p]){for(const x of l)if(x.name===p){b=!0,u[p]=d[p];const w=n==null?void 0:n.getSource(`line:${x.name}`);if(w){const y=d[p];w.setData({type:"FeatureCollection",features:x.lines.map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:y==null?void 0:y.includes(f.index)},geometry:{type:"LineString",coordinates:[[f.startLongitude,f.startLatitude],[f.endLongitude,f.endLatitude]]}}))})}}}b&&t({internalSelections:u})}function Fn(e,t,{map:n,popup:o,internalPointSources:a,mapLoaded:r,internalSelections:c},{pointSources:l,selections:d}){var m;if(!n||!r)return;if(a!==l)if(console.log("Setting points in map!"),a){for(const p of a){const x=n.getSource(`point:${p.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${p.name}`);try{n.getLayer(`layer:point:${p.name}:labels`)&&n.removeLayer(`layer:point:${p.name}:labels`)}catch{console.log("no label layer")}}t({internalPointSources:void 0})}else{for(const p of l){let x=n.getSource(`point:${p.name}`);const w=x===void 0;w&&(n.addSource(`point:${p.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`point:${p.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:p.points.map(y=>{var f;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:!((f=d[p.name])==null?void 0:f.includes(y.index)),label:y.label},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}}})}),n.addLayer({id:`layer:point:${p.name}`,type:"circle",source:`point:${p.name}`,paint:{"circle-color":["case",["get","selected"],p.color,p.selectedColor],"circle-radius":p.radius}}),((m=p.points[0])==null?void 0:m.label)&&n.addLayer({id:`layer:point:${p.name}:labels`,type:"symbol",source:`point:${p.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),w&&(n.on("mouseenter",`layer:point:${p.name}`,y=>{if(!y.features)return;const f=y.features[0];if(f.geometry.type==="Point"&&f.properties&&typeof f.properties.description=="string"&&f.properties.description){const k=[...f.geometry.coordinates],{description:S}=f.properties;for(;Math.abs(y.lngLat.lng-k[0])>180;)k[0]+=y.lngLat.lng>k[0]?360:-360;o.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:point:${p.name}`,()=>{o.remove()}),n.on("click",`layer:point:${p.name}`,y=>{let f;if(e.state.internalPointSources)for(const S of e.state.internalPointSources)f=S.click;if(!y.features||!f)return;const k=y.features[0];if(k.properties&&typeof k.properties.index=="number"){const{index:S}=k.properties;f(S)}}))}t({internalPointSources:l})}const u=h({},c);let b=!1;for(const p of Object.keys(d))if(d[p]!==c[p]){for(const x of l)if(x.name===p){b=!0,u[p]=d[p];const w=n.getSource(`point:${x.name}`);if(w){const y=d[p];w.setData({type:"FeatureCollection",features:x.points.map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:!(y==null?void 0:y.includes(f.index))},geometry:{type:"Point",coordinates:[f.longitude,f.latitude]}}))})}}}b&&t({internalSelections:u})}function Mn(e,t,{map:n,internalPolygonSources:o,mapLoaded:a},{polygonSources:r,selections:c}){if(n&&a&&o!==r)if(o){for(const l of o){const d=n.getSource(`poly:${l.name}`);d!==void 0&&d.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${l.name}`),n.removeLayer(`layer:poly:${l.name}:fill`)}t({internalPolygonSources:void 0})}else{for(const l of r){let d=n.getSource(`poly:${l.name}`);d===void 0&&(n.addSource(`poly:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),d=n.getSource(`poly:${l.name}`)),d!==void 0&&d.setData({type:"FeatureCollection",features:l.polygons.map(b=>{var m;return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:((m=c[l.name])==null?void 0:m.includes(b.index))||!1},geometry:{type:"Polygon",coordinates:[b.polygon.map(p=>[p.lon,p.lat])]}}})}),n.addLayer({id:`layer:poly:${l.name}:fill`,type:"fill",source:`poly:${l.name}`,layout:{},paint:{"fill-color":l.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${l.name}`,type:"line",source:`poly:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.borderColor,"line-width":l.borderRadius}})}t({internalPolygonSources:r})}}Ke.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Vn extends en.Component{constructor(t){super(t);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:C.exports.createRef(),popup:new ge.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=t.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:t,style:n}=this.state,o=typeof t=="object"?t==null?void 0:t.current:void 0;if(Ke.accessToken&&o){const a=new ge.exports.Map({container:o,style:n,center:[0,0],zoom:2});a.addControl(new ge.exports.NavigationControl),this.setState({map:a}),a.on("load",()=>{this.setState({mapLoaded:!0})}),a.on("click",({lngLat:r})=>{const{click:c}=this.props;c(be([r.lng,r.lat]))}),a.on("mousemove",({lngLat:r})=>{const{mouseMove:c}=this.props;c&&c(be([r.lng,r.lat]))}),a.on("draw.selectionchange",({features:r})=>{const{internalDrawnPointSource:c}=this.state;if(!c||!(c==null?void 0:c.select))return;const l=r.map(d=>d&&d.type==="Feature"&&d.geometry.type==="Point"&&d.properties&&"index"in d.properties&&typeof d.properties.index=="number"?d.properties.index:-1).filter(d=>d>-1);c.select(l)}),a.on("draw.update",({features:r,action:c})=>{const{internalDrawnPointSource:l}=this.state;if(!!(l==null?void 0:l.update)&&c==="move"&&r.length>0)for(const d of r)d.type==="Feature"&&d.geometry.type==="Point"&&d.properties&&"index"in d.properties&&typeof d.properties.index=="number"&&l.update(d.properties.index,be(d.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:t}=this.props,{style:n,map:o}=this.state;return t&&t!==n&&(this.setState({style:t}),o==null||o.setStyle(t)),jn(this,a=>this.setState(a),this.state,this.props),Mn(this,a=>this.setState(a),this.state,this.props),Dn(this,a=>this.setState(a),this.state,this.props),_n(this,a=>this.setState(a),this.state,this.props),Fn(this,a=>this.setState(a),this.state,this.props),$n(a=>this.setState(a),this.state,this.props),!1}render(){const{mapReference:t}=this.state;return s("div",{"data-testid":"map",className:"w-full h-full",ref:t})}}const le={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},In=(()=>{var t;const e=h(h({},le),JSON.parse((t=window.localStorage.getItem("mapSettings"))!=null?t:"{}"));return e.savedStyles=h(h({},e.savedStyles),le.savedStyles),e})();function On({settings:e,setSettings:t}){const[n,o]=C.exports.useState(""),[a,r]=C.exports.useState(""),[c,l]=C.exports.useState(""),d=u=>{t(u),window.localStorage.setItem("mapSettings",JSON.stringify(u))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Select Style"}),s("span",{className:"w-2/5 flex-shrink-0",children:v("select",{className:"bg-gray-800 w-full",value:e.currentStyleName,onChange:u=>{const b=u.target.value;if(b==="***CUSTOM")o(""),l(e.savedStyles.default.styleId),r(e.savedStyles.default.user),d(N(h({},e),{currentStyleName:"",currentStyle:e.savedStyles.default}));else{const m=e.savedStyles[b];o(b),l(m.styleId),r(m.user),d(N(h({},e),{currentStyleName:b,currentStyle:m}))}},children:[s("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(e.savedStyles).map(u=>s("option",{value:u,children:u},u))]})})]}),e.currentStyleName in le.savedStyles?s(F,{}):v(F,{children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Style Name"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:u=>{o(u.target.value)}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in le.savedStyles)&&d({currentStyle:{user:a,styleId:c},currentStyleName:n,savedStyles:N(h({},e.savedStyles),{[n]:{user:a,styleId:c}})})},children:"Save Style"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in e.savedStyles&&!(n in le.savedStyles)){const u={};for(const b of Object.keys(e.savedStyles))b!==n&&(u[b]=e.savedStyles[b]);d({currentStyle:u.default,currentStyleName:"default",savedStyles:u})}},children:"Delete Style"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"User"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:a,onChange:u=>{r(u.target.value)}})}),s("span",{className:"text-l font-bold",children:"Style Id"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:c,onChange:u=>{l(u.target.value)}})})]}),v("div",{children:["Adding a custom mapbox style:",v("ul",{children:[v("li",{children:["If you are creating a new style, go to"," ",s("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),s("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const Pn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var jt;const Rn=h(h({},Pn),JSON.parse((jt=window.localStorage.getItem("meshDisplaySettings"))!=null?jt:"{}"));function Bn({settings:e,setSettings:t,open:n,openMultiple:o}){const a=r=>{t(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{a(N(h({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Mesh"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>o(),children:"Open Meshes"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:r=>{a(N(h({},e),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:r=>{a(N(h({},e),{width:Number.parseFloat(r.target.value)}))}})})]})]})}const ie=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ve={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},En={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Dt;const An=h(h({},En),JSON.parse((Dt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Dt:"{}")),Tn=["",...ie];function Wn({settings:e,setSettings:t,segments:n,selected:o,setSegmentData:a,addNewSegment:r,splitSegment:c,setSelectionMode:l,save:d,open:u}){const b=x=>{t(x),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(x))},m=o.map(x=>n[x]).filter(x=>x),p=m.length>0?s(ne,{title:m.length===1?m[0].name:"Edit Selected Segments",items:m,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:x=>a(o,x),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>c(o),children:"Split Segment"})}):s(F,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{b(N(h({},e),{hide:!e.hide}))}})}),s("span",{className:"text-l font-bold flex-grow",children:"Projection"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hideProjection,onChange:()=>{b(N(h({},e),{hideProjection:!e.hideProjection}))}})})]}),v("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Segments & Vertices"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:x=>{b(N(h({},e),{color:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:x=>{b(N(h({},e),{width:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:x=>{b(N(h({},e),{activeColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.activeWidth,onChange:x=>{b(N(h({},e),{activeWidth:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Projection Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.projectionColor,onChange:x=>{b(N(h({},e),{projectionColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:x=>{b(N(h({},e),{plottableKey:x.currentTarget.value}))},children:Tn.map(x=>s("option",{value:x,children:x},x))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Segment"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:x=>{l({mode:"mapClick",label:"Select Segment End point",callback:w=>{r(x,w),l("normal")}})}})},children:"New Segment"})]}),p]})}const Ye=()=>tn(),T=nn;function Hn({folder:e,openFolder:t,filesOpen:n,saveFiles:o}){function a(){t()}const r=Ye(),[c,l]=T(d=>[d.main.past.length>0,d.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[s("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[e?s("button",{type:"button",onClick:()=>{r(ze.ActionCreators.undo())},"data-testid":"undo-button",disabled:!c,children:"Undo"}):s(F,{}),e?s("button",{type:"button",onClick:()=>{r(ze.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):s(F,{}),e?v("span",{children:["Working in ",e.name]}):s("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),n?s("button",{type:"button",onClick:o,"data-testid":"save-file-button",children:"Save Active Files"}):s(F,{})]})]})}const ce=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Gn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Kn(e){return h(h({},Gn),e)}const zn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},Jn=["",...ce];var Ft;const Un=JSON.parse((Ft=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ft:"false")||zn;function qn({settings:e,setSettings:t,selected:n,velocitys:o,setVelocityData:a,addNewVelocity:r,save:c,open:l}){const d=m=>{t(m),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(m))},u=n.map(m=>o[m]).filter(m=>m),b=u.length>0?s(ne,{title:u.length===1?u[0].name:"Edit Selected Velocities",items:u,deletable:!0,setItems:m=>a(n,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):s(F,{});return v(F,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{d(N(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:m=>{d(N(h({},e),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:m=>{d(N(h({},e),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Scale"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:e.scale,onChange:m=>{d(N(h({},e),{scale:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:m=>{d(N(h({},e),{width:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Arrow Head Size"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:e.arrowHead,onChange:m=>{d(N(h({},e),{arrowHead:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:m=>{d(N(h({},e),{plottableKey:m.currentTarget.value}))},children:Jn.map(m=>s("option",{value:m,children:m},m))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Velocity"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),b]})}const Qn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Mt;const Xn=h(h({},Qn),JSON.parse((Mt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Mt:"{}"));function Zn({settings:e,setSettings:t,vertices:n,selected:o,setVertexData:a,setSelectionMode:r,mergeVertices:c,bridgeVertices:l,extrudeVertex:d,save:u,open:b}){const m=w=>{t(w),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(w))},x=o.map(w=>({selectedVertex:n[w],index:w})).filter(w=>w.selectedVertex).map(({selectedVertex:w,index:y})=>s(ne,{title:"Selected Vertex",items:[w],ignoreFields:[],deletable:!1,setItems:f=>a(y,h(h({},w),f)),fieldDefinitions:{},controls:v(F,{children:[s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:f=>{c(y,f[0]),r("normal")}})},children:"Merge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:f=>{l(y,f[0]),r("normal")}})},children:"Bridge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:f=>{d(y,f),r("normal")}})},children:"Extrude"})]})},y));return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{m(N(h({},e),{hide:!e.hide}))}})}),v("span",{className:"w-2/5 flex-shrink flex flex-row justify-end gap-2",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>b(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Save Segments & Vertices"})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:w=>{m(N(h({},e),{color:w.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.radius,onChange:w=>{m(N(h({},e),{radius:Number.parseFloat(w.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:w=>{m(N(h({},e),{activeColor:w.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.activeRadius,onChange:w=>{m(N(h({},e),{activeRadius:Number.parseFloat(w.target.value)}))}})})]}),x]})}const Yn=e=>e.mode,eo=e=>e.setSelectedBlock,to=e=>e.setSelectedSegment,no=e=>e.setSelectedVelocity,oo=e=>e.setSelectedVertex,so=e=>e.setActiveTab,et=on(Yn,eo,to,no,oo,so,(e,t,n,o,a,r)=>e==="normal"?(c,l)=>{t(c==="block"?l:[]),n(c==="segment"?l:[]),o(c==="velocities"?l:[]),a(c==="vertex"?l:[]),r(c)}:e.mode==="override"?(c,l)=>{c===e.type&&e.callback(l)}:()=>{});function ao(e,{data:t}){return[...e,mn(t)]}function lo(e,t){const n=[];for(const[o,a]of e.entries())t.includes(o)||n.push(a);return n}function ro(e,t){const n=[...e];for(const o of t.indices){const a=h(h({},n[o]),t.data);n[o]=a}return n}function io(e,t){return t}function co(e,{index:t,position:n}){const o=[...e],a=h({},o[t]);return a.interior_lat=n.lat,a.interior_lon=n.lon,o[t]=a,o}const uo=[],tt=_("createBlock"),nt=_("editBlock"),ot=_("deleteBlock"),st=_("loadNewBlockData"),at=_("moveBlock"),fo=te(uo,e=>{e.addCase(tt,(t,n)=>ao(t,n.payload)).addCase(nt,(t,n)=>ro(t,n.payload)).addCase(ot,(t,n)=>lo(t,n.payload)).addCase(st,(t,n)=>io(t,n.payload)).addCase(at,(t,n)=>co(t,n.payload))}),lt=_("setRootFolder"),G=_("openFile"),po=_("closeFile"),mo={rootFolder:void 0,files:{}},ho=te(mo,e=>{e.addCase(lt,(t,n)=>({rootFolder:n.payload,files:{},fileOpenCallback:()=>{}})).addCase(G,(t,n)=>{const o=h({},t.files);return o[n.payload.key]={path:n.payload.path,file:n.payload.file},N(h({},t),{files:o})}).addCase(po,(t,n)=>{const o={};return Object.keys(t.files).filter(a=>a!==n.payload).map(a=>(o[a]=t.files[a],!0)),N(h({},t),{files:o})})});function go(e,t){return N(h({},e),{[t.name]:{name:t.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:t.data}})}function yo(e,t){const n={};for(const o of Object.keys(e))o!==t&&(n[o]=e[o]);return n}function bo(e,t){const n=e[t.collection];if(!n)return e;const o=N(h({},n),{startLon:t.startLon,startLat:t.startLat,endLon:t.endLon,endLat:t.endLat,plot:t.plot});return N(h({},e),{[t.collection]:o})}const xo={},rt=_("loadNewGenericCollectionData"),it=_("setGenericSegmentPositionKeys"),vo=_("removeGenericSegmentCollection"),wo=te(xo,e=>e.addCase(rt,(t,n)=>go(t,n.payload)).addCase(it,(t,n)=>bo(t,n.payload)).addCase(vo,(t,n)=>yo(t,n.payload))),So={mesh_filename:"",smoothing_weight:1e7,edge_constraints:[0,1,0],n_eigenvalues:20,a_priori_slip_filename:""};function No(e,t){var n;return N(h({},e),{[t.mesh]:{parameters:(n=t.parameters)!=null?n:So,line:t.data}})}function ko(e,t){const n={};for(const o of Object.keys(e))o!==t&&(n[o]=e[o]);return n}const ct={},we=_("loadMeshLineData"),Co=_("removeMesh"),dt=_("clearMeshes"),Lo=te(ct,e=>e.addCase(we,(t,n)=>No(t,n.payload)).addCase(Co,(t,n)=>ko(t,n.payload)).addCase(dt,()=>ct));function _o(e,{a:t,b:n}){const o=N(h({},ve),{start:t,end:n}),a=[...e.segments,o];return N(h({},e),{segments:a})}function $o(e,t){const n=h({},e.vertecies),o=h({},e.vertexDictionary),{lastIndex:a}=e,[r,c]=se(t.start,o,n,a),[l,d]=se(t.end,o,n,c),u=N(h(h({},ve),t),{start:r,end:l}),b=[...e.segments,u];return{vertecies:n,vertexDictionary:o,segments:b,lastIndex:d}}function jo(e,t){const n=[],o=[];let a=h({},e);for(const[r,c]of e.segments.entries())t.index.includes(r)?o.push(c):n.push(c);a.segments=n;for(const r of o)a=Ze(Ze(a,r.start),r.end);return a}function Do(e,t){const n=[...e.segments];for(const o of t.indices){const a=h(h({},n[o]),t.data);n[o]=a}return N(h({},e),{segments:n})}function Fo(e,t){const n=h({},e.vertecies),o=h({},e.vertexDictionary),[a,r]=se(t.targetPoint,o,n,e.lastIndex),c=N(h({},ve),{start:t.index,end:a}),l=[...e.segments,c];return{vertecies:n,vertexDictionary:o,segments:l,lastIndex:r}}function Mo(e,t){return t}function Vo(e,{a:t,b:n}){if(t===n)return e;const o=e.segments.map(d=>{let u=d;return u.start===n&&(u=N(h({},u),{start:t})),u.end===n&&(u=N(h({},u),{end:t})),u}).filter(d=>d.start!==d.end),a=e.vertecies[n],r=`${Math.floor(a.lon*A)},${Math.floor(a.lat*A)}`,c=h({},e.vertecies);delete c[n];const l=h({},e.vertexDictionary);return delete l[r],N(h({},e),{vertecies:c,vertexDictionary:l,segments:o})}function Io(e,{index:t,vertex:n}){const o=h({},e.vertecies),a=h({},e.vertexDictionary),r=[...e.segments],c=o[t],l=`${Math.floor(n.lon*A)},${Math.floor(n.lat*A)}`,d=`${Math.floor(c.lon*A)},${Math.floor(c.lat*A)}`;if(delete a[d],l in a){const u=a[l];for(const b of r)b.start===u&&(b.start=t),b.end===u&&(b.end=t);delete o[u]}return o[t]=n,N(h({},e),{segments:r,vertecies:o,vertexDictionary:a})}function Oo(e,t){const n=h({},e.vertecies),o=h({},e.vertexDictionary),a=[...e.segments];let{lastIndex:r}=e;for(const c of t){const l=e.segments[c],d=e.vertecies[l.start],u=e.vertecies[l.end],b={lon:(d.lon+u.lon)/2,lat:(d.lat+u.lat)/2},[m,p]=se(b,o,n,r);r=p;const x=N(h({},l),{end:m,name:`${l.name}_a`}),w=N(h({},l),{start:m,name:`${l.name}_b`});a[c]=x,a.push(w)}return{vertecies:n,vertexDictionary:o,segments:a,lastIndex:r}}const Po={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},ut=_("bridgeVertices"),ft=_("createSegmet"),pt=_("deleteSegment"),mt=_("editSegmentData"),ht=_("extrudeSegment"),Se=_("loadNewSegmentData"),gt=_("mergeVertices"),Ne=_("moveVertex"),yt=_("splitSegment");function Ro(e,t,n){if(n.dip===90||n.locking_depth<=0)return!1;const o=n.dip<90,r=(o?90-n.dip:n.dip-90)*(Math.PI/180),c=Math.abs(Math.tan(r)*n.locking_depth),[l,d]=e.lon>=t.lon?[e,t]:[t,e],u={lon:d.lat-l.lat,lat:-(d.lon-l.lon)};o&&(u.lon*=-1,u.lat*=-1);const b=Je(Ue([[l.lon,l.lat],[l.lon+u.lon,l.lat+u.lat]]),c,{units:"kilometers"}),m=Je(Ue([[d.lon,d.lat],[d.lon+u.lon,d.lat+u.lat]]),c,{units:"kilometers"});return[l,{lon:b.geometry.coordinates[0],lat:b.geometry.coordinates[1]},{lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1]},d]}function Bo(e){return e.segments.map(t=>Ro(e.vertecies[t.start],e.vertecies[t.end],t)).filter(t=>t)}const Eo=te(Po,e=>{e.addCase(ut,(t,n)=>_o(t,n.payload)).addCase(ft,(t,n)=>$o(t,n.payload)).addCase(pt,(t,n)=>jo(t,n.payload)).addCase(mt,(t,n)=>Do(t,n.payload)).addCase(ht,(t,n)=>Fo(t,n.payload)).addCase(Se,(t,n)=>Mo(t,n.payload)).addCase(gt,(t,n)=>Vo(t,n.payload)).addCase(Ne,(t,n)=>Io(t,n.payload)).addCase(yt,(t,n)=>Oo(t,n.payload))});function Ao(e,{data:t}){return[...e,Kn(t)]}function To(e,t){const n=[];for(const[o,a]of e.entries())t.includes(o)||n.push(a);return n}function Wo(e,t){const n=[...e];for(const o of t.indices){const a=h(h({},n[o]),t.data);n[o]=a}return n}function Ho(e,t){return t}function Go(e,{index:t,position:n}){const o=[...e],a=h(h({},o[t]),n);return o[t]=a,o}const Ko=[],bt=_("createVelocity"),xt=_("editVelocity"),vt=_("deleteVelocity"),wt=_("loadNewVelocityData"),St=_("moveVelocity"),zo=te(Ko,e=>{e.addCase(bt,(t,n)=>Ao(t,n.payload)).addCase(xt,(t,n)=>Wo(t,n.payload)).addCase(vt,(t,n)=>To(t,n.payload)).addCase(wt,(t,n)=>Ho(t,n.payload)).addCase(St,(t,n)=>Go(t,n.payload))});function re(e){const t=e.split(/\n/g),n=t[0].split(",").map(r=>r.trim()),o=t.slice(1),a=[];for(const r of o)if(r.trim()!==""){const c=r.split(/\s*,\s*/),l={};for(let d=0;d<n.length;d+=1){let u=c[d];const b=n[d],m=Number.parseFloat(u);u=Number.isNaN(m)?u:m,typeof u=="string"&&(u=u.startsWith('"')&&u.endsWith('"')?u.slice(1,-1).trim():u.trim()),l[b]=u}a.push(l)}return a}function ke(e,t){const n=[t.join(",")];for(const o of e){const a=o;n.push(t.map(r=>{if(r in a){const c=a[r];return typeof c=="string"&&/\s/.test(`${c}`)?`"${c.trim()}"`:`${typeof c=="number"&&(r.includes("lon")||r.includes("lat"))?c.toFixed(6):c}`}return""}).join(","))}return n.join(`
`)}function Jo(e){return e.map(t=>{const n={};for(const o of ye)n[o]=t[o]||(o==="name"?"":0);return n})}function Ce(e){return ke(e,ye)}async function Uo(e){return Jo(re(await e.getContents()))}class qo{constructor(t,n,o){j(this,"name");j(this,"path");j(this,"parent");this.name=t,this.parent=n,this.path=o!=null?o:[this.name]}async getContents(){const t=this.parent[this.name];if(typeof t!="string")throw new Error("No Such File");return t}async setContents(t){this.parent[this.name]=t}}class Le{constructor(t,n,o){j(this,"name");j(this,"path");j(this,"parent");j(this,"fileList");j(this,"folderList");this.name=t,this.parent=n,this.fileList=[],this.folderList=[],this.path=o!=null?o:[this.name];const a=n[t];for(const r of Object.keys(a))typeof a[r]=="string"?this.fileList.push(r):this.folderList.push(r)}async getFile(t){return new qo(t,this.parent[this.name],[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("No Such Directory");return new Le(t,this.parent[this.name],[...this.path,t])}}const Qo=async e=>new Le("root",e);let Nt=async()=>{var t;return Qo((t=window.FakeDirectory)!=null?t:{})};function Xo(e){Nt=e}async function Zo(){return Nt()}async function Yo(e,t,n){const o=t.split("/");let a=[...e.path];"getContents"in e&&a.pop();for(const d of o)if(d===".."){if(a.length===0)return!1;a.pop()}else d!==""&&d!=="."&&a.push(d);if(a.length<2)return!1;const r=a.pop();if(!r)return!1;a=a.slice(1);let c=n;for(const d of a)c=await c.getDirectory(d);return await c.getFile(r)}class es{constructor(t){j(this,"data");j(this,"handle");this.handle=t,this.data=void 0}async initialize(){const t=await this.handle.getContents(),n=re(t);this.data=n}async save(){}}function ts(e){const n=[...e.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(o=>{const a=Number.parseFloat(o[1]),r=Number.parseFloat(o[2]);return{lon:a,lat:r}});return n.splice(0,0,{lon:0,lat:0}),n}const ns={"1":e=>{var o,a;const t=Number.parseInt((o=e[e.length-2])!=null?o:"",10),n=Number.parseInt((a=e[e.length-1])!=null?a:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)?[[t,n]]:!1},"2":e=>{var a,r,c;const t=Number.parseInt((a=e[e.length-3])!=null?a:"",10),n=Number.parseInt((r=e[e.length-2])!=null?r:"",10),o=Number.parseInt((c=e[e.length-1])!=null?c:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)&&!Number.isNaN(o)?[[t,n],[n,o],[o,t]]:!1}};function os(e){return e.split(/\n/).map(t=>t.trim()).map(t=>t.split(/\s+/)).filter(t=>t.length>2).map(t=>{var o;return((o=ns[t[1]])!=null?o:()=>!1)(t)}).filter(t=>t).flat()}function ss(e,t){return t.map(([n,o])=>n!==o&&n>-1&&n<e.length&&o>-1&&o<e.length?[e[n],e[o]]:!1).filter(n=>n)}function as(e){if(!e.startsWith("$"))return[];const t=e.split("$");let n=[],o=[];for(const a of t)a.startsWith("Nodes")?n=ts(a):a.startsWith("Elements")&&(o=os(a));return ss(n,o)}class kt{constructor(t){j(this,"data");j(this,"handle");j(this,"startLonColumn");j(this,"endLonColumn");j(this,"startLatColumn");j(this,"endLatColumn");this.handle=t,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const t=await this.handle.getContents();if(t.startsWith("$"))this.data=as(t);else{const n=re(t);this.data=n.map(o=>{const a={lon:0,lat:0},r={lon:0,lat:0};console.log("parsing row",o),typeof o[this.startLonColumn]=="number"&&(a.lon=o[this.startLonColumn]),typeof o[this.startLatColumn]=="number"&&(a.lat=o[this.startLatColumn]),typeof o[this.endLonColumn]=="number"&&(r.lon=o[this.endLonColumn]),typeof o[this.endLatColumn]=="number"&&(r.lat=o[this.endLatColumn]);const c=Object.keys(o).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(c.length>0){const l={};for(const d of c)l[d]=o[d];return[a,r]}return[a,r]})}}async save(){console.log("Mesh files do not get saved")}}function ls(e){const t=e.map(c=>{const l={};for(const d of ie)l[d]=c[d]||(d==="name"?"":0);return l}).filter(c=>{for(const l of ie)if(!(l in c))return!1;return!0}),n={},o={},a=[];let r=0;for(const c of t){const[l,d]=se({lon:c.lon1,lat:c.lat1},n,o,r),[u,b]=se({lon:c.lon2,lat:c.lat2},n,o,d),m=N(h({},c),{start:l,end:u});r=b,a.push(m)}return{vertecies:o,vertexDictionary:n,segments:a,lastIndex:r}}function de({vertecies:e,segments:t}){const n=t.map(o=>{const a=e[o.start],r=e[o.end];return N(h({},o),{lon1:a.lon,lat1:a.lat,lon2:r.lon,lat2:r.lat})});return ke(n,ie)}async function Ct(e){const t=await e.getContents();return ls(re(t))}function rs(e){return e.map(t=>{const n={};for(const o of ce)n[o]=t[o]||(o==="name"?"":0);return n}).filter(t=>{for(const n of ce)if(!(n in t))return!1;return!0})}function _e(e){return ke(e,ce)}async function is(e){const t=await e.getContents();return rs(re(t))}async function cs(e){const t=new kt(e);return await t.initialize(),t}async function ds(e,t){const n=await e.getContents(),o=JSON.parse(n);return Array.isArray(o)?(await Promise.all(o.map(async r=>{const c=r.mesh_filename.split("/"),l=await Yo(e,c[c.length-1],t);if(!l)return!1;const d=await cs(l);return d.data?{line:d.data,parameters:r}:!1}))).filter(r=>!!r):[]}class us{constructor(t,n){j(this,"name");j(this,"path");j(this,"handle");this.handle=t,this.name=t.name,this.path=n!=null?n:[this.name]}async getContents(){return(await this.handle.getFile()).text()}async setContents(t){const n=await this.handle.createWritable();await n.write(t),await n.close()}}class $e{constructor(t,n){j(this,"name");j(this,"path");j(this,"handle");j(this,"fileList");j(this,"folderList");this.handle=t,this.fileList=[],this.folderList=[],this.name=t.name,this.path=n!=null?n:[this.name]}async initialize(){for await(const t of this.handle.values())t.kind==="directory"?this.folderList.push(t.name):this.fileList.push(t.name)}async getFile(t){const n=await this.handle.getFileHandle(t,{create:!0});return new us(n,[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(t),o=new $e(n,[...this.path,t]);return await o.initialize(),o}}const fs=async()=>{const e=await window.showDirectoryPicker();await e.requestPermission({mode:"readwrite"});const t=new $e(e);return await t.initialize(),t};window.location.search.includes("fake-dir")||Xo(fs);var P;(function(e){e.Vertex="Vertices",e.Block="Blocks",e.Velocity="Velocities"})(P||(P={}));const Lt={Block:P.Block,Vertex:P.Vertex,Velocity:P.Velocity},ps={segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function ms(){var We,He;const e=Ye(),t=T(i=>i.main.present.fileHandles.rootFolder),[n,o]=C.exports.useState(!1),[a,r]=C.exports.useState("map"),c=T(i=>i.main.present.fileHandles.files.segment),l=T(i=>i.main.present.fileHandles.files.block),d=T(i=>i.main.present.fileHandles.files.velocity),u=T(i=>i.main.present.segment),b=T(i=>i.main.present.block),m=T(i=>i.main.present.velocity),p=T(i=>i.main.present.meshLine),x=T(i=>i.main.present.genericSegments),[w,y]=C.exports.useState(Un),[f,k]=C.exports.useState(bn),[S,D]=C.exports.useState(An),[L,q]=C.exports.useState(Xn),[R,je]=C.exports.useState(Rn),[B,De]=C.exports.useState(Nn),[ae,Vt]=C.exports.useState(In),[E,Q]=C.exports.useState("normal"),[X,It]=C.exports.useState(P.Vertex),[ue,Fe]=C.exports.useState([]),[Me,Ve]=C.exports.useState([]),[Ie,Oe]=C.exports.useState([]),[Pe,Re]=C.exports.useState([]),[M,xs]=C.exports.useState({select:et({mode:E,setSelectedBlock:Fe,setSelectedSegment:Ve,setSelectedVelocity:Oe,setSelectedVertex:Re,setActiveTab:r})}),[Ot,Pt]=C.exports.useState([]),[Rt,Be]=C.exports.useState([]),[Bt,Et]=C.exports.useState([]),[At,Ee]=C.exports.useState([]),[Tt,fe]=C.exports.useState({color:L.color,selectedColor:L.activeColor,radius:L.radius,selectedRadius:L.activeRadius,points:[]}),[Ae,Wt]=C.exports.useState({lon:0,lat:0}),[pe,Ht]=C.exports.useState(!1);C.exports.useEffect(()=>{M.select=et({mode:E,setSelectedBlock:Fe,setSelectedSegment:Ve,setSelectedVelocity:Oe,setSelectedVertex:Re,setActiveTab:r})},[E,M]),C.exports.useEffect(()=>{const i=[];X!==P.Block&&!f.hide&&i.push({name:"blocks",color:f.color,selectedColor:f.selectedColor,radius:f.radius,points:b.map((g,$)=>({longitude:g.interior_lon,latitude:g.interior_lat,name:g.name,description:"",index:$,label:f.plottableKey in g?`${g[f.plottableKey]}`:""})),click:g=>{M.select("block",[g])}}),X!==P.Vertex&&!L.hide&&i.push({name:"vertices",color:L.color,selectedColor:L.activeColor,radius:L.radius,click:g=>{M.select("vertex",[g])},points:Object.keys(u.vertecies).map(g=>{const $=Number.parseInt(g,10),V=u.vertecies[$];return V?{longitude:V.lon,latitude:V.lat,index:$,name:"",description:""}:!1}).filter(g=>!!g)}),Pt(i)},[f,b,S,M,X,L.hide,L.color,L.activeColor,L.radius,u.vertecies]),C.exports.useEffect(()=>{const i=[];if(S.hide||i.push({name:"segments",color:S.color,selectedColor:S.activeColor,width:S.width,selectedWidth:S.activeWidth,lines:u.segments.map((g,$)=>{var ee,J;const V=(ee=u.vertecies[g.start])!=null?ee:Qe,z=(J=u.vertecies[g.end])!=null?J:Qe,[[Y,Z],[W,I]]=xe(V,z);return{startLongitude:Y,startLatitude:Z,endLongitude:W,endLatitude:I,name:g.name,description:`${V.lon},${V.lat} to ${z.lon},${z.lat}`,index:$,label:S.plottableKey in g?`${g[S.plottableKey]}`:""}}),click:g=>{M.select("segment",[g])}}),!R.hide)for(const g of Object.keys(p)){const $=p[g].line;i.push({name:`mesh:${g}`,color:R.color,selectedColor:R.activeColor,width:R.width,selectedWidth:R.activeWidth,lines:$.map((V,z)=>{const Y=V[0],Z=V[1],[[W,I],[ee,J]]=xe(Y,Z);return{startLongitude:W,startLatitude:I,endLongitude:ee,endLatitude:J,name:"",description:"",index:z}})||[]})}if(!B.hide)for(const g of Object.keys(x)){const{startLat:$,startLon:V,endLat:z,endLon:Y,plot:Z,segments:W}=x[g];$ in W[0]&&z in W[0]&&V in W[0]&&Y in W[0]&&i.push({name:`generic_segment:${g}`,color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:W.map((I,ee)=>{const J={lat:I[$],lon:I[V]},me={lat:I[z],lon:I[Y]};if(typeof J.lat!="number"||typeof J.lon!="number"||typeof me.lat!="number"||typeof me.lon!="number")return!1;const[[Gt,Kt],[zt,Jt]]=xe(J,me);return{startLongitude:Gt,startLatitude:Kt,endLongitude:zt,endLatitude:Jt,name:"",description:"",index:ee,label:Z&&Z in I?`${I[Z]}`:""}}).filter(I=>I)||[]})}Et(i)},[u,S,B,x,R,p,M]),C.exports.useEffect(()=>{switch(X){case P.Vertex:{fe({color:L.color,radius:L.radius,selectedColor:L.activeColor,selectedRadius:L.activeRadius,points:L.hide?[]:Object.keys(u.vertecies).map(i=>{const g=Number.parseInt(i,10),$=u.vertecies[g];return $?{longitude:$.lon,latitude:$.lat,index:g}:!1}).filter(i=>!!i),update:(i,g)=>{e(Ne({index:i,vertex:g}))},select:i=>{M.select("vertex",i)}});break}case P.Block:{fe({color:f.color,radius:f.radius,selectedColor:f.selectedColor,selectedRadius:f.radius,points:f.hide?[]:b.map((i,g)=>({longitude:i.interior_lon,latitude:i.interior_lat,name:i.name,description:"",index:g,label:f.plottableKey in i?`${i[f.plottableKey]}`:""})),update:(i,g)=>{e(at({index:i,position:g}))},select:i=>{M.select("block",i)}});break}case P.Velocity:{fe({color:w.color,radius:w.width,selectedColor:w.selectedColor,selectedRadius:w.width,points:w.hide?[]:m.map((i,g)=>({longitude:i.lon,latitude:i.lat,name:i.name,description:"",index:g})),update:(i,g)=>{e(St({index:i,position:g}))},select:i=>{M.select("velocities",i)}});break}}},[L,M,u.vertecies,e,X,f.color,f.radius,f.selectedColor,f.hide,b,w.color,w.width,w.selectedColor,w.hide,m,f.plottableKey]),C.exports.useEffect(()=>{w.hide?Be([]):Be([{name:"velocities",color:w.color,selectedColor:w.selectedColor,scale:w.scale,arrowHeadScale:w.arrowHead,width:w.width,arrows:m.map((i,g)=>{const $=Math.sqrt(i.east_vel*i.east_vel+i.north_vel*i.north_vel);return{longitude:i.lon,latitude:i.lat,direction:[i.east_vel/$,i.north_vel/$],scale:$,name:i.name,description:`north: ${i.north_vel}, east: ${i.east_vel}`,index:g,label:w.plottableKey in i?`${i[w.plottableKey]}`:""}}),click:i=>{M.select("velocities",[i])}}])},[M,w,m]),C.exports.useEffect(()=>{S.hideProjection||S.hide?Ee([]):Ee([{name:"fault_dip_projections",color:S.projectionColor,borderColor:S.projectionColor,borderRadius:.5,polygons:Bo(u).map((i,g)=>({polygon:i,index:g,name:"",description:""}))}])},[S,u]);let K=s("span",{});switch(a){case"velocities":K=s(qn,{open:()=>{console.log("opening velocities file"),o({extension:"csv",callback:async i=>{const g=await is(i);e(wt(g)),e(G({file:i,key:"velocity",path:i.path}))}})},settings:w,setSettings:y,selected:Ie,velocitys:m,setVelocityData:(i,g)=>{g?e(xt({indices:i,data:g})):(e(vt(i)),M.select("velocity",[]))},addNewVelocity:()=>{Q({label:"Click to place velocity estimate",mode:"mapClick",callback:i=>{Q("normal");const g=m.length;e(bt({data:{lat:i.lat,lon:i.lon}})),M.select("velocity",[g])}})},save:async i=>{i?o({extension:".csv",isSaveFile:!0,callback:async g=>{e(G({file:g,key:"velocity",path:g.path})),await g.setContents(_e(m))}}):d&&await d.file.setContents(_e(m))}});break;case"block":K=s(xn,{open:()=>{console.log("opening block file"),o({extension:"csv",callback:async i=>{const g=await Uo(i);e(st(g)),e(G({file:i,key:"block",path:i.path}))}})},settings:f,setSettings:k,selected:ue,blocks:b,addNewBlock:()=>{Q({label:"Click to place new block",mode:"mapClick",callback:i=>{const g=b.length;e(tt({data:{name:"New Block",interior_lon:i.lon,interior_lat:i.lat}})),M.select("block",[g]),Q("normal")}})},setBlockData:(i,g)=>{g?e(nt({indices:ue,data:g})):(e(ot(i)),M.select("block",[]))},save:async i=>{i?o({extension:".csv",isSaveFile:!0,callback:async g=>{e(G({file:g,key:"block",path:g.path})),await g.setContents(Ce(b))}}):l&&await l.file.setContents(Ce(b))}});break;case"segment":K=s(Wn,{open:()=>{console.log("opening segment file"),o({extension:"csv",callback:async i=>{const g=await Ct(i);e(Se(g)),e(G({file:i,key:"segment",path:i.path}))}})},settings:S,setSettings:D,segments:(We=u.segments)!=null?We:[],selected:Me,setSelectionMode:i=>Q(i),addNewSegment:(i,g)=>{const $=u.segments.length;e(ft({start:i,end:g})),M.select("segment",[$])},setSegmentData:(i,g)=>{e(g?mt({indices:i,data:g}):pt({index:i}))},splitSegment:i=>{e(yt(i)),M.select("segment",[])},save:async i=>{i?o({extension:".csv",isSaveFile:!0,callback:async g=>{e(G({file:g,key:"segment",path:g.path})),await g.setContents(de(u))}}):c&&await c.file.setContents(de(u))}});break;case"vertex":K=s(Zn,{open:()=>{console.log("opening segment file"),o({extension:"csv",callback:async i=>{const g=await Ct(i);e(Se(g)),e(G({file:i,key:"segment",path:i.path}))}})},settings:L,setSettings:q,vertices:(He=u.vertecies)!=null?He:{},selected:Pe,setVertexData:(i,g)=>{g&&e(Ne({index:i,vertex:g}))},setSelectionMode:i=>Q(i),mergeVertices:(i,g)=>{e(gt({a:i,b:g}))},bridgeVertices:(i,g)=>{e(ut({a:i,b:g}))},extrudeVertex:(i,g)=>{e(ht({index:i,targetPoint:g}))},save:async()=>{c&&await c.file.setContents(de(u))}});break;case"mesh":K=s(Bn,{open:()=>{console.log("opening mesh file"),o({extension:"msh",callback:async i=>{const g=new kt(i);await g.initialize(),g.data&&e(we({mesh:i.name,data:g.data}))}})},openMultiple:()=>{console.log("opening mesh file"),o({extension:"json",callback:async i=>{if(t){e(dt());const g=await ds(i,t);e(G({file:i,key:"mesh_params",path:i.path}));for(const $ of g)e(we({mesh:$.parameters.mesh_filename,parameters:$.parameters,data:$.line}))}}})},settings:R,setSettings:je});break;case"csv":K=s(kn,{open:()=>{console.log("opening generic segment file"),o({extension:"csv",callback:async i=>{const g=new es(i);await g.initialize(),g.data&&e(rt({name:i.name,data:g.data}))}})},settings:B,setSettings:De,setCollectionVertexKeys:i=>{e(it(i))},collections:x});break;case"map":K=s(On,{settings:ae,setSettings:Vt});break}const Te={Block:{state:f.hide,change:()=>{k(N(h({},f),{hide:!f.hide}))}},Vertex:{state:L.hide,change:()=>{q(N(h({},L),{hide:!L.hide}))}},Velocity:{state:w.hide,change:()=>{y(N(h({},w),{hide:!w.hide}))}},Segment:{state:S.hide,change:()=>{D(N(h({},S),{hide:!S.hide}))}},Grid:{state:!pe,change:()=>{Ht(!pe)}},Mesh:{state:R.hide,change:()=>{je(N(h({},R),{hide:!R.hide}))}},GenericSegments:{state:B.hide,change:()=>{De(N(h({},B),{hide:!B.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:i=>{i.key==="Escape"&&Q("normal")},children:[s(Hn,{filesOpen:t!==void 0,saveFiles:async()=>{c&&await c.file.setContents(de(u)),l&&await l.file.setContents(Ce(b)),d&&await d.file.setContents(_e(m))},folder:t,openFolder:async()=>{const i=await Zo();e(lt(i)),r("files")}}),E!=="normal"?s("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:v("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[s("span",{className:"text-lg font-semibold",children:E.label}),E.subtitle?s("span",{className:"text-md font-thin text-gray-500",children:E.subtitle}):s(F,{}),s("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):s(F,{}),v("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[s("div",{className:"flex flex-row items-center justify-between gap-5",children:v("span",{className:"p-1 text-sm text-center",children:["Hold ",s("span",{className:"font-bold",children:"Shift"})," to box select"," ",s("span",{className:"font-bold",children:X})]})}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor(Ae.lon*1e3)/1e3,","," ",Math.floor(Ae.lat*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[s("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Lt).map(i=>{const g=Lt[i];return s("button",{type:"button",className:`${X===g?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{It(g)},children:i},i)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Te).map(i=>{const g=Te[i];return s("button",{type:"button",className:`${g.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{g.change()},children:i},i)})]})]}),s(Vn,{pointSources:Ot,arrowSources:Rt,lineSources:Bt,drawnPointSource:Tt,polygonSources:At,selections:{segments:Me,blocks:ue,velocities:Ie,vertices:Pe},displayGrid:pe?10:-1,click:i=>{typeof E!="string"&&E.mode==="mapClick"&&E.callback(i)},mouseMove:i=>{Wt(i)},styleUri:`mapbox://styles/${ae.currentStyle.user}/${ae.currentStyle.styleId}`},`${ae.currentStyle.user}:${ae.currentStyle.styleId}`),t?s(Cn,{view:K,buttons:ps,active:a,setActive:i=>r(i)}):s(F,{}),t&&n?s(wn,{root:t,chooseFile:(i,g)=>{n.callback(i,g),o(!1)},close:()=>{o(!1)},extension:n.extension,isSaveDialog:n.isSaveFile===!0}):s(F,{})]})}const hs=sn({reducer:{main:an(ln({segment:Eo,block:fo,velocity:zo,meshLine:Lo,genericSegments:wo,fileHandles:ho}))}});function gs(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:a,onRegisterError:r}=e;let c;const l=async(d=!0)=>{};return"serviceWorker"in navigator&&(c=new rn("./sw.js",{scope:"./"}),c.addEventListener("activated",d=>{d.isUpdate?window.location.reload():o==null||o()}),c.register({immediate:t}).then(d=>{a==null||a(d)}).catch(d=>{r==null||r(d)})),l}gs();const ys=1,bs=new cn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ys}}});dn.render(s(C.exports.StrictMode,{children:s(un,{client:bs,children:s(fn,{store:hs,children:s(ms,{})})})}),document.querySelector("#root"));
