var on=Object.defineProperty,ln=Object.defineProperties;var rn=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var cn=Object.prototype.hasOwnProperty,dn=Object.prototype.propertyIsEnumerable;var Le=(t,e,n)=>e in t?on(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,f=(t,e)=>{for(var n in e||(e={}))cn.call(e,n)&&Le(t,n,e[n]);if(lt)for(var n of lt(e))dn.call(e,n)&&Le(t,n,e[n]);return t},w=(t,e)=>ln(t,rn(e));var L=(t,e,n)=>(Le(t,typeof e!="symbol"?e+"":e,n),n);import{j as o,a as v,F as P,r as C,M as un,m as it,R as fn,b as $e,u as mn,c as pn,l as rt,d as hn,e as le,f as F,g as ct,h as dt,i as gn,k as yn,n as bn,v as xn,Q as vn,o as wn,p as Sn,P as Nn}from"./vendor.da2b9cb6.js";const kn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};kn();const Fe=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],ut={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Cn(t){return t?f(f({},ut),t):f({},ut)}function _n({value:t,fieldDefinition:e,setField:n}){const[a,s]=C.exports.useState(-1),[i,c]=C.exports.useState(t);C.exports.useEffect(()=>{c(t)},[t]);let l=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof t=="number"?"number":"text",value:i,onChange:r=>{const d=typeof t=="number"?Number.parseFloat(r.target.value):r.target.value;c(d),a>-1&&clearTimeout(a),s(setTimeout(()=>n(d),1e3))}});return e.type==="select"&&(l=v("select",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",value:i,onChange:r=>{n(r.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(r=>o("option",{value:r.name,"data-testid":`input-editor-${e.name}-${r.name}`,children:r.name},r.name))]})),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(P,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function ie({title:t,items:e,setItems:n,fieldDefinitions:a,ignoreFields:s,deletable:i,controls:c}){const l=e[0],r=Object.keys(l).map((d,y)=>{if(s==null?void 0:s.includes(d))return{element:o("span",{style:{display:"hidden"}},d),order:y+1e4};let p=l[d];for(const x of e)if(x[d]!==p){p="-";break}const m=d in a&&a[d];return m?{element:o(_n,{value:p,fieldDefinition:m,setField:x=>n({[d]:x})},d),order:m.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${d}`,className:"text-l font-bold",children:d}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${d}`,className:"bg-gray-800 w-full",type:typeof p=="number"?"number":"text",value:p,onChange:x=>{n({[d]:typeof p=="number"?Number.parseFloat(x.target.value):x.target.value})}})})]},d),order:y+1e3}}).sort((d,y)=>d.order-y.order).map(d=>d.element);return v("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:t}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[c,i?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):o(P,{})]})]}),r]})}ie.defaultProps={ignoreFields:[],controls:o(P,{})};const Ln={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},$n=["",...Fe];var zt;const Fn=JSON.parse((zt=window.localStorage.getItem("blockDisplaySettings"))!=null?zt:"false")||Ln;function Dn({settings:t,setSettings:e,selected:n,blocks:a,setBlockData:s,addNewBlock:i,save:c,open:l}){const r=p=>{e(p),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(p))},d=n.map(p=>a[p]).filter(p=>p),y=d.length>0?o(ie,{title:d.length===1?d[0].name:"Edit Selected Blocks",items:d,deletable:!0,setItems:p=>s(n,p),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(P,{});return v(P,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{r(w(f({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:p=>{r(w(f({},t),{color:p.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.selectedColor,onChange:p=>{r(w(f({},t),{selectedColor:p.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:t.radius,onChange:p=>{r(w(f({},t),{radius:Number.parseFloat(p.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:p=>{r(w(f({},t),{plottableKey:p.currentTarget.value}))},children:$n.map(p=>o("option",{value:p,children:p},p))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Block"})]}),y]})}function jn(t){let e="..";for(let n=2;n<t;n+=1)e=`${e}/..`;return e}function Vn({root:t,chooseFile:e,close:n,extension:a,isSaveDialog:s}){var h,k;const[i,c]=C.exports.useState(""),[l,r]=C.exports.useState(),[d,y]=C.exports.useState(""),[p,m]=C.exports.useState([t]),x=(h=p.at(-1))!=null?h:t,N=[...p.filter(S=>S!==t).map((S,D)=>o("button",{type:"button","data-testid":`back-${D}`,onClick:async()=>{m(p.slice(0,D+1))},children:jn(p.length-D)},D)),...x.folderList.map(S=>o("button",{type:"button","data-testid":`folder-${S}`,onClick:async()=>{m([...p,await x.getDirectory(S)])},children:S},S))],b=x.fileList.filter(S=>S.endsWith(a)).map(S=>o("button",{type:"button","data-testid":`file-${S}`,className:(l==null?void 0:l.name)===S?"font-bold":"",onClick:async()=>{const D=await x.getFile(S);r(D),c(D.name),y(await D.getContents())},children:S},S));return o("div",{role:"none","data-testid":"explorer-backdrop",className:"fixed w-full h-full flex flex-col justify-center items-center z-50 bg-black/50",onClick:()=>n(),children:v("div",{role:"none",className:"bg-black p-5 flex flex-col gap-2",onClick:S=>S.stopPropagation(),children:[o("span",{children:"Open File"}),v("div",{className:"flex flex-row gap-2 pointer-events-auto",children:[v("div",{className:"border-gray-800 border p-2 flex flex-col gap-1 min-w-[20rem] max-w-[30rem] max-h-40 overflow-auto items-start",children:[N,b]}),l?v("div",{className:"border-gray-800 border p-2 max-w-[30rem] max-h-40 overflow-auto whitespace-pre",children:[o("span",{"data-testid":"selected-file-name",className:"text-xl font-bold",children:l.name}),o("p",{"data-testid":"selected-file-content",children:d})]}):o(P,{})]}),v("div",{className:"flex flex-row",children:[o("div",{"data-testid":"file-path",className:"flex-grow p-1",children:s?x.path.join("/"):(k=l==null?void 0:l.path.join("/"))!=null?k:""}),s?o("input",{"data-testid":"file-path-input",className:"flex-grow p-1 bg-gray-800",value:i,onChange:S=>c(S.target.value)}):o(P,{})]}),v("div",{className:"flex flex-row-reverse gap-2 pointer-events-auto",children:[o("button",{"data-testid":"select-button",type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2 disabled:bg-gray-900",disabled:!l&&!i,onClick:async()=>{let S=l;if(s&&(S=await x.getFile(i.endsWith(a)?i:`${i}${a}`)),S){const D=p.filter(z=>z!==t).map(z=>z.name);D.push(S.name),e(S,D)}},children:s?"Save":"Select"}),o("button",{"data-testid":"close-button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",type:"button",onClick:()=>n(),children:"Close"})]})]})})}function Mn({folder:t,files:e,setFile:n}){const a=Object.keys(e).map(s=>{const i=e[s],c=Array.isArray(i.currentFilePath)?[...i.currentFilePath]:[i.currentFilePath];return i.allowMultiple&&c.push(""),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:i.name}),o("span",{className:"text-sm","data-testid":`file-${s}-description`,children:i.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:c.map((l,r)=>v("select",{"data-testid":`file-${s}-select-${r}`,className:"bg-gray-800 w-full m-1",value:l,onChange:async d=>{const y=d.currentTarget.value;try{const p=await t.getFile(y);n(r,s,p.name,p)}catch{n(r,s,"")}},children:[o("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),t.fileList.filter(d=>d.endsWith(i.extension)).map(d=>o("option",{value:d,"data-testid":`file-${s}-select-${d}`,children:d},d))]},r))})]},s)});return o("div",{className:"flex flex-col gap-2",children:a})}const In={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Wt;const Pn=f(f({},In),JSON.parse((Wt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Wt:"{}"));function On({settings:t,setSettings:e,collections:n,setCollectionVertexKeys:a,open:s}){const i=l=>{e(l),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(l))},c=Object.keys(n).map(l=>{const{startLat:r,startLon:d,endLat:y,endLon:p,segments:m,plot:x}=n[l],N=Object.keys(m[0]).map((b,h)=>({name:b,value:h}));return o(ie,{title:l,items:[{startLat:r,startLon:d,endLat:y,endLon:p,plot:x}],deletable:!1,setItems:b=>{a(f({collection:l,startLat:r,startLon:d,endLat:y,endLon:p,plot:x},b))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:N},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:N},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:N},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:N},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:N}}},l)});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{i(w(f({},t),{hide:!t.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>s(),children:"Open Segments"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:l=>{i(w(f({},t),{color:l.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:l=>{i(w(f({},t),{width:Number.parseFloat(l.target.value)}))}})})]}),c]})}function Rn({view:t,buttons:e,active:n,setActive:a}){if(!e)return o("span",{});const s=[];for(const i of Object.keys(e)){const c=e[i],l=i===n;s.push(o("button",{type:"button","data-testid":`tab-${i}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(l?"":i),children:c},i))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:t}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:s})]})}const ft={lon:0,lat:0},Bn=180,re=360;function mt(t){let{lon:e,lat:n}=t;for(;e<0;)e+=re;for(;e>re;)e-=re;return[e,n]}function De([t,e]){return{lon:t<0?t+re:t,lat:e}}function je(t,e){const n=mt(t),a=mt(e),s=[a[0],a[1]];return a[0]-n[0]>=Bn?s[0]-=re:s[0]+=re,Math.abs(n[0]-a[0])>Math.abs(n[0]-s[0])?[n,s]:[n,a]}const A=1e6;function X(t,e,n,a){const s=`${Math.floor(t.lon*A)},${Math.floor(t.lat*A)}`;if(s in e)return[e[s],a];const i=a;return n[i]=t,e[s]=i,[i,a+1]}function pt(t,e){let n=!1;for(const a of t.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&t.vertecies[e]){const a=t.vertecies[e],s=`${Math.floor(a.lon*A)},${Math.floor(a.lat*A)}`,i=f({},t.vertecies);delete i[e];const c=f({},t.vertexDictionary);return delete c[s],w(f({},t),{vertecies:i,vertexDictionary:c})}return t}const ee=Math.PI/6,te=2*Math.PI-ee;function An(t,e,{map:n,popup:a,internalArrowSources:s,mapLoaded:i,internalSelections:c},{arrowSources:l,selections:r}){var p;if(n&&i&&s!==l)if(console.log("Setting arrows in map!"),s){for(const m of s){const x=n.getSource(`arrow:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${m.name}`),n.removeLayer(`layer:arrow:${m.name}:click`);try{n.getLayer(`layer:arrow:${m.name}:labels`)&&n.removeLayer(`layer:arrow:${m.name}:labels`)}catch{console.log("no label layer")}}e({internalArrowSources:void 0})}else{for(const m of l){let x=n.getSource(`arrow:${m.name}`);const N=x===void 0;if(N&&(n.addSource(`arrow:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${m.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`arrow:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.arrows.map(b=>{var $;const h=b.scale*m.scale,k=m.scale*m.arrowHeadScale,S=[b.longitude+b.direction[0]*h,b.latitude+b.direction[1]*h],D=[S[0]+(Math.cos(ee)*-b.direction[0]-Math.sin(ee)*-b.direction[1])*k,S[1]+(Math.sin(ee)*-b.direction[0]+Math.cos(ee)*-b.direction[1])*k],z=[S[0]+(Math.cos(te)*-b.direction[0]-Math.sin(te)*-b.direction[1])*k,S[1]+(Math.sin(te)*-b.direction[0]+Math.cos(te)*-b.direction[1])*k];return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:($=r[m.name])==null?void 0:$.includes(b.index)},geometry:{type:"LineString",coordinates:[[b.longitude,b.latitude],S,D,S,z]}}})}),n.addLayer({id:`layer:arrow:${m.name}`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],m.selectedColor,m.color],"line-width":m.width}}),n.addLayer({id:`layer:arrow:${m.name}:click`,type:"line",source:`arrow:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(p=m.arrows[0])==null?void 0:p.label){const b=n.getSource(`arrow:${m.name}:points`);b&&(b.setData({type:"FeatureCollection",features:m.arrows.map(h=>({type:"Feature",properties:{label:h.label},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))}),n.addLayer({id:`layer:arrow:${m.name}:labels`,type:"symbol",source:`arrow:${m.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}N&&(n.on("mouseenter",`layer:arrow:${m.name}:click`,b=>{if(!b.features)return;const h=b.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const k=[...h.geometry.coordinates],{description:S}=h.properties;for(;Math.abs(b.lngLat.lng-k[0])>180;)k[0]+=b.lngLat.lng>k[0]?360:-360;a.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:arrow:${m.name}:click`,()=>{a.remove()}),n.on("click",`layer:arrow:${m.name}:click`,b=>{let h;if(t.state.internalArrowSources)for(const S of t.state.internalArrowSources)h=S.click;if(!b.features||!h)return;const k=b.features[0];if(k.properties&&typeof k.properties.index=="number"&&typeof k.properties.name=="string"){const{index:S}=k.properties;h(S)}}))}e({internalArrowSources:l})}const d=f({},c);let y=!1;for(const m of Object.keys(r))if(r[m]!==c[m]){for(const x of l)if(x.name===m){y=!0,d[m]=r[m];const N=n==null?void 0:n.getSource(`arrow:${x.name}`);if(N){const b=r[m];N.setData({type:"FeatureCollection",features:x.arrows.map(h=>{const k=h.scale*x.scale,S=x.scale*x.arrowHeadScale,D=[h.longitude+h.direction[0]*k,h.latitude+h.direction[1]*k],z=[D[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*S,D[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*S],$=[D[0]+(Math.cos(te)*-h.direction[0]-Math.sin(te)*-h.direction[1])*S,D[1]+(Math.sin(te)*-h.direction[0]+Math.cos(te)*-h.direction[1])*S];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:b==null?void 0:b.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],D,z,D,$]}}})})}}}y&&e({internalSelections:d})}function En(t,{map:e,draw:n,drawnPointSettings:a,mapLoaded:s,internalDrawnPointSource:i},{drawnPointSource:c}){if(e&&s&&i!==c){console.log("Drawning Points"),t({internalDrawnPointSource:c});let l=n;if((c.selectedColor!==a.selectedColor||c.selectedRadius!==a.selectedRadius||c.color!==a.color||c.radius!==a.radius)&&(t({drawnPointSettings:{color:c.color,radius:c.radius,selectedRadius:c.selectedRadius,selectedColor:c.selectedColor}}),n&&(e.removeControl(n),l=void 0),c?(l=new un({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":c.selectedRadius,"circle-color":c.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":c.radius,"circle-color":c.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(l),t({draw:l})):l=void 0),l){const r=l.getAll(),d=c.points.length!==r.features.length?void 0:l.getSelected(),y={type:"FeatureCollection",features:c.points.map(p=>({type:"Feature",id:p.index.toString(),properties:{description:"",index:p.index,name:""},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))};if(l.set(y),d&&d.features.length>0&&d.features[0].properties&&typeof d.features[0].properties.index=="number"){const p=d.features[0].id;p&&l.changeMode("simple_select",{featureIds:[p]})}}}}const K="grid";function Tn(t,e,{map:n,internalGridDisplay:a,popup:s,mapLoaded:i},{displayGrid:c}){if(n&&i&&a!==c){if(console.log("Drawing Grid on map!"),a&&a>0){const l=n.getSource(K);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),n.removeLayer(K),e({internalGridDisplay:void 0})}else if(c&&c>0){let l=n.getSource(K);const r=l===void 0;if(r&&(n.addSource(K,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=n.getSource(K)),l!==void 0){const d=[];for(let y=-170;y<=180;y+=c)d.push({type:"Feature",properties:{label:`Lon: ${y<0?y+360:y}`},geometry:{type:"LineString",coordinates:[[y,-90],[y,90]]}});for(let y=-90;y<=90;y+=c)d.push({type:"Feature",properties:{label:`Lat: ${y}`},geometry:{type:"LineString",coordinates:[[180,y],[-180,y]]}});l.setData({type:"FeatureCollection",features:d})}n.addLayer({id:K,type:"line",source:K,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${K}:click`,type:"line",source:K,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),r&&(n.on("mouseenter",`${K}:click`,d=>{if(!d.features)return;const y=d.features[0];y.geometry.type==="LineString"&&y.properties&&typeof y.properties.label=="string"&&s.setLngLat(d.lngLat).setHTML(`${y.properties.label}`).addTo(n)}),n.on("mouseleave",`${K}:click`,()=>{s.remove()}))}e({internalGridDisplay:c})}}function zn(t,e,{map:n,popup:a,internalLineSources:s,mapLoaded:i,internalSelections:c},{lineSources:l,selections:r}){var p;if(n&&i&&s!==l)if(console.log("Setting lines in map!"),s){for(const m of s){const x=n.getSource(`line:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${m.name}`);try{n.getLayer(`layer:line:${m.name}:click`)&&n.removeLayer(`layer:line:${m.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${m.name}:labels`)&&n.removeLayer(`layer:line:${m.name}:labels`)}catch{console.log("no label layer")}}e({internalLineSources:void 0})}else{for(const m of l){let x=n.getSource(`line:${m.name}`);const N=x===void 0;if(N&&(n.addSource(`line:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${m.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`line:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.lines.map(b=>{var h,k;return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,label:(h=b.label)!=null?h:"",selected:((k=r[m.name])==null?void 0:k.includes(b.index))||!1},geometry:{type:"LineString",coordinates:[[b.startLongitude,b.startLatitude],[b.endLongitude,b.endLatitude]]}}})}),n.addLayer({id:`layer:line:${m.name}`,type:"line",source:`line:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],m.selectedColor,m.color],"line-width":["case",["get","selected"],m.selectedWidth,m.width]}}),(p=m.lines[0])==null?void 0:p.label){const b=n.getSource(`line:${m.name}:points`);b&&(b.setData({type:"FeatureCollection",features:m.lines.map(h=>({type:"Feature",properties:{label:h.label},geometry:{type:"Point",coordinates:[(h.startLongitude+h.endLongitude)/2,(h.startLatitude+h.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${m.name}:labels`,type:"symbol",source:`line:${m.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}m.click&&(n.addLayer({id:`layer:line:${m.name}:click`,type:"line",source:`line:${m.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":m.width*10}}),N&&(n.on("mouseenter",`layer:line:${m.name}:click`,b=>{if(!b.features)return;const h=b.features[0];if(h.geometry.type==="LineString"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const k=[(h.geometry.coordinates[0][0]+h.geometry.coordinates[1][0])/2,(h.geometry.coordinates[0][1]+h.geometry.coordinates[1][1])/2],{description:S}=h.properties;for(;Math.abs(b.lngLat.lng-k[0])>180;)k[0]+=b.lngLat.lng>k[0]?360:-360;a.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:line:${m.name}:click`,()=>{a.remove()}),n.on("click",`layer:line:${m.name}:click`,b=>{let h;if(t.state.internalLineSources)for(const S of t.state.internalLineSources)S.name===m.name&&(h=S.click);if(!b.features||!h)return;const k=b.features[0];if(k.properties&&typeof k.properties.index=="number"&&typeof k.properties.name=="string"){const{index:S}=k.properties;h(S)}})))}e({internalLineSources:l})}const d=f({},c);let y=!1;for(const m of Object.keys(r))if(r[m]!==c[m]){for(const x of l)if(x.name===m){y=!0,d[m]=r[m];const N=n==null?void 0:n.getSource(`line:${x.name}`);if(N){const b=r[m];N.setData({type:"FeatureCollection",features:x.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:b==null?void 0:b.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))})}}}y&&e({internalSelections:d})}function Wn(t,e,{map:n,popup:a,internalPointSources:s,mapLoaded:i,internalSelections:c},{pointSources:l,selections:r}){var p;if(!n||!i)return;if(s!==l)if(console.log("Setting points in map!"),s){for(const m of s){const x=n.getSource(`point:${m.name}`);x!==void 0&&x.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${m.name}`);try{n.getLayer(`layer:point:${m.name}:labels`)&&n.removeLayer(`layer:point:${m.name}:labels`)}catch{console.log("no label layer")}}e({internalPointSources:void 0})}else{for(const m of l){let x=n.getSource(`point:${m.name}`);const N=x===void 0;N&&(n.addSource(`point:${m.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x=n.getSource(`point:${m.name}`)),x!==void 0&&x.setData({type:"FeatureCollection",features:m.points.map(b=>{var h;return{type:"Feature",properties:{description:b.name||b.description?`<strong>${b.name}</strong><p>${b.description}</p>`:"",index:b.index,name:b.name,selected:!((h=r[m.name])==null?void 0:h.includes(b.index)),label:b.label},geometry:{type:"Point",coordinates:[b.longitude,b.latitude]}}})}),n.addLayer({id:`layer:point:${m.name}`,type:"circle",source:`point:${m.name}`,paint:{"circle-color":["case",["get","selected"],m.color,m.selectedColor],"circle-radius":m.radius}}),((p=m.points[0])==null?void 0:p.label)&&n.addLayer({id:`layer:point:${m.name}:labels`,type:"symbol",source:`point:${m.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),N&&(n.on("mouseenter",`layer:point:${m.name}`,b=>{if(!b.features)return;const h=b.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const k=[...h.geometry.coordinates],{description:S}=h.properties;for(;Math.abs(b.lngLat.lng-k[0])>180;)k[0]+=b.lngLat.lng>k[0]?360:-360;a.setLngLat(k).setHTML(S).addTo(n)}}),n.on("mouseleave",`layer:point:${m.name}`,()=>{a.remove()}),n.on("click",`layer:point:${m.name}`,b=>{let h;if(t.state.internalPointSources)for(const S of t.state.internalPointSources)h=S.click;if(!b.features||!h)return;const k=b.features[0];if(k.properties&&typeof k.properties.index=="number"&&typeof k.properties.name=="string"){const{index:S}=k.properties;h(S)}}))}e({internalPointSources:l})}const d=f({},c);let y=!1;for(const m of Object.keys(r))if(r[m]!==c[m]){for(const x of l)if(x.name===m){y=!0,d[m]=r[m];const N=n.getSource(`point:${x.name}`);if(N){const b=r[m];N.setData({type:"FeatureCollection",features:x.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(b==null?void 0:b.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}y&&e({internalSelections:d})}function Gn(t,e,{map:n,internalPolygonSources:a,mapLoaded:s},{polygonSources:i,selections:c}){if(n&&s&&a!==i)if(a){for(const l of a){const r=n.getSource(`poly:${l.name}`);r!==void 0&&r.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${l.name}`),n.removeLayer(`layer:poly:${l.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const l of i){let r=n.getSource(`poly:${l.name}`);r===void 0&&(n.addSource(`poly:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r=n.getSource(`poly:${l.name}`)),r!==void 0&&r.setData({type:"FeatureCollection",features:l.polygons.map(y=>{var p;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:((p=c[l.name])==null?void 0:p.includes(y.index))||!1},geometry:{type:"Polygon",coordinates:[y.polygon.map(m=>[m.lon,m.lat])]}}})}),n.addLayer({id:`layer:poly:${l.name}:fill`,type:"fill",source:`poly:${l.name}`,layout:{},paint:{"fill-color":l.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${l.name}`,type:"line",source:`poly:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.borderColor,"line-width":l.borderRadius}})}e({internalPolygonSources:i})}}it.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Kn extends fn.Component{constructor(e){super(e);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:C.exports.createRef(),popup:new $e.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=e.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:e,style:n}=this.state,a=typeof e=="object"?e==null?void 0:e.current:void 0;if(it.accessToken&&a){const s=new $e.exports.Map({container:a,style:n,center:[0,0],zoom:2});s.addControl(new $e.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:i})=>{const{click:c}=this.props;c(De([i.lng,i.lat]))}),s.on("mousemove",({lngLat:i})=>{const{mouseMove:c}=this.props;c&&c(De([i.lng,i.lat]))}),s.on("draw.selectionchange",({features:i})=>{const{internalDrawnPointSource:c}=this.state;if(!c||!(c==null?void 0:c.select))return;const l=i.map(r=>r&&r.type==="Feature"&&r.geometry.type==="Point"&&r.properties&&"index"in r.properties&&typeof r.properties.index=="number"?r.properties.index:-1).filter(r=>r>-1);c.select(l)}),s.on("draw.update",({features:i,action:c})=>{const{internalDrawnPointSource:l}=this.state;if(!!(l==null?void 0:l.update)&&c==="move"&&i.length>0)for(const r of i)r.type==="Feature"&&r.geometry.type==="Point"&&r.properties&&"index"in r.properties&&typeof r.properties.index=="number"&&l.update(r.properties.index,De(r.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:e}=this.props,{style:n,map:a}=this.state;return e&&e!==n&&(this.setState({style:e}),a==null||a.setStyle(e)),Tn(this,s=>this.setState(s),this.state,this.props),Gn(this,s=>this.setState(s),this.state,this.props),zn(this,s=>this.setState(s),this.state,this.props),An(this,s=>this.setState(s),this.state,this.props),Wn(this,s=>this.setState(s),this.state,this.props),En(s=>this.setState(s),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const fe={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},Hn=(()=>{var e;const t=f(f({},fe),JSON.parse((e=window.localStorage.getItem("mapSettings"))!=null?e:"{}"));return t.savedStyles=f(f({},t.savedStyles),fe.savedStyles),t})();function Jn({settings:t,setSettings:e}){const[n,a]=C.exports.useState(""),[s,i]=C.exports.useState(""),[c,l]=C.exports.useState(""),r=d=>{e(d),window.localStorage.setItem("mapSettings",JSON.stringify(d))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Select Style"}),o("span",{className:"w-2/5 flex-shrink-0",children:v("select",{className:"bg-gray-800 w-full",value:t.currentStyleName,onChange:d=>{const y=d.target.value;if(y==="***CUSTOM")a(""),l(t.savedStyles.default.styleId),i(t.savedStyles.default.user),r(w(f({},t),{currentStyleName:"",currentStyle:t.savedStyles.default}));else{const p=t.savedStyles[y];a(y),l(p.styleId),i(p.user),r(w(f({},t),{currentStyleName:y,currentStyle:p}))}},children:[o("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(t.savedStyles).map(d=>o("option",{value:d,children:d},d))]})})]}),t.currentStyleName in fe.savedStyles?o(P,{}):v(P,{children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Style Name"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:d=>{a(d.target.value)}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in fe.savedStyles)&&r({currentStyle:{user:s,styleId:c},currentStyleName:n,savedStyles:w(f({},t.savedStyles),{[n]:{user:s,styleId:c}})})},children:"Save Style"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in t.savedStyles&&!(n in fe.savedStyles)){const d={};for(const y of Object.keys(t.savedStyles))y!==n&&(d[y]=t.savedStyles[y]);r({currentStyle:d.default,currentStyleName:"default",savedStyles:d})}},children:"Delete Style"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"User"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:s,onChange:d=>{i(d.target.value)}})}),o("span",{className:"text-l font-bold",children:"Style Id"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:c,onChange:d=>{l(d.target.value)}})})]}),v("div",{children:["Adding a custom mapbox style:",v("ul",{children:[v("li",{children:["If you are creating a new style, go to"," ",o("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),o("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const Un={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Gt;const qn=f(f({},Un),JSON.parse((Gt=window.localStorage.getItem("meshDisplaySettings"))!=null?Gt:"{}"));function Qn({settings:t,setSettings:e,open:n}){const a=s=>{e(s),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(s))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{a(w(f({},t),{hide:!t.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Mesh"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:s=>{a(w(f({},t),{color:s.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:s=>{a(w(f({},t),{width:Number.parseFloat(s.target.value)}))}})})]})]})}const Ve=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ce={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Xn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Kt;const Zn=f(f({},Xn),JSON.parse((Kt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Kt:"{}")),Yn=["",...Ve];function ea({settings:t,setSettings:e,segments:n,selected:a,setSegmentData:s,addNewSegment:i,splitSegment:c,setSelectionMode:l,save:r,open:d}){const y=x=>{e(x),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(x))},p=a.map(x=>n[x]).filter(x=>x),m=p.length>0?o(ie,{title:p.length===1?p[0].name:"Edit Selected Segments",items:p,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:x=>s(a,x),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>c(a),children:"Split Segment"})}):o(P,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{y(w(f({},t),{hide:!t.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hideProjection,onChange:()=>{y(w(f({},t),{hideProjection:!t.hideProjection}))}})})]}),v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Open Segments"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>r(),children:"Save Segments & Vertices"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{r(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:x=>{y(w(f({},t),{color:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:x=>{y(w(f({},t),{width:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.activeColor,onChange:x=>{y(w(f({},t),{activeColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.activeWidth,onChange:x=>{y(w(f({},t),{activeWidth:Number.parseFloat(x.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.projectionColor,onChange:x=>{y(w(f({},t),{projectionColor:x.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:x=>{y(w(f({},t),{plottableKey:x.currentTarget.value}))},children:Yn.map(x=>o("option",{value:x,children:x},x))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:x=>{l({mode:"mapClick",label:"Select Segment End point",callback:N=>{i(x,N),l("normal")}})}})},children:"New Segment"})]}),m]})}const ht=()=>mn(),se=pn;function ta({folder:t,openFolder:e,filesOpen:n,saveFiles:a}){function s(){e()}const i=ht(),[c,l]=se(r=>[r.main.past.length>0,r.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[t?o("button",{type:"button",onClick:()=>{i(rt.ActionCreators.undo())},"data-testid":"undo-button",disabled:!c,children:"Undo"}):o(P,{}),t?o("button",{type:"button",onClick:()=>{i(rt.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):o(P,{}),t?v("span",{children:["Working in ",t.name]}):o("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),n?o("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Active Files"}):o(P,{})]})]})}const Me=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],na={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function aa(t){return f(f({},na),t)}const sa={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},oa=["",...Me];var Ht;const la=JSON.parse((Ht=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ht:"false")||sa;function ia({settings:t,setSettings:e,selected:n,velocitys:a,setVelocityData:s,addNewVelocity:i,save:c,open:l}){const r=p=>{e(p),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(p))},d=n.map(p=>a[p]).filter(p=>p),y=d.length>0?o(ie,{title:d.length===1?d[0].name:"Edit Selected Velocities",items:d,deletable:!0,setItems:p=>s(n,p),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(P,{});return v(P,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{r(w(f({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:p=>{r(w(f({},t),{color:p.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.selectedColor,onChange:p=>{r(w(f({},t),{selectedColor:p.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:t.scale,onChange:p=>{r(w(f({},t),{scale:Number.parseFloat(p.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:p=>{r(w(f({},t),{width:Number.parseFloat(p.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:t.arrowHead,onChange:p=>{r(w(f({},t),{arrowHead:Number.parseFloat(p.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:p=>{r(w(f({},t),{plottableKey:p.currentTarget.value}))},children:oa.map(p=>o("option",{value:p,children:p},p))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:i,children:"New Velocity"})]}),y]})}const ra={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Jt;const ca=f(f({},ra),JSON.parse((Jt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Jt:"{}"));function da({settings:t,setSettings:e,vertices:n,selected:a,setVertexData:s,setSelectionMode:i,mergeVertices:c,bridgeVertices:l,extrudeVertex:r,save:d,open:y}){const p=N=>{e(N),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(N))},x=a.map(N=>({selectedVertex:n[N],index:N})).filter(N=>N.selectedVertex).map(({selectedVertex:N,index:b})=>o(ie,{title:"Selected Vertex",items:[N],ignoreFields:[],deletable:!1,setItems:h=>s(b,f(f({},N),h)),fieldDefinitions:{},controls:v(P,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{c(b,h[0]),i("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{l(b,h[0]),i("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{r(b,h),i("normal")}})},children:"Extrude"})]})},b));return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{p(w(f({},t),{hide:!t.hide}))}})}),v("span",{className:"w-2/5 flex-shrink flex flex-row justify-end gap-2",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>y(),children:"Open Segments"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Segments & Vertices"})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:N=>{p(w(f({},t),{color:N.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.radius,onChange:N=>{p(w(f({},t),{radius:Number.parseFloat(N.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.activeColor,onChange:N=>{p(w(f({},t),{activeColor:N.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.activeRadius,onChange:N=>{p(w(f({},t),{activeRadius:Number.parseFloat(N.target.value)}))}})})]}),x]})}const ua=t=>t.mode,fa=t=>t.setSelectedBlock,ma=t=>t.setSelectedSegment,pa=t=>t.setSelectedVelocity,ha=t=>t.setSelectedVertex,ga=t=>t.setActiveTab,gt=hn(ua,fa,ma,pa,ha,ga,(t,e,n,a,s,i)=>t==="normal"?(c,l)=>{e(c==="block"?l:[]),n(c==="segment"?l:[]),a(c==="velocities"?l:[]),s(c==="vertex"?l:[]),i(c)}:t.mode==="override"?(c,l)=>{c===t.type&&t.callback(l)}:()=>{});function ya(t,{data:e}){return[...t,Cn(e)]}function ba(t,e){const n=[];for(const[a,s]of t.entries())e.includes(a)||n.push(s);return n}function xa(t,e){const n=[...t];for(const a of e.indices){const s=f(f({},n[a]),e.data);n[a]=s}return n}function va(t,e){return e}function wa(t,{index:e,position:n}){const a=[...t],s=f({},a[e]);return s.interior_lat=n.lat,s.interior_lon=n.lon,a[e]=s,a}const Sa=[],yt=F("createBlock"),bt=F("editBlock"),xt=F("deleteBlock"),we=F("loadNewBlockData"),vt=F("moveBlock"),Na=le(Sa,t=>{t.addCase(yt,(e,n)=>ya(e,n.payload)).addCase(bt,(e,n)=>xa(e,n.payload)).addCase(xt,(e,n)=>ba(e,n.payload)).addCase(we,(e,n)=>va(e,n.payload)).addCase(vt,(e,n)=>wa(e,n.payload))}),wt=F("setRootFolder"),ka=F("openFile"),Ca=F("closeFile"),_a={rootFolder:void 0,files:{}},La=le(_a,t=>{t.addCase(wt,(e,n)=>({rootFolder:n.payload,files:{},fileOpenCallback:()=>{}})).addCase(ka,(e,n)=>{const a=f({},e.files);return a[n.payload.key]={path:n.payload.path,file:n.payload.file},w(f({},e),{files:a})}).addCase(Ca,(e,n)=>{const a={};return Object.keys(e.files).filter(s=>s!==n.payload).map(s=>(a[s]=e.files[s],!0)),w(f({},e),{files:a})})});function $a(t,e){return w(f({},t),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:e.data}})}function Fa(t,e){const n={};for(const a of Object.keys(t))a!==e&&(n[a]=t[a]);return n}function Da(t,e){const n=t[e.collection];if(!n)return t;const a=w(f({},n),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat,plot:e.plot});return w(f({},t),{[e.collection]:a})}const ja={},Ie=F("loadNewGenericCollectionData"),St=F("setGenericSegmentPositionKeys"),Va=F("removeGenericSegmentCollection"),Ma=le(ja,t=>t.addCase(Ie,(e,n)=>$a(e,n.payload)).addCase(St,(e,n)=>Da(e,n.payload)).addCase(Va,(e,n)=>Fa(e,n.payload)));function Ia(t,e){return w(f({},t),{[e.mesh]:e.data})}function Pa(t,e){const n={};for(const a of Object.keys(t))a!==e&&(n[a]=t[a]);return n}const Oa={},Se=F("loadMeshLineData"),Ra=F("removeMesh"),Ba=le(Oa,t=>t.addCase(Se,(e,n)=>Ia(e,n.payload)).addCase(Ra,(e,n)=>Pa(e,n.payload)));function Aa(t,{a:e,b:n}){const a=w(f({},ce),{start:e,end:n}),s=[...t.segments,a];return w(f({},t),{segments:s})}function Ea(t,e){const n=f({},t.vertecies),a=f({},t.vertexDictionary),{lastIndex:s}=t,[i,c]=X(e.start,a,n,s),[l,r]=X(e.end,a,n,c),d=w(f(f({},ce),e),{start:i,end:l}),y=[...t.segments,d];return{vertecies:n,vertexDictionary:a,segments:y,lastIndex:r}}function Ta(t,e){const n=[],a=[];let s=f({},t);for(const[i,c]of t.segments.entries())e.index.includes(i)?a.push(c):n.push(c);s.segments=n;for(const i of a)s=pt(pt(s,i.start),i.end);return s}function za(t,e){const n=[...t.segments];for(const a of e.indices){const s=f(f({},n[a]),e.data);n[a]=s}return w(f({},t),{segments:n})}function Wa(t,e){const n=f({},t.vertecies),a=f({},t.vertexDictionary),[s,i]=X(e.targetPoint,a,n,t.lastIndex),c=w(f({},ce),{start:e.index,end:s}),l=[...t.segments,c];return{vertecies:n,vertexDictionary:a,segments:l,lastIndex:i}}function Ga(t,e){return e}function Ka(t,{a:e,b:n}){if(e===n)return t;const a=t.segments.map(r=>{let d=r;return d.start===n&&(d=w(f({},d),{start:e})),d.end===n&&(d=w(f({},d),{end:e})),d}).filter(r=>r.start!==r.end),s=t.vertecies[n],i=`${Math.floor(s.lon*A)},${Math.floor(s.lat*A)}`,c=f({},t.vertecies);delete c[n];const l=f({},t.vertexDictionary);return delete l[i],w(f({},t),{vertecies:c,vertexDictionary:l,segments:a})}function Ha(t,{index:e,vertex:n}){const a=f({},t.vertecies),s=f({},t.vertexDictionary),i=[...t.segments],c=a[e],l=`${Math.floor(n.lon*A)},${Math.floor(n.lat*A)}`,r=`${Math.floor(c.lon*A)},${Math.floor(c.lat*A)}`;if(delete s[r],l in s){const d=s[l];for(const y of i)y.start===d&&(y.start=e),y.end===d&&(y.end=e);delete a[d]}return a[e]=n,w(f({},t),{segments:i,vertecies:a,vertexDictionary:s})}function Ja(t,e){const n=f({},t.vertecies),a=f({},t.vertexDictionary),s=[...t.segments];let{lastIndex:i}=t;for(const c of e){const l=t.segments[c],r=t.vertecies[l.start],d=t.vertecies[l.end],y={lon:(r.lon+d.lon)/2,lat:(r.lat+d.lat)/2},[p,m]=X(y,a,n,i);i=m;const x=w(f({},l),{end:p,name:`${l.name}_a`}),N=w(f({},l),{start:p,name:`${l.name}_b`});s[c]=x,s.push(N)}return{vertecies:n,vertexDictionary:a,segments:s,lastIndex:i}}const Ua={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},Nt=F("bridgeVertices"),kt=F("createSegmet"),Ct=F("deleteSegment"),_t=F("editSegmentData"),Lt=F("extrudeSegment"),me=F("loadNewSegmentData"),$t=F("mergeVertices"),Pe=F("moveVertex"),Ft=F("splitSegment");function qa(t,e,n){if(n.dip===90||n.locking_depth<=0)return!1;const a=n.dip<90,i=(a?90-n.dip:n.dip-90)*(Math.PI/180),c=Math.abs(Math.tan(i)*n.locking_depth),[l,r]=t.lon>=e.lon?[t,e]:[e,t],d={lon:r.lat-l.lat,lat:-(r.lon-l.lon)};a&&(d.lon*=-1,d.lat*=-1);const y=ct(dt([[l.lon,l.lat],[l.lon+d.lon,l.lat+d.lat]]),c,{units:"kilometers"}),p=ct(dt([[r.lon,r.lat],[r.lon+d.lon,r.lat+d.lat]]),c,{units:"kilometers"});return[l,{lon:y.geometry.coordinates[0],lat:y.geometry.coordinates[1]},{lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1]},r]}function Qa(t){return t.segments.map(e=>qa(t.vertecies[e.start],t.vertecies[e.end],e)).filter(e=>e)}const Xa=le(Ua,t=>{t.addCase(Nt,(e,n)=>Aa(e,n.payload)).addCase(kt,(e,n)=>Ea(e,n.payload)).addCase(Ct,(e,n)=>Ta(e,n.payload)).addCase(_t,(e,n)=>za(e,n.payload)).addCase(Lt,(e,n)=>Wa(e,n.payload)).addCase(me,(e,n)=>Ga(e,n.payload)).addCase($t,(e,n)=>Ka(e,n.payload)).addCase(Pe,(e,n)=>Ha(e,n.payload)).addCase(Ft,(e,n)=>Ja(e,n.payload))});function Za(t,{data:e}){return[...t,aa(e)]}function Ya(t,e){const n=[];for(const[a,s]of t.entries())e.includes(a)||n.push(s);return n}function es(t,e){const n=[...t];for(const a of e.indices){const s=f(f({},n[a]),e.data);n[a]=s}return n}function ts(t,e){return e}function ns(t,{index:e,position:n}){const a=[...t],s=f(f({},a[e]),n);return a[e]=s,a}const as=[],Dt=F("createVelocity"),jt=F("editVelocity"),Vt=F("deleteVelocity"),Ne=F("loadNewVelocityData"),Mt=F("moveVelocity"),ss=le(as,t=>{t.addCase(Dt,(e,n)=>Za(e,n.payload)).addCase(jt,(e,n)=>es(e,n.payload)).addCase(Vt,(e,n)=>Ya(e,n.payload)).addCase(Ne,(e,n)=>ts(e,n.payload)).addCase(Mt,(e,n)=>ns(e,n.payload))});function pe(t){const e=t.split(/\n/g),n=e[0].split(",").map(i=>i.trim()),a=e.slice(1),s=[];for(const i of a)if(i.trim()!==""){const c=i.split(/\s*,\s*/),l={};for(let r=0;r<n.length;r+=1){let d=c[r];const y=n[r],p=Number.parseFloat(d);d=Number.isNaN(p)?d:p,typeof d=="string"&&(d=d.startsWith('"')&&d.endsWith('"')?d.slice(1,-1).trim():d.trim()),l[y]=d}s.push(l)}return s}function Oe(t,e){const n=[e.join(",")];for(const a of t){const s=a;n.push(e.map(i=>{if(i in s){const c=s[i];return typeof c=="string"&&/\s/.test(`${c}`)?`"${c.trim()}"`:`${typeof c=="number"&&(i.includes("lon")||i.includes("lat"))?c.toFixed(6):c}`}return""}).join(","))}return n.join(`
`)}function os(t){return t.map(e=>{const n={};for(const a of Fe)n[a]=e[a]||(a==="name"?"":0);return n})}function ls(t){return Oe(t,Fe)}class he{constructor(e){L(this,"handle");L(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e);this.data=os(n)}async save(){var e;await this.handle.setContents(ls((e=this.data)!=null?e:[]))}clone(){return new he(this.handle)}}const is={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function rs(t){return f(f({},is),t)}function cs(t){const e=JSON.parse(t);return rs(e)}function ds(t){return JSON.stringify(t)}class Re{constructor(e){L(this,"handle");L(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents();this.data=cs(e)}async save(){this.data&&await this.handle.setContents(ds(this.data))}clone(){return new Re(this.handle)}}class It{constructor(e){L(this,"data");L(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e);this.data=n}async save(){}}function us(t){const n=[...t.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const s=Number.parseFloat(a[1]),i=Number.parseFloat(a[2]);return{lon:s,lat:i}});return n.splice(0,0,{lon:0,lat:0}),n}const fs={"1":t=>{var a,s;const e=Number.parseInt((a=t[t.length-2])!=null?a:"",10),n=Number.parseInt((s=t[t.length-1])!=null?s:"",10);return!Number.isNaN(e)&&!Number.isNaN(n)?[[e,n]]:!1},"2":t=>{var s,i,c;const e=Number.parseInt((s=t[t.length-3])!=null?s:"",10),n=Number.parseInt((i=t[t.length-2])!=null?i:"",10),a=Number.parseInt((c=t[t.length-1])!=null?c:"",10);return!Number.isNaN(e)&&!Number.isNaN(n)&&!Number.isNaN(a)?[[e,n],[n,a],[a,e]]:!1}};function ms(t){return t.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var a;return((a=fs[e[1]])!=null?a:()=>!1)(e)}).filter(e=>e).flat()}function ps(t,e){return e.map(([n,a])=>n!==a&&n>-1&&n<t.length&&a>-1&&a<t.length?[t[n],t[a]]:!1).filter(n=>n)}function hs(t){if(!t.startsWith("$"))return[];const e=t.split("$");let n=[],a=[];for(const s of e)s.startsWith("Nodes")?n=us(s):s.startsWith("Elements")&&(a=ms(s));return ps(n,a)}class Pt{constructor(e){L(this,"data");L(this,"handle");L(this,"startLonColumn");L(this,"endLonColumn");L(this,"startLatColumn");L(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=hs(e);else{const n=pe(e);this.data=n.map(a=>{const s={lon:0,lat:0},i={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(s.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(s.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(i.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(i.lat=a[this.endLatColumn]);const c=Object.keys(a).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(c.length>0){const l={};for(const r of c)l[r]=a[r];return[s,i]}return[s,i]})}}async save(){console.log("Mesh files do not get saved")}}function gs(t){const e=t.map(c=>{const l={};for(const r of Ve)l[r]=c[r]||(r==="name"?"":0);return l}),n={},a={},s=[];let i=0;for(const c of e){const[l,r]=X({lon:c.lon1,lat:c.lat1},n,a,i),[d,y]=X({lon:c.lon2,lat:c.lat2},n,a,r),p=w(f({},c),{start:l,end:d});i=y,s.push(p)}return{vertecies:a,vertexDictionary:n,segments:s,lastIndex:i}}function ys({vertecies:t,segments:e}){const n=e.map(a=>{const s=t[a.start],i=t[a.end];return w(f({},a),{lon1:s.lon,lat1:s.lat,lon2:i.lon,lat2:i.lat})});return Oe(n,Ve)}class de{constructor(e){L(this,"handle");L(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e);this.data=gs(n)}async save(){this.data&&await this.handle.setContents(ys(this.data))}clone(){return new de(this.handle)}tryRemoveVertex(e){if(this.data){let n=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*A)},${Math.floor(a.lat*A)}`,i=f({},this.data.vertecies);delete i[e];const c=f({},this.data.vertexDictionary);delete c[s];const l=this.clone();return l.data=w(f({},this.data),{vertecies:i,vertexDictionary:c}),l}}return this}mergeVertices(e,n){if(this.data){for(const r of this.data.segments)r.start===n&&(r.start=e),r.end===n&&(r.end=e);const a=this.data.vertecies[n],s=`${Math.floor(a.lon*A)},${Math.floor(a.lat*A)}`,i=f({},this.data.vertecies);delete i[n];const c=f({},this.data.vertexDictionary);delete c[s];const l=this.clone();return l.data=w(f({},this.data),{vertecies:i,vertexDictionary:c}),l}return this}moveVertex(e,n){if(this.data){const a=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),i=[...this.data.segments],c=a[e],l=`${Math.floor(n.lon*A)},${Math.floor(n.lat*A)}`,r=`${Math.floor(c.lon*A)},${Math.floor(c.lat*A)}`;if(delete s[r],l in s){const y=s[l];for(const p of i)p.start===y&&(p.start=e),p.end===y&&(p.end=e);delete a[y]}a[e]=n;const d=this.clone();return d.data=w(f({},this.data),{segments:i,vertecies:a,vertexDictionary:s}),d}return this}splitSegment(e){if(this.data){const n=this.data.segments[e],a=this.data.vertecies[n.start],s=this.data.vertecies[n.end],i={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[c,l]=X(i,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),r=w(f({},n),{end:c,name:`${n.name}_a`}),d=w(f({},n),{start:c,name:`${n.name}_b`}),y=[...this.data.segments];y[e]=r,y.push(d);const p=this.clone();return p.data=w(f({},this.data),{segments:y,lastIndex:l}),p}return this}bridgeVertices(e,n){if(this.data){const a=w(f({},ce),{start:e,end:n}),s=[...this.data.segments,a],i=this.clone();return i.data=w(f({},this.data),{segments:s}),i}return this}extrudeSegment(e,n){if(this.data){const a=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),[i,c]=X(n,s,a,this.data.lastIndex),l=w(f({},ce),{start:e,end:i}),r=[...this.data.segments,l],d=this.clone();return d.data={vertecies:a,vertexDictionary:s,segments:r,lastIndex:c},d}return this}deleteSegment(e){if(this.data){const n=[...this.data.segments],a=n.splice(e,1)[0],s=this.clone();return s.data=w(f({},this.data),{segments:n}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,n){if(this.data){const a=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),[i,c]=X(e,s,a,this.data.lastIndex),[l,r]=X(n,s,a,c),d=w(f({},ce),{start:i,end:l}),y=[...this.data.segments,d],p=this.clone();return p.data={vertecies:a,vertexDictionary:s,segments:y,lastIndex:r},p}return this}}function bs(t){return t.map(e=>{const n={};for(const a of Me)n[a]=e[a]||(a==="name"?"":0);return n})}function xs(t){return Oe(t,Me)}class ge{constructor(e){L(this,"handle");L(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=pe(e);this.data=bs(n)}async save(){var e;await this.handle.setContents(xs((e=this.data)!=null?e:[]))}clone(){return new ge(this.handle)}}async function Ot(t){const e=new de(t);return await e.initialize(),e}async function Rt(t){const e=new he(t);return await e.initialize(),e}async function Bt(t){const e=new ge(t);return await e.initialize(),e}async function At(t){const e=new Pt(t);return await e.initialize(),e}async function vs(t){const e=new It(t);return await e.initialize(),e}async function ye(t,e,n){try{const a=await e.getFile(t);return await n(a)}catch{return!1}}async function ws(t,e,n){const a=new Re(e);if(await a.initialize(),a.data){const s=await ye(a.data.segment_file_name,t,Ot),i=await ye(a.data.block_file_name,t,Rt),c=await ye(a.data.station_file_name,t,Bt),l=await ye(a.data.mesh_parameters_file_name,t,async d=>{const y=JSON.parse(await d.getContents());return(await Promise.all(y.map(async m=>ye(m.mesh_filename,t,At)))).filter(m=>m)}),r=f({},n);return"command"in r&&(r.command=w(f({},r.command),{currentFilePath:e.name})),s&&"segment"in r&&(r.segment=w(f({},r.segment),{currentFilePath:a.data.segment_file_name})),i&&"block"in r&&(r.block=w(f({},r.block),{currentFilePath:a.data.block_file_name})),c&&"velocities"in r&&(r.velocities=w(f({},r.velocities),{currentFilePath:a.data.station_file_name})),l&&"mesh"in r&&(r.mesh=w(f({},r.mesh),{currentFilePath:l.map(d=>d.handle.name)})),{openableFiles:r,commands:a,segments:s,blocks:i,velocities:c,mesh:l}}throw new Error("Can't open command file")}class Ss{constructor(e,n){L(this,"name");L(this,"path");L(this,"handle");this.handle=e,this.name=e.name,this.path=n!=null?n:[this.name]}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const n=await this.handle.createWritable();await n.write(e),await n.close()}}class Be{constructor(e,n){L(this,"name");L(this,"path");L(this,"handle");L(this,"fileList");L(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name,this.path=n!=null?n:[this.name]}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){const n=await this.handle.getFileHandle(e,{create:!0});return new Ss(n,[...this.path,e])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(e),a=new Be(n,[...this.path,e]);return await a.initialize(),a}}const Ns=async()=>{const t=await window.showDirectoryPicker();await t.requestPermission({mode:"readwrite"});const e=new Be(t);return await e.initialize(),e};class ks{constructor(e,n,a){L(this,"name");L(this,"path");L(this,"parent");this.name=e,this.parent=n,this.path=a!=null?a:[this.name]}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class Ae{constructor(e,n,a){L(this,"name");L(this,"path");L(this,"parent");L(this,"fileList");L(this,"folderList");this.name=e,this.parent=n,this.fileList=[],this.folderList=[],this.path=a!=null?a:[this.name];const s=n[e];for(const i of Object.keys(s))typeof s[i]=="string"?this.fileList.push(i):this.folderList.push(i)}async getFile(e){return new ks(e,this.parent[this.name],[...this.path,e])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new Ae(e,this.parent[this.name],[...this.path,e])}}const Cs=async t=>new Ae("root",t);let Et=async()=>{var e;return Cs((e=window.FakeDirectory)!=null?e:{})};function _s(t){Et=t}async function Ls(){return Et()}window.location.search.includes("fake-dir")||_s(Ns);var H;(function(t){t.Vertex="Vertices",t.Block="Blocks",t.Velocity="Velocities"})(H||(H={}));const Tt={Block:H.Block,Vertex:H.Vertex,Velocity:H.Velocity},$s={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function Fs(){var at,st,ot;const t=ht(),e=se(u=>u.main.present.fileHandles.rootFolder),[n,a]=C.exports.useState(!1),[s,i]=C.exports.useState(""),[c,l]=C.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[r,d]=C.exports.useState(),[y,p]=C.exports.useState(),[m,x]=C.exports.useState(),[N,b]=C.exports.useState(),h=se(u=>u.main.present.segment),k=se(u=>u.main.present.block),S=se(u=>u.main.present.velocity),D=se(u=>u.main.present.meshLine),z=se(u=>u.main.present.genericSegments),[$,Ee]=C.exports.useState(la),[j,Te]=C.exports.useState(Fn),[R,ze]=C.exports.useState(Zn),[V,We]=C.exports.useState(ca),[J,Ge]=C.exports.useState(qn),[U,Ke]=C.exports.useState(Pn),[ue,Ut]=C.exports.useState(Hn),[q,ne]=C.exports.useState("normal"),[ae,qt]=C.exports.useState(H.Vertex),[ke,He]=C.exports.useState([]),[Je,Ue]=C.exports.useState([]),[qe,Qe]=C.exports.useState([]),[Xe,Ze]=C.exports.useState([]),[O,Is]=C.exports.useState({select:gt({mode:q,setSelectedBlock:He,setSelectedSegment:Ue,setSelectedVelocity:Qe,setSelectedVertex:Ze,setActiveTab:i})}),[Qt,Xt]=C.exports.useState([]),[Zt,Ye]=C.exports.useState([]),[Yt,en]=C.exports.useState([]),[tn,et]=C.exports.useState([]),[nn,Ce]=C.exports.useState({color:V.color,selectedColor:V.activeColor,radius:V.radius,selectedRadius:V.activeRadius,points:[]}),[tt,an]=C.exports.useState({lon:0,lat:0}),[_e,sn]=C.exports.useState(!1);C.exports.useEffect(()=>{O.select=gt({mode:q,setSelectedBlock:He,setSelectedSegment:Ue,setSelectedVelocity:Qe,setSelectedVertex:Ze,setActiveTab:i})},[q,O]),C.exports.useEffect(()=>{const u=[];ae!==H.Block&&!j.hide&&u.push({name:"blocks",color:j.color,selectedColor:j.selectedColor,radius:j.radius,points:k.map((g,_)=>({longitude:g.interior_lon,latitude:g.interior_lat,name:g.name,description:"",index:_,label:j.plottableKey in g?`${g[j.plottableKey]}`:""})),click:g=>{O.select("block",[g])}}),ae!==H.Vertex&&!V.hide&&u.push({name:"vertices",color:V.color,selectedColor:V.activeColor,radius:V.radius,click:g=>{O.select("vertex",[g])},points:Object.keys(h.vertecies).map(g=>{const _=Number.parseInt(g,10),I=h.vertecies[_];return I?{longitude:I.lon,latitude:I.lat,index:_,name:"",description:""}:!1}).filter(g=>!!g)}),Xt(u)},[j,k,R,O,ae,V.hide,V.color,V.activeColor,V.radius,h.vertecies]),C.exports.useEffect(()=>{const u=[];if(R.hide||u.push({name:"segments",color:R.color,selectedColor:R.activeColor,width:R.width,selectedWidth:R.activeWidth,lines:h.segments.map((g,_)=>{var Q,W;const I=(Q=h.vertecies[g.start])!=null?Q:ft,T=(W=h.vertecies[g.end])!=null?W:ft,[[Y,E],[G,B]]=je(I,T);return{startLongitude:Y,startLatitude:E,endLongitude:G,endLatitude:B,name:g.name,description:`${I.lon},${I.lat} to ${T.lon},${T.lat}`,index:_,label:R.plottableKey in g?`${g[R.plottableKey]}`:""}}),click:g=>{O.select("segment",[g])}}),!J.hide)for(const g of Object.keys(D)){const _=D[g];u.push({name:`mesh:${g}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:_.map((I,T)=>{const Y=I[0],E=I[1],[[G,B],[Q,W]]=je(Y,E);return{startLongitude:G,startLatitude:B,endLongitude:Q,endLatitude:W,name:"",description:"",index:T}})||[]})}if(!U.hide)for(const g of Object.keys(z)){const{startLat:_,startLon:I,endLat:T,endLon:Y,plot:E,segments:G}=z[g];_ in G[0]&&T in G[0]&&I in G[0]&&Y in G[0]&&u.push({name:`generic_segment:${g}`,color:U.color,selectedColor:U.activeColor,width:U.width,selectedWidth:U.activeWidth,lines:G.map((B,Q)=>{const W={lat:B[_],lon:B[I]},oe={lat:B[T],lon:B[Y]};if(typeof W.lat!="number"||typeof W.lon!="number"||typeof oe.lat!="number"||typeof oe.lon!="number")return!1;const[[be,M],[xe,ve]]=je(W,oe);return{startLongitude:be,startLatitude:M,endLongitude:xe,endLatitude:ve,name:"",description:"",index:Q,label:E&&E in B?`${B[E]}`:""}}).filter(B=>B)||[]})}en(u)},[h,R,U,z,J,D,O]),C.exports.useEffect(()=>{switch(ae){case H.Vertex:{Ce({color:V.color,radius:V.radius,selectedColor:V.activeColor,selectedRadius:V.activeRadius,points:V.hide?[]:Object.keys(h.vertecies).map(u=>{const g=Number.parseInt(u,10),_=h.vertecies[g];return _?{longitude:_.lon,latitude:_.lat,index:g}:!1}).filter(u=>!!u),update:(u,g)=>{t(Pe({index:u,vertex:g}))},select:u=>{O.select("vertex",u)}});break}case H.Block:{Ce({color:j.color,radius:j.radius,selectedColor:j.selectedColor,selectedRadius:j.radius,points:j.hide?[]:k.map((u,g)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:g,label:j.plottableKey in u?`${u[j.plottableKey]}`:""})),update:(u,g)=>{t(vt({index:u,position:g}))},select:u=>{O.select("block",u)}});break}case H.Velocity:{Ce({color:$.color,radius:$.width,selectedColor:$.selectedColor,selectedRadius:$.width,points:$.hide?[]:S.map((u,g)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:g})),update:(u,g)=>{t(Mt({index:u,position:g}))},select:u=>{O.select("velocities",u)}});break}}},[V,O,h.vertecies,t,ae,j.color,j.radius,j.selectedColor,j.hide,k,$.color,$.width,$.selectedColor,$.hide,S,j.plottableKey]),C.exports.useEffect(()=>{$.hide?Ye([]):Ye([{name:"velocities",color:$.color,selectedColor:$.selectedColor,scale:$.scale,arrowHeadScale:$.arrowHead,width:$.width,arrows:S.map((u,g)=>{const _=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/_,u.north_vel/_],scale:_,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:g,label:$.plottableKey in u?`${u[$.plottableKey]}`:""}}),click:u=>{O.select("velocities",[u])}}])},[O,$,S]),C.exports.useEffect(()=>{R.hideProjection||R.hide?et([]):et([{name:"fault_dip_projections",color:R.projectionColor,borderColor:R.projectionColor,borderRadius:.5,polygons:Qa(h).map((u,g)=>({polygon:u,index:g,name:"",description:""}))}])},[R,h]);let Z=o("span",{});switch(s){case"files":Z=e?o(Mn,{folder:e,files:c,setFile:async(u,g,_,I)=>{if(I){let T=f({},c);const Y=T[g];let{currentFilePath:E,allowMultiple:G}=Y;switch(G?Array.isArray(E)?(E=E.map(B=>B),E.length>u?E[u]=_:E.push(_)):E=[_]:E=_,T[g]=w(f({},Y),{currentFilePath:E}),g){case"segment":const B=await Ot(I);p(B),B.data&&t(me(B.data));break;case"block":const Q=await Rt(I);x(Q),Q.data&&t(we(Q.data));break;case"velocities":const W=await Bt(I);b(W),W.data&&t(Ne(W.data));break;case"mesh":const oe=await At(I);oe.data&&t(Se({mesh:`mesh_file_${u}`,data:oe.data}));break;case"csv":const be=await vs(I);be.data&&t(Ie({name:`generic_segment_${u}`,data:be.data}));break;case"command":const M=await ws(e,I,c);d(M.commands!==!1?M.commands:void 0),p(M.segments!==!1?M.segments:void 0),M.segments!==!1&&M.segments.data&&t(me(M.segments.data)),x(M.blocks!==!1?M.blocks:void 0),M.blocks!==!1&&M.blocks.data&&t(we(M.blocks.data)),b(M.velocities!==!1?M.velocities:void 0),M.velocities!==!1&&M.velocities.data&&t(Ne(M.velocities.data)),M.mesh&&M.mesh.map((xe,ve)=>(xe.data&&t(Se({mesh:`mesh_file_${ve}`,data:xe.data})),ve)),T=M.openableFiles;break}l(T)}}}):o("span",{});break;case"velocities":Z=o(ia,{open:()=>{console.log("opening velocities file"),a({extension:"csv",callback:async u=>{const g=new ge(u);await g.initialize(),g.data&&(t(Ne(g.data)),b(g))}})},settings:$,setSettings:Ee,selected:qe,velocitys:S,setVelocityData:(u,g)=>{g?t(jt({indices:u,data:g})):(t(Vt(u)),O.select("velocity",[]))},addNewVelocity:()=>{ne({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{ne("normal");const g=S.length;t(Dt({data:{lat:u.lat,lon:u.lon}})),O.select("velocity",[g])}})},save:async u=>{u?a({extension:".csv",isSaveFile:!0,callback:async g=>{const _=new ge(g);_.data=S,b(_),await _.save()}}):N&&(N.data=S,await N.save())}});break;case"block":Z=o(Dn,{open:()=>{console.log("opening block file"),a({extension:"csv",callback:async u=>{const g=new he(u);await g.initialize(),g.data&&(t(we(g.data)),x(g))}})},settings:j,setSettings:Te,selected:ke,blocks:k,addNewBlock:()=>{ne({label:"Click to place new block",mode:"mapClick",callback:u=>{const g=k.length;t(yt({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),O.select("block",[g]),ne("normal")}})},setBlockData:(u,g)=>{g?t(bt({indices:ke,data:g})):(t(xt(u)),O.select("block",[]))},save:async u=>{u?a({extension:".csv",isSaveFile:!0,callback:async g=>{const _=new he(g);_.data=k,x(_),await _.save()}}):m&&(m.data=k,await m.save())}});break;case"segment":Z=o(ea,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async u=>{const g=new de(u);await g.initialize(),g.data&&(t(me(g.data)),p(g))}})},settings:R,setSettings:ze,segments:(at=h.segments)!=null?at:[],selected:Je,setSelectionMode:u=>ne(u),addNewSegment:(u,g)=>{const _=h.segments.length;t(kt({start:u,end:g})),O.select("segment",[_])},setSegmentData:(u,g)=>{t(g?_t({indices:u,data:g}):Ct({index:u}))},splitSegment:u=>{t(Ft(u)),O.select("segment",[])},save:async u=>{u?a({extension:".csv",isSaveFile:!0,callback:async g=>{const _=new de(g);_.data=h,p(_),await _.save()}}):y&&(y.data=h,await y.save())}});break;case"vertex":Z=o(da,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async u=>{const g=new de(u);await g.initialize(),g.data&&(t(me(g.data)),p(g))}})},settings:V,setSettings:We,vertices:(st=h.vertecies)!=null?st:{},selected:Xe,setVertexData:(u,g)=>{g&&t(Pe({index:u,vertex:g}))},setSelectionMode:u=>ne(u),mergeVertices:(u,g)=>{t($t({a:u,b:g}))},bridgeVertices:(u,g)=>{t(Nt({a:u,b:g}))},extrudeVertex:(u,g)=>{t(Lt({index:u,targetPoint:g}))},save:async()=>{y&&(y.data=h,await y.save())}});break;case"mesh":Z=o(Qn,{open:()=>{console.log("opening mesh file"),a({extension:"msh",callback:async u=>{const g=new Pt(u);await g.initialize(),g.data&&t(Se({mesh:u.name,data:g.data}))}})},settings:J,setSettings:Ge});break;case"csv":Z=o(On,{open:()=>{console.log("opening generic segment file"),a({extension:"csv",callback:async u=>{const g=new It(u);await g.initialize(),g.data&&t(Ie({name:u.name,data:g.data}))}})},settings:U,setSettings:Ke,setCollectionVertexKeys:u=>{t(St(u))},collections:z});break;case"map":Z=o(Jn,{settings:ue,setSettings:Ut});break}const nt={Block:{state:j.hide,change:()=>{Te(w(f({},j),{hide:!j.hide}))}},Vertex:{state:V.hide,change:()=>{We(w(f({},V),{hide:!V.hide}))}},Velocity:{state:$.hide,change:()=>{Ee(w(f({},$),{hide:!$.hide}))}},Segment:{state:R.hide,change:()=>{ze(w(f({},R),{hide:!R.hide}))}},Grid:{state:!_e,change:()=>{sn(!_e)}},Mesh:{state:J.hide,change:()=>{Ge(w(f({},J),{hide:!J.hide}))}},GenericSegments:{state:U.hide,change:()=>{Ke(w(f({},U),{hide:!U.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:u=>{u.key==="Escape"&&ne("normal")},children:[o(ta,{filesOpen:((ot=r!=null?r:y)!=null?ot:m)!==void 0,saveFiles:async()=>{r&&await r.save(),y&&(y.data=h,await y.save()),m&&(m.data=k,await m.save()),N&&(N.data=S,await N.save())},folder:e,openFolder:async()=>{const u=await Ls();t(wt(u)),i("files")}}),q!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:v("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:q.label}),q.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:q.subtitle}):o(P,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(P,{}),v("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-between gap-5",children:v("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ae})]})}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor(tt.lon*1e3)/1e3,","," ",Math.floor(tt.lat*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Tt).map(u=>{const g=Tt[u];return o("button",{type:"button",className:`${ae===g?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{qt(g)},children:u},u)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(nt).map(u=>{const g=nt[u];return o("button",{type:"button",className:`${g.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{g.change()},children:u},u)})]})]}),o(Kn,{pointSources:Qt,arrowSources:Zt,lineSources:Yt,drawnPointSource:nn,polygonSources:tn,selections:{segments:Je,blocks:ke,velocities:qe,vertices:Xe},displayGrid:_e?10:-1,click:u=>{typeof q!="string"&&q.mode==="mapClick"&&q.callback(u)},mouseMove:u=>{an(u)},styleUri:`mapbox://styles/${ue.currentStyle.user}/${ue.currentStyle.styleId}`},`${ue.currentStyle.user}:${ue.currentStyle.styleId}`),e?o(Rn,{view:Z,buttons:$s,active:s,setActive:u=>i(u)}):o(P,{}),e&&n?o(Vn,{root:e,chooseFile:(u,g)=>{n.callback(u,g),a(!1)},close:()=>{a(!1)},extension:n.extension,isSaveDialog:n.isSaveFile===!0}):o(P,{})]})}const Ds=gn({reducer:{main:yn(bn({segment:Xa,block:Na,velocity:ss,meshLine:Ba,genericSegments:Ma,fileHandles:La}))}});function js(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:s,onRegisterError:i}=t;let c;const l=async(r=!0)=>{};return"serviceWorker"in navigator&&(c=new xn("./sw.js",{scope:"./"}),c.addEventListener("activated",r=>{r.isUpdate?window.location.reload():a==null||a()}),c.register({immediate:e}).then(r=>{s==null||s(r)}).catch(r=>{i==null||i(r)})),l}js();const Vs=1,Ms=new vn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Vs}}});wn.render(o(C.exports.StrictMode,{children:o(Sn,{client:Ms,children:o(Nn,{store:Ds,children:o(Fs,{})})})}),document.querySelector("#root"));
