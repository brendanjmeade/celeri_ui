var tn=Object.defineProperty,nn=Object.defineProperties;var an=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var on=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable;var Se=(e,t,n)=>t in e?tn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t)=>{for(var n in t||(t={}))on.call(t,n)&&Se(e,n,t[n]);if(ze)for(var n of ze(t))sn.call(t,n)&&Se(e,n,t[n]);return e},N=(e,t)=>nn(e,an(t));var D=(e,t,n)=>(Se(e,typeof t!="symbol"?t+"":t,n),n);import{j as s,a as b,F as V,r as k,M as ln,m as Je,R as rn,b as ke,u as cn,c as dn,l as He,d as un,e as ee,f as j,g as Ue,p as fn,h as mn,i as pn,k as qe,n as Qe,o as hn,q as gn,s as yn,v as bn,Q as xn,t as wn,w as vn,P as _n}from"./vendor.ec54c37f.js";const Nn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};Nn();const Ce=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Xe={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Sn(e){return e?g(g({},Xe),e):g({},Xe)}function kn({value:e,fieldDefinition:t,setField:n}){const[a,o]=k.exports.useState(-1),[r,d]=k.exports.useState(e);k.exports.useEffect(()=>{d(e)},[e]);let l=s("input",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",type:typeof e=="number"?"number":"text",value:r,onChange:i=>{const c=typeof e=="number"?Number.parseFloat(i.target.value):i.target.value;d(c),a>-1&&clearTimeout(a),o(setTimeout(()=>n(c),1e3))}});return t.type==="select"&&(l=b("select",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",value:r,onChange:i=>{n(i.currentTarget.value)},children:[s("option",{value:"","data-testid":`input-editor-${t.name}-empty`,children:"\xA0"}),t.items.map(i=>s("option",{value:i.name,"data-testid":`input-editor-${t.name}-${i.name}`,children:i.name},i.name))]})),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[s("span",{"data-testid":`input-title-${t.name}`,className:"text-l font-bold",children:t.name}),t.description?s("span",{className:"text-sm",children:t.description}):s(V,{})]}),s("span",{className:"w-2/5 flex-shrink-0",children:l})]})}function te({title:e,items:t,setItems:n,fieldDefinitions:a,ignoreFields:o,deletable:r,controls:d}){const l=t[0],i=Object.keys(l).map((c,m)=>{if(o==null?void 0:o.includes(c))return{element:s("span",{style:{display:"hidden"}},c),order:m+1e4};let f=l[c];for(const y of t)if(y[c]!==f){f="-";break}const u=c in a&&a[c];return u?{element:s(kn,{value:f,fieldDefinition:u,setField:y=>n({[c]:y})},c),order:u.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":`input-title-${c}`,className:"text-l font-bold",children:c}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${c}`,className:"bg-gray-800 w-full",type:typeof f=="number"?"number":"text",value:f,onChange:y=>{n({[c]:typeof f=="number"?Number.parseFloat(y.target.value):y.target.value})}})})]},c),order:m+1e3}}).sort((c,m)=>c.order-m.order).map(c=>c.element);return b("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:e}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[d,r?s("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):s(V,{})]})]}),i]})}te.defaultProps={ignoreFields:[],controls:s(V,{})};const Cn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},Ln=["",...Ce];var Dt;const $n=JSON.parse((Dt=window.localStorage.getItem("blockDisplaySettings"))!=null?Dt:"false")||Cn;function jn({settings:e,setSettings:t,selected:n,blocks:a,setBlockData:o,addNewBlock:r,save:d,open:l}){const i=f=>{t(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},c=n.map(f=>a[f]).filter(f=>f),m=c.length>0?s(te,{title:c.length===1?c[0].name:"Edit Selected Blocks",items:c,deletable:!0,setItems:f=>o(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(V,{});return b(V,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{i(N(g({},e),{hide:!e.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:f=>{i(N(g({},e),{color:f.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:f=>{i(N(g({},e),{selectedColor:f.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:e.radius,onChange:f=>{i(N(g({},e),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:f=>{i(N(g({},e),{plottableKey:f.currentTarget.value}))},children:Ln.map(f=>s("option",{value:f,children:f},f))})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Block"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),m]})}var P;(function(e){e.Vertex="vertex",e.Block="block",e.Velocity="velocities",e.Segments="segment"})(P||(P={}));const Ze={Block:P.Block,Vertex:P.Vertex,Velocity:P.Velocity,Segment:P.Segments};function Dn({selectionMode:e,setSelectionMode:t,hoverPoint:n,editMode:a,setEditMode:o,hiddenState:r}){return b("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[s("div",{className:"flex flex-row items-center justify-between gap-5",children:s("span",{className:"p-1 text-sm text-center",children:s("button",{type:"button",className:`${e!=="normal"&&e.mode==="lasso"?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{t({mode:"lasso",polygon:[]})},children:"Lasso Selection"})})}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[s("span",{className:"p-1 text-sm font-bold text-center",children:"Coordinates: "}),b("span",{children:[Math.floor(n.lon*1e3)/1e3,","," ",Math.floor(n.lat*1e3)/1e3]})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[s("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Ze).map(d=>{const l=Ze[d];return s("button",{type:"button",className:`${a===l?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{o(l)},children:d},d)})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[s("span",{className:"p-1 text-sm font-bold text-center",children:"Displaying: "}),Object.keys(r).map(d=>{const l=r[d];return s("button",{type:"button",className:`${l.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{l.change()},children:d},d)})]})]})}function Fn(e){let t="..";for(let n=2;n<e;n+=1)t=`${t}/..`;return t}function Vn({root:e,chooseFile:t,close:n,extension:a,isSaveDialog:o}){var p,S;const[r,d]=k.exports.useState(""),[l,i]=k.exports.useState(),[c,m]=k.exports.useState(""),[f,u]=k.exports.useState([e]),y=(p=f.at(-1))!=null?p:e,x=[...f.filter(w=>w!==e).map((w,L)=>s("button",{type:"button","data-testid":`back-${L}`,onClick:async()=>{u(f.slice(0,L+1))},children:Fn(f.length-L)},L)),...y.folderList.map(w=>s("button",{type:"button","data-testid":`folder-${w}`,onClick:async()=>{u([...f,await y.getDirectory(w)])},children:w},w))],h=y.fileList.filter(w=>w.endsWith(a)).map(w=>s("button",{type:"button","data-testid":`file-${w}`,className:(l==null?void 0:l.name)===w?"font-bold":"",onClick:async()=>{const L=await y.getFile(w);i(L),d(L.name),m(await L.getContents())},children:w},w));return s("div",{role:"none","data-testid":"explorer-backdrop",className:"fixed w-full h-full flex flex-col justify-center items-center z-50 bg-black/50",onClick:()=>n(),children:b("div",{role:"none",className:"bg-black p-5 flex flex-col gap-2",onClick:w=>w.stopPropagation(),children:[s("span",{children:"Open File"}),b("div",{className:"flex flex-row gap-2 pointer-events-auto",children:[b("div",{className:"border-gray-800 border p-2 flex flex-col gap-1 min-w-[20rem] max-w-[30rem] max-h-40 overflow-auto items-start",children:[x,h]}),l?b("div",{className:"border-gray-800 border p-2 max-w-[30rem] max-h-40 overflow-auto whitespace-pre",children:[s("span",{"data-testid":"selected-file-name",className:"text-xl font-bold",children:l.name}),s("p",{"data-testid":"selected-file-content",children:c})]}):s(V,{})]}),b("div",{className:"flex flex-row",children:[s("div",{"data-testid":"file-path",className:"flex-grow p-1",children:o?y.path.join("/"):(S=l==null?void 0:l.path.join("/"))!=null?S:""}),o?s("input",{"data-testid":"file-path-input",className:"flex-grow p-1 bg-gray-800",value:r,onChange:w=>d(w.target.value)}):s(V,{})]}),b("div",{className:"flex flex-row-reverse gap-2 pointer-events-auto",children:[s("button",{"data-testid":"select-button",type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2 disabled:bg-gray-900",disabled:!l&&!r,onClick:async()=>{let w=l;if(o&&(w=await y.getFile(r.endsWith(a)?r:`${r}${a}`)),w){const L=f.filter(I=>I!==e).map(I=>I.name);L.push(w.name),t(w,L)}},children:o?"Save":"Select"}),s("button",{"data-testid":"close-button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",type:"button",onClick:()=>n(),children:"Close"})]})]})})}const In={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Ft;const Mn=g(g({},In),JSON.parse((Ft=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Ft:"{}"));function Pn({settings:e,setSettings:t,collections:n,setCollectionVertexKeys:a,open:o}){const r=l=>{t(l),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(l))},d=Object.keys(n).map(l=>{const{startLat:i,startLon:c,endLat:m,endLon:f,segments:u,plot:y}=n[l],x=Object.keys(u[0]).map((h,p)=>({name:h,value:p}));return s(te,{title:l,items:[{startLat:i,startLon:c,endLat:m,endLon:f,plot:y}],deletable:!1,setItems:h=>{a(g({collection:l,startLat:i,startLon:c,endLat:m,endLon:f,plot:y},h))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:x},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:x},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:x},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:x},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:x}}},l)});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{r(N(g({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>o(),children:"Open Segments"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:l=>{r(N(g({},e),{color:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:l=>{r(N(g({},e),{width:Number.parseFloat(l.target.value)}))}})})]}),d]})}const Ye={lon:0,lat:0},On=180,oe=360;function et(e){let{lon:t,lat:n}=e;for(;t<0;)t+=oe;for(;t>oe;)t-=oe;return[t,n]}function Le([e,t]){return{lon:e<0?e+oe:e,lat:t}}function $e(e,t){const n=et(e),a=et(t),o=[a[0],a[1]];return a[0]-n[0]>=On?o[0]-=oe:o[0]+=oe,Math.abs(n[0]-a[0])>Math.abs(n[0]-o[0])?[n,o]:[n,a]}const z=1e6;function se(e,t,n,a){const o=`${Math.floor(e.lon*z)},${Math.floor(e.lat*z)}`;if(o in t)return[t[o],a];const r=a;return n[r]=e,t[o]=r,[r,a+1]}function tt(e,t){let n=!1;for(const a of e.segments)if(a.start===t||a.end===t){n=!0;break}if(!n&&e.vertecies[t]){const a=e.vertecies[t],o=`${Math.floor(a.lon*z)},${Math.floor(a.lat*z)}`,r=g({},e.vertecies);delete r[t];const d=g({},e.vertexDictionary);return delete d[o],N(g({},e),{vertecies:r,vertexDictionary:d})}return e}const q=Math.PI/6,Z=2*Math.PI-q;function Rn(e,t,{map:n,popup:a,internalArrowSources:o,mapLoaded:r,internalSelections:d},{arrowSources:l,selections:i}){var f;if(n&&r&&o!==l)if(console.log("Setting arrows in map!"),o){for(const u of o){const y=n.getSource(`arrow:${u.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${u.name}`),n.removeLayer(`layer:arrow:${u.name}:click`);try{n.getLayer(`layer:arrow:${u.name}:labels`)&&n.removeLayer(`layer:arrow:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalArrowSources:void 0})}else{for(const u of l){let y=n.getSource(`arrow:${u.name}`);const x=y===void 0;if(x&&(n.addSource(`arrow:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${u.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=n.getSource(`arrow:${u.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:u.arrows.map(h=>{var M;const p=h.scale*u.scale,S=u.scale*u.arrowHeadScale,w=[h.longitude+h.direction[0]*p,h.latitude+h.direction[1]*p],L=[w[0]+(Math.cos(q)*-h.direction[0]-Math.sin(q)*-h.direction[1])*S,w[1]+(Math.sin(q)*-h.direction[0]+Math.cos(q)*-h.direction[1])*S],I=[w[0]+(Math.cos(Z)*-h.direction[0]-Math.sin(Z)*-h.direction[1])*S,w[1]+(Math.sin(Z)*-h.direction[0]+Math.cos(Z)*-h.direction[1])*S];return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:(M=i[u.name])==null?void 0:M.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],w,L,w,I]}}})}),n.addLayer({id:`layer:arrow:${u.name}`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],u.selectedColor,u.color],"line-width":u.width}}),n.addLayer({id:`layer:arrow:${u.name}:click`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(f=u.arrows[0])==null?void 0:f.label){const h=n.getSource(`arrow:${u.name}:points`);h&&(h.setData({type:"FeatureCollection",features:u.arrows.map(p=>({type:"Feature",properties:{label:p.label},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))}),n.addLayer({id:`layer:arrow:${u.name}:labels`,type:"symbol",source:`arrow:${u.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}x&&(n.on("mouseenter",`layer:arrow:${u.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const S=[...p.geometry.coordinates],{description:w}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(w).addTo(n)}}),n.on("mouseleave",`layer:arrow:${u.name}:click`,()=>{a.remove()}),n.on("click",`layer:arrow:${u.name}:click`,h=>{let p;if(e.state.internalArrowSources)for(const w of e.state.internalArrowSources)p=w.click;if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:w}=S.properties;p(w)}}))}t({internalArrowSources:l})}const c=g({},d);let m=!1;for(const u of Object.keys(i))if(i[u]!==d[u]){for(const y of l)if(y.name===u){m=!0,c[u]=i[u];const x=n==null?void 0:n.getSource(`arrow:${y.name}`);if(x){const h=i[u];x.setData({type:"FeatureCollection",features:y.arrows.map(p=>{const S=p.scale*y.scale,w=y.scale*y.arrowHeadScale,L=[p.longitude+p.direction[0]*S,p.latitude+p.direction[1]*S],I=[L[0]+(Math.cos(q)*-p.direction[0]-Math.sin(q)*-p.direction[1])*w,L[1]+(Math.sin(q)*-p.direction[0]+Math.cos(q)*-p.direction[1])*w],M=[L[0]+(Math.cos(Z)*-p.direction[0]-Math.sin(Z)*-p.direction[1])*w,L[1]+(Math.sin(Z)*-p.direction[0]+Math.cos(Z)*-p.direction[1])*w];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:h==null?void 0:h.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],L,I,L,M]}}})})}}}m&&t({internalSelections:c})}function Bn(e,{map:t,draw:n,drawnPointSettings:a,mapLoaded:o,internalDrawnPointSource:r,internalSelections:d},{drawnPointSource:l,selections:i}){var c;if(t&&o&&r!==l){console.log("Drawning Points"),e({internalDrawnPointSource:l});let m=n;if((l.selectedColor!==a.selectedColor||l.selectedRadius!==a.selectedRadius||l.color!==a.color||l.radius!==a.radius)&&(e({drawnPointSettings:{color:l.color,radius:l.radius,selectedRadius:l.selectedRadius,selectedColor:l.selectedColor}}),n&&(t.removeControl(n),m=void 0),l?(m=new ln({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":l.selectedRadius,"circle-color":l.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":l.radius,"circle-color":l.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),t.addControl(m),e({draw:m})):m=void 0),m){const f=m.getAll();let u=l.points.length!==f.features.length?void 0:m.getSelected().features.map(x=>{var h,p;return(p=(h=x.properties)==null?void 0:h.index)!=null?p:-1}).filter(x=>x>-1);const y={type:"FeatureCollection",features:l.points.map(x=>({type:"Feature",id:x.index.toString(),properties:{description:"",index:x.index,name:""},geometry:{type:"Point",coordinates:[x.longitude,x.latitude]}}))};m.set(y),d.draw!==i.draw&&(u=i.draw,e({internalSelections:N(g({},d),{draw:i.draw})})),u&&u.length>0&&m.changeMode("simple_select",{featureIds:u.map(x=>`${x}`)})}}if(n&&d.draw!==i.draw&&!!i.draw){const m=(c=i.draw)!=null?c:[];e({internalSelections:N(g({},d),{draw:i.draw})}),n.changeMode("simple_select",{featureIds:m.map(f=>`${f}`)})}}const W="grid";function En(e,t,{map:n,internalGridDisplay:a,popup:o,mapLoaded:r},{displayGrid:d}){if(n&&r&&a!==d){if(console.log("Drawing Grid on map!"),a&&a>0){const l=n.getSource(W);l!==void 0&&l.setData({type:"FeatureCollection",features:[]}),n.removeLayer(W),t({internalGridDisplay:void 0})}else if(d&&d>0){let l=n.getSource(W);const i=l===void 0;if(i&&(n.addSource(W,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l=n.getSource(W)),l!==void 0){const c=[];for(let m=-170;m<=180;m+=d)c.push({type:"Feature",properties:{label:`Lon: ${m<0?m+360:m}`},geometry:{type:"LineString",coordinates:[[m,-90],[m,90]]}});for(let m=-90;m<=90;m+=d)c.push({type:"Feature",properties:{label:`Lat: ${m}`},geometry:{type:"LineString",coordinates:[[180,m],[-180,m]]}});l.setData({type:"FeatureCollection",features:c})}n.addLayer({id:W,type:"line",source:W,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${W}:click`,type:"line",source:W,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),i&&(n.on("mouseenter",`${W}:click`,c=>{if(!c.features)return;const m=c.features[0];m.geometry.type==="LineString"&&m.properties&&typeof m.properties.label=="string"&&o.setLngLat(c.lngLat).setHTML(`${m.properties.label}`).addTo(n)}),n.on("mouseleave",`${W}:click`,()=>{o.remove()}))}t({internalGridDisplay:d})}}function An(e,t,{map:n,popup:a,internalLineSources:o,mapLoaded:r,internalSelections:d},{lineSources:l,selections:i}){var f;if(n&&r&&o!==l)if(console.log("Setting lines in map!"),o){for(const u of o){const y=n.getSource(`line:${u.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${u.name}`);try{n.getLayer(`layer:line:${u.name}:click`)&&n.removeLayer(`layer:line:${u.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${u.name}:labels`)&&n.removeLayer(`layer:line:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalLineSources:void 0})}else{for(const u of l){let y=n.getSource(`line:${u.name}`);const x=y===void 0;if(x&&(n.addSource(`line:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${u.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=n.getSource(`line:${u.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:u.lines.map(h=>{var p,S,w;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,label:(p=h.label)!=null?p:"",selected:(w=(S=i[u.name])==null?void 0:S.includes(h.index))!=null?w:!1},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),n.addLayer({id:`layer:line:${u.name}`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],u.selectedColor,u.color],"line-width":["case",["get","selected"],u.selectedWidth,u.width]}}),(f=u.lines[0])==null?void 0:f.label){const h=n.getSource(`line:${u.name}:points`);h&&(h.setData({type:"FeatureCollection",features:u.lines.map(p=>({type:"Feature",properties:{label:p.label},geometry:{type:"Point",coordinates:[(p.startLongitude+p.endLongitude)/2,(p.startLatitude+p.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${u.name}:labels`,type:"symbol",source:`line:${u.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}u.click&&(n.addLayer({id:`layer:line:${u.name}:click`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":u.width*10}}),x&&(n.on("mouseenter",`layer:line:${u.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="LineString"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const S=[(p.geometry.coordinates[0][0]+p.geometry.coordinates[1][0])/2,(p.geometry.coordinates[0][1]+p.geometry.coordinates[1][1])/2],{description:w}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(w).addTo(n)}}),n.on("mouseleave",`layer:line:${u.name}:click`,()=>{a.remove()}),n.on("click",`layer:line:${u.name}:click`,h=>{let p;if(e.state.internalLineSources)for(const w of e.state.internalLineSources)w.name===u.name&&(p=w.click);if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:w}=S.properties;p(w)}})))}t({internalLineSources:l})}const c=g({},d);let m=!1;for(const u of Object.keys(i))if(i[u]!==d[u]){for(const y of l)if(y.name===u){m=!0,c[u]=i[u];const x=n==null?void 0:n.getSource(`line:${y.name}`);if(x){const h=i[u];x.setData({type:"FeatureCollection",features:y.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:h==null?void 0:h.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))})}}}m&&t({internalSelections:c})}function Tn(e,t,{map:n,popup:a,internalPointSources:o,mapLoaded:r,internalSelections:d},{pointSources:l,selections:i}){var f;if(!n||!r)return;if(o!==l)if(console.log("Setting points in map!"),o){for(const u of o){const y=n.getSource(`point:${u.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${u.name}`);try{n.getLayer(`layer:point:${u.name}:labels`)&&n.removeLayer(`layer:point:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalPointSources:void 0})}else{for(const u of l){let y=n.getSource(`point:${u.name}`);const x=y===void 0;x&&(n.addSource(`point:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=n.getSource(`point:${u.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:u.points.map(h=>{var p;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:!((p=i[u.name])==null?void 0:p.includes(h.index)),label:h.label},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}})}),n.addLayer({id:`layer:point:${u.name}`,type:"circle",source:`point:${u.name}`,paint:{"circle-color":["case",["get","selected"],u.color,u.selectedColor],"circle-radius":u.radius}}),((f=u.points[0])==null?void 0:f.label)&&n.addLayer({id:`layer:point:${u.name}:labels`,type:"symbol",source:`point:${u.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),x&&(n.on("mouseenter",`layer:point:${u.name}`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"&&p.properties.description){const S=[...p.geometry.coordinates],{description:w}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(w).addTo(n)}}),n.on("mouseleave",`layer:point:${u.name}`,()=>{a.remove()}),n.on("click",`layer:point:${u.name}`,h=>{let p;if(e.state.internalPointSources)for(const w of e.state.internalPointSources)p=w.click;if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"){const{index:w}=S.properties;p(w)}}))}t({internalPointSources:l})}const c=g({},d);let m=!1;for(const u of Object.keys(i))if(i[u]!==d[u]){for(const y of l)if(y.name===u){m=!0,c[u]=i[u];const x=n.getSource(`point:${y.name}`);if(x){const h=i[u];x.setData({type:"FeatureCollection",features:y.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:!(h==null?void 0:h.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))})}}}m&&t({internalSelections:c})}function Wn(e,t,{map:n,internalPolygonSources:a,mapLoaded:o},{polygonSources:r,selections:d}){if(n&&o&&a!==r)if(a){for(const l of a){const i=n.getSource(`poly:${l.name}`);i!==void 0&&i.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${l.name}`),n.removeLayer(`layer:poly:${l.name}:fill`)}t({internalPolygonSources:void 0})}else{for(const l of r){let i=n.getSource(`poly:${l.name}`);i===void 0&&(n.addSource(`poly:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i=n.getSource(`poly:${l.name}`)),i!==void 0&&i.setData({type:"FeatureCollection",features:l.polygons.map(m=>{var f,u;return{type:"Feature",properties:{description:m.name||m.description?`<strong>${m.name}</strong><p>${m.description}</p>`:"",index:m.index,name:m.name,selected:(u=(f=d[l.name])==null?void 0:f.includes(m.index))!=null?u:!1},geometry:{type:"Polygon",coordinates:[m.polygon.map(y=>[y.lon,y.lat])]}}})}),n.addLayer({id:`layer:poly:${l.name}:fill`,type:"fill",source:`poly:${l.name}`,layout:{},paint:{"fill-color":l.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${l.name}`,type:"line",source:`poly:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.borderColor,"line-width":l.borderRadius}})}t({internalPolygonSources:r})}}Je.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Gn extends rn.Component{constructor(t){super(t);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:k.exports.createRef(),popup:new ke.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=t.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:t,style:n}=this.state,{initialPosition:a}=this.props,o=typeof t=="object"?t==null?void 0:t.current:void 0;if(Je.accessToken&&o){const r=new ke.exports.Map({container:o,style:n,center:a?a.center:[0,0],zoom:a?a.zoom:2});r.addControl(new ke.exports.NavigationControl),this.setState({map:r}),r.on("load",()=>{this.setState({mapLoaded:!0})}),r.on("click",({lngLat:d})=>{const{click:l}=this.props;l(Le([d.lng,d.lat]))}),r.on("mousemove",({lngLat:d})=>{const{mouseMove:l}=this.props;l&&l(Le([d.lng,d.lat]))}),r.on("moveend",()=>{const d=r.getZoom(),l=r.getCenter(),{mapMoved:i}=this.props;i&&i(d,l)}),r.on("draw.selectionchange",({features:d})=>{const{internalDrawnPointSource:l}=this.state;if(!l||!(l==null?void 0:l.select))return;const i=d.map(c=>c&&c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"?c.properties.index:-1).filter(c=>c>-1);l.select(i)}),r.on("draw.update",({features:d,action:l})=>{const{internalDrawnPointSource:i}=this.state;if(!!(i==null?void 0:i.update)&&l==="move"&&d.length>0)for(const c of d)c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"&&i.update(c.properties.index,Le(c.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:t}=this.props,{style:n,map:a}=this.state;return t&&t!==n&&(this.setState({style:t}),a==null||a.setStyle(t)),En(this,o=>this.setState(o),this.state,this.props),Wn(this,o=>this.setState(o),this.state,this.props),An(this,o=>this.setState(o),this.state,this.props),Rn(this,o=>this.setState(o),this.state,this.props),Tn(this,o=>this.setState(o),this.state,this.props),Bn(o=>this.setState(o),this.state,this.props),!1}render(){const{mapReference:t}=this.state;return s("div",{"data-testid":"map",className:"w-full h-full",ref:t})}}const ce={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},Kn=(()=>{var t;const e=g(g({},ce),JSON.parse((t=window.localStorage.getItem("mapSettings"))!=null?t:"{}"));return e.savedStyles=g(g({},e.savedStyles),ce.savedStyles),e})();function zn({settings:e,setSettings:t}){const[n,a]=k.exports.useState(""),[o,r]=k.exports.useState(""),[d,l]=k.exports.useState(""),i=c=>{t(c),window.localStorage.setItem("mapSettings",JSON.stringify(c))};return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Select Style"}),s("span",{className:"w-2/5 flex-shrink-0",children:b("select",{className:"bg-gray-800 w-full",value:e.currentStyleName,onChange:c=>{const m=c.target.value;if(m==="***CUSTOM")a(""),l(e.savedStyles.default.styleId),r(e.savedStyles.default.user),i(N(g({},e),{currentStyleName:"",currentStyle:e.savedStyles.default}));else{const f=e.savedStyles[m];a(m),l(f.styleId),r(f.user),i(N(g({},e),{currentStyleName:m,currentStyle:f}))}},children:[s("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(e.savedStyles).map(c=>s("option",{value:c,children:c},c))]})})]}),e.currentStyleName in ce.savedStyles?s(V,{}):b(V,{children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Style Name"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:c=>{a(c.target.value)}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in ce.savedStyles)&&i({currentStyle:{user:o,styleId:d},currentStyleName:n,savedStyles:N(g({},e.savedStyles),{[n]:{user:o,styleId:d}})})},children:"Save Style"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in e.savedStyles&&!(n in ce.savedStyles)){const c={};for(const m of Object.keys(e.savedStyles))m!==n&&(c[m]=e.savedStyles[m]);i({currentStyle:c.default,currentStyleName:"default",savedStyles:c})}},children:"Delete Style"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"User"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:o,onChange:c=>{r(c.target.value)}})}),s("span",{className:"text-l font-bold",children:"Style Id"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:d,onChange:c=>{l(c.target.value)}})})]}),b("div",{children:["Adding a custom mapbox style:",b("ul",{children:[b("li",{children:["If you are creating a new style, go to"," ",s("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),s("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const Jn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Vt;const Hn=g(g({},Jn),JSON.parse((Vt=window.localStorage.getItem("meshDisplaySettings"))!=null?Vt:"{}"));function Un({settings:e,setSettings:t,open:n,openMultiple:a}){const o=r=>{t(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))};return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{o(N(g({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Mesh"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>a(),children:"Open Meshes"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:r=>{o(N(g({},e),{color:r.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:r=>{o(N(g({},e),{width:Number.parseFloat(r.target.value)}))}})})]})]})}const pe=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","create_ribbon_mesh","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag","ss_rate_bound_flag","ss_rate_bound_min","ss_rate_bound_max","ds_rate_bound_flag","ds_rate_bound_min","ds_rate_bound_max","ts_rate_bound_flag","ts_rate_bound_min","ts_rate_bound_max"],je={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,create_ribbon_mesh:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:-1,patch_flag:0,patch_slip_file:0,patch_slip_flag:0,ss_rate_bound_flag:0,ss_rate_bound_min:-1,ss_rate_bound_max:1,ds_rate_bound_flag:0,ds_rate_bound_min:-1,ds_rate_bound_max:1,ts_rate_bound_flag:0,ts_rate_bound_min:-1,ts_rate_bound_max:1},qn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var It;const Qn=g(g({},qn),JSON.parse((It=window.localStorage.getItem("segmentDisplaySettings"))!=null?It:"{}")),Xn=["",...pe];function Zn({settings:e,setSettings:t,segments:n,selected:a,setSegmentData:o,addNewSegment:r,splitSegment:d,setSelectionMode:l,save:i,open:c}){const m=y=>{t(y),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(y))},f=a.map(y=>n[y]).filter(y=>y),u=f.length>0?s(te,{title:f.length===1?f[0].name:"Edit Selected Segments",items:f,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:y=>o(a,y),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>d(a),children:"Split Segment"})}):s(V,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{m(N(g({},e),{hide:!e.hide}))}})}),s("span",{className:"text-l font-bold flex-grow",children:"Projection"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hideProjection,onChange:()=>{m(N(g({},e),{hideProjection:!e.hideProjection}))}})})]}),b("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>i(),children:"Save Segments & Vertices"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{i(!0)},children:"Save As"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:y=>{m(N(g({},e),{color:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:y=>{m(N(g({},e),{width:Number.parseFloat(y.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:y=>{m(N(g({},e),{activeColor:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.activeWidth,onChange:y=>{m(N(g({},e),{activeWidth:Number.parseFloat(y.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Projection Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.projectionColor,onChange:y=>{m(N(g({},e),{projectionColor:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:y=>{m(N(g({},e),{plottableKey:y.currentTarget.value}))},children:Xn.map(y=>s("option",{value:y,children:y},y))})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Segment"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{l({mode:"mapClick",label:"Select Segment Starting Point",callback:y=>{l({mode:"mapClick",label:"Select Segment End point",callback:x=>{r(y,x),l("normal")}})}})},children:"New Segment"})]}),u]})}function Yn({selectionMode:e}){return e!=="normal"?s("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center pointer-events-none",children:b("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[s("span",{className:"text-lg font-semibold",children:e.mode==="lasso"?"lasso":e.label}),e.mode==="lasso"||e.subtitle?s("span",{className:"text-md font-thin text-gray-500",children:e.mode==="lasso"?"Press Enter to Select":e.subtitle}):s(V,{}),s("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):s(V,{})}const nt=()=>cn(),B=dn;function ea({folder:e,openFolder:t,filesOpen:n,saveFiles:a}){function o(){t()}const r=nt(),[d,l]=B(i=>[i.main.past.length>0,i.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[s("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[e?s("button",{type:"button",onClick:()=>{r(He.ActionCreators.undo())},"data-testid":"undo-button",disabled:!d,children:"Undo"}):s(V,{}),e?s("button",{type:"button",onClick:()=>{r(He.ActionCreators.redo())},disabled:!l,"data-testid":"undo-button",children:"Redo"}):s(V,{}),e?b("span",{children:["Working in ",e.name]}):s("button",{type:"button",onClick:o,"data-testid":"open-folder-button",children:"Open Folder"}),n?s("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Active Files"}):s(V,{})]})]})}const he=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],ta={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function na(e){return g(g({},ta),e)}const aa={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},oa=["",...he];var Mt;const sa=JSON.parse((Mt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Mt:"false")||aa;function la({settings:e,setSettings:t,selected:n,velocitys:a,setVelocityData:o,addNewVelocity:r,save:d,open:l}){const i=f=>{t(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},c=n.map(f=>a[f]).filter(f=>f),m=c.length>0?s(te,{title:c.length===1?c[0].name:"Edit Selected Velocities",items:c,deletable:!0,setItems:f=>o(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):s(V,{});return b(V,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{i(N(g({},e),{hide:!e.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Open Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:f=>{i(N(g({},e),{color:f.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:f=>{i(N(g({},e),{selectedColor:f.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Scale"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:e.scale,onChange:f=>{i(N(g({},e),{scale:Number.parseFloat(f.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:f=>{i(N(g({},e),{width:Number.parseFloat(f.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Arrow Head Size"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:e.arrowHead,onChange:f=>{i(N(g({},e),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:f=>{i(N(g({},e),{plottableKey:f.currentTarget.value}))},children:oa.map(f=>s("option",{value:f,children:f},f))})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Velocity"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),m]})}const ra={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Pt;const ia=g(g({},ra),JSON.parse((Pt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Pt:"{}"));function ca({settings:e,setSettings:t,vertices:n,selected:a,setVertexData:o,setSelectionMode:r,mergeVertices:d,bridgeVertices:l,extrudeVertex:i,save:c,open:m}){const f=x=>{t(x),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(x))},y=a.map(x=>({selectedVertex:n[x],index:x})).filter(x=>x.selectedVertex).map(({selectedVertex:x,index:h})=>s(te,{title:"Selected Vertex",items:[x],ignoreFields:[],deletable:!1,setItems:p=>o(h,g(g({},x),p)),fieldDefinitions:{},controls:b(V,{children:[s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:p=>{d(h,p[0]),r("normal")}})},children:"Merge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:p=>{l(h,p[0]),r("normal")}})},children:"Bridge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:p=>{i(h,p),r("normal")}})},children:"Extrude"})]})},h));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{f(N(g({},e),{hide:!e.hide}))}})}),b("span",{className:"w-2/5 flex-shrink flex flex-row justify-end gap-2",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>m(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Segments & Vertices"})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:x=>{f(N(g({},e),{color:x.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.radius,onChange:x=>{f(N(g({},e),{radius:Number.parseFloat(x.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:x=>{f(N(g({},e),{activeColor:x.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.activeRadius,onChange:x=>{f(N(g({},e),{activeRadius:Number.parseFloat(x.target.value)}))}})})]}),y]})}const da=e=>e.mode,ua=e=>e.setSelectedBlock,fa=e=>e.setSelectedSegment,ma=e=>e.setSelectedVelocity,pa=e=>e.setSelectedVertex,ha=e=>e.setActiveTab,ga=e=>e.setLassoSelection,at=un(da,ua,fa,ma,pa,ha,ga,(e,t,n,a,o,r,d)=>e==="normal"||e.mode==="lasso"?(l,i)=>{t(l==="block"?i:[]),n(l==="segment"?i:[]),a(l==="velocities"?i:[]),o(l==="vertex"?i:[]),e!=="normal"&&e.mode==="lasso"&&d(i),r(l)}:e.mode==="override"?(l,i)=>{l===e.type&&e.callback(i)}:()=>{}),ot=j("setRootFolder"),R=j("openFile"),ya=j("closeFile"),ba={rootFolder:void 0,files:{}},xa=ee(ba,e=>{e.addCase(ot,(t,n)=>({rootFolder:n.payload,files:{},fileOpenCallback:()=>{}})).addCase(R,(t,n)=>{const a=g({},t.files);return a[n.payload.key]={path:n.payload.path,file:n.payload.file},N(g({},t),{files:a})}).addCase(ya,(t,n)=>{const a={};return Object.keys(t.files).filter(o=>o!==n.payload).map(o=>(a[o]=t.files[o],!0)),N(g({},t),{files:a})})});function de(e){const t=e.split(/\n/g),n=t[0].split(",").map(r=>r.trim()),a=t.slice(1),o=[];for(const r of a)if(r.trim()!==""){const d=r.split(/\s*,\s*/),l={};for(let i=0;i<n.length;i+=1){let c=d[i];const m=n[i],f=Number.parseFloat(c);c=Number.isNaN(f)?c:f,typeof c=="string"&&(c=c.startsWith('"')&&c.endsWith('"')?c.slice(1,-1).trim():c.trim()),l[m]=c}o.push(l)}return o}function De(e,t){const n=[t.join(",")];for(const a of e){const o=a;n.push(t.map(r=>{if(r in o){const d=o[r];return typeof d=="string"&&/\s/.test(`${d}`)?`"${d.trim()}"`:`${typeof d=="number"&&(r.includes("lon")||r.includes("lat"))?d.toFixed(6):d}`}return""}).join(","))}return n.join(`
`)}function wa(e){return e.map(t=>{const n={};for(const a of Ce)n[a]=t[a]||(a==="name"?"":0);return n})}function Fe(e){return De(e,Ce)}async function st(e){return wa(de(await e.getContents()))}class va{constructor(t,n,a){D(this,"name");D(this,"path");D(this,"parent");this.name=t,this.parent=n,this.path=a!=null?a:[this.name]}async getContents(){const t=this.parent[this.name];if(typeof t!="string")throw new Error("No Such File");return t}async setContents(t){this.parent[this.name]=t}}class Ve{constructor(t,n,a){D(this,"name");D(this,"path");D(this,"parent");D(this,"fileList");D(this,"folderList");this.name=t,this.parent=n,this.fileList=[],this.folderList=[],this.path=a!=null?a:[this.name];const o=n[t];for(const r of Object.keys(o))typeof o[r]=="string"?this.fileList.push(r):this.folderList.push(r)}async getFile(t){return new va(t,this.parent[this.name],[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("No Such Directory");return new Ve(t,this.parent[this.name],[...this.path,t])}}const _a=async e=>new Ve("root",e);let lt=async()=>{var t;return _a((t=window.FakeDirectory)!=null?t:{})};function Na(e){lt=e}async function Sa(){return lt()}async function rt(e,t,n){const a=t.split("/");let o=[...e.path];"getContents"in e&&o.pop();for(const i of a)if(i===".."){if(o.length===0)return!1;o.pop()}else i!==""&&i!=="."&&o.push(i);if(o.length<2)return!1;const r=o.pop();if(!r)return!1;o=o.slice(1);let d=n;for(const i of o)d=await d.getDirectory(i);return await d.getFile(r)}async function ge(e,t,n){const a=t.replace("../","").replace("./","").replace("data/","../");return rt(e,a,n)}function ye(e){return`../data/${e.path.slice(-2).join("/")}`}function ka(e,t){if(e.length===0||t.length===0)return[];const n=Ue(e.map(r=>fn([r.point.lon,r.point.lat],{index:r.id}))),a=Ue([mn([[...t,t[0]].map(r=>[r.lon,r.lat])])]);return pn(n,a).features.map(r=>{var d;return(d=r.properties.index)!=null?d:-1}).filter(r=>r>=0)}function Ca(e){const t=e.map(d=>{const l={};for(const i of pe)l[i]=d[i]||(i==="name"?"":0);return l}).filter(d=>{for(const l of pe)if(!(l in d))return!1;return!0}),n={},a={},o=[];let r=0;for(const d of t){const[l,i]=se({lon:d.lon1,lat:d.lat1},n,a,r),[c,m]=se({lon:d.lon2,lat:d.lat2},n,a,i),f=N(g({},d),{start:l,end:c});r=m,o.push(f)}return{vertecies:a,vertexDictionary:n,segments:o,lastIndex:r}}function be({vertecies:e,segments:t}){const n=t.map(a=>{const o=e[a.start],r=e[a.end];return N(g({},a),{lon1:o.lon,lat1:o.lat,lon2:r.lon,lat2:r.lat})});return De(n,pe)}async function Ie(e){const t=await e.getContents();return Ca(de(t))}function La(e){return e.map(t=>{const n={};for(const a of he)n[a]=t[a]||(a==="name"?"":0);return n}).filter(t=>{for(const n of he)if(!(n in t))return!1;return!0})}function Me(e){return De(e,he)}async function it(e){const t=await e.getContents();return La(de(t))}function $a({command:e,save:t,open:n,setCommandData:a}){return b(V,{children:[s("div",{className:"flex flex-col gap-2",children:b("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Command File"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>t(),children:"Save Command File"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{t(!0)},children:"Save As"})]})}),s(te,{title:e.file_name,items:[e],deletable:!1,setItems:o=>o&&a(o),fieldDefinitions:{},ignoreFields:["segment_file_name","station_file_name","block_file_name","mesh_parameters_file_name","file_name"]})]})}function ja(e,{data:t}){return[...e,Sn(t)]}function Da(e,t){const n=[];for(const[a,o]of e.entries())t.includes(a)||n.push(o);return n}function Fa(e,t){const n=[...e];for(const a of t.indices){const o=g(g({},n[a]),t.data);n[a]=o}return n}function Va(e,t){return t}function Ia(e,{index:t,position:n}){const a=[...e],o=g({},a[t]);return o.interior_lat=n.lat,o.interior_lon=n.lon,a[t]=o,a}const Ma=[],ct=j("createBlock"),dt=j("editBlock"),ut=j("deleteBlock"),Pe=j("loadNewBlockData"),ft=j("moveBlock"),Pa=ee(Ma,e=>{e.addCase(ct,(t,n)=>ja(t,n.payload)).addCase(dt,(t,n)=>Fa(t,n.payload)).addCase(ut,(t,n)=>Da(t,n.payload)).addCase(Pe,(t,n)=>Va(t,n.payload)).addCase(ft,(t,n)=>Ia(t,n.payload))}),xe={file_name:"Default Command",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""},Oa=Object.keys(xe),Ra=g({},xe),mt=j("loadNewCommandData"),Ba=j("newCommandFile"),Oe=j("editCommandData"),Ea=ee(Ra,e=>{e.addCase(mt,(t,n)=>n.payload).addCase(Ba,()=>g({},xe)).addCase(Oe,(t,n)=>g(g({},t),n.payload))});function Aa(e,t){return N(g({},e),{[t.name]:{name:t.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:t.data}})}function Ta(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}function Wa(e,t){const n=e[t.collection];if(!n)return e;const a=N(g({},n),{startLon:t.startLon,startLat:t.startLat,endLon:t.endLon,endLat:t.endLat,plot:t.plot});return N(g({},e),{[t.collection]:a})}const Ga={},pt=j("loadNewGenericCollectionData"),ht=j("setGenericSegmentPositionKeys"),Ka=j("removeGenericSegmentCollection"),za=ee(Ga,e=>e.addCase(pt,(t,n)=>Aa(t,n.payload)).addCase(ht,(t,n)=>Wa(t,n.payload)).addCase(Ka,(t,n)=>Ta(t,n.payload))),Ja={mesh_filename:"",smoothing_weight:1e7,edge_constraints:[0,1,0],n_eigenvalues:20,a_priori_slip_filename:""};function Ha(e,t){var n;return N(g({},e),{[t.mesh]:{parameters:(n=t.parameters)!=null?n:Ja,line:t.data}})}function Ua(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}const gt={},we=j("loadMeshLineData"),qa=j("removeMesh"),Re=j("clearMeshes"),Qa=ee(gt,e=>e.addCase(we,(t,n)=>Ha(t,n.payload)).addCase(qa,(t,n)=>Ua(t,n.payload)).addCase(Re,()=>gt));function Xa(e,{a:t,b:n}){const a=N(g({},je),{start:t,end:n}),o=[...e.segments,a];return N(g({},e),{segments:o})}function Za(e,t){const n=g({},e.vertecies),a=g({},e.vertexDictionary),{lastIndex:o}=e,[r,d]=se(t.start,a,n,o),[l,i]=se(t.end,a,n,d),c=N(g(g({},je),t),{start:r,end:l}),m=[...e.segments,c];return{vertecies:n,vertexDictionary:a,segments:m,lastIndex:i}}function Ya(e,t){const n=[],a=[];let o=g({},e);for(const[r,d]of e.segments.entries())t.index.includes(r)?a.push(d):n.push(d);o.segments=n;for(const r of a)o=tt(tt(o,r.start),r.end);return o}function eo(e,t){const n=[...e.segments];for(const a of t.indices){const o=g(g({},n[a]),t.data);n[a]=o}return N(g({},e),{segments:n})}function to(e,t){const n=g({},e.vertecies),a=g({},e.vertexDictionary),[o,r]=se(t.targetPoint,a,n,e.lastIndex),d=N(g({},je),{start:t.index,end:o}),l=[...e.segments,d];return{vertecies:n,vertexDictionary:a,segments:l,lastIndex:r}}function no(e,t){return t}function ao(e,{a:t,b:n}){if(t===n)return e;const a=e.segments.map(i=>{let c=i;return c.start===n&&(c=N(g({},c),{start:t})),c.end===n&&(c=N(g({},c),{end:t})),c}).filter(i=>i.start!==i.end),o=e.vertecies[n],r=`${Math.floor(o.lon*z)},${Math.floor(o.lat*z)}`,d=g({},e.vertecies);delete d[n];const l=g({},e.vertexDictionary);return delete l[r],N(g({},e),{vertecies:d,vertexDictionary:l,segments:a})}function oo(e,{index:t,vertex:n}){const a=g({},e.vertecies),o=g({},e.vertexDictionary),r=[...e.segments],d=a[t],l=`${Math.floor(n.lon*z)},${Math.floor(n.lat*z)}`,i=`${Math.floor(d.lon*z)},${Math.floor(d.lat*z)}`;if(delete o[i],l in o){const c=o[l];for(const m of r)m.start===c&&(m.start=t),m.end===c&&(m.end=t);delete a[c]}return a[t]=n,N(g({},e),{segments:r,vertecies:a,vertexDictionary:o})}function so(e,t){const n=g({},e.vertecies),a=g({},e.vertexDictionary),o=[...e.segments];let{lastIndex:r}=e;for(const d of t){const l=e.segments[d],i=e.vertecies[l.start],c=e.vertecies[l.end],m={lon:(i.lon+c.lon)/2,lat:(i.lat+c.lat)/2},[f,u]=se(m,a,n,r);r=u;const y=N(g({},l),{end:f,name:`${l.name}_a`}),x=N(g({},l),{start:f,name:`${l.name}_b`});o[d]=y,o.push(x)}return{vertecies:n,vertexDictionary:a,segments:o,lastIndex:r}}const lo={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},yt=j("bridgeVertices"),bt=j("createSegmet"),xt=j("deleteSegment"),wt=j("editSegmentData"),vt=j("extrudeSegment"),ve=j("loadNewSegmentData"),_t=j("mergeVertices"),Be=j("moveVertex"),Nt=j("splitSegment");function ro(e,t,n){if(n.dip===90||n.locking_depth<=0)return!1;const a=n.dip<90,r=(a?90-n.dip:n.dip-90)*(Math.PI/180),d=Math.abs(Math.tan(r)*n.locking_depth),[l,i]=e.lon>=t.lon?[e,t]:[t,e],c={lon:i.lat-l.lat,lat:-(i.lon-l.lon)};a&&(c.lon*=-1,c.lat*=-1);const m=qe(Qe([[l.lon,l.lat],[l.lon+c.lon,l.lat+c.lat]]),d,{units:"kilometers"}),f=qe(Qe([[i.lon,i.lat],[i.lon+c.lon,i.lat+c.lat]]),d,{units:"kilometers"});return[l,{lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1]},{lon:f.geometry.coordinates[0],lat:f.geometry.coordinates[1]},i]}function io(e){return e.segments.map(t=>ro(e.vertecies[t.start],e.vertecies[t.end],t)).filter(t=>t)}const co=ee(lo,e=>{e.addCase(yt,(t,n)=>Xa(t,n.payload)).addCase(bt,(t,n)=>Za(t,n.payload)).addCase(xt,(t,n)=>Ya(t,n.payload)).addCase(wt,(t,n)=>eo(t,n.payload)).addCase(vt,(t,n)=>to(t,n.payload)).addCase(ve,(t,n)=>no(t,n.payload)).addCase(_t,(t,n)=>ao(t,n.payload)).addCase(Be,(t,n)=>oo(t,n.payload)).addCase(Nt,(t,n)=>so(t,n.payload))});function uo(e,{data:t}){return[...e,na(t)]}function fo(e,t){const n=[];for(const[a,o]of e.entries())t.includes(a)||n.push(o);return n}function mo(e,t){const n=[...e];for(const a of t.indices){const o=g(g({},n[a]),t.data);n[a]=o}return n}function po(e,t){return t}function ho(e,{index:t,position:n}){const a=[...e],o=g(g({},a[t]),n);return a[t]=o,a}const go=[],St=j("createVelocity"),kt=j("editVelocity"),Ct=j("deleteVelocity"),Ee=j("loadNewVelocityData"),Lt=j("moveVelocity"),yo=ee(go,e=>{e.addCase(St,(t,n)=>uo(t,n.payload)).addCase(kt,(t,n)=>mo(t,n.payload)).addCase(Ct,(t,n)=>fo(t,n.payload)).addCase(Ee,(t,n)=>po(t,n.payload)).addCase(Lt,(t,n)=>ho(t,n.payload))});function bo(e){const t=g({},xe);for(const n of Oa)n in e&&(t[n]=e[n]);return t}function xo(e){const t=JSON.parse(e);return bo(t)}class wo{constructor(t){D(this,"data");D(this,"handle");this.handle=t,this.data=void 0}async initialize(){const t=await this.handle.getContents(),n=de(t);this.data=n}async save(){}}function vo(e){const n=[...e.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const o=Number.parseFloat(a[1]),r=Number.parseFloat(a[2]);return{lon:o,lat:r}});return n.splice(0,0,{lon:0,lat:0}),n}const _o={"1":e=>{var a,o;const t=Number.parseInt((a=e[e.length-2])!=null?a:"",10),n=Number.parseInt((o=e[e.length-1])!=null?o:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)?[[t,n]]:!1},"2":e=>{var o,r,d;const t=Number.parseInt((o=e[e.length-3])!=null?o:"",10),n=Number.parseInt((r=e[e.length-2])!=null?r:"",10),a=Number.parseInt((d=e[e.length-1])!=null?d:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)&&!Number.isNaN(a)?[[t,n],[n,a],[a,t]]:!1}};function No(e){return e.split(/\n/).map(t=>t.trim()).map(t=>t.split(/\s+/)).filter(t=>t.length>2).map(t=>{var a;return((a=_o[t[1]])!=null?a:()=>!1)(t)}).filter(t=>t).flat()}function So(e,t){return t.map(([n,a])=>n!==a&&n>-1&&n<e.length&&a>-1&&a<e.length?[e[n],e[a]]:!1).filter(n=>n)}function ko(e){if(!e.startsWith("$"))return[];const t=e.split("$");let n=[],a=[];for(const o of t)o.startsWith("Nodes")?n=vo(o):o.startsWith("Elements")&&(a=No(o));return So(n,a)}class $t{constructor(t){D(this,"data");D(this,"handle");D(this,"startLonColumn");D(this,"endLonColumn");D(this,"startLatColumn");D(this,"endLatColumn");this.handle=t,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const t=await this.handle.getContents();if(t.startsWith("$"))this.data=ko(t);else{const n=de(t);this.data=n.map(a=>{const o={lon:0,lat:0},r={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(o.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(o.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(r.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(r.lat=a[this.endLatColumn]);const d=Object.keys(a).filter(l=>l!==this.startLatColumn&&l!==this.endLatColumn&&l!==this.startLonColumn&&l!==this.endLonColumn);if(d.length>0){const l={};for(const i of d)l[i]=a[i];return[o,r]}return[o,r]})}}async save(){console.log("Mesh files do not get saved")}}async function Co(e){const t=new $t(e);return await t.initialize(),t}async function jt(e,t){const n=await e.getContents(),a=JSON.parse(n);return Array.isArray(a)?(await Promise.all(a.map(async r=>{const d=r.mesh_filename.split("/"),l=await rt(e,d[d.length-1],t);if(!l)return!1;const i=await Co(l);return i.data?{line:i.data,parameters:r}:!1}))).filter(r=>!!r):[]}async function Lo(e,t){const n=xo(await t.getContents()),a={commands:t,segments:!1,blocks:!1,velocities:!1,mesh:!1};return console.log("Opened command file",n),console.log("Current File",t),console.log("Root",e),n.segment_file_name&&(a.segments=await ge(t,n.segment_file_name,e)),n.block_file_name&&(a.blocks=await ge(t,n.block_file_name,e)),n.station_file_name&&(a.velocities=await ge(t,n.station_file_name,e)),n.mesh_parameters_file_name&&(a.mesh=await ge(t,n.mesh_parameters_file_name,e)),{command:n,files:a}}function $o({view:e,buttons:t,active:n,setActive:a}){if(!t)return s("span",{});const o=[];for(const r of Object.keys(t)){const d=t[r],l=r===n;o.push(s("button",{type:"button","data-testid":`tab-${r}`,className:`${l?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(l?"":r),children:d},r))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?s("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:e}):"",s("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:o})]})}const jo={command:"Command",segment:"Segment",vertex:"Vertices",block:"Block",velocities:"Velocities",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function Do({activeTab:e,setActiveTab:t,setFileOpenCallback:n,dispatch:a,velocitiesSettings:o,setVelocitiesSettings:r,selectedVelocity:d,velocities:l,select:i,setSelectionMode:c,velocityFile:m,blockSettings:f,setBlockSettings:u,selectedBlock:y,blocks:x,blockFile:h,segmentSettings:p,setSegmentSettings:S,segments:w,selectedSegment:L,segmentFile:I,vertexSettings:M,setVertexSettings:ne,selectedVertex:O,folderHandle:J,meshLineSettings:Q,setMeshLineSettings:ue,genericSegmentSettings:X,setGenericSegmentSettings:fe,genericSegments:Y,mapSettings:_e,setMapSettings:F,command:H,meshParametersFile:G,commandFile:me}){var le,re;let E=s("span",{});switch(e){case"velocities":E=s(la,{open:()=>{console.log("opening velocities file"),n({extension:"csv",callback:async v=>{const _=await it(v);a(Ee(_)),a(R({file:v,key:"velocity",path:v.path}))}})},settings:o,setSettings:r,selected:d,velocitys:l,setVelocityData:(v,_)=>{_?a(kt({indices:v,data:_})):(a(Ct(v)),i.select("velocity",[]))},addNewVelocity:()=>{c({label:"Click to place velocity estimate",mode:"mapClick",callback:v=>{c("normal");const _=l.length;a(St({data:{lat:v.lat,lon:v.lon}})),i.select("velocity",[_])}})},save:async v=>{v?n({extension:".csv",isSaveFile:!0,callback:async _=>{a(R({file:_,key:"velocity",path:_.path})),await _.setContents(Me(l))}}):m&&await m.file.setContents(Me(l))}});break;case"block":E=s(jn,{open:()=>{console.log("opening block file"),n({extension:"csv",callback:async v=>{const _=await st(v);a(Pe(_)),a(R({file:v,key:"block",path:v.path}))}})},settings:f,setSettings:u,selected:y,blocks:x,addNewBlock:()=>{c({label:"Click to place new block",mode:"mapClick",callback:v=>{const _=x.length;a(ct({data:{name:"New Block",interior_lon:v.lon,interior_lat:v.lat}})),i.select("block",[_]),c("normal")}})},setBlockData:(v,_)=>{_?a(dt({indices:y,data:_})):(a(ut(v)),i.select("block",[]))},save:async v=>{v?n({extension:".csv",isSaveFile:!0,callback:async _=>{a(R({file:_,key:"block",path:_.path})),await _.setContents(Fe(x))}}):h&&await h.file.setContents(Fe(x))}});break;case"segment":E=s(Zn,{open:()=>{console.log("opening segment file"),n({extension:"csv",callback:async v=>{const _=await Ie(v);a(ve(_)),a(R({file:v,key:"segment",path:v.path}))}})},settings:p,setSettings:S,segments:(le=w.segments)!=null?le:[],selected:L,setSelectionMode:v=>c(v),addNewSegment:(v,_)=>{const $=w.segments.length;a(bt({start:v,end:_})),i.select("segment",[$])},setSegmentData:(v,_)=>{a(_?wt({indices:v,data:_}):xt({index:v}))},splitSegment:v=>{a(Nt(v)),i.select("segment",[])},save:async v=>{v?n({extension:".csv",isSaveFile:!0,callback:async _=>{a(R({file:_,key:"segment",path:_.path})),await _.setContents(be(w))}}):I&&await I.file.setContents(be(w))}});break;case"vertex":E=s(ca,{open:()=>{console.log("opening segment file"),n({extension:"csv",callback:async v=>{const _=await Ie(v);a(ve(_)),a(R({file:v,key:"segment",path:v.path}))}})},settings:M,setSettings:ne,vertices:(re=w.vertecies)!=null?re:{},selected:O,setVertexData:(v,_)=>{_&&a(Be({index:v,vertex:_}))},setSelectionMode:v=>c(v),mergeVertices:(v,_)=>{a(_t({a:v,b:_}))},bridgeVertices:(v,_)=>{a(yt({a:v,b:_}))},extrudeVertex:(v,_)=>{a(vt({index:v,targetPoint:_}))},save:async()=>{I&&await I.file.setContents(be(w))}});break;case"mesh":E=s(Un,{open:()=>{console.log("opening mesh file"),n({extension:"msh",callback:async v=>{const _=new $t(v);await _.initialize(),_.data&&a(we({mesh:v.name,data:_.data}))}})},openMultiple:()=>{console.log("opening mesh file"),n({extension:"json",callback:async v=>{if(J){a(Re());const _=await jt(v,J);a(R({file:v,key:"mesh_params",path:v.path}));for(const $ of _)a(we({mesh:$.parameters.mesh_filename,parameters:$.parameters,data:$.line}))}}})},settings:Q,setSettings:ue});break;case"csv":E=s(Pn,{open:()=>{console.log("opening generic segment file"),n({extension:"csv",callback:async v=>{const _=new wo(v);await _.initialize(),_.data&&a(pt({name:v.name,data:_.data}))}})},settings:X,setSettings:fe,setCollectionVertexKeys:v=>{a(ht(v))},collections:Y});break;case"map":E=s(zn,{settings:_e,setSettings:F});break;case"command":E=s($a,{command:H,setCommandData:v=>{a(Oe(v))},open:()=>{console.log("opening command file"),n({extension:"json",callback:async v=>{if(J){const{command:_,files:$}=await Lo(J,v);if(a(mt(_)),a(R({file:v,key:"command",path:v.path})),$.blocks){const K=await st($.blocks);a(Pe(K)),a(R({file:$.blocks,key:"block",path:$.blocks.path}))}if($.segments){const K=await Ie($.segments);a(ve(K)),a(R({file:$.segments,key:"segment",path:$.segments.path}))}if($.velocities){const K=await it($.velocities);a(Ee(K)),a(R({file:$.velocities,key:"velocity",path:$.velocities.path}))}if($.mesh&&J){a(Re());const K=await jt($.mesh,J);a(R({file:$.mesh,key:"mesh_params",path:$.mesh.path}));for(const ae of K)a(we({mesh:ae.parameters.mesh_filename,parameters:ae.parameters,data:ae.line}))}}}})},save:async v=>{const _=g({},H);I&&(_.segment_file_name=ye(I.file)),h&&(_.block_file_name=ye(h.file)),m&&(_.station_file_name=ye(m.file)),G&&(_.mesh_parameters_file_name=ye(G.file)),v?n({extension:".json",isSaveFile:!0,callback:async $=>{a(R({file:$,key:"command",path:$.path})),a(Oe({file_name:$.name})),_.file_name=$.name,await $.setContents(JSON.stringify(_))}}):me&&await me.file.setContents(JSON.stringify(_))}});break}return s($o,{view:E,buttons:jo,active:e,setActive:v=>t(v)})}function Fo({velocitiesSettings:e,setArrowSources:t,velocities:n,select:a}){e.hide?t([]):t([{name:"velocities",color:e.color,selectedColor:e.selectedColor,scale:e.scale,arrowHeadScale:e.arrowHead,width:e.width,arrows:n.map((o,r)=>{const d=Math.sqrt(o.east_vel*o.east_vel+o.north_vel*o.north_vel);return{longitude:o.lon,latitude:o.lat,direction:[o.east_vel/d,o.north_vel/d],scale:d,name:o.name,description:`north: ${o.north_vel}, east: ${o.east_vel}`,index:r,label:e.plottableKey in o?`${o[e.plottableKey]}`:""}}),click:o=>{a.select("velocities",[o])}}])}function Vo({editMode:e,setDrawnPointSource:t,vertexSettings:n,segments:a,dispatch:o,select:r,blockSettings:d,blocks:l,velocitiesSettings:i,velocities:c}){switch(e){case P.Segments:case P.Vertex:{t({color:n.color,radius:n.radius,selectedColor:n.activeColor,selectedRadius:n.activeRadius,points:n.hide?[]:Object.keys(a.vertecies).map(m=>{const f=Number.parseInt(m,10),u=a.vertecies[f];return u?{longitude:u.lon,latitude:u.lat,index:f}:!1}).filter(m=>!!m),update:(m,f)=>{o(Be({index:m,vertex:f}))},select:m=>{r.select("vertex",m)}});break}case P.Block:{t({color:d.color,radius:d.radius,selectedColor:d.selectedColor,selectedRadius:d.radius,points:d.hide?[]:l.map((m,f)=>({longitude:m.interior_lon,latitude:m.interior_lat,name:m.name,description:"",index:f,label:d.plottableKey in m?`${m[d.plottableKey]}`:""})),update:(m,f)=>{o(ft({index:m,position:f}))},select:m=>{r.select("block",m)}});break}case P.Velocity:{t({color:i.color,radius:i.width,selectedColor:i.selectedColor,selectedRadius:i.width,points:i.hide?[]:c.map((m,f)=>({longitude:m.lon,latitude:m.lat,name:m.name,description:"",index:f})),update:(m,f)=>{o(Lt({index:m,position:f}))},select:m=>{r.select("velocities",m)}});break}}}function Io({segmentSettings:e,segments:t,select:n,meshLineSettings:a,meshLines:o,genericSegmentSettings:r,genericSegments:d,setLineSources:l}){const i=[];if(e.hide||i.push({name:"segments",color:e.color,selectedColor:e.activeColor,width:e.width,selectedWidth:e.activeWidth,lines:t.segments.map((c,m)=>{var S,w;const f=(S=t.vertecies[c.start])!=null?S:Ye,u=(w=t.vertecies[c.end])!=null?w:Ye,[[y,x],[h,p]]=$e(f,u);return{startLongitude:y,startLatitude:x,endLongitude:h,endLatitude:p,name:c.name,description:`${f.lon},${f.lat} to ${u.lon},${u.lat}`,index:m,label:e.plottableKey in c?`${c[e.plottableKey]}`:""}}),click:c=>{n.select("segment",[c])}}),!a.hide)for(const c of Object.keys(o)){const m=o[c].line;i.push({name:`mesh:${c}`,color:a.color,selectedColor:a.activeColor,width:a.width,selectedWidth:a.activeWidth,lines:m.map((f,u)=>{const y=f[0],x=f[1],[[h,p],[S,w]]=$e(y,x);return{startLongitude:h,startLatitude:p,endLongitude:S,endLatitude:w,name:"",description:"",index:u}})||[]})}if(!r.hide)for(const c of Object.keys(d)){const{startLat:m,startLon:f,endLat:u,endLon:y,plot:x,segments:h}=d[c];m in h[0]&&u in h[0]&&f in h[0]&&y in h[0]&&i.push({name:`generic_segment:${c}`,color:r.color,selectedColor:r.activeColor,width:r.width,selectedWidth:r.activeWidth,lines:h.map((p,S)=>{const w={lat:p[m],lon:p[f]},L={lat:p[u],lon:p[y]};if(typeof w.lat!="number"||typeof w.lon!="number"||typeof L.lat!="number"||typeof L.lon!="number")return!1;const[[I,M],[ne,O]]=$e(w,L);return{startLongitude:I,startLatitude:M,endLongitude:ne,endLatitude:O,name:"",description:"",index:S,label:x&&x in p?`${p[x]}`:""}}).filter(p=>p)||[]})}l(i)}function Mo({editMode:e,blockSettings:t,blocks:n,select:a,vertexSettings:o,segments:r,selectionMode:d,setPointSources:l}){const i=[];e!==P.Block&&!t.hide&&i.push({name:"blocks",color:t.color,selectedColor:t.selectedColor,radius:t.radius,points:n.map((c,m)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:m,label:t.plottableKey in c?`${c[t.plottableKey]}`:""})),click:c=>{a.select("block",[c])}}),e!==P.Vertex&&!o.hide&&i.push({name:"vertices",color:o.color,selectedColor:o.activeColor,radius:o.radius,click:c=>{a.select("vertex",[c])},points:Object.keys(r.vertecies).map(c=>{const m=Number.parseInt(c,10),f=r.vertecies[m];return f?{longitude:f.lon,latitude:f.lat,index:m,name:"",description:""}:!1}).filter(c=>!!c)}),d!=="normal"&&d.mode==="lasso"&&i.push({name:"selection",color:"#fff",selectedColor:"#fff",radius:1.5,points:d.polygon.map((c,m)=>({longitude:c.lon,latitude:c.lat,name:"",description:"",index:m}))}),l(i)}function Po(e,t,n,a){const o=[];e!=="normal"&&e.mode==="lasso"&&o.push({name:"selection_polygon",color:"#ffffff",borderColor:"#ffffff",borderRadius:.5,polygons:[{polygon:e.polygon,index:0,name:"",description:""}]}),!t.hideProjection&&!t.hide&&o.push({name:"fault_dip_projections",color:t.projectionColor,borderColor:t.projectionColor,borderRadius:.5,polygons:io(n).map((r,d)=>({polygon:r,index:d,name:"",description:""}))}),a(o)}function Oo(){const e=nt(),t=B(C=>C.main.present.fileHandles.rootFolder),[n,a]=k.exports.useState(!1),[o,r]=k.exports.useState("command"),d=B(C=>C.main.present.fileHandles.files.segment),l=B(C=>C.main.present.fileHandles.files.block),i=B(C=>C.main.present.fileHandles.files.velocity),c=B(C=>C.main.present.fileHandles.files.command),m=B(C=>C.main.present.fileHandles.files.mesh_params),f=B(C=>C.main.present.segment),u=B(C=>C.main.present.block),y=B(C=>C.main.present.velocity),x=B(C=>C.main.present.meshLine),h=B(C=>C.main.present.genericSegments),p=B(C=>C.main.present.command),[S,w]=k.exports.useState(sa),[L,I]=k.exports.useState($n),[M,ne]=k.exports.useState(Qn),[O,J]=k.exports.useState(ia),[Q,ue]=k.exports.useState(Hn),[X,fe]=k.exports.useState(Mn),[Y,_e]=k.exports.useState(Kn),[F,H]=k.exports.useState("normal"),[G,me]=k.exports.useState(P.Vertex),[E,le]=k.exports.useState([]),[re,v]=k.exports.useState([]),[_,$]=k.exports.useState([]),[K,ae]=k.exports.useState([]),[Ot,Te]=k.exports.useState([]),[A,Go]=k.exports.useState({select:at({mode:F,setSelectedBlock:le,setSelectedSegment:v,setSelectedVelocity:$,setSelectedVertex:ae,setActiveTab:r,setLassoSelection:Te})}),[Rt,Bt]=k.exports.useState([]),[Et,At]=k.exports.useState([]),[Tt,Wt]=k.exports.useState([]),[Gt,Kt]=k.exports.useState([]),[zt,Jt]=k.exports.useState({color:O.color,selectedColor:O.activeColor,radius:O.radius,selectedRadius:O.activeRadius,points:[]}),[Ht,Ut]=k.exports.useState({lon:0,lat:0}),[Ne,qt]=k.exports.useState(!1),[Qt,Xt]=k.exports.useState();k.exports.useEffect(()=>{A.select=at({mode:F,setSelectedBlock:le,setSelectedSegment:v,setSelectedVelocity:$,setSelectedVertex:ae,setActiveTab:r,setLassoSelection:Te})},[F,A]),k.exports.useEffect(()=>{Mo({editMode:G,blockSettings:L,blocks:u,select:A,vertexSettings:O,segments:f,selectionMode:F,setPointSources:Bt})},[L,u,M,A,G,O,f,F]),k.exports.useEffect(()=>{Io({segmentSettings:M,segments:f,select:A,meshLineSettings:Q,meshLines:x,genericSegmentSettings:X,genericSegments:h,setLineSources:Wt})},[f,M,X,h,Q,x,A]),k.exports.useEffect(()=>{Vo({editMode:G,setDrawnPointSource:Jt,vertexSettings:O,segments:f,dispatch:e,select:A,blockSettings:L,blocks:u,velocitiesSettings:S,velocities:y})},[L,u,e,G,f,A,y,S,O]),k.exports.useEffect(()=>{Fo({velocitiesSettings:S,setArrowSources:At,velocities:y,select:A})},[A,S,y]),k.exports.useEffect(()=>{Po(F,M,f,Kt)},[M,f,F]);const Zt={Block:{state:L.hide,change:()=>{I(N(g({},L),{hide:!L.hide}))}},Vertex:{state:O.hide,change:()=>{J(N(g({},O),{hide:!O.hide}))}},Velocity:{state:S.hide,change:()=>{w(N(g({},S),{hide:!S.hide}))}},Segment:{state:M.hide,change:()=>{ne(N(g({},M),{hide:!M.hide}))}},Grid:{state:!Ne,change:()=>{qt(!Ne)}},Mesh:{state:Q.hide,change:()=>{ue(N(g({},Q),{hide:!Q.hide}))}},GenericSegments:{state:X.hide,change:()=>{fe(N(g({},X),{hide:!X.hide}))}}};return b("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:C=>{if(C.key==="Escape")H("normal");else if(C.key==="Enter"&&F!=="normal"&&F.mode==="lasso"){if(F.polygon.length>2){let U=[];const We=G;switch(We){case P.Block:U=u.map((T,ie)=>({point:{lon:T.interior_lon,lat:T.interior_lat},id:ie}));break;case P.Velocity:U=y.map((T,ie)=>({point:{lon:T.lon,lat:T.lat},id:ie}));break;case P.Vertex:U=Object.keys(f.vertecies).map(T=>({point:f.vertecies[T],id:T}));break;case P.Segments:U=f.segments.map((T,ie)=>{const Ge=f.vertecies[T.start],Ke=f.vertecies[T.end];return{point:{lon:(Ge.lon+Ke.lon)/2,lat:(Ge.lat+Ke.lat)/2},id:ie}});break;default:H("normal");return}const{polygon:Yt}=F,en=ka(U,Yt);A.select(We,en)}H("normal")}},children:[s(ea,{filesOpen:t!==void 0,saveFiles:async()=>{d&&await d.file.setContents(be(f)),l&&await l.file.setContents(Fe(u)),i&&await i.file.setContents(Me(y))},folder:t,openFolder:async()=>{const C=await Sa();e(ot(C)),r("command")}}),s(Yn,{selectionMode:F}),s(Dn,{selectionMode:F,setSelectionMode:H,hoverPoint:Ht,editMode:G,setEditMode:me,hiddenState:Zt}),s(Gn,{pointSources:Rt,arrowSources:Et,lineSources:Tt,drawnPointSource:zt,polygonSources:Gt,selections:{segments:re,blocks:E,velocities:_,vertices:K,draw:G===P.Segments?void 0:Ot},displayGrid:Ne?10:-1,click:C=>{typeof F!="string"&&F.mode==="mapClick"?F.callback(C):typeof F!="string"&&F.mode==="lasso"&&H({mode:"lasso",polygon:[...F.polygon,C]})},mouseMove:C=>{Ut(C)},styleUri:`mapbox://styles/${Y.currentStyle.user}/${Y.currentStyle.styleId}`,mapMoved:(C,U)=>Xt({zoom:C,center:U}),initialPosition:Qt},`${Y.currentStyle.user}:${Y.currentStyle.styleId}`),t?s(Do,{activeTab:o,setActiveTab:C=>r(C),setFileOpenCallback:a,dispatch:e,velocitiesSettings:S,setVelocitiesSettings:w,selectedVelocity:_,velocities:y,select:A,setSelectionMode:H,velocityFile:i,blockSettings:L,setBlockSettings:I,selectedBlock:E,blocks:u,blockFile:l,segmentSettings:M,setSegmentSettings:ne,segments:f,selectedSegment:re,segmentFile:d,vertexSettings:O,setVertexSettings:J,selectedVertex:K,folderHandle:t,meshLineSettings:Q,setMeshLineSettings:ue,genericSegmentSettings:X,setGenericSegmentSettings:fe,genericSegments:h,mapSettings:Y,setMapSettings:_e,command:p,meshParametersFile:m,commandFile:c}):s(V,{}),t&&n?s(Vn,{root:t,chooseFile:(C,U)=>{n.callback(C,U),a(!1)},close:()=>{a(!1)},extension:n.extension,isSaveDialog:n.isSaveFile===!0}):s(V,{})]})}const Ro=hn({reducer:{main:gn(yn({segment:co,block:Pa,velocity:yo,meshLine:Qa,genericSegments:za,fileHandles:xa,command:Ea}))}});class Bo{constructor(t,n){D(this,"name");D(this,"path");D(this,"handle");this.handle=t,this.name=t.name,this.path=n!=null?n:[this.name]}async getContents(){return(await this.handle.getFile()).text()}async setContents(t){const n=await this.handle.createWritable();await n.write(t),await n.close()}}class Ae{constructor(t,n){D(this,"name");D(this,"path");D(this,"handle");D(this,"fileList");D(this,"folderList");this.handle=t,this.fileList=[],this.folderList=[],this.name=t.name,this.path=n!=null?n:[this.name]}async initialize(){for await(const t of this.handle.values())t.kind==="directory"?this.folderList.push(t.name):this.fileList.push(t.name)}async getFile(t){const n=await this.handle.getFileHandle(t,{create:!0});return new Bo(n,[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(t),a=new Ae(n,[...this.path,t]);return await a.initialize(),a}}const Eo=async()=>{const e=await window.showDirectoryPicker();await e.requestPermission({mode:"readwrite"});const t=new Ae(e);return await t.initialize(),t};function Ao(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:o,onRegisterError:r}=e;let d;const l=async(i=!0)=>{};return"serviceWorker"in navigator&&(d=new bn("./sw.js",{scope:"./"}),d.addEventListener("activated",i=>{i.isUpdate?window.location.reload():a==null||a()}),d.register({immediate:t}).then(i=>{o==null||o(i)}).catch(i=>{r==null||r(i)})),l}Ao();const To=1,Wo=new xn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:To}}});window.location.search.includes("fake-dir")||Na(Eo);wn.render(s(k.exports.StrictMode,{children:s(vn,{client:Wo,children:s(_n,{store:Ro,children:s(Oo,{})})})}),document.querySelector("#root"));
