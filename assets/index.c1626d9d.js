var it=Object.defineProperty,rt=Object.defineProperties;var lt=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var ce=(t,e,n)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var n in e||(e={}))ct.call(e,n)&&ce(t,n,e[n]);if($e)for(var n of $e(e))dt.call(e,n)&&ce(t,n,e[n]);return t},x=(t,e)=>rt(t,lt(e));var M=(t,e,n)=>(ce(t,typeof e!="symbol"?e+"":e,n),n);import{j as i,a as S,F as B,m as De,r as w,b as de,M as ut,u as mt,c as ft,d as pt,e as K,f as ht,v as gt,Q as yt,R as xt,g as vt,P as wt}from"./vendor.54fec1e0.js";const _t=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}};_t();function bt({value:t,fieldDefinition:e,setField:n}){return S("div",{className:"flex flex-row justify-between items-center",children:[S("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(B,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof t=="number"?"number":"text",value:t,onChange:a=>{n(typeof t=="number"?Number.parseFloat(a.target.value):a.target.value)}})})]})}function ne({title:t,item:e,setItem:n,fieldDefinitions:a,ignoreFields:s,deletable:r,controls:m}){const o=Object.keys(e).map((p,d)=>{if(s==null?void 0:s.includes(p))return{element:i("span",{style:{display:"hidden"}},p),order:d+1e4};const _=e[p],h=p in a&&a[p];return h?{element:i(bt,{value:_,fieldDefinition:h,setField:N=>n({[p]:N})},p),order:h.order}:{element:S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${p}`,className:"text-l font-bold",children:p}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${p}`,className:"rounded w-full",type:typeof _=="number"?"number":"text",value:_,onChange:N=>{n({[p]:typeof _=="number"?Number.parseFloat(N.target.value):N.target.value})}})})]},p),order:d+1e3}}).sort((p,d)=>p.order-d.order).map(p=>p.element);return S("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:t}),S("span",{className:"flex flex-row justify-end gap-2 grow",children:[m,r?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):i(B,{})]})]}),o]})}ne.defaultProps={ignoreFields:[],controls:i(B,{})};const St={color:"#0000ff",selectedColor:"#ff0000",radius:6};var Xe;const Nt=JSON.parse((Xe=window.localStorage.getItem("blockDisplaySettings"))!=null?Xe:"false")||St;function kt({settings:t,setSettings:e,selected:n,blocks:a,setBlockData:s,addNewBlock:r}){const m=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},o=a[n],p=o?i(ne,{title:o.name,item:o,deletable:!0,setItem:d=>s(n,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(B,{});return S(B,{children:[S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:d=>{m(x(u({},t),{color:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.selectedColor,onChange:d=>{m(x(u({},t),{selectedColor:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:t.radius,onChange:d=>{m(x(u({},t),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),p]})}function Ct({folder:t,files:e,setFile:n}){const a=Object.keys(e).map(s=>{const r=e[s];return S("div",{className:"flex flex-row justify-between items-center",children:[S("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:r.name}),i("span",{className:"text-sm","data-testid":`file-${s}-description`,children:r.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:S("select",{"data-testid":`file-${s}-select`,className:"w-full rounded",value:r.currentFilePath,onChange:async m=>{const o=m.currentTarget.value;try{const p=await t.getFile(o);n(s,p.name,p)}catch{n(s,"")}},children:[i("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),t.fileList.filter(m=>m.endsWith(r.extension)).map(m=>i("option",{value:m,"data-testid":`file-${s}-select-${m}`,children:m},m))]})})]},s)});return i("div",{className:"flex flex-col gap-2",children:a})}function $t({view:t,buttons:e,active:n,setActive:a}){if(!e)return i("span",{});const s=[];for(const r of Object.keys(e)){const m=e[r],o=r===n;s.push(i("button",{type:"button","data-testid":`tab-${r}`,className:`${o?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>a(o?"":r),children:m},r))}return S("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[n?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm",children:t}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:s})]})}const Fe={lon:0,lat:0},Dt=180,Y=360;function Le(t){let{lon:e,lat:n}=t;for(;e<0;)e+=Y;for(;e>Y;)e-=Y;return[e,n]}function Ie([t,e]){return{lon:t<0?t+Y:t,lat:e}}function Ft(t,e){const n=Le(t),a=Le(e),s=[a[0],a[1]];return a[0]-n[0]>=Dt?s[0]-=Y:s[0]+=Y,Math.abs(n[0]-a[0])>Math.abs(n[0]-s[0])?[n,s]:[n,a]}const j=1e3;function J(t,e,n,a){const s=`${Math.floor(t.lon*j)},${Math.floor(t.lat*j)}`;if(s in e)return[e[s],a];const r=a;return n[r]=t,e[s]=r,[r,a+1]}function Me(t,e){let n=!1;for(const a of t.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&t.vertecies[e]){const a=t.vertecies[e],s=`${Math.floor(a.lon*j)},${Math.floor(a.lat*j)}`,r=u({},t.vertecies);delete r[e];const m=u({},t.vertexDictionary);return delete m[s],x(u({},t),{vertecies:r,vertexDictionary:m})}return t}De.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const Q=Math.PI/6,U=2*Math.PI-Q,X={};function Lt({pointSources:t,arrowSources:e,lineSources:n,selections:a,drawnPointSource:s,click:r}){const m=w.exports.useRef(null),[o,p]=w.exports.useState(),[d,_]=w.exports.useState(!1),[h,N]=w.exports.useState(),[k]=w.exports.useState(new de.exports.Popup({closeButton:!1,closeOnClick:!1})),[H,R]=w.exports.useState(),[A,ae]=w.exports.useState(),[W,se]=w.exports.useState(),[E,ie]=w.exports.useState({source:void 0}),[P,re]=w.exports.useState({selectedColor:"",selectedRadius:0,color:"",radius:0}),[V,T]=w.exports.useState({}),[G,oe]=w.exports.useState({click:r});return w.exports.useEffect(()=>{G.click!==r&&(G.click=r,oe(G))},[r,G]),w.exports.useEffect(()=>{if(!o&&De.accessToken&&m.current){const D=new de.exports.Map({container:m.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});D.addControl(new de.exports.NavigationControl),p(D),D.on("load",()=>{_(!0)}),D.on("click",({lngLat:F})=>{G.click(Ie([F.lng,F.lat]))}),D.on("draw.selectionchange",({features:F})=>{var v;if(!((v=E.source)==null?void 0:v.select))return;const l=F[0];l&&l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"&&E.source.select(l.properties.index)}),D.on("draw.modechange",({mode:F})=>{F==="simple_select"&&a.drawnPoint&&h&&h.changeMode("direct_select",{featureId:`${a.drawnPoint}`})}),D.on("draw.update",({features:F,action:l})=>{var v;if(!!((v=E.source)==null?void 0:v.update)&&l==="move"&&F.length>0)for(const $ of F)$.type==="Feature"&&$.geometry.type==="Point"&&$.properties&&"index"in $.properties&&typeof $.properties.index=="number"&&E.source.update($.properties.index,Ie($.geometry.coordinates))})}console.log("Updating map...")},[h,G,E.source,o,a]),w.exports.useEffect(()=>{if(o&&d&&E.source!==s){console.log("Drawning Points"),E.source=s,ie(E);let D=h;(s.selectedColor!==P.selectedColor||s.selectedRadius!==P.selectedRadius||s.color!==P.color||s.radius!==P.radius)&&(re({color:s.color,radius:s.radius,selectedRadius:s.selectedRadius,selectedColor:s.selectedColor}),h&&o.removeControl(h),s?(D=new ut({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":s.selectedRadius,"circle-color":s.selectedColor}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":s.radius,"circle-color":s.color}}]}),o.addControl(D),N(D)):D=void 0),D&&D.set({type:"FeatureCollection",features:s.points.map(F=>({type:"Feature",properties:{description:"",index:F.index,name:""},geometry:{type:"Point",coordinates:[F.longitude,F.latitude]}}))})}},[o,d,E,s,P,h]),w.exports.useEffect(()=>{if(o&&d&&A!==e)if(console.log("Setting arrows in map!"),A){for(const l of A){X[`arrow:${l.name}`]=l.click;const v=o.getSource(`arrow:${l.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:arrow:${l.name}`),o.removeLayer(`layer:arrow:${l.name}:click`)}ae(void 0)}else{for(const l of e){X[`arrow:${l.name}`]=l.click;let v=o.getSource(`arrow:${l.name}`);const $=v===void 0;$&&(o.addSource(`arrow:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=o.getSource(`arrow:${l.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:l.arrows.map(g=>{const f=g.scale*l.scale,b=l.scale*l.arrowHeadScale,L=[g.longitude+g.direction[0]*f,g.latitude+g.direction[1]*f],z=[L[0]+(Math.cos(Q)*-g.direction[0]-Math.sin(Q)*-g.direction[1])*b,L[1]+(Math.sin(Q)*-g.direction[0]+Math.cos(Q)*-g.direction[1])*b],te=[L[0]+(Math.cos(U)*-g.direction[0]-Math.sin(U)*-g.direction[1])*b,L[1]+(Math.sin(U)*-g.direction[0]+Math.cos(U)*-g.direction[1])*b];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index===a[l.name]},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],L,z,L,te]}}})}),o.addLayer({id:`layer:arrow:${l.name}`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":l.width}}),o.addLayer({id:`layer:arrow:${l.name}:click`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),$&&(o.on("mouseenter",`layer:arrow:${l.name}:click`,g=>{if(!g.features)return;const f=g.features[0];if(f.geometry.type==="Point"&&f.properties&&typeof f.properties.description=="string"){const b=[...f.geometry.coordinates],{description:L}=f.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;k.setLngLat(b).setHTML(L).addTo(o)}}),o.on("mouseleave",`layer:arrow:${l.name}:click`,()=>{k.remove()}),o.on("click",`layer:arrow:${l.name}:click`,g=>{const f=X[`arrow:${l.name}`];if(!g.features||!f)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:L}=b.properties;f(L)}}))}ae(e)}const D=u({},V);let F=!1;for(const l of Object.keys(a))if(a[l]!==V[l]){for(const v of e)if(v.name===l){F=!0,D[l]=a[l];const $=o==null?void 0:o.getSource(`arrow:${v.name}`);if($){const g=a[l];$.setData({type:"FeatureCollection",features:v.arrows.map(f=>{const b=f.scale*v.scale,L=v.scale*v.arrowHeadScale,z=[f.longitude+f.direction[0]*b,f.latitude+f.direction[1]*b],te=[z[0]+(Math.cos(Q)*-f.direction[0]-Math.sin(Q)*-f.direction[1])*L,z[1]+(Math.sin(Q)*-f.direction[0]+Math.cos(Q)*-f.direction[1])*L],le=[z[0]+(Math.cos(U)*-f.direction[0]-Math.sin(U)*-f.direction[1])*L,z[1]+(Math.sin(U)*-f.direction[0]+Math.cos(U)*-f.direction[1])*L];return{type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:f.index===g},geometry:{type:"LineString",coordinates:[[f.longitude,f.latitude],z,te,z,le]}}})})}}}F&&T(D)},[o,A,e,d,k,a,V]),w.exports.useEffect(()=>{if(o&&d&&W!==n)if(console.log("Setting lines in map!"),W){for(const l of W){X[`line:${l.name}`]=l.click;const v=o.getSource(`line:${l.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:line:${l.name}`),o.removeLayer(`layer:line:${l.name}:click`)}se(void 0)}else{for(const l of n){X[`line:${l.name}`]=l.click;let v=o.getSource(`line:${l.name}`);const $=v===void 0;$&&(o.addSource(`line:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=o.getSource(`line:${l.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:l.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index===a[l.name]},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))}),o.addLayer({id:`layer:line:${l.name}`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":["case",["get","selected"],l.selectedWidth,l.width]}}),o.addLayer({id:`layer:line:${l.name}:click`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":l.width*10}}),$&&(o.on("mouseenter",`layer:line:${l.name}:click`,g=>{if(!g.features)return;const f=g.features[0];if(f.geometry.type==="LineString"&&f.properties&&typeof f.properties.description=="string"){const b=[(f.geometry.coordinates[0][0]+f.geometry.coordinates[1][0])/2,(f.geometry.coordinates[0][1]+f.geometry.coordinates[1][1])/2],{description:L}=f.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;k.setLngLat(b).setHTML(L).addTo(o)}}),o.on("mouseleave",`layer:line:${l.name}:click`,()=>{k.remove()}),o.on("click",`layer:line:${l.name}:click`,g=>{const f=X[`line:${l.name}`];if(!g.features||!f)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:L}=b.properties;f(L)}}))}se(n)}const D=u({},V);let F=!1;for(const l of Object.keys(a))if(a[l]!==V[l]){for(const v of n)if(v.name===l){F=!0,D[l]=a[l];const $=o==null?void 0:o.getSource(`line:${v.name}`);if($){const g=a[l];$.setData({type:"FeatureCollection",features:v.lines.map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:f.index===g},geometry:{type:"LineString",coordinates:[[f.startLongitude,f.startLatitude],[f.endLongitude,f.endLatitude]]}}))})}}}F&&T(D)},[o,W,n,d,k,a,V]),w.exports.useEffect(()=>{if(!o||!d)return;if(H!==t)if(console.log("Setting points in map!"),H){for(const l of H){X[`point:${l.name}`]=l.click;const v=o.getSource(`point:${l.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:point:${l.name}`)}R(void 0)}else{for(const l of t){X[`point:${l.name}`]=l.click;let v=o.getSource(`point:${l.name}`);const $=v===void 0;$&&(o.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=o.getSource(`point:${l.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:l.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index!==a[l.name]},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),o.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":["case",["get","selected"],l.selectedColor,l.color],"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),$&&(o.on("mouseenter",`layer:point:${l.name}`,g=>{if(!g.features)return;const f=g.features[0];if(f.geometry.type==="Point"&&f.properties&&typeof f.properties.description=="string"){const b=[...f.geometry.coordinates],{description:L}=f.properties;for(;Math.abs(g.lngLat.lng-b[0])>180;)b[0]+=g.lngLat.lng>b[0]?360:-360;k.setLngLat(b).setHTML(L).addTo(o)}}),o.on("mouseleave",`layer:point:${l.name}`,()=>{k.remove()}),o.on("click",`layer:point:${l.name}`,g=>{const f=X[`point:${l.name}`];if(!g.features||!f)return;const b=g.features[0];if(b.properties&&typeof b.properties.index=="number"&&typeof b.properties.name=="string"){const{index:L}=b.properties;f(L)}}))}R(t)}const D=u({},V);let F=!1;for(const l of Object.keys(a))if(a[l]!==V[l]){for(const v of t)if(v.name===l){F=!0,D[l]=a[l];const $=o.getSource(`point:${v.name}`);if($){const g=a[l];$.setData({type:"FeatureCollection",features:v.points.map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name,selected:f.index!==g},geometry:{type:"Point",coordinates:[f.longitude,f.latitude]}}))})}}}F&&T(D)},[o,H,t,d,k,a,V]),i("div",{"data-testid":"map",className:"w-full h-full",ref:m})}const It={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3};var Ue;const Mt=u(u({},It),JSON.parse((Ue=window.localStorage.getItem("segmentDisplaySettings"))!=null?Ue:"{}"));function Vt({settings:t,setSettings:e,segments:n,selected:a,setSegmentData:s,addNewSegment:r,splitSegment:m,setSelectionMode:o}){const p=h=>{e(h),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(h))},d=n[a],_=d?i(ne,{title:d.name,item:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:h=>s(a,h),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>m(a),children:"Split Segment"})}):i(B,{});return S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:h=>{p(x(u({},t),{color:h.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:h=>{p(x(u({},t),{width:Number.parseFloat(h.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.activeColor,onChange:h=>{p(x(u({},t),{activeColor:h.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.activeWidth,onChange:h=>{p(x(u({},t),{activeWidth:Number.parseFloat(h.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({mode:"mapClick",label:"Select Segment Starting Point",callback:h=>{o({mode:"mapClick",label:"Select Segment End point",callback:N=>{r(h,N),o("normal")}})}})},children:"New Segment"})]}),_]})}function jt({folder:t,openFolder:e,filesOpen:n,saveFiles:a}){function s(){e()}return S("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"celeri_ui"}),S("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[t?S("span",{children:["Working in ",t.name]}):i("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),n?i("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Files"}):i(B,{})]})]})}const Et={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa"};var Ze;const Ot=JSON.parse((Ze=window.localStorage.getItem("velocityDisplaySettings"))!=null?Ze:"false")||Et;function Pt({settings:t,setSettings:e,selected:n,velocitys:a,setVelocityData:s,addNewVelocity:r}){const m=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},o=a[n],p=o?i(ne,{title:o.name,item:o,deletable:!0,setItem:d=>s(n,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(B,{});return S(B,{children:[S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:d=>{m(x(u({},t),{color:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.selectedColor,onChange:d=>{m(x(u({},t),{selectedColor:d.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:t.scale,onChange:d=>{m(x(u({},t),{scale:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:d=>{m(x(u({},t),{width:Number.parseFloat(d.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:t.arrowHead,onChange:d=>{m(x(u({},t),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),p]})}const Rt={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3};var Ye;const At=u(u({},Rt),JSON.parse((Ye=window.localStorage.getItem("vertexDisplaySettings"))!=null?Ye:"{}"));function Bt({settings:t,setSettings:e,vertices:n,selected:a,setVertexData:s,setSelectionMode:r,mergeVertices:m,bridgeVertices:o,extrudeVertex:p}){const d=N=>{e(N),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(N))},_=n[a],h=_?i(ne,{title:"Selected Vertex",item:_,ignoreFields:[],deletable:!1,setItem:N=>s(a,N),fieldDefinitions:{},controls:S(B,{children:[i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertex",callback:N=>{m(a,N),r("normal")}})},children:"Merge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",callback:N=>{o(a,N),r("normal")}})},children:"Bridge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",callback:N=>{p(a,N),r("normal")}})},children:"Extrude"})]})}):i(B,{});return S("div",{className:"flex flex-col gap-2",children:[S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:N=>{d(x(u({},t),{color:N.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.radius,onChange:N=>{d(x(u({},t),{radius:Number.parseFloat(N.target.value)}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.activeColor,onChange:N=>{d(x(u({},t),{activeColor:N.target.value}))}})})]}),S("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.activeRadius,onChange:N=>{d(x(u({},t),{activeRadius:Number.parseFloat(N.target.value)}))}})})]}),h]})}const Tt=()=>mt(),Ht=ft,Ve=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ee={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Wt(t,{a:e,b:n}){const a=x(u({},ee),{start:e,end:n}),s=[...t.segments,a];return x(u({},t),{segments:s})}function zt(t,e){const n=u({},t.vertecies),a=u({},t.vertexDictionary),{lastIndex:s}=t,[r,m]=J(e.start,a,n,s),[o,p]=J(e.end,a,n,m),d=x(u({},ee),{start:r,end:o}),_=[...t.segments,d];return{vertecies:n,vertexDictionary:a,segments:_,lastIndex:p}}function Jt(t,e){const n=[...t.segments],a=n.splice(e.index,1)[0];return Me(Me(x(u({},t),{segments:n}),a.start),a.end)}function Gt(t,e){const n=[...t.segments],a=u(u({},n[e.index]),e.data);return n[e.index]=a,x(u({},t),{segments:n})}function qt(t,e){const n=u({},t.vertecies),a=u({},t.vertexDictionary),[s,r]=J(e.targetPoint,a,n,t.lastIndex),m=x(u({},ee),{start:e.index,end:s}),o=[...t.segments,m];return{vertecies:n,vertexDictionary:a,segments:o,lastIndex:r}}function Kt(t,e){return e}function Qt(t,{a:e,b:n}){const a=t.segments.map(p=>{let d=p;return d.start===n&&(d=x(u({},d),{start:e})),d.end===n&&(d=x(u({},d),{end:e})),d}).filter(p=>p.start!==p.end),s=t.vertecies[n],r=`${Math.floor(s.lon*j)},${Math.floor(s.lat*j)}`,m=u({},t.vertecies);delete m[n];const o=u({},t.vertexDictionary);return delete o[r],x(u({},t),{vertecies:m,vertexDictionary:o,segments:a})}function Xt(t,{index:e,vertex:n}){const a=u({},t.vertecies),s=u({},t.vertexDictionary),r=[...t.segments],m=a[e],o=`${Math.floor(n.lon*j)},${Math.floor(n.lat*j)}`,p=`${Math.floor(m.lon*j)},${Math.floor(m.lat*j)}`;if(delete s[p],o in s){const d=s[o];for(const _ of r)_.start===d&&(_.start=e),_.end===d&&(_.end=e);delete a[d]}return a[e]=n,x(u({},t),{segments:r,vertecies:a,vertexDictionary:s})}function Ut(t,e){const n=t.segments[e],a=t.vertecies[n.start],s=t.vertecies[n.end],r={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},m=u({},t.vertecies),o=u({},t.vertexDictionary),[p,d]=J(r,o,m,t.lastIndex),_=x(u({},n),{end:p,name:`${n.name}_a`}),h=x(u({},n),{start:p,name:`${n.name}_b`}),N=[...t.segments];return N[e]=_,N.push(h),{vertecies:m,vertexDictionary:o,segments:N,lastIndex:d}}const Zt={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},je=K("bridgeVertices"),Ee=K("createSegmet"),Oe=K("deleteSegment"),Pe=K("editSegmentData"),Re=K("extrudeSegment"),ue=K("loadNewData"),Ae=K("mergeVertices"),Be=K("moveVertex"),Te=K("splitSegment"),Yt=pt(Zt,t=>{t.addCase(je,(e,n)=>Wt(e,n.payload)).addCase(Ee,(e,n)=>zt(e,n.payload)).addCase(Oe,(e,n)=>Jt(e,n.payload)).addCase(Pe,(e,n)=>Gt(e,n.payload)).addCase(Re,(e,n)=>qt(e,n.payload)).addCase(ue,(e,n)=>Kt(e,n.payload)).addCase(Ae,(e,n)=>Qt(e,n.payload)).addCase(Be,(e,n)=>Xt(e,n.payload)).addCase(Te,(e,n)=>Ut(e,n.payload))});function me(t){const e=t.split(/\n/g),n=e[0].split(","),a=e.slice(1),s=[];for(const r of a)if(r.trim()!==""){const m=r.split(/\s*,\s*/),o={};for(let p=0;p<n.length;p+=1){let d=m[p];const _=n[p],h=Number.parseFloat(d);d=Number.isNaN(h)?d:h,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),o[_]=d}s.push(o)}return s}function fe(t,e){const n=[e.join(",")];for(const a of t){const s=a;n.push(e.map(r=>r in s?typeof s[r]=="string"&&/\s/.test(`${s[r]}`)?`"${s[r]}"`:`${s[r]}`:"").join(","))}return n.join(`
`)}const He=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],en={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function We(t){return u(u({},en),t)}class pe{constructor(e){M(this,"handle");M(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=me(e).map(s=>{const r={};for(const m of He)r[m]=s[m]||(m==="name"?"":0);return r});this.data=a}async save(){var n;const e=fe((n=this.data)!=null?n:[],He);await this.handle.setContents(e)}clone(){return new pe(this.handle)}}const tn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function nn(t){return u(u({},tn),t)}class he{constructor(e){M(this,"handle");M(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=JSON.parse(e);this.data=nn(n)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new he(this.handle)}}class ge{constructor(e){M(this,"handle");M(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=me(e).map(p=>{const d={};for(const _ of Ve)d[_]=p[_]||(_==="name"?"":0);return d}),s={},r={},m=[];let o=0;for(const p of a){const[d,_]=J({lon:p.lon1,lat:p.lat1},s,r,o),[h,N]=J({lon:p.lon2,lat:p.lat2},s,r,_),k=x(u({},p),{start:d,end:h});o=N,m.push(k)}this.data={vertecies:r,segments:m,vertexDictionary:s,lastIndex:o}}async save(){let e=[];if(this.data){const{vertecies:a,segments:s}=this.data;e=s.map(r=>{const m=a[r.start],o=a[r.end];return x(u({},r),{lon1:m.lon,lat1:m.lat,lon2:o.lon,lat2:o.lat})})}const n=fe(e,Ve);await this.handle.setContents(n)}clone(){return new ge(this.handle)}tryRemoveVertex(e){if(this.data){let n=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*j)},${Math.floor(a.lat*j)}`,r=u({},this.data.vertecies);delete r[e];const m=u({},this.data.vertexDictionary);delete m[s];const o=this.clone();return o.data=x(u({},this.data),{vertecies:r,vertexDictionary:m}),o}}return this}mergeVertices(e,n){if(this.data){for(const p of this.data.segments)p.start===n&&(p.start=e),p.end===n&&(p.end=e);const a=this.data.vertecies[n],s=`${Math.floor(a.lon*j)},${Math.floor(a.lat*j)}`,r=u({},this.data.vertecies);delete r[n];const m=u({},this.data.vertexDictionary);delete m[s];const o=this.clone();return o.data=x(u({},this.data),{vertecies:r,vertexDictionary:m}),o}return this}moveVertex(e,n){if(this.data){const a=u({},this.data.vertecies),s=u({},this.data.vertexDictionary),r=[...this.data.segments],m=a[e],o=`${Math.floor(n.lon*j)},${Math.floor(n.lat*j)}`,p=`${Math.floor(m.lon*j)},${Math.floor(m.lat*j)}`;if(delete s[p],o in s){const _=s[o];for(const h of r)h.start===_&&(h.start=e),h.end===_&&(h.end=e);delete a[_]}a[e]=n;const d=this.clone();return d.data=x(u({},this.data),{segments:r,vertecies:a,vertexDictionary:s}),d}return this}splitSegment(e){if(this.data){const n=this.data.segments[e],a=this.data.vertecies[n.start],s=this.data.vertecies[n.end],r={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[m,o]=J(r,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),p=x(u({},n),{end:m,name:`${n.name}_a`}),d=x(u({},n),{start:m,name:`${n.name}_b`}),_=[...this.data.segments];_[e]=p,_.push(d);const h=this.clone();return h.data=x(u({},this.data),{segments:_,lastIndex:o}),h}return this}bridgeVertices(e,n){if(this.data){const a=x(u({},ee),{start:e,end:n}),s=[...this.data.segments,a],r=this.clone();return r.data=x(u({},this.data),{segments:s}),r}return this}extrudeSegment(e,n){if(this.data){const a=u({},this.data.vertecies),s=u({},this.data.vertexDictionary),[r,m]=J(n,s,a,this.data.lastIndex),o=x(u({},ee),{start:e,end:r}),p=[...this.data.segments,o],d=this.clone();return d.data={vertecies:a,vertexDictionary:s,segments:p,lastIndex:m},d}return this}deleteSegment(e){if(this.data){const n=[...this.data.segments],a=n.splice(e,1)[0],s=this.clone();return s.data=x(u({},this.data),{segments:n}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,n){if(this.data){const a=u({},this.data.vertecies),s=u({},this.data.vertexDictionary),[r,m]=J(e,s,a,this.data.lastIndex),[o,p]=J(n,s,a,m),d=x(u({},ee),{start:r,end:o}),_=[...this.data.segments,d],h=this.clone();return h.data={vertecies:a,vertexDictionary:s,segments:_,lastIndex:p},h}return this}}const ze=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],an={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function Je(t){return u(u({},an),t)}class ye{constructor(e){M(this,"handle");M(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=me(e).map(s=>{const r={};for(const m of ze)r[m]=s[m]||(m==="name"?"":0);return r});this.data=a}async save(){var n;const e=fe((n=this.data)!=null?n:[],ze);await this.handle.setContents(e)}clone(){return new ye(this.handle)}}async function Ge(t){const e=new ge(t);return await e.initialize(),e}async function qe(t){const e=new pe(t);return await e.initialize(),e}async function Ke(t){const e=new ye(t);return await e.initialize(),e}async function sn(t,e,n){const a=new he(e);if(await a.initialize(),a.data){const s=await Ge(await t.getFile(a.data.segment_file_name)),r=await qe(await t.getFile(a.data.block_file_name)),m=await Ke(await t.getFile(a.data.station_file_name)),o=u({},n);return"command"in o&&(o.command=x(u({},o.command),{currentFilePath:e.name})),"segment"in o&&(o.segment=x(u({},o.segment),{currentFilePath:a.data.segment_file_name})),"block"in o&&(o.block=x(u({},o.block),{currentFilePath:a.data.block_file_name})),"velocities"in o&&(o.velocities=x(u({},o.velocities),{currentFilePath:a.data.station_file_name})),{openableFiles:o,commands:a,segments:s,blocks:r,velocities:m}}throw new Error("Can't open command file")}class on{constructor(e){M(this,"name");M(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const n=await this.handle.createWritable();await n.write(e),await n.close()}}class xe{constructor(e){M(this,"name");M(this,"handle");M(this,"fileList");M(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const n=await this.handle.getFileHandle(e);return new on(n)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(e),a=new xe(n);return await a.initialize(),a}}const rn=async()=>{const t=await window.showDirectoryPicker(),e=new xe(t);return await e.initialize(),e};class ln{constructor(e,n){M(this,"name");M(this,"parent");this.name=e,this.parent=n}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ve{constructor(e,n){M(this,"name");M(this,"parent");M(this,"fileList");M(this,"folderList");this.name=e,this.parent=n,this.fileList=[],this.folderList=[];const a=n[e];for(const s of Object.keys(a))typeof a[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new ln(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ve(e,this.parent[this.name])}}const cn=async t=>new ve("root",t);let Qe=async()=>{var e;return cn((e=window.FakeDirectory)!=null?e:{})};function dn(t){Qe=t}async function un(){return Qe()}window.location.search.includes("fake-dir")||dn(rn);const mn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function fn(){var we,_e,be,Se,Ne;const t=Tt(),[e,n]=w.exports.useState(),[a,s]=w.exports.useState(""),[r,m]=w.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[o,p]=w.exports.useState(),[d,_]=w.exports.useState(),[h,N]=w.exports.useState(),[k,H]=w.exports.useState(),R=Ht(c=>c.segments),[A,ae]=w.exports.useState(Ot),[W,se]=w.exports.useState(Nt),[E,ie]=w.exports.useState(Mt),[P,re]=w.exports.useState(At),[V,T]=w.exports.useState("normal"),[G,oe]=w.exports.useState(-1),[D,F]=w.exports.useState(-1),[l,v]=w.exports.useState(-1),[$,g]=w.exports.useState(-1),[f,b]=w.exports.useState({select:(c,y)=>{oe(c==="block"?y:-1),F(c==="segment"?y:-1),v(c==="velocities"?y:-1),g(c==="vertex"?y:-1),s(c)}}),[L,z]=w.exports.useState([]),[te,le]=w.exports.useState([]),[et,tt]=w.exports.useState([]),[nt,at]=w.exports.useState({color:P.color,selectedColor:P.activeColor,radius:P.radius,selectedRadius:P.activeRadius,points:[]});w.exports.useEffect(()=>{V==="normal"?b({select:(c,y)=>{oe(c==="block"?y:-1),F(c==="segment"?y:-1),v(c==="velocities"?y:-1),g(c==="vertex"?y:-1),s(c)}}):V.mode==="override"?b({select:(c,y)=>{c===V.type&&V.callback(y)}}):b({select:()=>{}})},[V]),w.exports.useEffect(()=>{z([{name:"blocks",color:W.color,selectedColor:W.selectedColor,radius:W.radius,points:(h==null?void 0:h.data)?h.data.map((c,y)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:y})):[],click:c=>{f.select("block",c)}}])},[W,h,E,f]),w.exports.useEffect(()=>{tt([{name:"segments",color:E.color,selectedColor:E.activeColor,width:E.width,selectedWidth:E.activeWidth,lines:R.segments.map((c,y)=>{var ke,Ce;const C=(ke=R.vertecies[c.start])!=null?ke:Fe,I=(Ce=R.vertecies[c.end])!=null?Ce:Fe,[[O,q],[st,ot]]=Ft(C,I);return{startLongitude:O,startLatitude:q,endLongitude:st,endLatitude:ot,name:c.name,description:`${C.lon},${C.lat} to ${I.lon},${I.lat}`,index:y}}),click:c=>{f.select("segment",c)}}])},[R,E,f]),w.exports.useEffect(()=>{at({color:P.color,radius:P.radius,selectedColor:P.activeColor,selectedRadius:P.activeRadius,points:Object.keys(R.vertecies).map(c=>{const y=Number.parseInt(c,10),C=R.vertecies[y];return C?{longitude:C.lon,latitude:C.lat,index:y}:!1}).filter(c=>!!c),update:(c,y)=>{t(Be({index:c,vertex:y}))},select:c=>{f.select("vertex",c)}})},[P,f,R.vertecies,t]),w.exports.useEffect(()=>{le([{name:"velocities",color:A.color,selectedColor:A.selectedColor,scale:A.scale,arrowHeadScale:A.arrowHead,width:A.width,arrows:(k==null?void 0:k.data)?k.data.map((c,y)=>{const C=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/C,c.north_vel/C],scale:C,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`,index:y}}):[],click:c=>{f.select("velocities",c)}}])},[f,A,k]);let Z=i("span",{});switch(a){case"files":Z=e?i(Ct,{folder:e,files:r,setFile:async(c,y,C)=>{if(C){let I=u({},r);switch(I[c]=x(u({},I[c]),{currentFilePath:y}),c){case"segment":const O=await Ge(C);_(O),O.data&&t(ue(O.data));break;case"block":N(await qe(C));break;case"velocity":H(await Ke(C));break;case"command":const q=await sn(e,C,r);p(q.commands),_(q.segments),q.segments.data&&t(ue(q.segments.data)),N(q.blocks),H(q.velocities),I=q.openableFiles;break}m(I)}}}):i("span",{});break;case"velocities":Z=i(Pt,{settings:A,setSettings:ae,selected:l,velocitys:(we=k==null?void 0:k.data)!=null?we:[],setVelocityData:(c,y)=>{if(k!==void 0)if(y){const C=k.data&&k.data[c]?u(u({},k.data[c]),y):Je(y),I=k.data?[...k.data]:[];I[c]=C;const O=k.clone();O.data=I,H(O)}else{const C=k.data?[...k.data]:[];C.splice(c,1);const I=k.clone();I.data=C,H(I)}},addNewVelocity:()=>{T({label:"Click to place velocity estimate",mode:"mapClick",callback:c=>{if(T("normal"),k!==void 0){const y=k.data?[...k.data]:[],C=y.length,I=Je({lat:c.lat,lon:c.lon});y.push(I);const O=k.clone();O.data=y,H(O),f.select("velocity",C)}}})}});break;case"block":Z=i(kt,{settings:W,setSettings:se,selected:G,blocks:(_e=h==null?void 0:h.data)!=null?_e:[],addNewBlock:()=>{T({label:"Click to place new block",mode:"mapClick",callback:c=>{if(h!==void 0){const y=h.data?[...h.data]:[],C=We({name:"New Block",interior_lon:c.lon,interior_lat:c.lat}),I=y.length;y.push(C);const O=h.clone();O.data=y,N(O),f.select("block",I)}T("normal")}})},setBlockData:(c,y)=>{if(h!==void 0)if(y){const C=h.data&&h.data[c]?u(u({},h.data[c]),y):We(y),I=h.data?[...h.data]:[];I[c]=C;const O=h.clone();O.data=I,N(O)}else{const C=h.data?[...h.data]:[];C.splice(c,1);const I=h.clone();I.data=C,N(I)}}});break;case"segment":Z=i(Vt,{settings:E,setSettings:ie,segments:(be=R.segments)!=null?be:[],selected:D,setSelectionMode:c=>T(c),addNewSegment:(c,y)=>{const C=R.segments.length;t(Ee({start:c,end:y})),f.select("segment",C)},setSegmentData:(c,y)=>{t(y?Pe({index:c,data:y}):Oe({index:c}))},splitSegment:c=>{t(Te(c))}});break;case"vertex":Z=i(Bt,{settings:P,setSettings:re,vertices:(Se=R.vertecies)!=null?Se:{},selected:$,setVertexData:function(c,y){throw new Error("Function not implemented.")},setSelectionMode:c=>T(c),mergeVertices:(c,y)=>{t(Ae({a:c,b:y}))},bridgeVertices:(c,y)=>{t(je({a:c,b:y}))},extrudeVertex:(c,y)=>{t(Re({index:c,targetPoint:y}))}});break}return S("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:c=>{c.key==="Escape"&&T("normal")},children:[i(jt,{filesOpen:((Ne=o!=null?o:d)!=null?Ne:h)!==void 0,saveFiles:async()=>{o&&await o.save(),d&&(d.data=R,await d.save()),h&&await h.save()},folder:e,openFolder:async()=>{const c=await un();n(c),s("files")}}),V!=="normal"?i("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:S("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[i("span",{className:"text-lg font-semibold",children:V.label}),i("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):i(B,{}),i(Lt,{pointSources:L,arrowSources:te,lineSources:et,drawnPointSource:nt,selections:{segments:D,blocks:G,velocities:l,drawnPoint:$},click:c=>{typeof V!="string"&&V.mode==="mapClick"&&V.callback(c)}}),i($t,{view:Z,buttons:e?mn:void 0,active:a,setActive:c=>s(c)})]})}const pn=ht({reducer:{segments:Yt}});function hn(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:s,onRegisterError:r}=t;let m;const o=async(p=!0)=>{};return"serviceWorker"in navigator&&(m=new gt("./sw.js",{scope:"./"}),m.addEventListener("activated",p=>{p.isUpdate?window.location.reload():a==null||a()}),m.register({immediate:e}).then(p=>{s==null||s(p)}).catch(p=>{r==null||r(p)})),o}hn();const gn=1,yn=new yt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:gn}}});xt.render(i(w.exports.StrictMode,{children:i(vt,{client:yn,children:i(wt,{store:pn,children:i(fn,{})})})}),document.querySelector("#root"));
