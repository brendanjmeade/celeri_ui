var ln=Object.defineProperty,rn=Object.defineProperties;var cn=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var dn=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable;var we=(e,t,n)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))dn.call(t,n)&&we(e,n,t[n]);if(tt)for(var n of tt(t))un.call(t,n)&&we(e,n,t[n]);return e},S=(e,t)=>rn(e,cn(t));var j=(e,t,n)=>(we(e,typeof t!="symbol"?t+"":t,n),n);import{j as s,a as v,F as V,r as L,M as mn,m as nt,R as fn,b as Se,u as pn,c as hn,l as at,d as gn,e as ee,f as $,g as st,h as ot,i as yn,k as bn,n as xn,v as vn,Q as wn,o as Sn,p as Nn,P as kn}from"./vendor.da2b9cb6.js";const Cn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};Cn();const Ne=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],lt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function _n(e){return e?h(h({},lt),e):h({},lt)}function Ln({value:e,fieldDefinition:t,setField:n}){const[a,o]=L.exports.useState(-1),[r,c]=L.exports.useState(e);L.exports.useEffect(()=>{c(e)},[e]);let i=s("input",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",type:typeof e=="number"?"number":"text",value:r,onChange:d=>{const f=typeof e=="number"?Number.parseFloat(d.target.value):d.target.value;c(f),a>-1&&clearTimeout(a),o(setTimeout(()=>n(f),1e3))}});return t.type==="select"&&(i=v("select",{"data-testid":`input-editor-${t.name}`,className:"bg-gray-800 w-full",value:r,onChange:d=>{n(d.currentTarget.value)},children:[s("option",{value:"","data-testid":`input-editor-${t.name}-empty`,children:"\xA0"}),t.items.map(d=>s("option",{value:d.name,"data-testid":`input-editor-${t.name}-${d.name}`,children:d.name},d.name))]})),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[s("span",{"data-testid":`input-title-${t.name}`,className:"text-l font-bold",children:t.name}),t.description?s("span",{className:"text-sm",children:t.description}):s(V,{})]}),s("span",{className:"w-2/5 flex-shrink-0",children:i})]})}function te({title:e,items:t,setItems:n,fieldDefinitions:a,ignoreFields:o,deletable:r,controls:c}){const i=t[0],d=Object.keys(i).map((f,x)=>{if(o==null?void 0:o.includes(f))return{element:s("span",{style:{display:"hidden"}},f),order:x+1e4};let m=i[f];for(const b of t)if(b[f]!==m){m="-";break}const u=f in a&&a[f];return u?{element:s(Ln,{value:m,fieldDefinition:u,setField:b=>n({[f]:b})},f),order:u.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":`input-title-${f}`,className:"text-l font-bold",children:f}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${f}`,className:"bg-gray-800 w-full",type:typeof m=="number"?"number":"text",value:m,onChange:b=>{n({[f]:typeof m=="number"?Number.parseFloat(b.target.value):b.target.value})}})})]},f),order:x+1e3}}).sort((f,x)=>f.order-x.order).map(f=>f.element);return v("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:e}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[c,r?s("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):s(V,{})]})]}),d]})}te.defaultProps={ignoreFields:[],controls:s(V,{})};const $n={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},jn=["",...Ne];var Et;const Dn=JSON.parse((Et=window.localStorage.getItem("blockDisplaySettings"))!=null?Et:"false")||$n;function Fn({settings:e,setSettings:t,selected:n,blocks:a,setBlockData:o,addNewBlock:r,save:c,open:i}){const d=m=>{t(m),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(m))},f=n.map(m=>a[m]).filter(m=>m),x=f.length>0?s(te,{title:f.length===1?f[0].name:"Edit Selected Blocks",items:f,deletable:!0,setItems:m=>o(n,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(V,{});return v(V,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{d(S(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>i(),children:"Open Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Blocks"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:m=>{d(S(h({},e),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:m=>{d(S(h({},e),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:e.radius,onChange:m=>{d(S(h({},e),{radius:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:m=>{d(S(h({},e),{plottableKey:m.currentTarget.value}))},children:jn.map(m=>s("option",{value:m,children:m},m))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Block"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),x]})}function Mn({command:e,save:t,open:n,setCommandData:a}){return v(V,{children:[s("div",{className:"flex flex-col gap-2",children:v("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Command File"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>t(),children:"Save Command File"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{t(!0)},children:"Save As"})]})}),s(te,{title:e.file_name,items:[e],deletable:!1,setItems:o=>o&&a(o),fieldDefinitions:{},ignoreFields:["segment_file_name","station_file_name","block_file_name","mesh_parameters_file_name","file_name"]})]})}function Vn(e){let t="..";for(let n=2;n<e;n+=1)t=`${t}/..`;return t}function In({root:e,chooseFile:t,close:n,extension:a,isSaveDialog:o}){var g,w;const[r,c]=L.exports.useState(""),[i,d]=L.exports.useState(),[f,x]=L.exports.useState(""),[m,u]=L.exports.useState([e]),b=(g=m.at(-1))!=null?g:e,k=[...m.filter(N=>N!==e).map((N,_)=>s("button",{type:"button","data-testid":`back-${_}`,onClick:async()=>{u(m.slice(0,_+1))},children:Vn(m.length-_)},_)),...b.folderList.map(N=>s("button",{type:"button","data-testid":`folder-${N}`,onClick:async()=>{u([...m,await b.getDirectory(N)])},children:N},N))],y=b.fileList.filter(N=>N.endsWith(a)).map(N=>s("button",{type:"button","data-testid":`file-${N}`,className:(i==null?void 0:i.name)===N?"font-bold":"",onClick:async()=>{const _=await b.getFile(N);d(_),c(_.name),x(await _.getContents())},children:N},N));return s("div",{role:"none","data-testid":"explorer-backdrop",className:"fixed w-full h-full flex flex-col justify-center items-center z-50 bg-black/50",onClick:()=>n(),children:v("div",{role:"none",className:"bg-black p-5 flex flex-col gap-2",onClick:N=>N.stopPropagation(),children:[s("span",{children:"Open File"}),v("div",{className:"flex flex-row gap-2 pointer-events-auto",children:[v("div",{className:"border-gray-800 border p-2 flex flex-col gap-1 min-w-[20rem] max-w-[30rem] max-h-40 overflow-auto items-start",children:[k,y]}),i?v("div",{className:"border-gray-800 border p-2 max-w-[30rem] max-h-40 overflow-auto whitespace-pre",children:[s("span",{"data-testid":"selected-file-name",className:"text-xl font-bold",children:i.name}),s("p",{"data-testid":"selected-file-content",children:f})]}):s(V,{})]}),v("div",{className:"flex flex-row",children:[s("div",{"data-testid":"file-path",className:"flex-grow p-1",children:o?b.path.join("/"):(w=i==null?void 0:i.path.join("/"))!=null?w:""}),o?s("input",{"data-testid":"file-path-input",className:"flex-grow p-1 bg-gray-800",value:r,onChange:N=>c(N.target.value)}):s(V,{})]}),v("div",{className:"flex flex-row-reverse gap-2 pointer-events-auto",children:[s("button",{"data-testid":"select-button",type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2 disabled:bg-gray-900",disabled:!i&&!r,onClick:async()=>{let N=i;if(o&&(N=await b.getFile(r.endsWith(a)?r:`${r}${a}`)),N){const _=m.filter(T=>T!==e).map(T=>T.name);_.push(N.name),t(N,_)}},children:o?"Save":"Select"}),s("button",{"data-testid":"close-button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",type:"button",onClick:()=>n(),children:"Close"})]})]})})}const On={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var At;const Pn=h(h({},On),JSON.parse((At=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?At:"{}"));function Rn({settings:e,setSettings:t,collections:n,setCollectionVertexKeys:a,open:o}){const r=i=>{t(i),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(i))},c=Object.keys(n).map(i=>{const{startLat:d,startLon:f,endLat:x,endLon:m,segments:u,plot:b}=n[i],k=Object.keys(u[0]).map((y,g)=>({name:y,value:g}));return s(te,{title:i,items:[{startLat:d,startLon:f,endLat:x,endLon:m,plot:b}],deletable:!1,setItems:y=>{a(h({collection:i,startLat:d,startLon:f,endLat:x,endLon:m,plot:b},y))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:k},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:k},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:k},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:k},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:k}}},i)});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{r(S(h({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>o(),children:"Open Segments"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:i=>{r(S(h({},e),{color:i.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:i=>{r(S(h({},e),{width:Number.parseFloat(i.target.value)}))}})})]}),c]})}function Bn({view:e,buttons:t,active:n,setActive:a}){if(!t)return s("span",{});const o=[];for(const r of Object.keys(t)){const c=t[r],i=r===n;o.push(s("button",{type:"button","data-testid":`tab-${r}`,className:`${i?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(i?"":r),children:c},r))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?s("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:e}):"",s("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:o})]})}const it={lon:0,lat:0},En=180,se=360;function rt(e){let{lon:t,lat:n}=e;for(;t<0;)t+=se;for(;t>se;)t-=se;return[t,n]}function ke([e,t]){return{lon:e<0?e+se:e,lat:t}}function Ce(e,t){const n=rt(e),a=rt(t),o=[a[0],a[1]];return a[0]-n[0]>=En?o[0]-=se:o[0]+=se,Math.abs(n[0]-a[0])>Math.abs(n[0]-o[0])?[n,o]:[n,a]}const H=1e6;function oe(e,t,n,a){const o=`${Math.floor(e.lon*H)},${Math.floor(e.lat*H)}`;if(o in t)return[t[o],a];const r=a;return n[r]=e,t[o]=r,[r,a+1]}function ct(e,t){let n=!1;for(const a of e.segments)if(a.start===t||a.end===t){n=!0;break}if(!n&&e.vertecies[t]){const a=e.vertecies[t],o=`${Math.floor(a.lon*H)},${Math.floor(a.lat*H)}`,r=h({},e.vertecies);delete r[t];const c=h({},e.vertexDictionary);return delete c[o],S(h({},e),{vertecies:r,vertexDictionary:c})}return e}const U=Math.PI/6,Q=2*Math.PI-U;function An(e,t,{map:n,popup:a,internalArrowSources:o,mapLoaded:r,internalSelections:c},{arrowSources:i,selections:d}){var m;if(n&&r&&o!==i)if(console.log("Setting arrows in map!"),o){for(const u of o){const b=n.getSource(`arrow:${u.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${u.name}`),n.removeLayer(`layer:arrow:${u.name}:click`);try{n.getLayer(`layer:arrow:${u.name}:labels`)&&n.removeLayer(`layer:arrow:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalArrowSources:void 0})}else{for(const u of i){let b=n.getSource(`arrow:${u.name}`);const k=b===void 0;if(k&&(n.addSource(`arrow:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${u.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`arrow:${u.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:u.arrows.map(y=>{var D;const g=y.scale*u.scale,w=u.scale*u.arrowHeadScale,N=[y.longitude+y.direction[0]*g,y.latitude+y.direction[1]*g],_=[N[0]+(Math.cos(U)*-y.direction[0]-Math.sin(U)*-y.direction[1])*w,N[1]+(Math.sin(U)*-y.direction[0]+Math.cos(U)*-y.direction[1])*w],T=[N[0]+(Math.cos(Q)*-y.direction[0]-Math.sin(Q)*-y.direction[1])*w,N[1]+(Math.sin(Q)*-y.direction[0]+Math.cos(Q)*-y.direction[1])*w];return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:(D=d[u.name])==null?void 0:D.includes(y.index)},geometry:{type:"LineString",coordinates:[[y.longitude,y.latitude],N,_,N,T]}}})}),n.addLayer({id:`layer:arrow:${u.name}`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],u.selectedColor,u.color],"line-width":u.width}}),n.addLayer({id:`layer:arrow:${u.name}:click`,type:"line",source:`arrow:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(m=u.arrows[0])==null?void 0:m.label){const y=n.getSource(`arrow:${u.name}:points`);y&&(y.setData({type:"FeatureCollection",features:u.arrows.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),n.addLayer({id:`layer:arrow:${u.name}:labels`,type:"symbol",source:`arrow:${u.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}k&&(n.on("mouseenter",`layer:arrow:${u.name}:click`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const w=[...g.geometry.coordinates],{description:N}=g.properties;for(;Math.abs(y.lngLat.lng-w[0])>180;)w[0]+=y.lngLat.lng>w[0]?360:-360;a.setLngLat(w).setHTML(N).addTo(n)}}),n.on("mouseleave",`layer:arrow:${u.name}:click`,()=>{a.remove()}),n.on("click",`layer:arrow:${u.name}:click`,y=>{let g;if(e.state.internalArrowSources)for(const N of e.state.internalArrowSources)g=N.click;if(!y.features||!g)return;const w=y.features[0];if(w.properties&&typeof w.properties.index=="number"){const{index:N}=w.properties;g(N)}}))}t({internalArrowSources:i})}const f=h({},c);let x=!1;for(const u of Object.keys(d))if(d[u]!==c[u]){for(const b of i)if(b.name===u){x=!0,f[u]=d[u];const k=n==null?void 0:n.getSource(`arrow:${b.name}`);if(k){const y=d[u];k.setData({type:"FeatureCollection",features:b.arrows.map(g=>{const w=g.scale*b.scale,N=b.scale*b.arrowHeadScale,_=[g.longitude+g.direction[0]*w,g.latitude+g.direction[1]*w],T=[_[0]+(Math.cos(U)*-g.direction[0]-Math.sin(U)*-g.direction[1])*N,_[1]+(Math.sin(U)*-g.direction[0]+Math.cos(U)*-g.direction[1])*N],D=[_[0]+(Math.cos(Q)*-g.direction[0]-Math.sin(Q)*-g.direction[1])*N,_[1]+(Math.sin(Q)*-g.direction[0]+Math.cos(Q)*-g.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:y==null?void 0:y.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],_,T,_,D]}}})})}}}x&&t({internalSelections:f})}function Tn(e,{map:t,draw:n,drawnPointSettings:a,mapLoaded:o,internalDrawnPointSource:r},{drawnPointSource:c}){if(t&&o&&r!==c){console.log("Drawning Points"),e({internalDrawnPointSource:c});let i=n;if((c.selectedColor!==a.selectedColor||c.selectedRadius!==a.selectedRadius||c.color!==a.color||c.radius!==a.radius)&&(e({drawnPointSettings:{color:c.color,radius:c.radius,selectedRadius:c.selectedRadius,selectedColor:c.selectedColor}}),n&&(t.removeControl(n),i=void 0),c?(i=new mn({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":c.selectedRadius,"circle-color":c.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":c.radius,"circle-color":c.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),t.addControl(i),e({draw:i})):i=void 0),i){const d=i.getAll(),f=c.points.length!==d.features.length?void 0:i.getSelected(),x={type:"FeatureCollection",features:c.points.map(m=>({type:"Feature",id:m.index.toString(),properties:{description:"",index:m.index,name:""},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}}))};if(i.set(x),f&&f.features.length>0&&f.features[0].properties&&typeof f.features[0].properties.index=="number"){const m=f.features[0].id;m&&i.changeMode("simple_select",{featureIds:[m]})}}}}const E="grid";function Wn(e,t,{map:n,internalGridDisplay:a,popup:o,mapLoaded:r},{displayGrid:c}){if(n&&r&&a!==c){if(console.log("Drawing Grid on map!"),a&&a>0){const i=n.getSource(E);i!==void 0&&i.setData({type:"FeatureCollection",features:[]}),n.removeLayer(E),t({internalGridDisplay:void 0})}else if(c&&c>0){let i=n.getSource(E);const d=i===void 0;if(d&&(n.addSource(E,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i=n.getSource(E)),i!==void 0){const f=[];for(let x=-170;x<=180;x+=c)f.push({type:"Feature",properties:{label:`Lon: ${x<0?x+360:x}`},geometry:{type:"LineString",coordinates:[[x,-90],[x,90]]}});for(let x=-90;x<=90;x+=c)f.push({type:"Feature",properties:{label:`Lat: ${x}`},geometry:{type:"LineString",coordinates:[[180,x],[-180,x]]}});i.setData({type:"FeatureCollection",features:f})}n.addLayer({id:E,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${E}:click`,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),d&&(n.on("mouseenter",`${E}:click`,f=>{if(!f.features)return;const x=f.features[0];x.geometry.type==="LineString"&&x.properties&&typeof x.properties.label=="string"&&o.setLngLat(f.lngLat).setHTML(`${x.properties.label}`).addTo(n)}),n.on("mouseleave",`${E}:click`,()=>{o.remove()}))}t({internalGridDisplay:c})}}function Gn(e,t,{map:n,popup:a,internalLineSources:o,mapLoaded:r,internalSelections:c},{lineSources:i,selections:d}){var m;if(n&&r&&o!==i)if(console.log("Setting lines in map!"),o){for(const u of o){const b=n.getSource(`line:${u.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${u.name}`);try{n.getLayer(`layer:line:${u.name}:click`)&&n.removeLayer(`layer:line:${u.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${u.name}:labels`)&&n.removeLayer(`layer:line:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalLineSources:void 0})}else{for(const u of i){let b=n.getSource(`line:${u.name}`);const k=b===void 0;if(k&&(n.addSource(`line:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${u.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`line:${u.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:u.lines.map(y=>{var g,w;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,label:(g=y.label)!=null?g:"",selected:((w=d[u.name])==null?void 0:w.includes(y.index))||!1},geometry:{type:"LineString",coordinates:[[y.startLongitude,y.startLatitude],[y.endLongitude,y.endLatitude]]}}})}),n.addLayer({id:`layer:line:${u.name}`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],u.selectedColor,u.color],"line-width":["case",["get","selected"],u.selectedWidth,u.width]}}),(m=u.lines[0])==null?void 0:m.label){const y=n.getSource(`line:${u.name}:points`);y&&(y.setData({type:"FeatureCollection",features:u.lines.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[(g.startLongitude+g.endLongitude)/2,(g.startLatitude+g.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${u.name}:labels`,type:"symbol",source:`line:${u.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}u.click&&(n.addLayer({id:`layer:line:${u.name}:click`,type:"line",source:`line:${u.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":u.width*10}}),k&&(n.on("mouseenter",`layer:line:${u.name}:click`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="LineString"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const w=[(g.geometry.coordinates[0][0]+g.geometry.coordinates[1][0])/2,(g.geometry.coordinates[0][1]+g.geometry.coordinates[1][1])/2],{description:N}=g.properties;for(;Math.abs(y.lngLat.lng-w[0])>180;)w[0]+=y.lngLat.lng>w[0]?360:-360;a.setLngLat(w).setHTML(N).addTo(n)}}),n.on("mouseleave",`layer:line:${u.name}:click`,()=>{a.remove()}),n.on("click",`layer:line:${u.name}:click`,y=>{let g;if(e.state.internalLineSources)for(const N of e.state.internalLineSources)N.name===u.name&&(g=N.click);if(!y.features||!g)return;const w=y.features[0];if(w.properties&&typeof w.properties.index=="number"){const{index:N}=w.properties;g(N)}})))}t({internalLineSources:i})}const f=h({},c);let x=!1;for(const u of Object.keys(d))if(d[u]!==c[u]){for(const b of i)if(b.name===u){x=!0,f[u]=d[u];const k=n==null?void 0:n.getSource(`line:${b.name}`);if(k){const y=d[u];k.setData({type:"FeatureCollection",features:b.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:y==null?void 0:y.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))})}}}x&&t({internalSelections:f})}function Kn(e,t,{map:n,popup:a,internalPointSources:o,mapLoaded:r,internalSelections:c},{pointSources:i,selections:d}){var m;if(!n||!r)return;if(o!==i)if(console.log("Setting points in map!"),o){for(const u of o){const b=n.getSource(`point:${u.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${u.name}`);try{n.getLayer(`layer:point:${u.name}:labels`)&&n.removeLayer(`layer:point:${u.name}:labels`)}catch{console.log("no label layer")}}t({internalPointSources:void 0})}else{for(const u of i){let b=n.getSource(`point:${u.name}`);const k=b===void 0;k&&(n.addSource(`point:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`point:${u.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:u.points.map(y=>{var g;return{type:"Feature",properties:{description:y.name||y.description?`<strong>${y.name}</strong><p>${y.description}</p>`:"",index:y.index,name:y.name,selected:!((g=d[u.name])==null?void 0:g.includes(y.index)),label:y.label},geometry:{type:"Point",coordinates:[y.longitude,y.latitude]}}})}),n.addLayer({id:`layer:point:${u.name}`,type:"circle",source:`point:${u.name}`,paint:{"circle-color":["case",["get","selected"],u.color,u.selectedColor],"circle-radius":u.radius}}),((m=u.points[0])==null?void 0:m.label)&&n.addLayer({id:`layer:point:${u.name}:labels`,type:"symbol",source:`point:${u.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),k&&(n.on("mouseenter",`layer:point:${u.name}`,y=>{if(!y.features)return;const g=y.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const w=[...g.geometry.coordinates],{description:N}=g.properties;for(;Math.abs(y.lngLat.lng-w[0])>180;)w[0]+=y.lngLat.lng>w[0]?360:-360;a.setLngLat(w).setHTML(N).addTo(n)}}),n.on("mouseleave",`layer:point:${u.name}`,()=>{a.remove()}),n.on("click",`layer:point:${u.name}`,y=>{let g;if(e.state.internalPointSources)for(const N of e.state.internalPointSources)g=N.click;if(!y.features||!g)return;const w=y.features[0];if(w.properties&&typeof w.properties.index=="number"){const{index:N}=w.properties;g(N)}}))}t({internalPointSources:i})}const f=h({},c);let x=!1;for(const u of Object.keys(d))if(d[u]!==c[u]){for(const b of i)if(b.name===u){x=!0,f[u]=d[u];const k=n.getSource(`point:${b.name}`);if(k){const y=d[u];k.setData({type:"FeatureCollection",features:b.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:!(y==null?void 0:y.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))})}}}x&&t({internalSelections:f})}function Hn(e,t,{map:n,internalPolygonSources:a,mapLoaded:o},{polygonSources:r,selections:c}){if(n&&o&&a!==r)if(a){for(const i of a){const d=n.getSource(`poly:${i.name}`);d!==void 0&&d.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${i.name}`),n.removeLayer(`layer:poly:${i.name}:fill`)}t({internalPolygonSources:void 0})}else{for(const i of r){let d=n.getSource(`poly:${i.name}`);d===void 0&&(n.addSource(`poly:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),d=n.getSource(`poly:${i.name}`)),d!==void 0&&d.setData({type:"FeatureCollection",features:i.polygons.map(x=>{var m;return{type:"Feature",properties:{description:x.name||x.description?`<strong>${x.name}</strong><p>${x.description}</p>`:"",index:x.index,name:x.name,selected:((m=c[i.name])==null?void 0:m.includes(x.index))||!1},geometry:{type:"Polygon",coordinates:[x.polygon.map(u=>[u.lon,u.lat])]}}})}),n.addLayer({id:`layer:poly:${i.name}:fill`,type:"fill",source:`poly:${i.name}`,layout:{},paint:{"fill-color":i.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${i.name}`,type:"line",source:`poly:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":i.borderColor,"line-width":i.borderRadius}})}t({internalPolygonSources:r})}}nt.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class zn extends fn.Component{constructor(t){super(t);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:L.exports.createRef(),popup:new Se.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=t.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:t,style:n}=this.state,a=typeof t=="object"?t==null?void 0:t.current:void 0;if(nt.accessToken&&a){const o=new Se.exports.Map({container:a,style:n,center:[0,0],zoom:2});o.addControl(new Se.exports.NavigationControl),this.setState({map:o}),o.on("load",()=>{this.setState({mapLoaded:!0})}),o.on("click",({lngLat:r})=>{const{click:c}=this.props;c(ke([r.lng,r.lat]))}),o.on("mousemove",({lngLat:r})=>{const{mouseMove:c}=this.props;c&&c(ke([r.lng,r.lat]))}),o.on("draw.selectionchange",({features:r})=>{const{internalDrawnPointSource:c}=this.state;if(!c||!(c==null?void 0:c.select))return;const i=r.map(d=>d&&d.type==="Feature"&&d.geometry.type==="Point"&&d.properties&&"index"in d.properties&&typeof d.properties.index=="number"?d.properties.index:-1).filter(d=>d>-1);c.select(i)}),o.on("draw.update",({features:r,action:c})=>{const{internalDrawnPointSource:i}=this.state;if(!!(i==null?void 0:i.update)&&c==="move"&&r.length>0)for(const d of r)d.type==="Feature"&&d.geometry.type==="Point"&&d.properties&&"index"in d.properties&&typeof d.properties.index=="number"&&i.update(d.properties.index,ke(d.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:t}=this.props,{style:n,map:a}=this.state;return t&&t!==n&&(this.setState({style:t}),a==null||a.setStyle(t)),Wn(this,o=>this.setState(o),this.state,this.props),Hn(this,o=>this.setState(o),this.state,this.props),Gn(this,o=>this.setState(o),this.state,this.props),An(this,o=>this.setState(o),this.state,this.props),Kn(this,o=>this.setState(o),this.state,this.props),Tn(o=>this.setState(o),this.state,this.props),!1}render(){const{mapReference:t}=this.state;return s("div",{"data-testid":"map",className:"w-full h-full",ref:t})}}const ie={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},Jn=(()=>{var t;const e=h(h({},ie),JSON.parse((t=window.localStorage.getItem("mapSettings"))!=null?t:"{}"));return e.savedStyles=h(h({},e.savedStyles),ie.savedStyles),e})();function Un({settings:e,setSettings:t}){const[n,a]=L.exports.useState(""),[o,r]=L.exports.useState(""),[c,i]=L.exports.useState(""),d=f=>{t(f),window.localStorage.setItem("mapSettings",JSON.stringify(f))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Select Style"}),s("span",{className:"w-2/5 flex-shrink-0",children:v("select",{className:"bg-gray-800 w-full",value:e.currentStyleName,onChange:f=>{const x=f.target.value;if(x==="***CUSTOM")a(""),i(e.savedStyles.default.styleId),r(e.savedStyles.default.user),d(S(h({},e),{currentStyleName:"",currentStyle:e.savedStyles.default}));else{const m=e.savedStyles[x];a(x),i(m.styleId),r(m.user),d(S(h({},e),{currentStyleName:x,currentStyle:m}))}},children:[s("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(e.savedStyles).map(f=>s("option",{value:f,children:f},f))]})})]}),e.currentStyleName in ie.savedStyles?s(V,{}):v(V,{children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Style Name"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:f=>{a(f.target.value)}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in ie.savedStyles)&&d({currentStyle:{user:o,styleId:c},currentStyleName:n,savedStyles:S(h({},e.savedStyles),{[n]:{user:o,styleId:c}})})},children:"Save Style"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in e.savedStyles&&!(n in ie.savedStyles)){const f={};for(const x of Object.keys(e.savedStyles))x!==n&&(f[x]=e.savedStyles[x]);d({currentStyle:f.default,currentStyleName:"default",savedStyles:f})}},children:"Delete Style"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"User"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:o,onChange:f=>{r(f.target.value)}})}),s("span",{className:"text-l font-bold",children:"Style Id"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"text",value:c,onChange:f=>{i(f.target.value)}})})]}),v("div",{children:["Adding a custom mapbox style:",v("ul",{children:[v("li",{children:["If you are creating a new style, go to"," ",s("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),s("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const qn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Tt;const Qn=h(h({},qn),JSON.parse((Tt=window.localStorage.getItem("meshDisplaySettings"))!=null?Tt:"{}"));function Xn({settings:e,setSettings:t,open:n,openMultiple:a}){const o=r=>{t(r),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(r))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Display"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{o(S(h({},e),{hide:!e.hide}))}})}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>n(),children:"Open Mesh"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>a(),children:"Open Meshes"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:r=>{o(S(h({},e),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:r=>{o(S(h({},e),{width:Number.parseFloat(r.target.value)}))}})})]})]})}const ce=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],_e={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Zn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Wt;const Yn=h(h({},Zn),JSON.parse((Wt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Wt:"{}")),ea=["",...ce];function ta({settings:e,setSettings:t,segments:n,selected:a,setSegmentData:o,addNewSegment:r,splitSegment:c,setSelectionMode:i,save:d,open:f}){const x=b=>{t(b),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(b))},m=a.map(b=>n[b]).filter(b=>b),u=m.length>0?s(te,{title:m.length===1?m[0].name:"Edit Selected Segments",items:m,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:b=>o(a,b),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>c(a),children:"Split Segment"})}):s(V,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{x(S(h({},e),{hide:!e.hide}))}})}),s("span",{className:"text-l font-bold flex-grow",children:"Projection"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hideProjection,onChange:()=>{x(S(h({},e),{hideProjection:!e.hideProjection}))}})})]}),v("div",{className:"flex flex-row justify-between items-center gap-1",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>f(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>d(),children:"Save Segments & Vertices"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{d(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:b=>{x(S(h({},e),{color:b.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:b=>{x(S(h({},e),{width:Number.parseFloat(b.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:b=>{x(S(h({},e),{activeColor:b.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.activeWidth,onChange:b=>{x(S(h({},e),{activeWidth:Number.parseFloat(b.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Projection Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.projectionColor,onChange:b=>{x(S(h({},e),{projectionColor:b.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:b=>{x(S(h({},e),{plottableKey:b.currentTarget.value}))},children:ea.map(b=>s("option",{value:b,children:b},b))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Segment"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Select Segment Starting Point",callback:b=>{i({mode:"mapClick",label:"Select Segment End point",callback:k=>{r(b,k),i("normal")}})}})},children:"New Segment"})]}),u]})}const dt=()=>pn(),P=hn;function na({folder:e,openFolder:t,filesOpen:n,saveFiles:a}){function o(){t()}const r=dt(),[c,i]=P(d=>[d.main.past.length>0,d.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[s("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[e?s("button",{type:"button",onClick:()=>{r(at.ActionCreators.undo())},"data-testid":"undo-button",disabled:!c,children:"Undo"}):s(V,{}),e?s("button",{type:"button",onClick:()=>{r(at.ActionCreators.redo())},disabled:!i,"data-testid":"undo-button",children:"Redo"}):s(V,{}),e?v("span",{children:["Working in ",e.name]}):s("button",{type:"button",onClick:o,"data-testid":"open-folder-button",children:"Open Folder"}),n?s("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Active Files"}):s(V,{})]})]})}const de=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],aa={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function sa(e){return h(h({},aa),e)}const oa={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},la=["",...de];var Gt;const ia=JSON.parse((Gt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Gt:"false")||oa;function ra({settings:e,setSettings:t,selected:n,velocitys:a,setVelocityData:o,addNewVelocity:r,save:c,open:i}){const d=m=>{t(m),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(m))},f=n.map(m=>a[m]).filter(m=>m),x=f.length>0?s(te,{title:f.length===1?f[0].name:"Edit Selected Velocities",items:f,deletable:!0,setItems:m=>o(n,m),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):s(V,{});return v(V,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{d(S(h({},e),{hide:!e.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>i(),children:"Open Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>c(),children:"Save Velocities"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{c(!0)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:m=>{d(S(h({},e),{color:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.selectedColor,onChange:m=>{d(S(h({},e),{selectedColor:m.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Scale"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:e.scale,onChange:m=>{d(S(h({},e),{scale:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:e.width,onChange:m=>{d(S(h({},e),{width:Number.parseFloat(m.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Arrow Head Size"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:e.arrowHead,onChange:m=>{d(S(h({},e),{arrowHead:Number.parseFloat(m.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Plotted Value"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("select",{className:"bg-gray-800 w-full",value:e.plottableKey,onChange:m=>{d(S(h({},e),{plottableKey:m.currentTarget.value}))},children:la.map(m=>s("option",{value:m,children:m},m))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Add New Velocity"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),x]})}const ca={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Kt;const da=h(h({},ca),JSON.parse((Kt=window.localStorage.getItem("vertexDisplaySettings"))!=null?Kt:"{}"));function ua({settings:e,setSettings:t,vertices:n,selected:a,setVertexData:o,setSelectionMode:r,mergeVertices:c,bridgeVertices:i,extrudeVertex:d,save:f,open:x}){const m=k=>{t(k),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(k))},b=a.map(k=>({selectedVertex:n[k],index:k})).filter(k=>k.selectedVertex).map(({selectedVertex:k,index:y})=>s(te,{title:"Selected Vertex",items:[k],ignoreFields:[],deletable:!1,setItems:g=>o(y,h(h({},k),g)),fieldDefinitions:{},controls:v(V,{children:[s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:g=>{c(y,g[0]),r("normal")}})},children:"Merge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:g=>{i(y,g[0]),r("normal")}})},children:"Bridge"}),s("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:g=>{d(y,g),r("normal")}})},children:"Extrude"})]})},y));return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold flex-grow",children:"Display"}),s("span",{className:"w-2/5 flex-shrink",children:s("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!e.hide,onChange:()=>{m(S(h({},e),{hide:!e.hide}))}})}),v("span",{className:"w-2/5 flex-shrink flex flex-row justify-end gap-2",children:[s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>x(),children:"Open Segments"}),s("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>f(),children:"Save Segments & Vertices"})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.color,onChange:k=>{m(S(h({},e),{color:k.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.radius,onChange:k=>{m(S(h({},e),{radius:Number.parseFloat(k.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"color",value:e.activeColor,onChange:k=>{m(S(h({},e),{activeColor:k.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:e.activeRadius,onChange:k=>{m(S(h({},e),{activeRadius:Number.parseFloat(k.target.value)}))}})})]}),b]})}const ma=e=>e.mode,fa=e=>e.setSelectedBlock,pa=e=>e.setSelectedSegment,ha=e=>e.setSelectedVelocity,ga=e=>e.setSelectedVertex,ya=e=>e.setActiveTab,ut=gn(ma,fa,pa,ha,ga,ya,(e,t,n,a,o,r)=>e==="normal"?(c,i)=>{t(c==="block"?i:[]),n(c==="segment"?i:[]),a(c==="velocities"?i:[]),o(c==="vertex"?i:[]),r(c)}:e.mode==="override"?(c,i)=>{c===e.type&&e.callback(i)}:()=>{});function ba(e,{data:t}){return[...e,_n(t)]}function xa(e,t){const n=[];for(const[a,o]of e.entries())t.includes(a)||n.push(o);return n}function va(e,t){const n=[...e];for(const a of t.indices){const o=h(h({},n[a]),t.data);n[a]=o}return n}function wa(e,t){return t}function Sa(e,{index:t,position:n}){const a=[...e],o=h({},a[t]);return o.interior_lat=n.lat,o.interior_lon=n.lon,a[t]=o,a}const Na=[],mt=$("createBlock"),ft=$("editBlock"),pt=$("deleteBlock"),Le=$("loadNewBlockData"),ht=$("moveBlock"),ka=ee(Na,e=>{e.addCase(mt,(t,n)=>ba(t,n.payload)).addCase(ft,(t,n)=>va(t,n.payload)).addCase(pt,(t,n)=>xa(t,n.payload)).addCase(Le,(t,n)=>wa(t,n.payload)).addCase(ht,(t,n)=>Sa(t,n.payload))}),ue={file_name:"Default Command",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""},Ca=Object.keys(ue),_a=h({},ue),gt=$("loadNewCommandData"),La=$("newCommandFile"),$e=$("editCommandData"),$a=ee(_a,e=>{e.addCase(gt,(t,n)=>n.payload).addCase(La,()=>h({},ue)).addCase($e,(t,n)=>h(h({},t),n.payload))}),yt=$("setRootFolder"),O=$("openFile"),ja=$("closeFile"),Da={rootFolder:void 0,files:{}},Fa=ee(Da,e=>{e.addCase(yt,(t,n)=>({rootFolder:n.payload,files:{},fileOpenCallback:()=>{}})).addCase(O,(t,n)=>{const a=h({},t.files);return a[n.payload.key]={path:n.payload.path,file:n.payload.file},S(h({},t),{files:a})}).addCase(ja,(t,n)=>{const a={};return Object.keys(t.files).filter(o=>o!==n.payload).map(o=>(a[o]=t.files[o],!0)),S(h({},t),{files:a})})});function Ma(e,t){return S(h({},e),{[t.name]:{name:t.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:t.data}})}function Va(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}function Ia(e,t){const n=e[t.collection];if(!n)return e;const a=S(h({},n),{startLon:t.startLon,startLat:t.startLat,endLon:t.endLon,endLat:t.endLat,plot:t.plot});return S(h({},e),{[t.collection]:a})}const Oa={},bt=$("loadNewGenericCollectionData"),xt=$("setGenericSegmentPositionKeys"),Pa=$("removeGenericSegmentCollection"),Ra=ee(Oa,e=>e.addCase(bt,(t,n)=>Ma(t,n.payload)).addCase(xt,(t,n)=>Ia(t,n.payload)).addCase(Pa,(t,n)=>Va(t,n.payload))),Ba={mesh_filename:"",smoothing_weight:1e7,edge_constraints:[0,1,0],n_eigenvalues:20,a_priori_slip_filename:""};function Ea(e,t){var n;return S(h({},e),{[t.mesh]:{parameters:(n=t.parameters)!=null?n:Ba,line:t.data}})}function Aa(e,t){const n={};for(const a of Object.keys(e))a!==t&&(n[a]=e[a]);return n}const vt={},me=$("loadMeshLineData"),Ta=$("removeMesh"),je=$("clearMeshes"),Wa=ee(vt,e=>e.addCase(me,(t,n)=>Ea(t,n.payload)).addCase(Ta,(t,n)=>Aa(t,n.payload)).addCase(je,()=>vt));function Ga(e,{a:t,b:n}){const a=S(h({},_e),{start:t,end:n}),o=[...e.segments,a];return S(h({},e),{segments:o})}function Ka(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),{lastIndex:o}=e,[r,c]=oe(t.start,a,n,o),[i,d]=oe(t.end,a,n,c),f=S(h(h({},_e),t),{start:r,end:i}),x=[...e.segments,f];return{vertecies:n,vertexDictionary:a,segments:x,lastIndex:d}}function Ha(e,t){const n=[],a=[];let o=h({},e);for(const[r,c]of e.segments.entries())t.index.includes(r)?a.push(c):n.push(c);o.segments=n;for(const r of a)o=ct(ct(o,r.start),r.end);return o}function za(e,t){const n=[...e.segments];for(const a of t.indices){const o=h(h({},n[a]),t.data);n[a]=o}return S(h({},e),{segments:n})}function Ja(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),[o,r]=oe(t.targetPoint,a,n,e.lastIndex),c=S(h({},_e),{start:t.index,end:o}),i=[...e.segments,c];return{vertecies:n,vertexDictionary:a,segments:i,lastIndex:r}}function Ua(e,t){return t}function qa(e,{a:t,b:n}){if(t===n)return e;const a=e.segments.map(d=>{let f=d;return f.start===n&&(f=S(h({},f),{start:t})),f.end===n&&(f=S(h({},f),{end:t})),f}).filter(d=>d.start!==d.end),o=e.vertecies[n],r=`${Math.floor(o.lon*H)},${Math.floor(o.lat*H)}`,c=h({},e.vertecies);delete c[n];const i=h({},e.vertexDictionary);return delete i[r],S(h({},e),{vertecies:c,vertexDictionary:i,segments:a})}function Qa(e,{index:t,vertex:n}){const a=h({},e.vertecies),o=h({},e.vertexDictionary),r=[...e.segments],c=a[t],i=`${Math.floor(n.lon*H)},${Math.floor(n.lat*H)}`,d=`${Math.floor(c.lon*H)},${Math.floor(c.lat*H)}`;if(delete o[d],i in o){const f=o[i];for(const x of r)x.start===f&&(x.start=t),x.end===f&&(x.end=t);delete a[f]}return a[t]=n,S(h({},e),{segments:r,vertecies:a,vertexDictionary:o})}function Xa(e,t){const n=h({},e.vertecies),a=h({},e.vertexDictionary),o=[...e.segments];let{lastIndex:r}=e;for(const c of t){const i=e.segments[c],d=e.vertecies[i.start],f=e.vertecies[i.end],x={lon:(d.lon+f.lon)/2,lat:(d.lat+f.lat)/2},[m,u]=oe(x,a,n,r);r=u;const b=S(h({},i),{end:m,name:`${i.name}_a`}),k=S(h({},i),{start:m,name:`${i.name}_b`});o[c]=b,o.push(k)}return{vertecies:n,vertexDictionary:a,segments:o,lastIndex:r}}const Za={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},wt=$("bridgeVertices"),St=$("createSegmet"),Nt=$("deleteSegment"),kt=$("editSegmentData"),Ct=$("extrudeSegment"),fe=$("loadNewSegmentData"),_t=$("mergeVertices"),De=$("moveVertex"),Lt=$("splitSegment");function Ya(e,t,n){if(n.dip===90||n.locking_depth<=0)return!1;const a=n.dip<90,r=(a?90-n.dip:n.dip-90)*(Math.PI/180),c=Math.abs(Math.tan(r)*n.locking_depth),[i,d]=e.lon>=t.lon?[e,t]:[t,e],f={lon:d.lat-i.lat,lat:-(d.lon-i.lon)};a&&(f.lon*=-1,f.lat*=-1);const x=st(ot([[i.lon,i.lat],[i.lon+f.lon,i.lat+f.lat]]),c,{units:"kilometers"}),m=st(ot([[d.lon,d.lat],[d.lon+f.lon,d.lat+f.lat]]),c,{units:"kilometers"});return[i,{lon:x.geometry.coordinates[0],lat:x.geometry.coordinates[1]},{lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1]},d]}function es(e){return e.segments.map(t=>Ya(e.vertecies[t.start],e.vertecies[t.end],t)).filter(t=>t)}const ts=ee(Za,e=>{e.addCase(wt,(t,n)=>Ga(t,n.payload)).addCase(St,(t,n)=>Ka(t,n.payload)).addCase(Nt,(t,n)=>Ha(t,n.payload)).addCase(kt,(t,n)=>za(t,n.payload)).addCase(Ct,(t,n)=>Ja(t,n.payload)).addCase(fe,(t,n)=>Ua(t,n.payload)).addCase(_t,(t,n)=>qa(t,n.payload)).addCase(De,(t,n)=>Qa(t,n.payload)).addCase(Lt,(t,n)=>Xa(t,n.payload))});function ns(e,{data:t}){return[...e,sa(t)]}function as(e,t){const n=[];for(const[a,o]of e.entries())t.includes(a)||n.push(o);return n}function ss(e,t){const n=[...e];for(const a of t.indices){const o=h(h({},n[a]),t.data);n[a]=o}return n}function os(e,t){return t}function ls(e,{index:t,position:n}){const a=[...e],o=h(h({},a[t]),n);return a[t]=o,a}const is=[],$t=$("createVelocity"),jt=$("editVelocity"),Dt=$("deleteVelocity"),Fe=$("loadNewVelocityData"),Ft=$("moveVelocity"),rs=ee(is,e=>{e.addCase($t,(t,n)=>ns(t,n.payload)).addCase(jt,(t,n)=>ss(t,n.payload)).addCase(Dt,(t,n)=>as(t,n.payload)).addCase(Fe,(t,n)=>os(t,n.payload)).addCase(Ft,(t,n)=>ls(t,n.payload))});function re(e){const t=e.split(/\n/g),n=t[0].split(",").map(r=>r.trim()),a=t.slice(1),o=[];for(const r of a)if(r.trim()!==""){const c=r.split(/\s*,\s*/),i={};for(let d=0;d<n.length;d+=1){let f=c[d];const x=n[d],m=Number.parseFloat(f);f=Number.isNaN(m)?f:m,typeof f=="string"&&(f=f.startsWith('"')&&f.endsWith('"')?f.slice(1,-1).trim():f.trim()),i[x]=f}o.push(i)}return o}function Me(e,t){const n=[t.join(",")];for(const a of e){const o=a;n.push(t.map(r=>{if(r in o){const c=o[r];return typeof c=="string"&&/\s/.test(`${c}`)?`"${c.trim()}"`:`${typeof c=="number"&&(r.includes("lon")||r.includes("lat"))?c.toFixed(6):c}`}return""}).join(","))}return n.join(`
`)}function cs(e){return e.map(t=>{const n={};for(const a of Ne)n[a]=t[a]||(a==="name"?"":0);return n})}function Ve(e){return Me(e,Ne)}async function Mt(e){return cs(re(await e.getContents()))}class ds{constructor(t,n,a){j(this,"name");j(this,"path");j(this,"parent");this.name=t,this.parent=n,this.path=a!=null?a:[this.name]}async getContents(){const t=this.parent[this.name];if(typeof t!="string")throw new Error("No Such File");return t}async setContents(t){this.parent[this.name]=t}}class Ie{constructor(t,n,a){j(this,"name");j(this,"path");j(this,"parent");j(this,"fileList");j(this,"folderList");this.name=t,this.parent=n,this.fileList=[],this.folderList=[],this.path=a!=null?a:[this.name];const o=n[t];for(const r of Object.keys(o))typeof o[r]=="string"?this.fileList.push(r):this.folderList.push(r)}async getFile(t){return new ds(t,this.parent[this.name],[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("No Such Directory");return new Ie(t,this.parent[this.name],[...this.path,t])}}const us=async e=>new Ie("root",e);let Vt=async()=>{var t;return us((t=window.FakeDirectory)!=null?t:{})};function ms(e){Vt=e}async function fs(){return Vt()}async function It(e,t,n){const a=t.split("/");let o=[...e.path];"getContents"in e&&o.pop();for(const d of a)if(d===".."){if(o.length===0)return!1;o.pop()}else d!==""&&d!=="."&&o.push(d);if(o.length<2)return!1;const r=o.pop();if(!r)return!1;o=o.slice(1);let c=n;for(const d of o)c=await c.getDirectory(d);return await c.getFile(r)}async function pe(e,t,n){const a=t.replace("../","").replace("./","").replace("data/","../");return It(e,a,n)}function he(e){return`../data/${e.path.slice(-2).join("/")}`}function ps(e){const t=h({},ue);for(const n of Ca)n in e&&(t[n]=e[n]);return t}function hs(e){const t=JSON.parse(e);return ps(t)}class gs{constructor(t){j(this,"data");j(this,"handle");this.handle=t,this.data=void 0}async initialize(){const t=await this.handle.getContents(),n=re(t);this.data=n}async save(){}}function ys(e){const n=[...e.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const o=Number.parseFloat(a[1]),r=Number.parseFloat(a[2]);return{lon:o,lat:r}});return n.splice(0,0,{lon:0,lat:0}),n}const bs={"1":e=>{var a,o;const t=Number.parseInt((a=e[e.length-2])!=null?a:"",10),n=Number.parseInt((o=e[e.length-1])!=null?o:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)?[[t,n]]:!1},"2":e=>{var o,r,c;const t=Number.parseInt((o=e[e.length-3])!=null?o:"",10),n=Number.parseInt((r=e[e.length-2])!=null?r:"",10),a=Number.parseInt((c=e[e.length-1])!=null?c:"",10);return!Number.isNaN(t)&&!Number.isNaN(n)&&!Number.isNaN(a)?[[t,n],[n,a],[a,t]]:!1}};function xs(e){return e.split(/\n/).map(t=>t.trim()).map(t=>t.split(/\s+/)).filter(t=>t.length>2).map(t=>{var a;return((a=bs[t[1]])!=null?a:()=>!1)(t)}).filter(t=>t).flat()}function vs(e,t){return t.map(([n,a])=>n!==a&&n>-1&&n<e.length&&a>-1&&a<e.length?[e[n],e[a]]:!1).filter(n=>n)}function ws(e){if(!e.startsWith("$"))return[];const t=e.split("$");let n=[],a=[];for(const o of t)o.startsWith("Nodes")?n=ys(o):o.startsWith("Elements")&&(a=xs(o));return vs(n,a)}class Ot{constructor(t){j(this,"data");j(this,"handle");j(this,"startLonColumn");j(this,"endLonColumn");j(this,"startLatColumn");j(this,"endLatColumn");this.handle=t,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const t=await this.handle.getContents();if(t.startsWith("$"))this.data=ws(t);else{const n=re(t);this.data=n.map(a=>{const o={lon:0,lat:0},r={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(o.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(o.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(r.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(r.lat=a[this.endLatColumn]);const c=Object.keys(a).filter(i=>i!==this.startLatColumn&&i!==this.endLatColumn&&i!==this.startLonColumn&&i!==this.endLonColumn);if(c.length>0){const i={};for(const d of c)i[d]=a[d];return[o,r]}return[o,r]})}}async save(){console.log("Mesh files do not get saved")}}function Ss(e){const t=e.map(c=>{const i={};for(const d of ce)i[d]=c[d]||(d==="name"?"":0);return i}).filter(c=>{for(const i of ce)if(!(i in c))return!1;return!0}),n={},a={},o=[];let r=0;for(const c of t){const[i,d]=oe({lon:c.lon1,lat:c.lat1},n,a,r),[f,x]=oe({lon:c.lon2,lat:c.lat2},n,a,d),m=S(h({},c),{start:i,end:f});r=x,o.push(m)}return{vertecies:a,vertexDictionary:n,segments:o,lastIndex:r}}function ge({vertecies:e,segments:t}){const n=t.map(a=>{const o=e[a.start],r=e[a.end];return S(h({},a),{lon1:o.lon,lat1:o.lat,lon2:r.lon,lat2:r.lat})});return Me(n,ce)}async function Oe(e){const t=await e.getContents();return Ss(re(t))}function Ns(e){return e.map(t=>{const n={};for(const a of de)n[a]=t[a]||(a==="name"?"":0);return n}).filter(t=>{for(const n of de)if(!(n in t))return!1;return!0})}function Pe(e){return Me(e,de)}async function Pt(e){const t=await e.getContents();return Ns(re(t))}async function ks(e){const t=new Ot(e);return await t.initialize(),t}async function Rt(e,t){const n=await e.getContents(),a=JSON.parse(n);return Array.isArray(a)?(await Promise.all(a.map(async r=>{const c=r.mesh_filename.split("/"),i=await It(e,c[c.length-1],t);if(!i)return!1;const d=await ks(i);return d.data?{line:d.data,parameters:r}:!1}))).filter(r=>!!r):[]}async function Cs(e,t){const n=hs(await t.getContents()),a={commands:t,segments:!1,blocks:!1,velocities:!1,mesh:!1};return console.log("Opened command file",n),console.log("Current File",t),console.log("Root",e),n.segment_file_name&&(a.segments=await pe(t,n.segment_file_name,e)),n.block_file_name&&(a.blocks=await pe(t,n.block_file_name,e)),n.station_file_name&&(a.velocities=await pe(t,n.station_file_name,e)),n.mesh_parameters_file_name&&(a.mesh=await pe(t,n.mesh_parameters_file_name,e)),{command:n,files:a}}class _s{constructor(t,n){j(this,"name");j(this,"path");j(this,"handle");this.handle=t,this.name=t.name,this.path=n!=null?n:[this.name]}async getContents(){return(await this.handle.getFile()).text()}async setContents(t){const n=await this.handle.createWritable();await n.write(t),await n.close()}}class Re{constructor(t,n){j(this,"name");j(this,"path");j(this,"handle");j(this,"fileList");j(this,"folderList");this.handle=t,this.fileList=[],this.folderList=[],this.name=t.name,this.path=n!=null?n:[this.name]}async initialize(){for await(const t of this.handle.values())t.kind==="directory"?this.folderList.push(t.name):this.fileList.push(t.name)}async getFile(t){const n=await this.handle.getFileHandle(t,{create:!0});return new _s(n,[...this.path,t])}async getDirectory(t){if(!this.folderList.includes(t))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(t),a=new Re(n,[...this.path,t]);return await a.initialize(),a}}const Ls=async()=>{const e=await window.showDirectoryPicker();await e.requestPermission({mode:"readwrite"});const t=new Re(e);return await t.initialize(),t};window.location.search.includes("fake-dir")||ms(Ls);var A;(function(e){e.Vertex="Vertices",e.Block="Blocks",e.Velocity="Velocities"})(A||(A={}));const Bt={Block:A.Block,Vertex:A.Vertex,Velocity:A.Velocity},$s={command:"Command",segment:"Segment",vertex:"Vertices",block:"Block",velocities:"Velocities",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function js(){var Ye,et;const e=dt(),t=P(l=>l.main.present.fileHandles.rootFolder),[n,a]=L.exports.useState(!1),[o,r]=L.exports.useState("command"),c=P(l=>l.main.present.fileHandles.files.segment),i=P(l=>l.main.present.fileHandles.files.block),d=P(l=>l.main.present.fileHandles.files.velocity),f=P(l=>l.main.present.fileHandles.files.command),x=P(l=>l.main.present.fileHandles.files.mesh_params),m=P(l=>l.main.present.segment),u=P(l=>l.main.present.block),b=P(l=>l.main.present.velocity),k=P(l=>l.main.present.meshLine),y=P(l=>l.main.present.genericSegments),g=P(l=>l.main.present.command),[w,N]=L.exports.useState(ia),[_,T]=L.exports.useState(Dn),[D,Be]=L.exports.useState(Yn),[F,Ee]=L.exports.useState(da),[W,Ae]=L.exports.useState(Qn),[G,Te]=L.exports.useState(Pn),[le,Ht]=L.exports.useState(Jn),[K,X]=L.exports.useState("normal"),[Z,zt]=L.exports.useState(A.Vertex),[ye,We]=L.exports.useState([]),[Ge,Ke]=L.exports.useState([]),[He,ze]=L.exports.useState([]),[Je,Ue]=L.exports.useState([]),[I,Is]=L.exports.useState({select:ut({mode:K,setSelectedBlock:We,setSelectedSegment:Ke,setSelectedVelocity:ze,setSelectedVertex:Ue,setActiveTab:r})}),[Jt,Ut]=L.exports.useState([]),[qt,qe]=L.exports.useState([]),[Qt,Xt]=L.exports.useState([]),[Zt,Qe]=L.exports.useState([]),[Yt,be]=L.exports.useState({color:F.color,selectedColor:F.activeColor,radius:F.radius,selectedRadius:F.activeRadius,points:[]}),[Xe,en]=L.exports.useState({lon:0,lat:0}),[xe,tn]=L.exports.useState(!1);L.exports.useEffect(()=>{I.select=ut({mode:K,setSelectedBlock:We,setSelectedSegment:Ke,setSelectedVelocity:ze,setSelectedVertex:Ue,setActiveTab:r})},[K,I]),L.exports.useEffect(()=>{const l=[];Z!==A.Block&&!_.hide&&l.push({name:"blocks",color:_.color,selectedColor:_.selectedColor,radius:_.radius,points:u.map((p,C)=>({longitude:p.interior_lon,latitude:p.interior_lat,name:p.name,description:"",index:C,label:_.plottableKey in p?`${p[_.plottableKey]}`:""})),click:p=>{I.select("block",[p])}}),Z!==A.Vertex&&!F.hide&&l.push({name:"vertices",color:F.color,selectedColor:F.activeColor,radius:F.radius,click:p=>{I.select("vertex",[p])},points:Object.keys(m.vertecies).map(p=>{const C=Number.parseInt(p,10),M=m.vertecies[C];return M?{longitude:M.lon,latitude:M.lat,index:C,name:"",description:""}:!1}).filter(p=>!!p)}),Ut(l)},[_,u,D,I,Z,F.hide,F.color,F.activeColor,F.radius,m.vertecies]),L.exports.useEffect(()=>{const l=[];if(D.hide||l.push({name:"segments",color:D.color,selectedColor:D.activeColor,width:D.width,selectedWidth:D.activeWidth,lines:m.segments.map((p,C)=>{var ae,q;const M=(ae=m.vertecies[p.start])!=null?ae:it,R=(q=m.vertecies[p.end])!=null?q:it,[[ne,Y],[J,B]]=Ce(M,R);return{startLongitude:ne,startLatitude:Y,endLongitude:J,endLatitude:B,name:p.name,description:`${M.lon},${M.lat} to ${R.lon},${R.lat}`,index:C,label:D.plottableKey in p?`${p[D.plottableKey]}`:""}}),click:p=>{I.select("segment",[p])}}),!W.hide)for(const p of Object.keys(k)){const C=k[p].line;l.push({name:`mesh:${p}`,color:W.color,selectedColor:W.activeColor,width:W.width,selectedWidth:W.activeWidth,lines:C.map((M,R)=>{const ne=M[0],Y=M[1],[[J,B],[ae,q]]=Ce(ne,Y);return{startLongitude:J,startLatitude:B,endLongitude:ae,endLatitude:q,name:"",description:"",index:R}})||[]})}if(!G.hide)for(const p of Object.keys(y)){const{startLat:C,startLon:M,endLat:R,endLon:ne,plot:Y,segments:J}=y[p];C in J[0]&&R in J[0]&&M in J[0]&&ne in J[0]&&l.push({name:`generic_segment:${p}`,color:G.color,selectedColor:G.activeColor,width:G.width,selectedWidth:G.activeWidth,lines:J.map((B,ae)=>{const q={lat:B[C],lon:B[M]},ve={lat:B[R],lon:B[ne]};if(typeof q.lat!="number"||typeof q.lon!="number"||typeof ve.lat!="number"||typeof ve.lon!="number")return!1;const[[nn,an],[sn,on]]=Ce(q,ve);return{startLongitude:nn,startLatitude:an,endLongitude:sn,endLatitude:on,name:"",description:"",index:ae,label:Y&&Y in B?`${B[Y]}`:""}}).filter(B=>B)||[]})}Xt(l)},[m,D,G,y,W,k,I]),L.exports.useEffect(()=>{switch(Z){case A.Vertex:{be({color:F.color,radius:F.radius,selectedColor:F.activeColor,selectedRadius:F.activeRadius,points:F.hide?[]:Object.keys(m.vertecies).map(l=>{const p=Number.parseInt(l,10),C=m.vertecies[p];return C?{longitude:C.lon,latitude:C.lat,index:p}:!1}).filter(l=>!!l),update:(l,p)=>{e(De({index:l,vertex:p}))},select:l=>{I.select("vertex",l)}});break}case A.Block:{be({color:_.color,radius:_.radius,selectedColor:_.selectedColor,selectedRadius:_.radius,points:_.hide?[]:u.map((l,p)=>({longitude:l.interior_lon,latitude:l.interior_lat,name:l.name,description:"",index:p,label:_.plottableKey in l?`${l[_.plottableKey]}`:""})),update:(l,p)=>{e(ht({index:l,position:p}))},select:l=>{I.select("block",l)}});break}case A.Velocity:{be({color:w.color,radius:w.width,selectedColor:w.selectedColor,selectedRadius:w.width,points:w.hide?[]:b.map((l,p)=>({longitude:l.lon,latitude:l.lat,name:l.name,description:"",index:p})),update:(l,p)=>{e(Ft({index:l,position:p}))},select:l=>{I.select("velocities",l)}});break}}},[F,I,m.vertecies,e,Z,_.color,_.radius,_.selectedColor,_.hide,u,w.color,w.width,w.selectedColor,w.hide,b,_.plottableKey]),L.exports.useEffect(()=>{w.hide?qe([]):qe([{name:"velocities",color:w.color,selectedColor:w.selectedColor,scale:w.scale,arrowHeadScale:w.arrowHead,width:w.width,arrows:b.map((l,p)=>{const C=Math.sqrt(l.east_vel*l.east_vel+l.north_vel*l.north_vel);return{longitude:l.lon,latitude:l.lat,direction:[l.east_vel/C,l.north_vel/C],scale:C,name:l.name,description:`north: ${l.north_vel}, east: ${l.east_vel}`,index:p,label:w.plottableKey in l?`${l[w.plottableKey]}`:""}}),click:l=>{I.select("velocities",[l])}}])},[I,w,b]),L.exports.useEffect(()=>{D.hideProjection||D.hide?Qe([]):Qe([{name:"fault_dip_projections",color:D.projectionColor,borderColor:D.projectionColor,borderRadius:.5,polygons:es(m).map((l,p)=>({polygon:l,index:p,name:"",description:""}))}])},[D,m]);let z=s("span",{});switch(o){case"velocities":z=s(ra,{open:()=>{console.log("opening velocities file"),a({extension:"csv",callback:async l=>{const p=await Pt(l);e(Fe(p)),e(O({file:l,key:"velocity",path:l.path}))}})},settings:w,setSettings:N,selected:He,velocitys:b,setVelocityData:(l,p)=>{p?e(jt({indices:l,data:p})):(e(Dt(l)),I.select("velocity",[]))},addNewVelocity:()=>{X({label:"Click to place velocity estimate",mode:"mapClick",callback:l=>{X("normal");const p=b.length;e($t({data:{lat:l.lat,lon:l.lon}})),I.select("velocity",[p])}})},save:async l=>{l?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(O({file:p,key:"velocity",path:p.path})),await p.setContents(Pe(b))}}):d&&await d.file.setContents(Pe(b))}});break;case"block":z=s(Fn,{open:()=>{console.log("opening block file"),a({extension:"csv",callback:async l=>{const p=await Mt(l);e(Le(p)),e(O({file:l,key:"block",path:l.path}))}})},settings:_,setSettings:T,selected:ye,blocks:u,addNewBlock:()=>{X({label:"Click to place new block",mode:"mapClick",callback:l=>{const p=u.length;e(mt({data:{name:"New Block",interior_lon:l.lon,interior_lat:l.lat}})),I.select("block",[p]),X("normal")}})},setBlockData:(l,p)=>{p?e(ft({indices:ye,data:p})):(e(pt(l)),I.select("block",[]))},save:async l=>{l?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(O({file:p,key:"block",path:p.path})),await p.setContents(Ve(u))}}):i&&await i.file.setContents(Ve(u))}});break;case"segment":z=s(ta,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async l=>{const p=await Oe(l);e(fe(p)),e(O({file:l,key:"segment",path:l.path}))}})},settings:D,setSettings:Be,segments:(Ye=m.segments)!=null?Ye:[],selected:Ge,setSelectionMode:l=>X(l),addNewSegment:(l,p)=>{const C=m.segments.length;e(St({start:l,end:p})),I.select("segment",[C])},setSegmentData:(l,p)=>{e(p?kt({indices:l,data:p}):Nt({index:l}))},splitSegment:l=>{e(Lt(l)),I.select("segment",[])},save:async l=>{l?a({extension:".csv",isSaveFile:!0,callback:async p=>{e(O({file:p,key:"segment",path:p.path})),await p.setContents(ge(m))}}):c&&await c.file.setContents(ge(m))}});break;case"vertex":z=s(ua,{open:()=>{console.log("opening segment file"),a({extension:"csv",callback:async l=>{const p=await Oe(l);e(fe(p)),e(O({file:l,key:"segment",path:l.path}))}})},settings:F,setSettings:Ee,vertices:(et=m.vertecies)!=null?et:{},selected:Je,setVertexData:(l,p)=>{p&&e(De({index:l,vertex:p}))},setSelectionMode:l=>X(l),mergeVertices:(l,p)=>{e(_t({a:l,b:p}))},bridgeVertices:(l,p)=>{e(wt({a:l,b:p}))},extrudeVertex:(l,p)=>{e(Ct({index:l,targetPoint:p}))},save:async()=>{c&&await c.file.setContents(ge(m))}});break;case"mesh":z=s(Xn,{open:()=>{console.log("opening mesh file"),a({extension:"msh",callback:async l=>{const p=new Ot(l);await p.initialize(),p.data&&e(me({mesh:l.name,data:p.data}))}})},openMultiple:()=>{console.log("opening mesh file"),a({extension:"json",callback:async l=>{if(t){e(je());const p=await Rt(l,t);e(O({file:l,key:"mesh_params",path:l.path}));for(const C of p)e(me({mesh:C.parameters.mesh_filename,parameters:C.parameters,data:C.line}))}}})},settings:W,setSettings:Ae});break;case"csv":z=s(Rn,{open:()=>{console.log("opening generic segment file"),a({extension:"csv",callback:async l=>{const p=new gs(l);await p.initialize(),p.data&&e(bt({name:l.name,data:p.data}))}})},settings:G,setSettings:Te,setCollectionVertexKeys:l=>{e(xt(l))},collections:y});break;case"map":z=s(Un,{settings:le,setSettings:Ht});break;case"command":z=s(Mn,{command:g,setCommandData:l=>{e($e(l))},open:()=>{console.log("opening command file"),a({extension:"json",callback:async l=>{if(t){const{command:p,files:C}=await Cs(t,l);if(e(gt(p)),e(O({file:l,key:"command",path:l.path})),C.blocks){const M=await Mt(C.blocks);e(Le(M)),e(O({file:C.blocks,key:"block",path:C.blocks.path}))}if(C.segments){const M=await Oe(C.segments);e(fe(M)),e(O({file:C.segments,key:"segment",path:C.segments.path}))}if(C.velocities){const M=await Pt(C.velocities);e(Fe(M)),e(O({file:C.velocities,key:"velocity",path:C.velocities.path}))}if(C.mesh&&t){e(je());const M=await Rt(C.mesh,t);e(O({file:C.mesh,key:"mesh_params",path:C.mesh.path}));for(const R of M)e(me({mesh:R.parameters.mesh_filename,parameters:R.parameters,data:R.line}))}}}})},save:async l=>{const p=h({},g);c&&(p.segment_file_name=he(c.file)),i&&(p.block_file_name=he(i.file)),d&&(p.station_file_name=he(d.file)),x&&(p.mesh_parameters_file_name=he(x.file)),l?a({extension:".json",isSaveFile:!0,callback:async C=>{e(O({file:C,key:"command",path:C.path})),e($e({file_name:C.name})),p.file_name=C.name,await C.setContents(JSON.stringify(p))}}):f&&await f.file.setContents(JSON.stringify(p))}});break}const Ze={Block:{state:_.hide,change:()=>{T(S(h({},_),{hide:!_.hide}))}},Vertex:{state:F.hide,change:()=>{Ee(S(h({},F),{hide:!F.hide}))}},Velocity:{state:w.hide,change:()=>{N(S(h({},w),{hide:!w.hide}))}},Segment:{state:D.hide,change:()=>{Be(S(h({},D),{hide:!D.hide}))}},Grid:{state:!xe,change:()=>{tn(!xe)}},Mesh:{state:W.hide,change:()=>{Ae(S(h({},W),{hide:!W.hide}))}},GenericSegments:{state:G.hide,change:()=>{Te(S(h({},G),{hide:!G.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:l=>{l.key==="Escape"&&X("normal")},children:[s(na,{filesOpen:t!==void 0,saveFiles:async()=>{c&&await c.file.setContents(ge(m)),i&&await i.file.setContents(Ve(u)),d&&await d.file.setContents(Pe(b))},folder:t,openFolder:async()=>{const l=await fs();e(yt(l)),r("command")}}),K!=="normal"?s("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:v("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[s("span",{className:"text-lg font-semibold",children:K.label}),K.subtitle?s("span",{className:"text-md font-thin text-gray-500",children:K.subtitle}):s(V,{}),s("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):s(V,{}),v("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[s("div",{className:"flex flex-row items-center justify-between gap-5",children:v("span",{className:"p-1 text-sm text-center",children:["Hold ",s("span",{className:"font-bold",children:"Shift"})," to box select"," ",s("span",{className:"font-bold",children:Z})]})}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor(Xe.lon*1e3)/1e3,","," ",Math.floor(Xe.lat*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[s("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Bt).map(l=>{const p=Bt[l];return s("button",{type:"button",className:`${Z===p?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{zt(p)},children:l},l)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Ze).map(l=>{const p=Ze[l];return s("button",{type:"button",className:`${p.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{p.change()},children:l},l)})]})]}),s(zn,{pointSources:Jt,arrowSources:qt,lineSources:Qt,drawnPointSource:Yt,polygonSources:Zt,selections:{segments:Ge,blocks:ye,velocities:He,vertices:Je},displayGrid:xe?10:-1,click:l=>{typeof K!="string"&&K.mode==="mapClick"&&K.callback(l)},mouseMove:l=>{en(l)},styleUri:`mapbox://styles/${le.currentStyle.user}/${le.currentStyle.styleId}`},`${le.currentStyle.user}:${le.currentStyle.styleId}`),t?s(Bn,{view:z,buttons:$s,active:o,setActive:l=>r(l)}):s(V,{}),t&&n?s(In,{root:t,chooseFile:(l,p)=>{n.callback(l,p),a(!1)},close:()=>{a(!1)},extension:n.extension,isSaveDialog:n.isSaveFile===!0}):s(V,{})]})}const Ds=yn({reducer:{main:bn(xn({segment:ts,block:ka,velocity:rs,meshLine:Wa,genericSegments:Ra,fileHandles:Fa,command:$a}))}});function Fs(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:o,onRegisterError:r}=e;let c;const i=async(d=!0)=>{};return"serviceWorker"in navigator&&(c=new vn("./sw.js",{scope:"./"}),c.addEventListener("activated",d=>{d.isUpdate?window.location.reload():a==null||a()}),c.register({immediate:t}).then(d=>{o==null||o(d)}).catch(d=>{r==null||r(d)})),i}Fs();const Ms=1,Vs=new wn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Ms}}});Sn.render(s(L.exports.StrictMode,{children:s(Nn,{client:Vs,children:s(kn,{store:Ds,children:s(js,{})})})}),document.querySelector("#root"));
