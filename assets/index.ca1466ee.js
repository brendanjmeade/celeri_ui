var U=Object.defineProperty,K=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var M=(n,e,a)=>e in n?U(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,y=(n,e)=>{for(var a in e||(e={}))Y.call(e,a)&&M(n,a,e[a]);if(R)for(var a of R(e))ee.call(e,a)&&M(n,a,e[a]);return n},x=(n,e)=>K(n,X(e));var f=(n,e,a)=>(M(n,typeof e!="symbol"?e+"":e,a),a);import{j as O,m as H,r as g,a as D,M as te,v as ne,Q as ae,R as se,b as ie}from"./vendor.2c6bff34.js";const oe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}};oe();const r=O.exports.jsx,v=O.exports.jsxs,re=O.exports.Fragment,le={color:"#0000ff",radius:6};var Q;const ce=JSON.parse((Q=window.localStorage.getItem("blockDisplaySettings"))!=null?Q:"false")||le;function de({settings:n,setSettings:e}){const a=t=>{e(t),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(t))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:t=>{a(x(y({},n),{color:t.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Radius"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:t=>{a(x(y({},n),{radius:Number.parseFloat(t.target.value)}))}})})]})]})}function pe({folder:n,files:e,setFile:a}){const t=Object.keys(e).map(s=>{const i=e[s];return v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[r("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:i.name}),r("span",{className:"text-sm","data-testid":`file-${s}-description`,children:i.description})]}),r("span",{className:"w-2/5 flex-shrink-0",children:v("select",{"data-testid":`file-${s}-select`,className:"w-full rounded",value:i.currentFilePath,onChange:async d=>{const u=d.currentTarget.value;try{const w=await n.getFile(u);a(s,w.name,w)}catch{a(s,"")}},children:[r("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),n.fileList.filter(d=>d.endsWith(i.extension)).map(d=>r("option",{value:d,"data-testid":`file-${s}-select-${d}`,children:d},d))]})})]},s)});return r("div",{className:"flex flex-col gap-2",children:t})}function ue({view:n,buttons:e,active:a,setActive:t}){if(!e)return r("span",{});const s=[];for(const i of Object.keys(e)){const d=e[i],u=i===a;s.push(r("button",{type:"button","data-testid":`tab-${i}`,className:`${u?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>t(u?"":i),children:d},i))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[a?r("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:n}):"",r("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:s})]})}H.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const j=Math.PI/6,P=2*Math.PI-j;function fe({pointSources:n,arrowSources:e}){const a=g.exports.useRef(null),[t,s]=g.exports.useState(),[i,d]=g.exports.useState(!1),[u,w]=g.exports.useState(),[_]=g.exports.useState(new D.exports.Popup({closeButton:!1,closeOnClick:!1})),[S,k]=g.exports.useState(),[N,$]=g.exports.useState();return g.exports.useEffect(()=>{if(!t&&H.accessToken&&a.current){const o=new D.exports.Map({container:a.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});o.addControl(new D.exports.NavigationControl);const m=new te({});o.addControl(m),s(o),w(m),o.on("load",()=>{d(!0)})}console.log("Updating map...")},[t,u]),g.exports.useEffect(()=>{if(console.log("Adding layers"),t&&i&&S!==n)if(console.log("Setting points in map!"),S){for(const o of S){const m=t.getSource(`point:${o.name}`);m!==void 0&&m.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${o.name}`)}k(void 0)}else{for(const o of n){let m=t.getSource(`point:${o.name}`);const F=m===void 0;F&&(t.addSource(`point:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),m=t.getSource(`point:${o.name}`)),m!==void 0&&m.setData({type:"FeatureCollection",features:o.points.map((l,p)=>({type:"Feature",properties:{description:`<strong>${l.name}</strong><p>${l.description}</p>`,index:p,name:l.name},geometry:{type:"Point",coordinates:[l.longitude,l.latitude]}}))}),t.addLayer({id:`layer:point:${o.name}`,type:"circle",source:`point:${o.name}`,paint:{"circle-color":o.color,"circle-radius":o.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),F&&(t.on("mouseenter",`layer:point:${o.name}`,l=>{if(!l.features)return;const p=l.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const c=[...p.geometry.coordinates],{description:h}=p.properties;for(;Math.abs(l.lngLat.lng-c[0])>180;)c[0]+=l.lngLat.lng>c[0]?360:-360;_.setLngLat(c).setHTML(h).addTo(t)}}),t.on("mouseleave",`layer:point:${o.name}`,()=>{_.remove()}),t.on("click",`layer:point:${o.name}`,l=>{if(!l.features||!o.clickPoint)return;const p=l.features[0];if(p.properties&&typeof p.properties.index=="number"&&typeof p.properties.name=="string"){const{index:c,name:h}=p.properties;o.clickPoint(c,h)}}))}k(n)}},[t,S,n,i,_]),g.exports.useEffect(()=>{if(console.log("Adding layers"),t&&i&&N!==e)if(console.log("Setting arrows in map!"),N){for(const o of N){const m=t.getSource(`arrow:${o.name}`);m!==void 0&&m.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${o.name}`)}$(void 0)}else{for(const o of e){let m=t.getSource(`arrow:${o.name}`);const F=m===void 0;F&&(t.addSource(`arrow:${o.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),m=t.getSource(`arrow:${o.name}`)),m!==void 0&&m.setData({type:"FeatureCollection",features:o.arrows.map((l,p)=>{const c=l.scale*o.scale,h=o.scale*o.arrowHeadScale,b=[l.longitude+l.direction[0]*c,l.latitude+l.direction[1]*c],L=[b[0]+(Math.cos(j)*-l.direction[0]-Math.sin(j)*-l.direction[1])*h,b[1]+(Math.sin(j)*-l.direction[0]+Math.cos(j)*-l.direction[1])*h],C=[b[0]+(Math.cos(P)*-l.direction[0]-Math.sin(P)*-l.direction[1])*h,b[1]+(Math.sin(P)*-l.direction[0]+Math.cos(P)*-l.direction[1])*h];return{type:"Feature",properties:{description:`<strong>${l.name}</strong><p>${l.description}</p>`,index:p,name:l.name},geometry:{type:"LineString",coordinates:[[l.longitude,l.latitude],b,L,b,C]}}})}),t.addLayer({id:`layer:arrow:${o.name}`,type:"line",source:`arrow:${o.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":o.color,"line-width":o.width}}),F&&(t.on("mouseenter",`layer:arrow:${o.name}`,l=>{if(!l.features)return;const p=l.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const c=[...p.geometry.coordinates],{description:h}=p.properties;for(;Math.abs(l.lngLat.lng-c[0])>180;)c[0]+=l.lngLat.lng>c[0]?360:-360;_.setLngLat(c).setHTML(h).addTo(t)}}),t.on("mouseleave",`layer:arrow:${o.name}`,()=>{_.remove()}),t.on("click",`layer:arrow:${o.name}`,l=>{if(!l.features||!o.clickArrow)return;const p=l.features[0];if(p.properties&&typeof p.properties.index=="number"&&typeof p.properties.name=="string"){const{index:c,name:h}=p.properties;o.clickArrow(c,h)}}))}$(e)}},[t,N,e,i,_]),r("div",{"data-testid":"map",className:"w-full h-full",ref:a})}function me({folder:n,openFolder:e}){function a(){e()}return v("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[r("h3",{className:"text-lg font-bold",children:"Celeri UI"}),r("span",{"data-testid":"open-folder-topbar",children:n?v(re,{children:["Working in ",n.name]}):r("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"})})]})}const he={color:"#ffff00",scale:.02,width:1,arrowHead:1};var Z;const ge=JSON.parse((Z=window.localStorage.getItem("velocityDisplaySettings"))!=null?Z:"false")||he;function _e({settings:n,setSettings:e}){const a=t=>{e(t),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(t))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:t=>{a(x(y({},n),{color:t.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Scale"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:t=>{a(x(y({},n),{scale:Number.parseFloat(t.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Width"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:t=>{a(x(y({},n),{width:Number.parseFloat(t.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Arrow Head Size"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:t=>{a(x(y({},n),{arrowHead:Number.parseFloat(t.target.value)}))}})})]})]})}function A(n){const e=n.split(/\n/g),a=e[0].split(","),t=e.slice(1),s=[];for(const i of t){const d=i.split(/\s*,\s*/),u={};for(let w=0;w<a.length;w+=1){let _=d[w];const S=a[w],k=Number.parseFloat(_);_=Number.isNaN(k)?_:k,typeof _=="string"&&_.startsWith('"')&&_.endsWith('"')&&(_=_.slice(1,-1)),u[S]=_}s.push(u)}return s}function I(n,e){const a=[e.join(",")];for(const t of n){const s=t;a.push(e.map(i=>i in s?typeof s[i]=="string"&&/\s/.test(`${s[i]}`)?`"${s[i]}"`:`${s[i]}`:"").join(","))}return a.join(`
`)}const T=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"];class we{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=A(e).map(s=>{const i={};for(const d of T)i[d]=s[d]||(d==="name"?"":0);return i});this.data=t}async save(){var a;const e=I((a=this.data)!=null?a:[],T);await this.handle.setContents(e)}}const ye={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function ve(n){return y(y({},ye),n)}class be{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=JSON.parse(e);this.data=ve(a)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}}const V=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"];class xe{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=A(e).map(s=>{const i={};for(const d of V)i[d]=s[d]||(d==="name"?"":0);return i});this.data=t}async save(){var a;const e=I((a=this.data)!=null?a:[],V);await this.handle.setContents(e)}}const W=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class Se{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=A(e).map(s=>{const i={};for(const d of W)i[d]=s[d]||(d==="name"?"":0);return i});this.data=t}async save(){var a;const e=I((a=this.data)!=null?a:[],W);await this.handle.setContents(e)}}async function B(n){const e=new xe(n);return await e.initialize(),e}async function J(n){const e=new we(n);return await e.initialize(),e}async function q(n){const e=new Se(n);return await e.initialize(),e}async function Ne(n,e,a){const t=new be(e);if(await t.initialize(),t.data){const s=await B(await n.getFile(t.data.segment_file_name)),i=await J(await n.getFile(t.data.block_file_name)),d=await q(await n.getFile(t.data.station_file_name)),u=y({},a);return"command"in u&&(u.command=x(y({},u.command),{currentFilePath:e.name})),"segment"in u&&(u.segment=x(y({},u.segment),{currentFilePath:t.data.segment_file_name})),"block"in u&&(u.block=x(y({},u.block),{currentFilePath:t.data.block_file_name})),"velocities"in u&&(u.velocities=x(y({},u.velocities),{currentFilePath:t.data.station_file_name})),{openableFiles:u,commands:t,segments:s,blocks:i,velocities:d}}throw new Error("Can't open command file")}class Fe{constructor(e){f(this,"name");f(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const a=await this.handle.createWritable();await a.write(e),await a.close()}}class E{constructor(e){f(this,"name");f(this,"handle");f(this,"fileList");f(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const a=await this.handle.getFileHandle(e);return new Fe(a)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const a=await this.handle.getDirectoryHandle(e),t=new E(a);return await t.initialize(),t}}const ke=async()=>{const n=await window.showDirectoryPicker(),e=new E(n);return await e.initialize(),e};class Ce{constructor(e,a){f(this,"name");f(this,"parent");this.name=e,this.parent=a}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class z{constructor(e,a){f(this,"name");f(this,"parent");f(this,"fileList");f(this,"folderList");this.name=e,this.parent=a,this.fileList=[],this.folderList=[];const t=a[e];for(const s of Object.keys(t))typeof t[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Ce(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new z(e,this.parent[this.name])}}const Le=async n=>new z("root",n);let G=async()=>{var e;return Le((e=window.FakeDirectory)!=null?e:{})};function $e(n){G=n}async function je(){return G()}window.location.search.includes("fake-dir")||$e(ke);const Pe={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",mesh:"Mesh"};function Me(){const[n,e]=g.exports.useState(),[a,t]=g.exports.useState(""),[s,i]=g.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[d,u]=g.exports.useState(),[w,_]=g.exports.useState(),[S,k]=g.exports.useState(),[N,$]=g.exports.useState(),[o,m]=g.exports.useState(ge),[F,l]=g.exports.useState(ce);let p=r("span",{});switch(a){case"files":p=n?r(pe,{folder:n,files:s,setFile:async(c,h,b)=>{if(b){let L=y({},s);switch(L[c]=x(y({},L[c]),{currentFilePath:h}),c){case"segment":_(await B(b));break;case"block":k(await J(b));break;case"velocity":$(await q(b));break;case"command":const C=await Ne(n,b,s);u(C.commands),_(C.segments),k(C.blocks),$(C.velocities),L=C.openableFiles;break}i(L)}}}):r("span",{});break;case"velocities":p=r(_e,{settings:o,setSettings:m});break;case"block":p=r(de,{settings:F,setSettings:l});break}return v("div",{className:"w-screen h-screen flex flex-col",children:[r(me,{folder:n,openFolder:async()=>{const c=await je();e(c),t("files")}}),r(fe,{pointSources:[{name:"blocks",color:F.color,radius:F.radius,points:(S==null?void 0:S.data)?S.data.map(c=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:""})):[],clickPoint:(c,h)=>console.log(`Clicked ${c}: ${h}`)}],arrowSources:[{name:"velocity",color:o.color,scale:o.scale,arrowHeadScale:o.arrowHead,width:o.width,arrows:(N==null?void 0:N.data)?N.data.map(c=>{const h=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/h,c.north_vel/h],scale:h,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`}}):[]}]}),r(ue,{view:p,buttons:n?Pe:void 0,active:a,setActive:c=>t(c)})]})}function Oe(n={}){const{immediate:e=!1,onNeedRefresh:a,onOfflineReady:t,onRegistered:s,onRegisterError:i}=n;let d;const u=async(w=!0)=>{};return"serviceWorker"in navigator&&(d=new ne("./sw.js",{scope:"./"}),d.addEventListener("activated",w=>{w.isUpdate?window.location.reload():t==null||t()}),d.register({immediate:e}).then(w=>{s==null||s(w)}).catch(w=>{i==null||i(w)})),u}Oe();const De=1,Ae=new ae({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:De}}});se.render(r(g.exports.StrictMode,{children:r(ie,{client:Ae,children:r(Me,{})})}),document.querySelector("#root"));
