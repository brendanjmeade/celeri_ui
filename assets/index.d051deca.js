var ye=Object.defineProperty,ve=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var V=(i,e,t)=>e in i?ye(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,g=(i,e)=>{for(var t in e||(e={}))xe.call(e,t)&&V(i,t,e[t]);if(ne)for(var t of ne(e))be.call(e,t)&&V(i,t,e[t]);return i},S=(i,e)=>ve(i,we(e));var w=(i,e,t)=>(V(i,typeof e!="symbol"?e+"":e,t),t);import{j as J,m as se,r as m,a as q,M as Ne,v as Se,Q as ke,R as Ce,b as Fe}from"./vendor.2c6bff34.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}};$e();const n=J.exports.jsx,y=J.exports.jsxs,A=J.exports.Fragment;function je({value:i,fieldDefinition:e,setField:t}){return y("div",{className:"flex flex-row justify-between items-center",children:[y("div",{className:"flex flex-col",children:[n("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?n("span",{className:"text-sm",children:e.description}):n(A,{})]}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof i=="number"?"number":"text",value:i,onChange:r=>{t(typeof i=="number"?Number.parseFloat(r.target.value):r.target.value)}})})]})}function oe({title:i,item:e,setItem:t,fieldDefinitions:r}){const a=Object.keys(e).map((o,c)=>{const u=e[o],s=o in r&&r[o];return s?{element:n(je,{value:u,fieldDefinition:s,setField:x=>t({[o]:x})}),order:s.order}:{element:y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{"data-testid":`input-title-${o}`,className:"text-l font-bold",children:o}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{"data-testid":`input-editor-${o}`,className:"rounded w-full",type:typeof u=="number"?"number":"text",value:u,onChange:x=>{t({[o]:typeof u=="number"?Number.parseFloat(x.target.value):x.target.value})}})})]}),order:c+1e3}}).sort((o,c)=>o.order-c.order).map(o=>o.element);return y("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[n("span",{"data-testid":"editable-item-title",className:"text-xl font-bold",children:i}),a]})}const De={color:"#0000ff",selectedColor:"#ff0000",radius:6};var me;const Pe=JSON.parse((me=window.localStorage.getItem("blockDisplaySettings"))!=null?me:"false")||De;function Me({settings:i,setSettings:e,selected:t,blocks:r,setBlockData:a}){const o=s=>{e(s),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(s))},c=r[t],u=c?n(oe,{title:c.name,item:c,setItem:s=>a(t,s),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):n(A,{});return y(A,{children:[y("div",{className:"flex flex-col gap-2",children:[y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Color"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"color",value:i.color,onChange:s=>{o(S(g({},i),{color:s.target.value}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Selected Color"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"color",value:i.selectedColor,onChange:s=>{o(S(g({},i),{selectedColor:s.target.value}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Radius"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:i.radius,onChange:s=>{o(S(g({},i),{radius:Number.parseFloat(s.target.value)}))}})})]})]}),u]})}function Oe({folder:i,files:e,setFile:t}){const r=Object.keys(e).map(a=>{const o=e[a];return y("div",{className:"flex flex-row justify-between items-center",children:[y("div",{className:"flex flex-col",children:[n("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:o.name}),n("span",{className:"text-sm","data-testid":`file-${a}-description`,children:o.description})]}),n("span",{className:"w-2/5 flex-shrink-0",children:y("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:o.currentFilePath,onChange:async c=>{const u=c.currentTarget.value;try{const s=await i.getFile(u);t(a,s.name,s)}catch{t(a,"")}},children:[n("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),i.fileList.filter(c=>c.endsWith(o.extension)).map(c=>n("option",{value:c,"data-testid":`file-${a}-select-${c}`,children:c},c))]})})]},a)});return n("div",{className:"flex flex-col gap-2",children:r})}function Le({view:i,buttons:e,active:t,setActive:r}){if(!e)return n("span",{});const a=[];for(const o of Object.keys(e)){const c=e[o],u=o===t;a.push(n("button",{type:"button","data-testid":`tab-${o}`,className:`${u?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>r(u?"":o),children:c},o))}return y("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?n("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:i}):"",n("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:a})]})}se.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const B=Math.PI/6,R=2*Math.PI-B;function We({pointSources:i,arrowSources:e,drawnLineSource:t}){const r=m.exports.useRef(null),[a,o]=m.exports.useState(),[c,u]=m.exports.useState(!1),[s,x]=m.exports.useState(),[_]=m.exports.useState(new q.exports.Popup({closeButton:!1,closeOnClick:!1})),[C,L]=m.exports.useState({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),[W,P]=m.exports.useState(),[E,O]=m.exports.useState(),[z,F]=m.exports.useState();return m.exports.useEffect(()=>{if(!a&&se.accessToken&&r.current){const l=new q.exports.Map({container:r.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});l.addControl(new q.exports.NavigationControl),o(l),l.on("load",()=>{u(!0)}),l.on("draw.selectionchange",({features:h})=>{if(!t.clickLine)return;let k=-1;for(const p of h)if(p.geometry.type==="LineString"&&p.properties&&"index"in p.properties&&typeof p.properties.index=="number"){k=p.properties.index,s==null||s.changeMode("direct_select",{featureId:p.id});break}t.clickLine(k)})}console.log("Updating map...")},[s,t,a]),m.exports.useEffect(()=>{if(a&&c&&z!==t){console.log("Drawning lines"),F(t);let l=s;(t.activeColor!==C.activeColor||t.activeWidth!==C.activeWidth||t.color!==C.color||t.width!==C.width)&&(L({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),s&&a.removeControl(s),t.active?(l=new Ne({displayControlsDefault:!1,controls:{line_string:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":2*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth+2,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.activeColor,"line-dasharray":[.2,2],"line-width":t.activeWidth}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}}]}),a.addControl(l),x(l)):l=void 0),l&&l.set({type:"FeatureCollection",features:t.lines.flatMap(h=>[{type:"Feature",properties:{name:h.name,index:h.index,selected:h.selected?1:0},id:h.index,geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}])})}},[a,c,z,t,C,s]),m.exports.useEffect(()=>{if(a&&c&&W!==i)if(console.log("Setting points in map!"),W){for(const l of W){const h=a.getSource(`point:${l.name}`);h!==void 0&&h.setData({type:"FeatureCollection",features:[]}),a.removeLayer(`layer:point:${l.name}`);const k=a.getSource(`point:${l.name}:selected`);k!==void 0&&k.setData({type:"FeatureCollection",features:[]}),a.removeLayer(`layer:point:${l.name}:selected`)}P(void 0)}else{for(const l of i){let h=a.getSource(`point:${l.name}`),k=a.getSource(`point:${l.name}:selected`);const p=h===void 0;p&&(a.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=a.getSource(`point:${l.name}`),a.addSource(`point:${l.name}:selected`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),k=a.getSource(`point:${l.name}:selected`)),h!==void 0&&k!==void 0&&(h.setData({type:"FeatureCollection",features:l.points.filter(f=>!f.selected).map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name},geometry:{type:"Point",coordinates:[f.longitude,f.latitude]}}))}),k.setData({type:"FeatureCollection",features:l.points.filter(f=>f.selected).map(f=>({type:"Feature",properties:{description:`<strong>${f.name}</strong><p>${f.description}</p>`,index:f.index,name:f.name},geometry:{type:"Point",coordinates:[f.longitude,f.latitude]}}))})),a.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":l.color,"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),a.addLayer({id:`layer:point:${l.name}:selected`,type:"circle",source:`point:${l.name}:selected`,paint:{"circle-color":l.selectedColor,"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),p&&(a.on("mouseenter",`layer:point:${l.name}`,f=>{if(!f.features)return;const v=f.features[0];if(v.geometry.type==="Point"&&v.properties&&typeof v.properties.description=="string"){const N=[...v.geometry.coordinates],{description:$}=v.properties;for(;Math.abs(f.lngLat.lng-N[0])>180;)N[0]+=f.lngLat.lng>N[0]?360:-360;_.setLngLat(N).setHTML($).addTo(a)}}),a.on("mouseleave",`layer:point:${l.name}`,()=>{_.remove()}),a.on("click",`layer:point:${l.name}`,f=>{if(!f.features||!l.clickPoint)return;const v=f.features[0];if(v.properties&&typeof v.properties.index=="number"&&typeof v.properties.name=="string"){const{index:N,name:$}=v.properties;l.clickPoint(N,$)}}))}P(i)}},[a,W,i,c,_]),m.exports.useEffect(()=>{if(a&&c&&E!==e)if(console.log("Setting arrows in map!"),E){for(const l of E){const h=a.getSource(`arrow:${l.name}`);h!==void 0&&h.setData({type:"FeatureCollection",features:[]}),a.removeLayer(`layer:arrow:${l.name}`)}O(void 0)}else{for(const l of e){let h=a.getSource(`arrow:${l.name}`);const k=h===void 0;k&&(a.addSource(`arrow:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=a.getSource(`arrow:${l.name}`)),h!==void 0&&h.setData({type:"FeatureCollection",features:l.arrows.map((p,f)=>{const v=p.scale*l.scale,N=l.scale*l.arrowHeadScale,$=[p.longitude+p.direction[0]*v,p.latitude+p.direction[1]*v],H=[$[0]+(Math.cos(B)*-p.direction[0]-Math.sin(B)*-p.direction[1])*N,$[1]+(Math.sin(B)*-p.direction[0]+Math.cos(B)*-p.direction[1])*N],T=[$[0]+(Math.cos(R)*-p.direction[0]-Math.sin(R)*-p.direction[1])*N,$[1]+(Math.sin(R)*-p.direction[0]+Math.cos(R)*-p.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:f,name:p.name},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],$,H,$,T]}}})}),a.addLayer({id:`layer:arrow:${l.name}`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.color,"line-width":l.width}}),k&&(a.on("mouseenter",`layer:arrow:${l.name}`,p=>{if(!p.features)return;const f=p.features[0];if(f.geometry.type==="Point"&&f.properties&&typeof f.properties.description=="string"){const v=[...f.geometry.coordinates],{description:N}=f.properties;for(;Math.abs(p.lngLat.lng-v[0])>180;)v[0]+=p.lngLat.lng>v[0]?360:-360;_.setLngLat(v).setHTML(N).addTo(a)}}),a.on("mouseleave",`layer:arrow:${l.name}`,()=>{_.remove()}),a.on("click",`layer:arrow:${l.name}`,p=>{if(!p.features||!l.clickArrow)return;const f=p.features[0];if(f.properties&&typeof f.properties.index=="number"&&typeof f.properties.name=="string"){const{index:v,name:N}=f.properties;l.clickArrow(v,N)}}))}O(e)}},[a,E,e,c,_]),n("div",{"data-testid":"map",className:"w-full h-full",ref:r})}const Ee={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2};var he;const Ie=JSON.parse((he=window.localStorage.getItem("segmentDisplaySettings"))!=null?he:"false")||Ee;function Ae({settings:i,setSettings:e,segments:t,selected:r,setSegmentData:a}){const o=s=>{e(s),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(s))},c=t[r],u=c?n(oe,{title:c.name,item:c,setItem:s=>a(r,s),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):n(A,{});return y("div",{className:"flex flex-col gap-2",children:[y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Color"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"color",value:i.color,onChange:s=>{o(S(g({},i),{color:s.target.value}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Width"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.width,onChange:s=>{o(S(g({},i),{width:Number.parseFloat(s.target.value)}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Active Color"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"color",value:i.activeColor,onChange:s=>{o(S(g({},i),{activeColor:s.target.value}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Active Width"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.activeWidth,onChange:s=>{o(S(g({},i),{activeWidth:Number.parseFloat(s.target.value)}))}})})]}),u]})}function Be({folder:i,openFolder:e,filesOpen:t,saveFiles:r}){function a(){e()}return y("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[n("h3",{className:"text-lg font-bold",children:"Celeri UI"}),y("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[i?y("span",{children:["Working in ",i.name]}):n("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?n("button",{type:"button",onClick:r,"data-testid":"save-file-button",children:"Save Files"}):n(A,{})]})]})}const ze={color:"#ffff00",scale:.02,width:1,arrowHead:1};var ge;const Re=JSON.parse((ge=window.localStorage.getItem("velocityDisplaySettings"))!=null?ge:"false")||ze;function He({settings:i,setSettings:e}){const t=r=>{e(r),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(r))};return y("div",{className:"flex flex-col gap-2",children:[y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Color"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"color",value:i.color,onChange:r=>{t(S(g({},i),{color:r.target.value}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Scale"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:i.scale,onChange:r=>{t(S(g({},i),{scale:Number.parseFloat(r.target.value)}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Width"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.width,onChange:r=>{t(S(g({},i),{width:Number.parseFloat(r.target.value)}))}})})]}),y("div",{className:"flex flex-row justify-between items-center",children:[n("span",{className:"text-l font-bold",children:"Arrow Head Size"}),n("span",{className:"w-2/5 flex-shrink-0",children:n("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:i.arrowHead,onChange:r=>{t(S(g({},i),{arrowHead:Number.parseFloat(r.target.value)}))}})})]})]})}function G(i){const e=i.split(/\n/g),t=e[0].split(","),r=e.slice(1),a=[];for(const o of r){const c=o.split(/\s*,\s*/),u={};for(let s=0;s<t.length;s+=1){let x=c[s];const _=t[s],C=Number.parseFloat(x);x=Number.isNaN(C)?x:C,typeof x=="string"&&x.startsWith('"')&&x.endsWith('"')&&(x=x.slice(1,-1)),u[_]=x}a.push(u)}return a}function Q(i,e){const t=[e.join(",")];for(const r of i){const a=r;t.push(e.map(o=>o in a?typeof a[o]=="string"&&/\s/.test(`${a[o]}`)?`"${a[o]}"`:`${a[o]}`:"").join(","))}return t.join(`
`)}const re=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Te={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Ve(i){return g(g({},Te),i)}class Z{constructor(e){w(this,"handle");w(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),r=G(e).map(a=>{const o={};for(const c of re)o[c]=a[c]||(c==="name"?"":0);return o});this.data=r}async save(){var t;const e=Q((t=this.data)!=null?t:[],re);await this.handle.setContents(e)}clone(){return new Z(this.handle)}}const Je={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function qe(i){return g(g({},Je),i)}class U{constructor(e){w(this,"handle");w(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=qe(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new U(this.handle)}}const le=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],Ge={name:"",lon1:0,lat1:0,lon2:0,lat2:0,dip:0,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:0,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Qe(i){return g(g({},Ge),i)}class K{constructor(e){w(this,"handle");w(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),r=G(e).map(a=>{const o={};for(const c of le)o[c]=a[c]||(c==="name"?"":0);return o});this.data=r}async save(){var t;const e=Q((t=this.data)!=null?t:[],le);await this.handle.setContents(e)}clone(){return new K(this.handle)}}const ce=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class X{constructor(e){w(this,"handle");w(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),r=G(e).map(a=>{const o={};for(const c of ce)o[c]=a[c]||(c==="name"?"":0);return o});this.data=r}async save(){var t;const e=Q((t=this.data)!=null?t:[],ce);await this.handle.setContents(e)}clone(){return new X(this.handle)}}async function de(i){const e=new K(i);return await e.initialize(),e}async function pe(i){const e=new Z(i);return await e.initialize(),e}async function fe(i){const e=new X(i);return await e.initialize(),e}async function Ze(i,e,t){const r=new U(e);if(await r.initialize(),r.data){const a=await de(await i.getFile(r.data.segment_file_name)),o=await pe(await i.getFile(r.data.block_file_name)),c=await fe(await i.getFile(r.data.station_file_name)),u=g({},t);return"command"in u&&(u.command=S(g({},u.command),{currentFilePath:e.name})),"segment"in u&&(u.segment=S(g({},u.segment),{currentFilePath:r.data.segment_file_name})),"block"in u&&(u.block=S(g({},u.block),{currentFilePath:r.data.block_file_name})),"velocities"in u&&(u.velocities=S(g({},u.velocities),{currentFilePath:r.data.station_file_name})),{openableFiles:u,commands:r,segments:a,blocks:o,velocities:c}}throw new Error("Can't open command file")}class Ue{constructor(e){w(this,"name");w(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Y{constructor(e){w(this,"name");w(this,"handle");w(this,"fileList");w(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Ue(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),r=new Y(t);return await r.initialize(),r}}const Ke=async()=>{const i=await window.showDirectoryPicker(),e=new Y(i);return await e.initialize(),e};class Xe{constructor(e,t){w(this,"name");w(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ee{constructor(e,t){w(this,"name");w(this,"parent");w(this,"fileList");w(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const r=t[e];for(const a of Object.keys(r))typeof r[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Xe(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ee(e,this.parent[this.name])}}const Ye=async i=>new ee("root",i);let ue=async()=>{var e;return Ye((e=window.FakeDirectory)!=null?e:{})};function et(i){ue=i}async function tt(){return ue()}window.location.search.includes("fake-dir")||et(Ke);const at={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities"};function it(){var te,ae,ie;const[i,e]=m.exports.useState(),[t,r]=m.exports.useState(""),[a,o]=m.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[c,u]=m.exports.useState(),[s,x]=m.exports.useState(),[_,C]=m.exports.useState(),[L,W]=m.exports.useState(),[P,E]=m.exports.useState(Re),[O,z]=m.exports.useState(Pe),[F,l]=m.exports.useState(Ie),[h,k]=m.exports.useState(-1),[p,f]=m.exports.useState(-1),[v,N]=m.exports.useState([]),[$,H]=m.exports.useState([]),[T,_e]=m.exports.useState({color:F.color,activeColor:F.activeColor,activeWidth:F.activeWidth,width:F.width,active:s!==void 0,lines:[]});m.exports.useEffect(()=>{N([{name:"blocks",color:O.color,selectedColor:O.selectedColor,radius:O.radius,points:(_==null?void 0:_.data)?_.data.map((d,b)=>({longitude:d.interior_lon,latitude:d.interior_lat,name:d.name,description:"",selected:b===h,index:b})):[],clickPoint:(d,b)=>{k(d),r("block")}}])},[O,_,h]),m.exports.useEffect(()=>{H([{name:"velocity",color:P.color,scale:P.scale,arrowHeadScale:P.arrowHead,width:P.width,arrows:(L==null?void 0:L.data)?L.data.map(d=>{const b=Math.sqrt(d.east_vel*d.east_vel+d.north_vel*d.north_vel);return{longitude:d.lon,latitude:d.lat,direction:[d.east_vel/b,d.north_vel/b],scale:b,name:d.name,description:`north: ${d.north_vel}, east: ${d.east_vel}`}}):[]}])},[P,L]),m.exports.useEffect(()=>{_e({color:F.color,activeColor:F.activeColor,activeWidth:F.activeWidth,width:F.width,active:s!==void 0,lines:(s==null?void 0:s.data)?s.data.map((d,b)=>({startLongitude:d.lon1,endLongitude:d.lon2,startLatitude:d.lat1,endLatitude:d.lat2,name:d.name,index:b,description:"",selected:b===p})):[],clickLine:d=>{f(d),r("segment")}})},[F,s,p]);let I=n("span",{});switch(t){case"files":I=i?n(Oe,{folder:i,files:a,setFile:async(d,b,M)=>{if(M){let D=g({},a);switch(D[d]=S(g({},D[d]),{currentFilePath:b}),d){case"segment":x(await de(M));break;case"block":C(await pe(M));break;case"velocity":W(await fe(M));break;case"command":const j=await Ze(i,M,a);u(j.commands),x(j.segments),C(j.blocks),W(j.velocities),D=j.openableFiles;break}o(D)}}}):n("span",{});break;case"velocities":I=n(He,{settings:P,setSettings:E});break;case"block":I=n(Me,{settings:O,setSettings:z,selected:h,blocks:(te=_==null?void 0:_.data)!=null?te:[],setBlockData:(d,b)=>{if(_!==void 0){const M=_.data&&_.data[d]?g(g({},_.data[d]),b):Ve(b),D=_.data?[..._.data]:[];D[d]=M;const j=_.clone();j.data=D,C(j)}}});break;case"segment":I=n(Ae,{settings:F,setSettings:l,segments:(ae=s==null?void 0:s.data)!=null?ae:[],selected:p,setSegmentData:(d,b)=>{if(s!==void 0){const M=s.data&&s.data[d]?g(g({},s.data[d]),b):Qe(b),D=s.data?[...s.data]:[];D[d]=M;const j=s.clone();j.data=D,x(j)}}});break}return y("div",{className:"w-screen h-screen flex flex-col",children:[n(Be,{filesOpen:((ie=c!=null?c:s)!=null?ie:_)!==void 0,saveFiles:async()=>{c&&await c.save(),s&&await s.save(),_&&await _.save()},folder:i,openFolder:async()=>{const d=await tt();e(d),r("files")}}),n(We,{pointSources:v,arrowSources:$,drawnLineSource:T}),n(Le,{view:I,buttons:i?at:void 0,active:t,setActive:d=>r(d)})]})}function nt(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:a,onRegisterError:o}=i;let c;const u=async(s=!0)=>{};return"serviceWorker"in navigator&&(c=new Se("./sw.js",{scope:"./"}),c.addEventListener("activated",s=>{s.isUpdate?window.location.reload():r==null||r()}),c.register({immediate:e}).then(s=>{a==null||a(s)}).catch(s=>{o==null||o(s)})),u}nt();const st=1,ot=new ke({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:st}}});Ce.render(n(m.exports.StrictMode,{children:n(Fe,{client:ot,children:n(it,{})})}),document.querySelector("#root"));
