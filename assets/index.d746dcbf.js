var Bt=Object.defineProperty,At=Object.defineProperties;var Tt=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var Wt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;var ue=(n,e,t)=>e in n?Bt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))Wt.call(e,t)&&ue(n,t,e[t]);if(Je)for(var t of Je(e))zt.call(e,t)&&ue(n,t,e[t]);return n},x=(n,e)=>At(n,Tt(e));var k=(n,e,t)=>(ue(n,typeof e!="symbol"?e+"":e,t),t);import{j as r,a as b,F as I,r as S,M as Ht,m as Ke,R as Gt,b as fe,u as Jt,c as Kt,l as Ue,d as ae,e as L,f as Ut,g as qt,h as Qt,v as Xt,Q as Zt,i as Yt,k as en,P as tn}from"./vendor.6cf141b2.js";const nn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}};nn();function sn({value:n,fieldDefinition:e,setField:t}){const[s,a]=S.exports.useState(-1),[o,d]=S.exports.useState(n);return S.exports.useEffect(()=>{d(n)},[n]),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[r("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?r("span",{className:"text-sm",children:e.description}):r(I,{})]}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof n=="number"?"number":"text",value:o,onChange:c=>{const m=typeof n=="number"?Number.parseFloat(c.target.value):c.target.value;d(m),s>-1&&clearTimeout(s),a(setTimeout(()=>t(m),1e3))}})})]})}function oe({title:n,items:e,setItems:t,fieldDefinitions:s,ignoreFields:a,deletable:o,controls:d}){const c=e[0],m=Object.keys(c).map((l,g)=>{if(a==null?void 0:a.includes(l))return{element:r("span",{style:{display:"hidden"}},l),order:g+1e4};let i=c[l];for(const _ of e)if(_[l]!==i){i="-";break}const v=l in s&&s[l];return v?{element:r(sn,{value:i,fieldDefinition:v,setField:_=>t({[l]:_})},l),order:v.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{"data-testid":`input-title-${l}`,className:"text-l font-bold",children:l}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{"data-testid":`input-editor-${l}`,className:"rounded w-full",type:typeof i=="number"?"number":"text",value:i,onChange:_=>{t({[l]:typeof i=="number"?Number.parseFloat(_.target.value):_.target.value})}})})]},l),order:g+1e3}}).sort((l,g)=>l.order-g.order).map(l=>l.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[d,o?r("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):r(I,{})]})]}),m]})}oe.defaultProps={ignoreFields:[],controls:r(I,{})};const an={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var kt;const on=JSON.parse((kt=window.localStorage.getItem("blockDisplaySettings"))!=null?kt:"false")||an;function rn({settings:n,setSettings:e,selected:t,blocks:s,setBlockData:a,addNewBlock:o}){const d=l=>{e(l),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(l))},c=t.map(l=>s[l]).filter(l=>l),m=c.length>0?r(oe,{title:c.length===1?c[0].name:"Edit Selected Blocks",items:c,deletable:!0,setItems:l=>a(t,l),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):r(I,{});return b(I,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Display"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(x(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:l=>{d(x(f({},n),{color:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Selected Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:l=>{d(x(f({},n),{selectedColor:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Radius"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:l=>{d(x(f({},n),{radius:Number.parseFloat(l.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Add New Block"}),r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:o,children:"New Block"})]}),m]})}function ln({folder:n,files:e,setFile:t}){const s=Object.keys(e).map(a=>{const o=e[a],d=Array.isArray(o.currentFilePath)?[...o.currentFilePath]:[o.currentFilePath];return o.allowMultiple&&d.push(""),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[r("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:o.name}),r("span",{className:"text-sm","data-testid":`file-${a}-description`,children:o.description})]}),r("span",{className:"w-2/5 flex-shrink-0",children:d.map((c,m)=>b("select",{"data-testid":`file-${a}-select-${m}`,className:"w-full rounded",value:c,onChange:async l=>{const g=l.currentTarget.value;try{const i=await n.getFile(g);t(m,a,i.name,i)}catch{t(m,a,"")}},children:[r("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),n.fileList.filter(l=>l.endsWith(o.extension)).map(l=>r("option",{value:l,"data-testid":`file-${a}-select-${l}`,children:l},l))]},m))})]},a)});return r("div",{className:"flex flex-col gap-2",children:s})}function cn({view:n,buttons:e,active:t,setActive:s}){if(!e)return r("span",{});const a=[];for(const o of Object.keys(e)){const d=e[o],c=o===t;a.push(r("button",{type:"button","data-testid":`tab-${o}`,className:`${c?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>s(c?"":o),children:d},o))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?r("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm overflow-y-auto",children:n}):"",r("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:a})]})}const qe={lon:0,lat:0},dn=180,te=360;function Qe(n){let{lon:e,lat:t}=n;for(;e<0;)e+=te;for(;e>te;)e-=te;return[e,t]}function me([n,e]){return{lon:n<0?n+te:n,lat:e}}function Xe(n,e){const t=Qe(n),s=Qe(e),a=[s[0],s[1]];return s[0]-t[0]>=dn?a[0]-=te:a[0]+=te,Math.abs(t[0]-s[0])>Math.abs(t[0]-a[0])?[t,a]:[t,s]}const M=1e3;function H(n,e,t,s){const a=`${Math.floor(n.lon*M)},${Math.floor(n.lat*M)}`;if(a in e)return[e[a],s];const o=s;return t[o]=n,e[a]=o,[o,s+1]}function Ze(n,e){let t=!1;for(const s of n.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&n.vertecies[e]){const s=n.vertecies[e],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,o=f({},n.vertecies);delete o[e];const d=f({},n.vertexDictionary);return delete d[a],x(f({},n),{vertecies:o,vertexDictionary:d})}return n}const J=Math.PI/6,q=2*Math.PI-J;function un(n,e,{map:t,popup:s,internalArrowSources:a,mapLoaded:o,internalSelections:d},{arrowSources:c,selections:m}){if(t&&o&&a!==c)if(console.log("Setting arrows in map!"),a){for(const i of a){const v=t.getSource(`arrow:${i.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${i.name}`),t.removeLayer(`layer:arrow:${i.name}:click`)}e({internalArrowSources:void 0})}else{for(const i of c){let v=t.getSource(`arrow:${i.name}`);const _=v===void 0;_&&(t.addSource(`arrow:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=t.getSource(`arrow:${i.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:i.arrows.map(p=>{var Q;const h=p.scale*i.scale,w=i.scale*i.arrowHeadScale,N=[p.longitude+p.direction[0]*h,p.latitude+p.direction[1]*h],P=[N[0]+(Math.cos(J)*-p.direction[0]-Math.sin(J)*-p.direction[1])*w,N[1]+(Math.sin(J)*-p.direction[0]+Math.cos(J)*-p.direction[1])*w],C=[N[0]+(Math.cos(q)*-p.direction[0]-Math.sin(q)*-p.direction[1])*w,N[1]+(Math.sin(q)*-p.direction[0]+Math.cos(q)*-p.direction[1])*w];return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:(Q=m[i.name])==null?void 0:Q.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],N,P,N,C]}}})}),t.addLayer({id:`layer:arrow:${i.name}`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":i.width}}),t.addLayer({id:`layer:arrow:${i.name}:click`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),_&&(t.on("mouseenter",`layer:arrow:${i.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:arrow:${i.name}:click`,()=>{s.remove()}),t.on("click",`layer:arrow:${i.name}:click`,p=>{let h;if(n.state.internalArrowSources)for(const N of n.state.internalArrowSources)h=N.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}}))}e({internalArrowSources:c})}const l=f({},d);let g=!1;for(const i of Object.keys(m))if(m[i]!==d[i]){for(const v of c)if(v.name===i){g=!0,l[i]=m[i];const _=t==null?void 0:t.getSource(`arrow:${v.name}`);if(_){const p=m[i];_.setData({type:"FeatureCollection",features:v.arrows.map(h=>{const w=h.scale*v.scale,N=v.scale*v.arrowHeadScale,P=[h.longitude+h.direction[0]*w,h.latitude+h.direction[1]*w],C=[P[0]+(Math.cos(J)*-h.direction[0]-Math.sin(J)*-h.direction[1])*N,P[1]+(Math.sin(J)*-h.direction[0]+Math.cos(J)*-h.direction[1])*N],Q=[P[0]+(Math.cos(q)*-h.direction[0]-Math.sin(q)*-h.direction[1])*N,P[1]+(Math.sin(q)*-h.direction[0]+Math.cos(q)*-h.direction[1])*N];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:p==null?void 0:p.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],P,C,P,Q]}}})})}}}g&&e({internalSelections:l})}function fn(n,{map:e,draw:t,drawnPointSettings:s,mapLoaded:a,internalDrawnPointSource:o},{drawnPointSource:d}){if(e&&a&&o!==d){console.log("Drawning Points"),n({internalDrawnPointSource:d});let c=t;if((d.selectedColor!==s.selectedColor||d.selectedRadius!==s.selectedRadius||d.color!==s.color||d.radius!==s.radius)&&(n({drawnPointSettings:{color:d.color,radius:d.radius,selectedRadius:d.selectedRadius,selectedColor:d.selectedColor}}),t&&(e.removeControl(t),c=void 0),d?(c=new Ht({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":d.selectedRadius,"circle-color":d.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":d.radius,"circle-color":d.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(c),n({draw:c})):c=void 0),c){const m=c.getAll(),l=d.points.length!==m.features.length?void 0:c.getSelected(),g={type:"FeatureCollection",features:d.points.map(i=>({type:"Feature",id:i.index.toString(),properties:{description:"",index:i.index,name:""},geometry:{type:"Point",coordinates:[i.longitude,i.latitude]}}))};if(c.set(g),l&&l.features.length>0&&l.features[0].properties&&typeof l.features[0].properties.index=="number"){const i=l.features[0].id;i&&c.changeMode("simple_select",{featureIds:[i]})}}}}const A="grid";function mn(n,e,{map:t,internalGridDisplay:s,popup:a,mapLoaded:o},{displayGrid:d}){if(t&&o&&s!==d){if(console.log("Drawing Grid on map!"),s&&s>0){const c=t.getSource(A);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),t.removeLayer(A),e({internalGridDisplay:void 0})}else if(d&&d>0){let c=t.getSource(A);const m=c===void 0;if(m&&(t.addSource(A,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=t.getSource(A)),c!==void 0){const l=[];for(let g=-170;g<=180;g+=d)l.push({type:"Feature",properties:{label:`Lon: ${g<0?g+360:g}`},geometry:{type:"LineString",coordinates:[[g,-90],[g,90]]}});for(let g=-90;g<=90;g+=d)l.push({type:"Feature",properties:{label:`Lat: ${g}`},geometry:{type:"LineString",coordinates:[[180,g],[-180,g]]}});c.setData({type:"FeatureCollection",features:l})}t.addLayer({id:A,type:"line",source:A,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${A}:click`,type:"line",source:A,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),m&&(t.on("mouseenter",`${A}:click`,l=>{if(!l.features)return;const g=l.features[0];g.geometry.type==="LineString"&&g.properties&&typeof g.properties.label=="string"&&a.setLngLat(l.lngLat).setHTML(`${g.properties.label}`).addTo(t)}),t.on("mouseleave",`${A}:click`,()=>{a.remove()}))}e({internalGridDisplay:d})}}function hn(n,e,{map:t,popup:s,internalLineSources:a,mapLoaded:o,internalSelections:d},{lineSources:c,selections:m}){if(t&&o&&a!==c)if(console.log("Setting lines in map!"),a){for(const i of a){const v=t.getSource(`line:${i.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${i.name}`),t.removeLayer(`layer:line:${i.name}:click`)}e({internalLineSources:void 0})}else{for(const i of c){let v=t.getSource(`line:${i.name}`);const _=v===void 0;_&&(t.addSource(`line:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=t.getSource(`line:${i.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:i.lines.map(p=>{var h;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:((h=m[i.name])==null?void 0:h.includes(p.index))||!1},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}})}),t.addLayer({id:`layer:line:${i.name}`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":["case",["get","selected"],i.selectedWidth,i.width]}}),i.click&&(t.addLayer({id:`layer:line:${i.name}:click`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":i.width*10}}),_&&(t.on("mouseenter",`layer:line:${i.name}:click`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="LineString"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[(h.geometry.coordinates[0][0]+h.geometry.coordinates[1][0])/2,(h.geometry.coordinates[0][1]+h.geometry.coordinates[1][1])/2],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:line:${i.name}:click`,()=>{s.remove()}),t.on("click",`layer:line:${i.name}:click`,p=>{let h;if(n.state.internalLineSources)for(const N of n.state.internalLineSources)N.name===i.name&&(h=N.click);if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}})))}e({internalLineSources:c})}const l=f({},d);let g=!1;for(const i of Object.keys(m))if(m[i]!==d[i]){for(const v of c)if(v.name===i){g=!0,l[i]=m[i];const _=t==null?void 0:t.getSource(`line:${v.name}`);if(_){const p=m[i];_.setData({type:"FeatureCollection",features:v.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:p==null?void 0:p.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))})}}}g&&e({internalSelections:l})}function pn(n,e,{map:t,popup:s,internalPointSources:a,mapLoaded:o,internalSelections:d},{pointSources:c,selections:m}){if(!t||!o)return;if(a!==c)if(console.log("Setting points in map!"),a){for(const i of a){const v=t.getSource(`point:${i.name}`);v!==void 0&&v.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${i.name}`)}e({internalPointSources:void 0})}else{for(const i of c){let v=t.getSource(`point:${i.name}`);const _=v===void 0;_&&(t.addSource(`point:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),v=t.getSource(`point:${i.name}`)),v!==void 0&&v.setData({type:"FeatureCollection",features:i.points.map(p=>{var h;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:!((h=m[i.name])==null?void 0:h.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}})}),t.addLayer({id:`layer:point:${i.name}`,type:"circle",source:`point:${i.name}`,paint:{"circle-color":["case",["get","selected"],i.color,i.selectedColor],"circle-radius":i.radius}}),_&&(t.on("mouseenter",`layer:point:${i.name}`,p=>{if(!p.features)return;const h=p.features[0];if(h.geometry.type==="Point"&&h.properties&&typeof h.properties.description=="string"&&h.properties.description){const w=[...h.geometry.coordinates],{description:N}=h.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;s.setLngLat(w).setHTML(N).addTo(t)}}),t.on("mouseleave",`layer:point:${i.name}`,()=>{s.remove()}),t.on("click",`layer:point:${i.name}`,p=>{let h;if(n.state.internalPointSources)for(const N of n.state.internalPointSources)h=N.click;if(!p.features||!h)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:N}=w.properties;h(N)}}))}e({internalPointSources:c})}const l=f({},d);let g=!1;for(const i of Object.keys(m))if(m[i]!==d[i]){for(const v of c)if(v.name===i){g=!0,l[i]=m[i];const _=t.getSource(`point:${v.name}`);if(_){const p=m[i];_.setData({type:"FeatureCollection",features:v.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:!(p==null?void 0:p.includes(h.index))},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))})}}}g&&e({internalSelections:l})}Ke.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class gn extends Gt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:S.exports.createRef(),popup:new fe.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Ke.accessToken&&t){const s=new fe.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});s.addControl(new fe.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:a})=>{const{click:o}=this.props;o(me([a.lng,a.lat]))}),s.on("mousemove",({lngLat:a})=>{const{mouseMove:o}=this.props;o&&o(me([a.lng,a.lat]))}),s.on("draw.selectionchange",({features:a})=>{const{internalDrawnPointSource:o}=this.state;if(!o||!(o==null?void 0:o.select))return;const d=a.map(c=>c&&c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"?c.properties.index:-1).filter(c=>c>-1);o.select(d)}),s.on("draw.update",({features:a,action:o})=>{const{internalDrawnPointSource:d}=this.state;if(!!(d==null?void 0:d.update)&&o==="move"&&a.length>0)for(const c of a)c.type==="Feature"&&c.geometry.type==="Point"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"&&d.update(c.properties.index,me(c.geometry.coordinates))})}}componentDidUpdate(){return mn(this,e=>this.setState(e),this.state,this.props),hn(this,e=>this.setState(e),this.state,this.props),un(this,e=>this.setState(e),this.state,this.props),pn(this,e=>this.setState(e),this.state,this.props),fn(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return r("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const yn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Ct;const vn=f(f({},yn),JSON.parse((Ct=window.localStorage.getItem("meshDisplaySettings"))!=null?Ct:"{}"));function xn({settings:n,setSettings:e}){const t=s=>{e(s),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(s))};return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Display"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{t(x(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:s=>{t(x(f({},n),{color:s.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Width"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:s=>{t(x(f({},n),{width:Number.parseFloat(s.target.value)}))}})})]})]})}const bn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Lt;const wn=f(f({},bn),JSON.parse((Lt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Lt:"{}"));function _n({settings:n,setSettings:e,segments:t,selected:s,setSegmentData:a,addNewSegment:o,splitSegment:d,setSelectionMode:c}){const m=i=>{e(i),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(i))},l=s.map(i=>t[i]).filter(i=>i),g=l.length>0?r(oe,{title:l.length===1?l[0].name:"Edit Selected Segments",items:l,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:i=>a(s,i),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>d(s),children:"Split Segment"})}):r(I,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Display"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{m(x(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:i=>{m(x(f({},n),{color:i.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Width"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:i=>{m(x(f({},n),{width:Number.parseFloat(i.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Active Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:i=>{m(x(f({},n),{activeColor:i.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Active Width"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:i=>{m(x(f({},n),{activeWidth:Number.parseFloat(i.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Add New Segment"}),r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Select Segment Starting Point",callback:i=>{c({mode:"mapClick",label:"Select Segment End point",callback:v=>{o(i,v),c("normal")}})}})},children:"New Segment"})]}),g]})}const Ye=()=>Jt(),ie=Kt;function Nn({folder:n,openFolder:e,filesOpen:t,saveFiles:s}){function a(){e()}const o=Ye(),[d,c]=ie(m=>[m.main.past.length>0,m.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[r("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?r("button",{type:"button",onClick:()=>{o(Ue.ActionCreators.undo())},"data-testid":"undo-button",disabled:!d,children:"Undo"}):r(I,{}),n?r("button",{type:"button",onClick:()=>{o(Ue.ActionCreators.redo())},disabled:!c,"data-testid":"undo-button",children:"Redo"}):r(I,{}),n?b("span",{children:["Working in ",n.name]}):r("button",{type:"button",onClick:a,"data-testid":"open-folder-button",children:"Open Folder"}),t?r("button",{type:"button",onClick:s,"data-testid":"save-file-button",children:"Save Files"}):r(I,{})]})]})}const Sn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var Dt;const kn=JSON.parse((Dt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Dt:"false")||Sn;function Cn({settings:n,setSettings:e,selected:t,velocitys:s,setVelocityData:a,addNewVelocity:o}){const d=l=>{e(l),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(l))},c=t.map(l=>s[l]).filter(l=>l),m=c.length>0?r(oe,{title:c.length===1?c[0].name:"Edit Selected Velocities",items:c,deletable:!0,setItems:l=>a(t,l),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):r(I,{});return b(I,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Display"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(x(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:l=>{d(x(f({},n),{color:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Selected Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:l=>{d(x(f({},n),{selectedColor:l.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Scale"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:l=>{d(x(f({},n),{scale:Number.parseFloat(l.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Width"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:l=>{d(x(f({},n),{width:Number.parseFloat(l.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Arrow Head Size"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:l=>{d(x(f({},n),{arrowHead:Number.parseFloat(l.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Add New Velocity"}),r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:o,children:"New Velocity"})]}),m]})}const Ln={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var Ft;const Dn=f(f({},Ln),JSON.parse((Ft=window.localStorage.getItem("vertexDisplaySettings"))!=null?Ft:"{}"));function Fn({settings:n,setSettings:e,vertices:t,selected:s,setVertexData:a,setSelectionMode:o,mergeVertices:d,bridgeVertices:c,extrudeVertex:m}){const l=v=>{e(v),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(v))},i=s.map(v=>({selectedVertex:t[v],index:v})).filter(v=>v.selectedVertex).map(({selectedVertex:v,index:_})=>r(oe,{title:"Selected Vertex",items:[v],ignoreFields:[],deletable:!1,setItems:p=>a(_,f(f({},v),p)),fieldDefinitions:{},controls:b(I,{children:[r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:p=>{d(_,p[0]),o("normal")}})},children:"Merge"}),r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:p=>{c(_,p[0]),o("normal")}})},children:"Bridge"}),r("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:p=>{m(_,p),o("normal")}})},children:"Extrude"})]})},_));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Display"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{l(x(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.color,onChange:v=>{l(x(f({},n),{color:v.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Radius"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:v=>{l(x(f({},n),{radius:Number.parseFloat(v.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Active Color"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:v=>{l(x(f({},n),{activeColor:v.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[r("span",{className:"text-l font-bold",children:"Active Radius"}),r("span",{className:"w-2/5 flex-shrink-0",children:r("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:v=>{l(x(f({},n),{activeRadius:Number.parseFloat(v.target.value)}))}})})]}),i]})}const et=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],tt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function $n(n){return n?f(f({},tt),n):f({},tt)}function Vn(n,{data:e}){return[...n,$n(e)]}function Mn(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function jn(n,e){const t=[...n];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return t}function In(n,e){return e}function Rn(n,{index:e,position:t}){const s=[...n],a=f({},s[e]);return a.interior_lat=t.lat,a.interior_lon=t.lon,s[e]=a,s}const On=[],nt=L("createBlock"),st=L("editBlock"),at=L("deleteBlock"),he=L("loadNewBlockData"),ot=L("moveBlock"),Pn=ae(On,n=>{n.addCase(nt,(e,t)=>Vn(e,t.payload)).addCase(st,(e,t)=>jn(e,t.payload)).addCase(at,(e,t)=>Mn(e,t.payload)).addCase(he,(e,t)=>In(e,t.payload)).addCase(ot,(e,t)=>Rn(e,t.payload))});function En(n,e){return x(f({},n),{[e.mesh]:e.data})}function Bn(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}const An={},pe=L("loadMeshLineData"),Tn=L("removeMesh"),Wn=ae(An,n=>n.addCase(pe,(e,t)=>En(e,t.payload)).addCase(Tn,(e,t)=>Bn(e,t.payload))),it=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ne={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function zn(n,{a:e,b:t}){const s=x(f({},ne),{start:e,end:t}),a=[...n.segments,s];return x(f({},n),{segments:a})}function Hn(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),{lastIndex:a}=n,[o,d]=H(e.start,s,t,a),[c,m]=H(e.end,s,t,d),l=x(f({},ne),{start:o,end:c}),g=[...n.segments,l];return{vertecies:t,vertexDictionary:s,segments:g,lastIndex:m}}function Gn(n,e){const t=[],s=[];let a=f({},n);for(const[o,d]of n.segments.entries())e.index.includes(o)?s.push(d):t.push(d);a.segments=t;for(const o of s)a=Ze(Ze(a,o.start),o.end);return a}function Jn(n,e){const t=[...n.segments];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return x(f({},n),{segments:t})}function Kn(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),[a,o]=H(e.targetPoint,s,t,n.lastIndex),d=x(f({},ne),{start:e.index,end:a}),c=[...n.segments,d];return{vertecies:t,vertexDictionary:s,segments:c,lastIndex:o}}function Un(n,e){return e}function qn(n,{a:e,b:t}){if(e===t)return n;const s=n.segments.map(m=>{let l=m;return l.start===t&&(l=x(f({},l),{start:e})),l.end===t&&(l=x(f({},l),{end:e})),l}).filter(m=>m.start!==m.end),a=n.vertecies[t],o=`${Math.floor(a.lon*M)},${Math.floor(a.lat*M)}`,d=f({},n.vertecies);delete d[t];const c=f({},n.vertexDictionary);return delete c[o],x(f({},n),{vertecies:d,vertexDictionary:c,segments:s})}function Qn(n,{index:e,vertex:t}){const s=f({},n.vertecies),a=f({},n.vertexDictionary),o=[...n.segments],d=s[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,m=`${Math.floor(d.lon*M)},${Math.floor(d.lat*M)}`;if(delete a[m],c in a){const l=a[c];for(const g of o)g.start===l&&(g.start=e),g.end===l&&(g.end=e);delete s[l]}return s[e]=t,x(f({},n),{segments:o,vertecies:s,vertexDictionary:a})}function Xn(n,e){const t=f({},n.vertecies),s=f({},n.vertexDictionary),a=[...n.segments];let{lastIndex:o}=n;for(const d of e){const c=n.segments[d],m=n.vertecies[c.start],l=n.vertecies[c.end],g={lon:(m.lon+l.lon)/2,lat:(m.lat+l.lat)/2},[i,v]=H(g,s,t,o);o=v;const _=x(f({},c),{end:i,name:`${c.name}_a`}),p=x(f({},c),{start:i,name:`${c.name}_b`});a[d]=_,a.push(p)}return{vertecies:t,vertexDictionary:s,segments:a,lastIndex:o}}const Zn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},rt=L("bridgeVertices"),lt=L("createSegmet"),ct=L("deleteSegment"),dt=L("editSegmentData"),ut=L("extrudeSegment"),ge=L("loadNewSegmentData"),ft=L("mergeVertices"),ye=L("moveVertex"),mt=L("splitSegment"),Yn=ae(Zn,n=>{n.addCase(rt,(e,t)=>zn(e,t.payload)).addCase(lt,(e,t)=>Hn(e,t.payload)).addCase(ct,(e,t)=>Gn(e,t.payload)).addCase(dt,(e,t)=>Jn(e,t.payload)).addCase(ut,(e,t)=>Kn(e,t.payload)).addCase(ge,(e,t)=>Un(e,t.payload)).addCase(ft,(e,t)=>qn(e,t.payload)).addCase(ye,(e,t)=>Qn(e,t.payload)).addCase(mt,(e,t)=>Xn(e,t.payload))}),ht=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],es={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function ts(n){return f(f({},es),n)}function ns(n,{data:e}){return[...n,ts(e)]}function ss(n,e){const t=[];for(const[s,a]of n.entries())e.includes(s)||t.push(a);return t}function as(n,e){const t=[...n];for(const s of e.indices){const a=f(f({},t[s]),e.data);t[s]=a}return t}function os(n,e){return e}function is(n,{index:e,position:t}){const s=[...n],a=f(f({},s[e]),t);return s[e]=a,s}const rs=[],pt=L("createVelocity"),gt=L("editVelocity"),yt=L("deleteVelocity"),ve=L("loadNewVelocityData"),vt=L("moveVelocity"),ls=ae(rs,n=>{n.addCase(pt,(e,t)=>ns(e,t.payload)).addCase(gt,(e,t)=>as(e,t.payload)).addCase(yt,(e,t)=>ss(e,t.payload)).addCase(ve,(e,t)=>os(e,t.payload)).addCase(vt,(e,t)=>is(e,t.payload))});function re(n){const e=n.split(/\n/g),t=e[0].split(",").map(o=>o.trim()),s=e.slice(1),a=[];for(const o of s)if(o.trim()!==""){const d=o.split(/\s*,\s*/),c={};for(let m=0;m<t.length;m+=1){let l=d[m];const g=t[m],i=Number.parseFloat(l);l=Number.isNaN(i)?l:i,typeof l=="string"&&l.startsWith('"')&&l.endsWith('"')&&(l=l.slice(1,-1)),c[g]=l}a.push(c)}return a}function xe(n,e){const t=[e.join(",")];for(const s of n){const a=s;t.push(e.map(o=>o in a?typeof a[o]=="string"&&/\s/.test(`${a[o]}`)?`"${a[o]}"`:`${a[o]}`:"").join(","))}return t.join(`
`)}class be{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(a=>{const o={};for(const d of et)o[d]=a[d]||(d==="name"?"":0);return o});this.data=s}async save(){var t;const e=xe((t=this.data)!=null?t:[],et);await this.handle.setContents(e)}clone(){return new be(this.handle)}}const cs={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function ds(n){return f(f({},cs),n)}class we{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=ds(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new we(this.handle)}}function us(n){const t=[...n.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(s=>{const a=Number.parseFloat(s[1]),o=Number.parseFloat(s[2]);return{lon:a,lat:o}});return t.splice(0,0,{lon:0,lat:0}),t}const fs={"1":n=>{var s,a;const e=Number.parseInt((s=n[n.length-2])!=null?s:"",10),t=Number.parseInt((a=n[n.length-1])!=null?a:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)?[[e,t]]:!1},"2":n=>{var a,o,d;const e=Number.parseInt((a=n[n.length-3])!=null?a:"",10),t=Number.parseInt((o=n[n.length-2])!=null?o:"",10),s=Number.parseInt((d=n[n.length-1])!=null?d:"",10);return!Number.isNaN(e)&&!Number.isNaN(t)&&!Number.isNaN(s)?[[e,t],[t,s],[s,e]]:!1}};function ms(n){return n.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var s;return((s=fs[e[1]])!=null?s:()=>!1)(e)}).filter(e=>e).flat()}function hs(n,e){return e.map(([t,s])=>t!==s&&t>-1&&t<n.length&&s>-1&&s<n.length?[n[t],n[s]]:!1).filter(t=>t)}function ps(n){const e=n.split("$");let t=[],s=[];for(const a of e)a.startsWith("Nodes")?t=us(a):a.startsWith("Elements")&&(s=ms(a));return console.log("mesh file:",t,s),hs(t,s)}class gs{constructor(e){k(this,"data");k(this,"handle");k(this,"startLonColumn");k(this,"endLonColumn");k(this,"startLatColumn");k(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=ps(e);else{const t=re(e);this.data=t.map(s=>{const a={lon:0,lat:0},o={lon:0,lat:0};console.log("parsing row",s),typeof s[this.startLonColumn]=="number"&&(a.lon=s[this.startLonColumn]),typeof s[this.startLatColumn]=="number"&&(a.lat=s[this.startLatColumn]),typeof s[this.endLonColumn]=="number"&&(o.lon=s[this.endLonColumn]),typeof s[this.endLatColumn]=="number"&&(o.lat=s[this.endLatColumn]);const d=Object.keys(s).filter(c=>c!==this.startLatColumn&&c!==this.endLatColumn&&c!==this.startLonColumn&&c!==this.endLonColumn);if(d.length>0){const c={};for(const m of d)c[m]=s[m];return[a,o]}return[a,o]})}}async save(){console.log("Mesh files do not get saved")}}class _e{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(m=>{const l={};for(const g of it)l[g]=m[g]||(g==="name"?"":0);return l}),a={},o={},d=[];let c=0;for(const m of s){const[l,g]=H({lon:m.lon1,lat:m.lat1},a,o,c),[i,v]=H({lon:m.lon2,lat:m.lat2},a,o,g),_=x(f({},m),{start:l,end:i});c=v,d.push(_)}this.data={vertecies:o,segments:d,vertexDictionary:a,lastIndex:c}}async save(){let e=[];if(this.data){const{vertecies:s,segments:a}=this.data;e=a.map(o=>{const d=s[o.start],c=s[o.end];return x(f({},o),{lon1:d.lon,lat1:d.lat,lon2:c.lon,lat2:c.lat})})}const t=xe(e,it);await this.handle.setContents(t)}clone(){return new _e(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const s of this.data.segments)if(s.start===e||s.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const s=this.data.vertecies[e],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,o=f({},this.data.vertecies);delete o[e];const d=f({},this.data.vertexDictionary);delete d[a];const c=this.clone();return c.data=x(f({},this.data),{vertecies:o,vertexDictionary:d}),c}}return this}mergeVertices(e,t){if(this.data){for(const m of this.data.segments)m.start===t&&(m.start=e),m.end===t&&(m.end=e);const s=this.data.vertecies[t],a=`${Math.floor(s.lon*M)},${Math.floor(s.lat*M)}`,o=f({},this.data.vertecies);delete o[t];const d=f({},this.data.vertexDictionary);delete d[a];const c=this.clone();return c.data=x(f({},this.data),{vertecies:o,vertexDictionary:d}),c}return this}moveVertex(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),o=[...this.data.segments],d=s[e],c=`${Math.floor(t.lon*M)},${Math.floor(t.lat*M)}`,m=`${Math.floor(d.lon*M)},${Math.floor(d.lat*M)}`;if(delete a[m],c in a){const g=a[c];for(const i of o)i.start===g&&(i.start=e),i.end===g&&(i.end=e);delete s[g]}s[e]=t;const l=this.clone();return l.data=x(f({},this.data),{segments:o,vertecies:s,vertexDictionary:a}),l}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],s=this.data.vertecies[t.start],a=this.data.vertecies[t.end],o={lon:(s.lon+a.lon)/2,lat:(s.lat+a.lat)/2},[d,c]=H(o,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),m=x(f({},t),{end:d,name:`${t.name}_a`}),l=x(f({},t),{start:d,name:`${t.name}_b`}),g=[...this.data.segments];g[e]=m,g.push(l);const i=this.clone();return i.data=x(f({},this.data),{segments:g,lastIndex:c}),i}return this}bridgeVertices(e,t){if(this.data){const s=x(f({},ne),{start:e,end:t}),a=[...this.data.segments,s],o=this.clone();return o.data=x(f({},this.data),{segments:a}),o}return this}extrudeSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[o,d]=H(t,a,s,this.data.lastIndex),c=x(f({},ne),{start:e,end:o}),m=[...this.data.segments,c],l=this.clone();return l.data={vertecies:s,vertexDictionary:a,segments:m,lastIndex:d},l}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],s=t.splice(e,1)[0],a=this.clone();return a.data=x(f({},this.data),{segments:t}),a.tryRemoveVertex(s.start).tryRemoveVertex(s.end)}return this}createSegment(e,t){if(this.data){const s=f({},this.data.vertecies),a=f({},this.data.vertexDictionary),[o,d]=H(e,a,s,this.data.lastIndex),[c,m]=H(t,a,s,d),l=x(f({},ne),{start:o,end:c}),g=[...this.data.segments,l],i=this.clone();return i.data={vertecies:s,vertexDictionary:a,segments:g,lastIndex:m},i}return this}}class Ne{constructor(e){k(this,"handle");k(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),s=re(e).map(a=>{const o={};for(const d of ht)o[d]=a[d]||(d==="name"?"":0);return o});this.data=s}async save(){var t;const e=xe((t=this.data)!=null?t:[],ht);await this.handle.setContents(e)}clone(){return new Ne(this.handle)}}async function xt(n){const e=new _e(n);return await e.initialize(),e}async function bt(n){const e=new be(n);return await e.initialize(),e}async function wt(n){const e=new Ne(n);return await e.initialize(),e}async function _t(n){const e=new gs(n);return await e.initialize(),e}async function ys(n,e,t){const s=new we(e);if(await s.initialize(),s.data){const a=await xt(await n.getFile(s.data.segment_file_name)),o=await bt(await n.getFile(s.data.block_file_name)),d=await wt(await n.getFile(s.data.station_file_name)),c=await n.getFile(s.data.mesh_parameters_file_name),m=JSON.parse(await c.getContents()),l=await Promise.all(m.map(async i=>_t(await n.getFile(i.mesh_filename)))),g=f({},t);return"command"in g&&(g.command=x(f({},g.command),{currentFilePath:e.name})),"segment"in g&&(g.segment=x(f({},g.segment),{currentFilePath:s.data.segment_file_name})),"block"in g&&(g.block=x(f({},g.block),{currentFilePath:s.data.block_file_name})),"velocities"in g&&(g.velocities=x(f({},g.velocities),{currentFilePath:s.data.station_file_name})),"mesh"in g&&(g.mesh=x(f({},g.mesh),{currentFilePath:m.map(i=>i.mesh_filename)})),{openableFiles:g,commands:s,segments:a,blocks:o,velocities:d,mesh:l}}throw new Error("Can't open command file")}class vs{constructor(e){k(this,"name");k(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class Se{constructor(e){k(this,"name");k(this,"handle");k(this,"fileList");k(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new vs(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),s=new Se(t);return await s.initialize(),s}}const xs=async()=>{const n=await window.showDirectoryPicker(),e=new Se(n);return await e.initialize(),e};class bs{constructor(e,t){k(this,"name");k(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ke{constructor(e,t){k(this,"name");k(this,"parent");k(this,"fileList");k(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const s=t[e];for(const a of Object.keys(s))typeof s[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new bs(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ke(e,this.parent[this.name])}}const ws=async n=>new ke("root",n);let Nt=async()=>{var e;return ws((e=window.FakeDirectory)!=null?e:{})};function _s(n){Nt=n}async function Ns(){return Nt()}window.location.search.includes("fake-dir")||_s(xs);var T;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(T||(T={}));const St={Block:T.Block,Vertex:T.Vertex,Velocity:T.Velocity},Ss={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh"};function ks(){var Ae,Te,We;const n=Ye(),[e,t]=S.exports.useState(),[s,a]=S.exports.useState(""),[o,d]=S.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[c,m]=S.exports.useState(),[l,g]=S.exports.useState(),[i,v]=S.exports.useState(),[_,p]=S.exports.useState(),h=ie(u=>u.main.present.segment),w=ie(u=>u.main.present.block),N=ie(u=>u.main.present.velocity),P=ie(u=>u.main.present.meshLine),[C,Q]=S.exports.useState(kn),[V,Ce]=S.exports.useState(on),[B,Le]=S.exports.useState(wn),[F,De]=S.exports.useState(Dn),[W,Fe]=S.exports.useState(vn),[E,X]=S.exports.useState("normal"),[Z,$t]=S.exports.useState(T.Vertex),[le,$e]=S.exports.useState([]),[Ve,Me]=S.exports.useState([]),[je,Ie]=S.exports.useState([]),[Re,Oe]=S.exports.useState([]),[$,Es]=S.exports.useState({select:(u,y)=>{$e(u==="block"?y:[]),Me(u==="segment"?y:[]),Ie(u==="velocities"?y:[]),Oe(u==="vertex"?y:[]),a(u)}}),[Vt,Mt]=S.exports.useState([]),[jt,Pe]=S.exports.useState([]),[It,Rt]=S.exports.useState([]),[Ot,ce]=S.exports.useState({color:F.color,selectedColor:F.activeColor,radius:F.radius,selectedRadius:F.activeRadius,points:[]}),[Ee,Pt]=S.exports.useState({lon:0,lat:0}),[de,Et]=S.exports.useState(!1);S.exports.useEffect(()=>{E==="normal"?$.select=(u,y)=>{$e(u==="block"?y:[]),Me(u==="segment"?y:[]),Ie(u==="velocities"?y:[]),Oe(u==="vertex"?y:[]),a(u)}:E.mode==="override"?$.select=(u,y)=>{u===E.type&&E.callback(y)}:$.select=()=>{}},[E,$]),S.exports.useEffect(()=>{const u=[];Z!==T.Block&&!V.hide&&u.push({name:"blocks",color:V.color,selectedColor:V.selectedColor,radius:V.radius,points:w.map((y,D)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:D})),click:y=>{$.select("block",[y])}}),Z!==T.Vertex&&!F.hide&&u.push({name:"vertices",color:F.color,selectedColor:F.activeColor,radius:F.radius,click:y=>{$.select("vertex",[y])},points:Object.keys(h.vertecies).map(y=>{const D=Number.parseInt(y,10),j=h.vertecies[D];return j?{longitude:j.lon,latitude:j.lat,index:D,name:"",description:""}:!1}).filter(y=>!!y)}),Mt(u)},[V,w,B,$,Z,F.hide,F.color,F.activeColor,F.radius,h.vertecies]),S.exports.useEffect(()=>{const u=[];if(B.hide||u.push({name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:h.segments.map((y,D)=>{var K,U;const j=(K=h.vertecies[y.start])!=null?K:qe,z=(U=h.vertecies[y.end])!=null?U:qe,[[ee,R],[se,G]]=Xe(j,z);return{startLongitude:ee,startLatitude:R,endLongitude:se,endLatitude:G,name:y.name,description:`${j.lon},${j.lat} to ${z.lon},${z.lat}`,index:D}}),click:y=>{$.select("segment",[y])}}),!W.hide)for(const y of Object.keys(P)){const D=P[y];u.push({name:`mesh:${y}`,color:W.color,selectedColor:W.activeColor,width:W.width,selectedWidth:W.activeWidth,lines:D.map((j,z)=>{const ee=j[0],R=j[1],[[se,G],[K,U]]=Xe(ee,R);return{startLongitude:se,startLatitude:G,endLongitude:K,endLatitude:U,name:"",description:"",index:z}})||[]})}Rt(u)},[h,B,W,P,$]),S.exports.useEffect(()=>{switch(Z){case T.Vertex:{ce({color:F.color,radius:F.radius,selectedColor:F.activeColor,selectedRadius:F.activeRadius,points:F.hide?[]:Object.keys(h.vertecies).map(u=>{const y=Number.parseInt(u,10),D=h.vertecies[y];return D?{longitude:D.lon,latitude:D.lat,index:y}:!1}).filter(u=>!!u),update:(u,y)=>{n(ye({index:u,vertex:y}))},select:u=>{$.select("vertex",u)}});break}case T.Block:{ce({color:V.color,radius:V.radius,selectedColor:V.selectedColor,selectedRadius:V.radius,points:V.hide?[]:w.map((u,y)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(ot({index:u,position:y}))},select:u=>{$.select("block",u)}});break}case T.Velocity:{ce({color:C.color,radius:C.width,selectedColor:C.selectedColor,selectedRadius:C.width,points:C.hide?[]:N.map((u,y)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:y})),update:(u,y)=>{n(vt({index:u,position:y}))},select:u=>{$.select("velocities",u)}});break}}},[F,$,h.vertecies,n,Z,V.color,V.radius,V.selectedColor,V.hide,w,C.color,C.width,C.selectedColor,C.hide,N]),S.exports.useEffect(()=>{C.hide?Pe([]):Pe([{name:"velocities",color:C.color,selectedColor:C.selectedColor,scale:C.scale,arrowHeadScale:C.arrowHead,width:C.width,arrows:N.map((u,y)=>{const D=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/D,u.north_vel/D],scale:D,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:y}}),click:u=>{$.select("velocities",[u])}}])},[$,C,N]);let Y=r("span",{});switch(s){case"files":Y=e?r(ln,{folder:e,files:o,setFile:async(u,y,D,j)=>{if(j){let z=f({},o);const ee=z[y];let{currentFilePath:R,allowMultiple:se}=ee;switch(se?Array.isArray(R)?(R=R.map(G=>G),R.length>u?R[u]=D:R.push(D)):R=[D]:R=D,z[y]=x(f({},ee),{currentFilePath:R}),y){case"segment":const G=await xt(j);g(G),G.data&&n(ge(G.data));break;case"block":const K=await bt(j);v(K),K.data&&n(he(K.data));break;case"velocity":const U=await wt(j);p(U),U.data&&n(ve(U.data));break;case"mesh":const ze=await _t(j);ze.data&&n(pe({mesh:`mesh_file_${u}`,data:ze.data}));break;case"command":const O=await ys(e,j,o);m(O.commands),g(O.segments),O.segments.data&&n(ge(O.segments.data)),v(O.blocks),O.blocks.data&&n(he(O.blocks.data)),p(O.velocities),O.velocities.data&&n(ve(O.velocities.data)),O.mesh&&O.mesh.map((He,Ge)=>(He.data&&n(pe({mesh:`mesh_file_${Ge}`,data:He.data})),Ge)),z=O.openableFiles;break}d(z)}}}):r("span",{});break;case"velocities":Y=r(Cn,{settings:C,setSettings:Q,selected:je,velocitys:N,setVelocityData:(u,y)=>{y?n(gt({indices:u,data:y})):(n(yt(u)),$.select("velocity",[]))},addNewVelocity:()=>{X({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{X("normal");const y=N.length;n(pt({data:{lat:u.lat,lon:u.lon}})),$.select("velocity",[y])}})}});break;case"block":Y=r(rn,{settings:V,setSettings:Ce,selected:le,blocks:w,addNewBlock:()=>{X({label:"Click to place new block",mode:"mapClick",callback:u=>{const y=w.length;n(nt({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),$.select("block",[y]),X("normal")}})},setBlockData:(u,y)=>{y?n(st({indices:le,data:y})):(n(at(u)),$.select("block",[]))}});break;case"segment":Y=r(_n,{settings:B,setSettings:Le,segments:(Ae=h.segments)!=null?Ae:[],selected:Ve,setSelectionMode:u=>X(u),addNewSegment:(u,y)=>{const D=h.segments.length;n(lt({start:u,end:y})),$.select("segment",[D])},setSegmentData:(u,y)=>{n(y?dt({indices:u,data:y}):ct({index:u}))},splitSegment:u=>{n(mt(u)),$.select("segment",[])}});break;case"vertex":Y=r(Fn,{settings:F,setSettings:De,vertices:(Te=h.vertecies)!=null?Te:{},selected:Re,setVertexData:(u,y)=>{y&&n(ye({index:u,vertex:y}))},setSelectionMode:u=>X(u),mergeVertices:(u,y)=>{n(ft({a:u,b:y}))},bridgeVertices:(u,y)=>{n(rt({a:u,b:y}))},extrudeVertex:(u,y)=>{n(ut({index:u,targetPoint:y}))}});break;case"mesh":Y=r(xn,{settings:W,setSettings:Fe});break}const Be={Block:{state:V.hide,change:()=>{Ce(x(f({},V),{hide:!V.hide}))}},Vertex:{state:F.hide,change:()=>{De(x(f({},F),{hide:!F.hide}))}},Velocity:{state:C.hide,change:()=>{Q(x(f({},C),{hide:!C.hide}))}},Segment:{state:B.hide,change:()=>{Le(x(f({},B),{hide:!B.hide}))}},Grid:{state:!de,change:()=>{Et(!de)}},Mesh:{state:W.hide,change:()=>{Fe(x(f({},W),{hide:!W.hide}))}}};return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:u=>{u.key==="Escape"&&X("normal")},children:[r(Nn,{filesOpen:((We=c!=null?c:l)!=null?We:i)!==void 0,saveFiles:async()=>{c&&await c.save(),l&&(l.data=h,await l.save()),i&&(i.data=w,await i.save()),_&&(_.data=N,await _.save())},folder:e,openFolder:async()=>{const u=await Ns();t(u),a("files")}}),E!=="normal"?r("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[r("span",{className:"text-lg font-semibold",children:E.label}),E.subtitle?r("span",{className:"text-md font-thin text-gray-500",children:E.subtitle}):r(I,{}),r("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):r(I,{}),b("div",{className:"absolute bottom-0 left-2 flex flex-col bg-white rounded-t p-2 gap-5 shadow-sm z-50",children:[r("div",{className:"flex flex-row items-center justify-start gap-5",children:b("span",{className:"p-1 text-sm text-center",children:["Hold ",r("span",{className:"font-bold",children:"Shift"})," to box select"," ",r("span",{className:"font-bold",children:Z})]})}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),b("span",{children:[Math.floor(Ee.lon*1e3)/1e3,","," ",Math.floor(Ee.lat*1e3)/1e3]})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[r("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(St).map(u=>{const y=St[u];return r("button",{type:"button",className:`${Z===y?"bg-gray-200":"bg-white"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{$t(y)},children:u},u)})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(Be).map(u=>{const y=Be[u];return r("button",{type:"button",className:`${y.state?"bg-white":"bg-gray-200"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{y.change()},children:u},u)})]})]}),r(gn,{pointSources:Vt,arrowSources:jt,lineSources:It,drawnPointSource:Ot,selections:{segments:Ve,blocks:le,velocities:je,vertices:Re},displayGrid:de?10:-1,click:u=>{typeof E!="string"&&E.mode==="mapClick"&&E.callback(u)},mouseMove:u=>{Pt(u)}}),r(cn,{view:Y,buttons:e?Ss:void 0,active:s,setActive:u=>a(u)})]})}function Cs(n,e){return x(f({},n),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",segments:e.data}})}function Ls(n,e){const t={};for(const s of Object.keys(n))s!==e&&(t[s]=n[s]);return t}function Ds(n,e){const t=n[e.collection];if(!t)return n;const s=x(f({},t),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat});return x(f({},n),{[e.collection]:s})}const Fs={},$s=L("loadNewGenericCollectionData"),Vs=L("setGenericSegmentPositionKeys"),Ms=L("removeGenericSegmentCollection"),js=ae(Fs,n=>n.addCase($s,(e,t)=>Cs(e,t.payload)).addCase(Vs,(e,t)=>Ds(e,t.payload)).addCase(Ms,(e,t)=>Ls(e,t.payload))),Is=Ut({reducer:{main:qt(Qt({segment:Yn,block:Pn,velocity:ls,meshLine:Wn,genericSegments:js}))}});function Rs(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisterError:o}=n;let d;const c=async(m=!0)=>{};return"serviceWorker"in navigator&&(d=new Xt("./sw.js",{scope:"./"}),d.addEventListener("activated",m=>{m.isUpdate?window.location.reload():s==null||s()}),d.register({immediate:e}).then(m=>{a==null||a(m)}).catch(m=>{o==null||o(m)})),c}Rs();const Os=1,Ps=new Zt({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Os}}});Yt.render(r(S.exports.StrictMode,{children:r(en,{client:Ps,children:r(tn,{store:Is,children:r(ks,{})})})}),document.querySelector("#root"));
