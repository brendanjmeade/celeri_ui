var yt=Object.defineProperty,xt=Object.defineProperties;var vt=Object.getOwnPropertyDescriptors;var Ie=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var me=(t,e,n)=>e in t?yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))wt.call(e,n)&&me(t,n,e[n]);if(Ie)for(var n of Ie(e))_t.call(e,n)&&me(t,n,e[n]);return t},x=(t,e)=>xt(t,vt(e));var F=(t,e,n)=>(me(t,typeof e!="symbol"?e+"":e,n),n);import{j as i,a as b,F as P,r as v,m as Me,b as fe,M as bt,u as St,c as Nt,l as je,d as pe,e as j,f as kt,g as Ct,h as $t,v as Dt,Q as Ft,R as Lt,i as Vt,P as It}from"./vendor.08b12812.js";const Mt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}};Mt();function jt({value:t,fieldDefinition:e,setField:n}){const[a,s]=v.exports.useState(-1),[r,d]=v.exports.useState(t);return v.exports.useEffect(()=>{d(t)},[t]),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?i("span",{className:"text-sm",children:e.description}):i(P,{})]}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof t=="number"?"number":"text",value:r,onChange:o=>{const f=typeof t=="number"?Number.parseFloat(o.target.value):o.target.value;d(f),a>-1&&clearTimeout(a),s(setTimeout(()=>n(f),1e3))}})})]})}function ie({title:t,item:e,setItem:n,fieldDefinitions:a,ignoreFields:s,deletable:r,controls:d}){const o=Object.keys(e).map((f,u)=>{if(s==null?void 0:s.includes(f))return{element:i("span",{style:{display:"hidden"}},f),order:u+1e4};const _=e[f],g=f in a&&a[f];return g?{element:i(jt,{value:_,fieldDefinition:g,setField:N=>n({[f]:N})},f),order:g.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":`input-title-${f}`,className:"text-l font-bold",children:f}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{"data-testid":`input-editor-${f}`,className:"rounded w-full",type:typeof _=="number"?"number":"text",value:_,onChange:N=>{n({[f]:typeof _=="number"?Number.parseFloat(N.target.value):N.target.value})}})})]},f),order:u+1e3}}).sort((f,u)=>f.order-u.order).map(f=>f.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:t}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[d,r?i("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):i(P,{})]})]}),o]})}ie.defaultProps={ignoreFields:[],controls:i(P,{})};const Et={color:"#0000ff",selectedColor:"#ff0000",radius:6};var rt;const Rt=JSON.parse((rt=window.localStorage.getItem("blockDisplaySettings"))!=null?rt:"false")||Et;function Ot({settings:t,setSettings:e,selected:n,blocks:a,setBlockData:s,addNewBlock:r}){const d=u=>{e(u),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(u))},o=a[n],f=o?i(ie,{title:o.name,item:o,deletable:!0,setItem:u=>s(n,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):i(P,{});return b(P,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:u=>{d(x(m({},t),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.selectedColor,onChange:u=>{d(x(m({},t),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:t.radius,onChange:u=>{d(x(m({},t),{radius:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Block"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),f]})}function Pt({folder:t,files:e,setFile:n}){const a=Object.keys(e).map(s=>{const r=e[s];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[i("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:r.name}),i("span",{className:"text-sm","data-testid":`file-${s}-description`,children:r.description})]}),i("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${s}-select`,className:"w-full rounded",value:r.currentFilePath,onChange:async d=>{const o=d.currentTarget.value;try{const f=await t.getFile(o);n(s,f.name,f)}catch{n(s,"")}},children:[i("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),t.fileList.filter(d=>d.endsWith(r.extension)).map(d=>i("option",{value:d,"data-testid":`file-${s}-select-${d}`,children:d},d))]})})]},s)});return i("div",{className:"flex flex-col gap-2",children:a})}function Bt({view:t,buttons:e,active:n,setActive:a}){if(!e)return i("span",{});const s=[];for(const r of Object.keys(e)){const d=e[r],o=r===n;s.push(i("button",{type:"button","data-testid":`tab-${r}`,className:`${o?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>a(o?"":r),children:d},r))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[n?i("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm",children:t}):"",i("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:s})]})}const Ee={lon:0,lat:0},At=180,Y=360;function Re(t){let{lon:e,lat:n}=t;for(;e<0;)e+=Y;for(;e>Y;)e-=Y;return[e,n]}function Oe([t,e]){return{lon:t<0?t+Y:t,lat:e}}function Tt(t,e){const n=Re(t),a=Re(e),s=[a[0],a[1]];return a[0]-n[0]>=At?s[0]-=Y:s[0]+=Y,Math.abs(n[0]-a[0])>Math.abs(n[0]-s[0])?[n,s]:[n,a]}const I=1e3;function z(t,e,n,a){const s=`${Math.floor(t.lon*I)},${Math.floor(t.lat*I)}`;if(s in e)return[e[s],a];const r=a;return n[r]=t,e[s]=r,[r,a+1]}function Pe(t,e){let n=!1;for(const a of t.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&t.vertecies[e]){const a=t.vertecies[e],s=`${Math.floor(a.lon*I)},${Math.floor(a.lat*I)}`,r=m({},t.vertecies);delete r[e];const d=m({},t.vertexDictionary);return delete d[s],x(m({},t),{vertecies:r,vertexDictionary:d})}return t}Me.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const G=Math.PI/6,Q=2*Math.PI-G,q={};function Ht({pointSources:t,arrowSources:e,lineSources:n,selections:a,drawnPointSource:s,click:r}){const d=v.exports.useRef(null),[o,f]=v.exports.useState(),[u,_]=v.exports.useState(!1),[g,N]=v.exports.useState(),[E]=v.exports.useState(new fe.exports.Popup({closeButton:!1,closeOnClick:!1})),[X,O]=v.exports.useState(),[W,U]=v.exports.useState(),[T,re]=v.exports.useState(),[R,ce]=v.exports.useState({source:void 0}),[B,de]=v.exports.useState({selectedColor:"",selectedRadius:0,color:"",radius:0}),[L,te]=v.exports.useState({}),[M,J]=v.exports.useState({click:r});return v.exports.useEffect(()=>{M.click!==r&&(M.click=r,J(M))},[r,M]),v.exports.useEffect(()=>{if(!o&&Me.accessToken&&d.current){const $=new fe.exports.Map({container:d.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});$.addControl(new fe.exports.NavigationControl),f($),$.on("load",()=>{_(!0)}),$.on("click",({lngLat:D})=>{M.click(Oe([D.lng,D.lat]))}),$.on("draw.selectionchange",({features:D})=>{var w;if(!((w=R.source)==null?void 0:w.select))return;const l=D[0];l&&l.type==="Feature"&&l.geometry.type==="Point"&&l.properties&&"index"in l.properties&&typeof l.properties.index=="number"&&R.source.select(l.properties.index)}),$.on("draw.modechange",({mode:D})=>{D==="simple_select"&&a.drawnPoint&&g&&g.changeMode("direct_select",{featureId:`${a.drawnPoint}`})}),$.on("draw.update",({features:D,action:l})=>{var w;if(!!((w=R.source)==null?void 0:w.update)&&l==="move"&&D.length>0)for(const C of D)C.type==="Feature"&&C.geometry.type==="Point"&&C.properties&&"index"in C.properties&&typeof C.properties.index=="number"&&R.source.update(C.properties.index,Oe(C.geometry.coordinates))})}console.log("Updating map...")},[g,M,R.source,o,a]),v.exports.useEffect(()=>{if(o&&u&&R.source!==s){console.log("Drawning Points"),R.source=s,ce(R);let $=g;(s.selectedColor!==B.selectedColor||s.selectedRadius!==B.selectedRadius||s.color!==B.color||s.radius!==B.radius)&&(de({color:s.color,radius:s.radius,selectedRadius:s.selectedRadius,selectedColor:s.selectedColor}),g&&o.removeControl(g),s?($=new bt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":s.selectedRadius,"circle-color":s.selectedColor}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":s.radius,"circle-color":s.color}}]}),o.addControl($),N($)):$=void 0),$&&$.set({type:"FeatureCollection",features:s.points.map(D=>({type:"Feature",properties:{description:"",index:D.index,name:""},geometry:{type:"Point",coordinates:[D.longitude,D.latitude]}}))})}},[o,u,R,s,B,g]),v.exports.useEffect(()=>{if(o&&u&&W!==e)if(console.log("Setting arrows in map!"),W){for(const l of W){q[`arrow:${l.name}`]=l.click;const w=o.getSource(`arrow:${l.name}`);w!==void 0&&w.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:arrow:${l.name}`),o.removeLayer(`layer:arrow:${l.name}:click`)}U(void 0)}else{for(const l of e){q[`arrow:${l.name}`]=l.click;let w=o.getSource(`arrow:${l.name}`);const C=w===void 0;C&&(o.addSource(`arrow:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),w=o.getSource(`arrow:${l.name}`)),w!==void 0&&w.setData({type:"FeatureCollection",features:l.arrows.map(h=>{const p=h.scale*l.scale,S=l.scale*l.arrowHeadScale,k=[h.longitude+h.direction[0]*p,h.latitude+h.direction[1]*p],H=[k[0]+(Math.cos(G)*-h.direction[0]-Math.sin(G)*-h.direction[1])*S,k[1]+(Math.sin(G)*-h.direction[0]+Math.cos(G)*-h.direction[1])*S],ne=[k[0]+(Math.cos(Q)*-h.direction[0]-Math.sin(Q)*-h.direction[1])*S,k[1]+(Math.sin(Q)*-h.direction[0]+Math.cos(Q)*-h.direction[1])*S];return{type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index===a[l.name]},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],k,H,k,ne]}}})}),o.addLayer({id:`layer:arrow:${l.name}`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":l.width}}),o.addLayer({id:`layer:arrow:${l.name}:click`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),C&&(o.on("mouseenter",`layer:arrow:${l.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const S=[...p.geometry.coordinates],{description:k}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;E.setLngLat(S).setHTML(k).addTo(o)}}),o.on("mouseleave",`layer:arrow:${l.name}:click`,()=>{E.remove()}),o.on("click",`layer:arrow:${l.name}:click`,h=>{const p=q[`arrow:${l.name}`];if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:k}=S.properties;p(k)}}))}U(e)}const $=m({},L);let D=!1;for(const l of Object.keys(a))if(a[l]!==L[l]){for(const w of e)if(w.name===l){D=!0,$[l]=a[l];const C=o==null?void 0:o.getSource(`arrow:${w.name}`);if(C){const h=a[l];C.setData({type:"FeatureCollection",features:w.arrows.map(p=>{const S=p.scale*w.scale,k=w.scale*w.arrowHeadScale,H=[p.longitude+p.direction[0]*S,p.latitude+p.direction[1]*S],ne=[H[0]+(Math.cos(G)*-p.direction[0]-Math.sin(G)*-p.direction[1])*k,H[1]+(Math.sin(G)*-p.direction[0]+Math.cos(G)*-p.direction[1])*k],ue=[H[0]+(Math.cos(Q)*-p.direction[0]-Math.sin(Q)*-p.direction[1])*k,H[1]+(Math.sin(Q)*-p.direction[0]+Math.cos(Q)*-p.direction[1])*k];return{type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===h},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],H,ne,H,ue]}}})})}}}D&&te($)},[o,W,e,u,E,a,L]),v.exports.useEffect(()=>{if(o&&u&&T!==n)if(console.log("Setting lines in map!"),T){for(const l of T){q[`line:${l.name}`]=l.click;const w=o.getSource(`line:${l.name}`);w!==void 0&&w.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:line:${l.name}`),o.removeLayer(`layer:line:${l.name}:click`)}re(void 0)}else{for(const l of n){q[`line:${l.name}`]=l.click;let w=o.getSource(`line:${l.name}`);const C=w===void 0;C&&(o.addSource(`line:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),w=o.getSource(`line:${l.name}`)),w!==void 0&&w.setData({type:"FeatureCollection",features:l.lines.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index===a[l.name]},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}))}),o.addLayer({id:`layer:line:${l.name}`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],l.selectedColor,l.color],"line-width":["case",["get","selected"],l.selectedWidth,l.width]}}),o.addLayer({id:`layer:line:${l.name}:click`,type:"line",source:`line:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":l.width*10}}),C&&(o.on("mouseenter",`layer:line:${l.name}:click`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="LineString"&&p.properties&&typeof p.properties.description=="string"){const S=[(p.geometry.coordinates[0][0]+p.geometry.coordinates[1][0])/2,(p.geometry.coordinates[0][1]+p.geometry.coordinates[1][1])/2],{description:k}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;E.setLngLat(S).setHTML(k).addTo(o)}}),o.on("mouseleave",`layer:line:${l.name}:click`,()=>{E.remove()}),o.on("click",`layer:line:${l.name}:click`,h=>{const p=q[`line:${l.name}`];if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:k}=S.properties;p(k)}}))}re(n)}const $=m({},L);let D=!1;for(const l of Object.keys(a))if(a[l]!==L[l]){for(const w of n)if(w.name===l){D=!0,$[l]=a[l];const C=o==null?void 0:o.getSource(`line:${w.name}`);if(C){const h=a[l];C.setData({type:"FeatureCollection",features:w.lines.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index===h},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}))})}}}D&&te($)},[o,T,n,u,E,a,L]),v.exports.useEffect(()=>{if(!o||!u)return;if(X!==t)if(console.log("Setting points in map!"),X){for(const l of X){q[`point:${l.name}`]=l.click;const w=o.getSource(`point:${l.name}`);w!==void 0&&w.setData({type:"FeatureCollection",features:[]}),o.removeLayer(`layer:point:${l.name}`)}O(void 0)}else{for(const l of t){q[`point:${l.name}`]=l.click;let w=o.getSource(`point:${l.name}`);const C=w===void 0;C&&(o.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),w=o.getSource(`point:${l.name}`)),w!==void 0&&w.setData({type:"FeatureCollection",features:l.points.map(h=>({type:"Feature",properties:{description:`<strong>${h.name}</strong><p>${h.description}</p>`,index:h.index,name:h.name,selected:h.index!==a[l.name]},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}))}),o.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":["case",["get","selected"],l.selectedColor,l.color],"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),C&&(o.on("mouseenter",`layer:point:${l.name}`,h=>{if(!h.features)return;const p=h.features[0];if(p.geometry.type==="Point"&&p.properties&&typeof p.properties.description=="string"){const S=[...p.geometry.coordinates],{description:k}=p.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;E.setLngLat(S).setHTML(k).addTo(o)}}),o.on("mouseleave",`layer:point:${l.name}`,()=>{E.remove()}),o.on("click",`layer:point:${l.name}`,h=>{const p=q[`point:${l.name}`];if(!h.features||!p)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:k}=S.properties;p(k)}}))}O(t)}const $=m({},L);let D=!1;for(const l of Object.keys(a))if(a[l]!==L[l]){for(const w of t)if(w.name===l){D=!0,$[l]=a[l];const C=o.getSource(`point:${w.name}`);if(C){const h=a[l];C.setData({type:"FeatureCollection",features:w.points.map(p=>({type:"Feature",properties:{description:`<strong>${p.name}</strong><p>${p.description}</p>`,index:p.index,name:p.name,selected:p.index!==h},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}))})}}}D&&te($)},[o,X,t,u,E,a,L]),i("div",{"data-testid":"map",className:"w-full h-full",ref:d})}const Wt={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3};var lt;const zt=m(m({},Wt),JSON.parse((lt=window.localStorage.getItem("segmentDisplaySettings"))!=null?lt:"{}"));function Jt({settings:t,setSettings:e,segments:n,selected:a,setSegmentData:s,addNewSegment:r,splitSegment:d,setSelectionMode:o}){const f=g=>{e(g),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(g))},u=n[a],_=u?i(ie,{title:u.name,item:u,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItem:g=>s(a,g),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>d(a),children:"Split Segment"})}):i(P,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:g=>{f(x(m({},t),{color:g.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:g=>{f(x(m({},t),{width:Number.parseFloat(g.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.activeColor,onChange:g=>{f(x(m({},t),{activeColor:g.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.activeWidth,onChange:g=>{f(x(m({},t),{activeWidth:Number.parseFloat(g.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Segment"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{o({mode:"mapClick",label:"Select Segment Starting Point",callback:g=>{o({mode:"mapClick",label:"Select Segment End point",callback:N=>{r(g,N),o("normal")}})}})},children:"New Segment"})]}),_]})}const Be=()=>St(),le=Nt;function Gt({folder:t,openFolder:e,filesOpen:n,saveFiles:a}){function s(){e()}const r=Be(),[d,o]=le(f=>[f.main.past.length>0,f.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[i("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[t?i("button",{type:"button",onClick:()=>{r(je.ActionCreators.undo())},"data-testid":"undo-button",disabled:!d,children:"Undo"}):i(P,{}),t?i("button",{type:"button",onClick:()=>{r(je.ActionCreators.redo())},disabled:!o,"data-testid":"undo-button",children:"Redo"}):i(P,{}),t?b("span",{children:["Working in ",t.name]}):i("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),n?i("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Files"}):i(P,{})]})]})}const qt={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa"};var ct;const Ut=JSON.parse((ct=window.localStorage.getItem("velocityDisplaySettings"))!=null?ct:"false")||qt;function Kt({settings:t,setSettings:e,selected:n,velocitys:a,setVelocityData:s,addNewVelocity:r}){const d=u=>{e(u),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(u))},o=a[n],f=o?i(ie,{title:o.name,item:o,deletable:!0,setItem:u=>s(n,u),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):i(P,{});return b(P,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:u=>{d(x(m({},t),{color:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Selected Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.selectedColor,onChange:u=>{d(x(m({},t),{selectedColor:u.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Scale"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:t.scale,onChange:u=>{d(x(m({},t),{scale:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Width"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:u=>{d(x(m({},t),{width:Number.parseFloat(u.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Arrow Head Size"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:t.arrowHead,onChange:u=>{d(x(m({},t),{arrowHead:Number.parseFloat(u.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Add New Velocity"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),f]})}const Qt={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3};var dt;const Xt=m(m({},Qt),JSON.parse((dt=window.localStorage.getItem("vertexDisplaySettings"))!=null?dt:"{}"));function Zt({settings:t,setSettings:e,vertices:n,selected:a,setVertexData:s,setSelectionMode:r,mergeVertices:d,bridgeVertices:o,extrudeVertex:f}){const u=N=>{e(N),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(N))},_=n[a],g=_?i(ie,{title:"Selected Vertex",item:_,ignoreFields:[],deletable:!1,setItem:N=>s(a,m(m({},_),N)),fieldDefinitions:{},controls:b(P,{children:[i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertex",callback:N=>{d(a,N),r("normal")}})},children:"Merge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",callback:N=>{o(a,N),r("normal")}})},children:"Bridge"}),i("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",callback:N=>{f(a,N),r("normal")}})},children:"Extrude"})]})}):i(P,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.color,onChange:N=>{u(x(m({},t),{color:N.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.radius,onChange:N=>{u(x(m({},t),{radius:Number.parseFloat(N.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Color"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"color",value:t.activeColor,onChange:N=>{u(x(m({},t),{activeColor:N.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[i("span",{className:"text-l font-bold",children:"Active Radius"}),i("span",{className:"w-2/5 flex-shrink-0",children:i("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.activeRadius,onChange:N=>{u(x(m({},t),{activeRadius:Number.parseFloat(N.target.value)}))}})})]}),g]})}const Ae=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Te={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Yt(t){return t?m(m({},Te),t):m({},Te)}function en(t,{data:e}){return[...t,Yt(e)]}function tn(t,e){const n=[...t];return n.splice(e,1),n}function nn(t,e){const n=[...t],a=m(m({},n[e.index]),e.data);return n[e.index]=a,n}function an(t,e){return e}const sn=[],He=j("createBlock"),We=j("editBlock"),ze=j("deleteBlock"),he=j("loadNewBlockData"),on=pe(sn,t=>{t.addCase(He,(e,n)=>en(e,n.payload)).addCase(We,(e,n)=>nn(e,n.payload)).addCase(ze,(e,n)=>tn(e,n.payload)).addCase(he,(e,n)=>an(e,n.payload))}),Je=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],ee={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function rn(t,{a:e,b:n}){const a=x(m({},ee),{start:e,end:n}),s=[...t.segments,a];return x(m({},t),{segments:s})}function ln(t,e){const n=m({},t.vertecies),a=m({},t.vertexDictionary),{lastIndex:s}=t,[r,d]=z(e.start,a,n,s),[o,f]=z(e.end,a,n,d),u=x(m({},ee),{start:r,end:o}),_=[...t.segments,u];return{vertecies:n,vertexDictionary:a,segments:_,lastIndex:f}}function cn(t,e){const n=[...t.segments],a=n.splice(e.index,1)[0];return Pe(Pe(x(m({},t),{segments:n}),a.start),a.end)}function dn(t,e){const n=[...t.segments],a=m(m({},n[e.index]),e.data);return n[e.index]=a,x(m({},t),{segments:n})}function un(t,e){const n=m({},t.vertecies),a=m({},t.vertexDictionary),[s,r]=z(e.targetPoint,a,n,t.lastIndex),d=x(m({},ee),{start:e.index,end:s}),o=[...t.segments,d];return{vertecies:n,vertexDictionary:a,segments:o,lastIndex:r}}function mn(t,e){return e}function fn(t,{a:e,b:n}){if(e===n)return t;const a=t.segments.map(f=>{let u=f;return u.start===n&&(u=x(m({},u),{start:e})),u.end===n&&(u=x(m({},u),{end:e})),u}).filter(f=>f.start!==f.end),s=t.vertecies[n],r=`${Math.floor(s.lon*I)},${Math.floor(s.lat*I)}`,d=m({},t.vertecies);delete d[n];const o=m({},t.vertexDictionary);return delete o[r],x(m({},t),{vertecies:d,vertexDictionary:o,segments:a})}function pn(t,{index:e,vertex:n}){const a=m({},t.vertecies),s=m({},t.vertexDictionary),r=[...t.segments],d=a[e],o=`${Math.floor(n.lon*I)},${Math.floor(n.lat*I)}`,f=`${Math.floor(d.lon*I)},${Math.floor(d.lat*I)}`;if(delete s[f],o in s){const u=s[o];for(const _ of r)_.start===u&&(_.start=e),_.end===u&&(_.end=e);delete a[u]}return a[e]=n,x(m({},t),{segments:r,vertecies:a,vertexDictionary:s})}function hn(t,e){const n=t.segments[e],a=t.vertecies[n.start],s=t.vertecies[n.end],r={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},d=m({},t.vertecies),o=m({},t.vertexDictionary),[f,u]=z(r,o,d,t.lastIndex),_=x(m({},n),{end:f,name:`${n.name}_a`}),g=x(m({},n),{start:f,name:`${n.name}_b`}),N=[...t.segments];return N[e]=_,N.push(g),{vertecies:d,vertexDictionary:o,segments:N,lastIndex:u}}const gn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},Ge=j("bridgeVertices"),qe=j("createSegmet"),Ue=j("deleteSegment"),Ke=j("editSegmentData"),Qe=j("extrudeSegment"),ge=j("loadNewSegmentData"),Xe=j("mergeVertices"),ye=j("moveVertex"),Ze=j("splitSegment"),yn=pe(gn,t=>{t.addCase(Ge,(e,n)=>rn(e,n.payload)).addCase(qe,(e,n)=>ln(e,n.payload)).addCase(Ue,(e,n)=>cn(e,n.payload)).addCase(Ke,(e,n)=>dn(e,n.payload)).addCase(Qe,(e,n)=>un(e,n.payload)).addCase(ge,(e,n)=>mn(e,n.payload)).addCase(Xe,(e,n)=>fn(e,n.payload)).addCase(ye,(e,n)=>pn(e,n.payload)).addCase(Ze,(e,n)=>hn(e,n.payload))}),Ye=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],xn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function vn(t){return m(m({},xn),t)}function wn(t,{data:e}){return[...t,vn(e)]}function _n(t,e){const n=[...t];return n.splice(e,1),n}function bn(t,e){const n=[...t],a=m(m({},n[e.index]),e.data);return n[e.index]=a,n}function Sn(t,e){return e}const Nn=[],et=j("createVelocity"),tt=j("editVelocity"),nt=j("deleteVelocity"),xe=j("loadNewVelocityData"),kn=pe(Nn,t=>{t.addCase(et,(e,n)=>wn(e,n.payload)).addCase(tt,(e,n)=>bn(e,n.payload)).addCase(nt,(e,n)=>_n(e,n.payload)).addCase(xe,(e,n)=>Sn(e,n.payload))});function ve(t){const e=t.split(/\n/g),n=e[0].split(","),a=e.slice(1),s=[];for(const r of a)if(r.trim()!==""){const d=r.split(/\s*,\s*/),o={};for(let f=0;f<n.length;f+=1){let u=d[f];const _=n[f],g=Number.parseFloat(u);u=Number.isNaN(g)?u:g,typeof u=="string"&&u.startsWith('"')&&u.endsWith('"')&&(u=u.slice(1,-1)),o[_]=u}s.push(o)}return s}function we(t,e){const n=[e.join(",")];for(const a of t){const s=a;n.push(e.map(r=>r in s?typeof s[r]=="string"&&/\s/.test(`${s[r]}`)?`"${s[r]}"`:`${s[r]}`:"").join(","))}return n.join(`
`)}class _e{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ve(e).map(s=>{const r={};for(const d of Ae)r[d]=s[d]||(d==="name"?"":0);return r});this.data=a}async save(){var n;const e=we((n=this.data)!=null?n:[],Ae);await this.handle.setContents(e)}clone(){return new _e(this.handle)}}const Cn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function $n(t){return m(m({},Cn),t)}class be{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=JSON.parse(e);this.data=$n(n)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new be(this.handle)}}class Se{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ve(e).map(f=>{const u={};for(const _ of Je)u[_]=f[_]||(_==="name"?"":0);return u}),s={},r={},d=[];let o=0;for(const f of a){const[u,_]=z({lon:f.lon1,lat:f.lat1},s,r,o),[g,N]=z({lon:f.lon2,lat:f.lat2},s,r,_),E=x(m({},f),{start:u,end:g});o=N,d.push(E)}this.data={vertecies:r,segments:d,vertexDictionary:s,lastIndex:o}}async save(){let e=[];if(this.data){const{vertecies:a,segments:s}=this.data;e=s.map(r=>{const d=a[r.start],o=a[r.end];return x(m({},r),{lon1:d.lon,lat1:d.lat,lon2:o.lon,lat2:o.lat})})}const n=we(e,Je);await this.handle.setContents(n)}clone(){return new Se(this.handle)}tryRemoveVertex(e){if(this.data){let n=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*I)},${Math.floor(a.lat*I)}`,r=m({},this.data.vertecies);delete r[e];const d=m({},this.data.vertexDictionary);delete d[s];const o=this.clone();return o.data=x(m({},this.data),{vertecies:r,vertexDictionary:d}),o}}return this}mergeVertices(e,n){if(this.data){for(const f of this.data.segments)f.start===n&&(f.start=e),f.end===n&&(f.end=e);const a=this.data.vertecies[n],s=`${Math.floor(a.lon*I)},${Math.floor(a.lat*I)}`,r=m({},this.data.vertecies);delete r[n];const d=m({},this.data.vertexDictionary);delete d[s];const o=this.clone();return o.data=x(m({},this.data),{vertecies:r,vertexDictionary:d}),o}return this}moveVertex(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),r=[...this.data.segments],d=a[e],o=`${Math.floor(n.lon*I)},${Math.floor(n.lat*I)}`,f=`${Math.floor(d.lon*I)},${Math.floor(d.lat*I)}`;if(delete s[f],o in s){const _=s[o];for(const g of r)g.start===_&&(g.start=e),g.end===_&&(g.end=e);delete a[_]}a[e]=n;const u=this.clone();return u.data=x(m({},this.data),{segments:r,vertecies:a,vertexDictionary:s}),u}return this}splitSegment(e){if(this.data){const n=this.data.segments[e],a=this.data.vertecies[n.start],s=this.data.vertecies[n.end],r={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[d,o]=z(r,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),f=x(m({},n),{end:d,name:`${n.name}_a`}),u=x(m({},n),{start:d,name:`${n.name}_b`}),_=[...this.data.segments];_[e]=f,_.push(u);const g=this.clone();return g.data=x(m({},this.data),{segments:_,lastIndex:o}),g}return this}bridgeVertices(e,n){if(this.data){const a=x(m({},ee),{start:e,end:n}),s=[...this.data.segments,a],r=this.clone();return r.data=x(m({},this.data),{segments:s}),r}return this}extrudeSegment(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),[r,d]=z(n,s,a,this.data.lastIndex),o=x(m({},ee),{start:e,end:r}),f=[...this.data.segments,o],u=this.clone();return u.data={vertecies:a,vertexDictionary:s,segments:f,lastIndex:d},u}return this}deleteSegment(e){if(this.data){const n=[...this.data.segments],a=n.splice(e,1)[0],s=this.clone();return s.data=x(m({},this.data),{segments:n}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),[r,d]=z(e,s,a,this.data.lastIndex),[o,f]=z(n,s,a,d),u=x(m({},ee),{start:r,end:o}),_=[...this.data.segments,u],g=this.clone();return g.data={vertecies:a,vertexDictionary:s,segments:_,lastIndex:f},g}return this}}class Ne{constructor(e){F(this,"handle");F(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),a=ve(e).map(s=>{const r={};for(const d of Ye)r[d]=s[d]||(d==="name"?"":0);return r});this.data=a}async save(){var n;const e=we((n=this.data)!=null?n:[],Ye);await this.handle.setContents(e)}clone(){return new Ne(this.handle)}}async function at(t){const e=new Se(t);return await e.initialize(),e}async function st(t){const e=new _e(t);return await e.initialize(),e}async function ot(t){const e=new Ne(t);return await e.initialize(),e}async function Dn(t,e,n){const a=new be(e);if(await a.initialize(),a.data){const s=await at(await t.getFile(a.data.segment_file_name)),r=await st(await t.getFile(a.data.block_file_name)),d=await ot(await t.getFile(a.data.station_file_name)),o=m({},n);return"command"in o&&(o.command=x(m({},o.command),{currentFilePath:e.name})),"segment"in o&&(o.segment=x(m({},o.segment),{currentFilePath:a.data.segment_file_name})),"block"in o&&(o.block=x(m({},o.block),{currentFilePath:a.data.block_file_name})),"velocities"in o&&(o.velocities=x(m({},o.velocities),{currentFilePath:a.data.station_file_name})),{openableFiles:o,commands:a,segments:s,blocks:r,velocities:d}}throw new Error("Can't open command file")}class Fn{constructor(e){F(this,"name");F(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const n=await this.handle.createWritable();await n.write(e),await n.close()}}class ke{constructor(e){F(this,"name");F(this,"handle");F(this,"fileList");F(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const n=await this.handle.getFileHandle(e);return new Fn(n)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(e),a=new ke(n);return await a.initialize(),a}}const Ln=async()=>{const t=await window.showDirectoryPicker(),e=new ke(t);return await e.initialize(),e};class Vn{constructor(e,n){F(this,"name");F(this,"parent");this.name=e,this.parent=n}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class Ce{constructor(e,n){F(this,"name");F(this,"parent");F(this,"fileList");F(this,"folderList");this.name=e,this.parent=n,this.fileList=[],this.folderList=[];const a=n[e];for(const s of Object.keys(a))typeof a[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Vn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new Ce(e,this.parent[this.name])}}const In=async t=>new Ce("root",t);let it=async()=>{var e;return In((e=window.FakeDirectory)!=null?e:{})};function Mn(t){it=t}async function jn(){return it()}window.location.search.includes("fake-dir")||Mn(Ln);const En={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function Rn(){var $e,De,Fe;const t=Be(),[e,n]=v.exports.useState(),[a,s]=v.exports.useState(""),[r,d]=v.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[o,f]=v.exports.useState(),[u,_]=v.exports.useState(),[g,N]=v.exports.useState(),[E,X]=v.exports.useState(),O=le(c=>c.main.present.segment),W=le(c=>c.main.present.block),U=le(c=>c.main.present.velocity),[T,re]=v.exports.useState(Ut),[R,ce]=v.exports.useState(Rt),[B,de]=v.exports.useState(zt),[L,te]=v.exports.useState(Xt),[M,J]=v.exports.useState("normal"),[$,D]=v.exports.useState(-1),[l,w]=v.exports.useState(-1),[C,h]=v.exports.useState(-1),[p,S]=v.exports.useState(-1),[k,H]=v.exports.useState({select:(c,y)=>{D(c==="block"?y:-1),w(c==="segment"?y:-1),h(c==="velocities"?y:-1),S(c==="vertex"?y:-1),s(c)}}),[ne,ue]=v.exports.useState([]),[ut,mt]=v.exports.useState([]),[ft,pt]=v.exports.useState([]),[ht,gt]=v.exports.useState({color:L.color,selectedColor:L.activeColor,radius:L.radius,selectedRadius:L.activeRadius,points:[]});v.exports.useEffect(()=>{M==="normal"?H({select:(c,y)=>{D(c==="block"?y:-1),w(c==="segment"?y:-1),h(c==="velocities"?y:-1),S(c==="vertex"?y:-1),s(c)}}):M.mode==="override"?H({select:(c,y)=>{c===M.type&&M.callback(y)}}):H({select:()=>{}})},[M]),v.exports.useEffect(()=>{ue([{name:"blocks",color:R.color,selectedColor:R.selectedColor,radius:R.radius,points:W.map((c,y)=>({longitude:c.interior_lon,latitude:c.interior_lat,name:c.name,description:"",index:y})),click:c=>{k.select("block",c)}}])},[R,W,B,k]),v.exports.useEffect(()=>{pt([{name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:O.segments.map((c,y)=>{var Le,Ve;const V=(Le=O.vertecies[c.start])!=null?Le:Ee,K=(Ve=O.vertecies[c.end])!=null?Ve:Ee,[[ae,se],[oe,A]]=Tt(V,K);return{startLongitude:ae,startLatitude:se,endLongitude:oe,endLatitude:A,name:c.name,description:`${V.lon},${V.lat} to ${K.lon},${K.lat}`,index:y}}),click:c=>{k.select("segment",c)}}])},[O,B,k]),v.exports.useEffect(()=>{gt({color:L.color,radius:L.radius,selectedColor:L.activeColor,selectedRadius:L.activeRadius,points:Object.keys(O.vertecies).map(c=>{const y=Number.parseInt(c,10),V=O.vertecies[y];return V?{longitude:V.lon,latitude:V.lat,index:y}:!1}).filter(c=>!!c),update:(c,y)=>{t(ye({index:c,vertex:y}))},select:c=>{k.select("vertex",c)}})},[L,k,O.vertecies,t]),v.exports.useEffect(()=>{mt([{name:"velocities",color:T.color,selectedColor:T.selectedColor,scale:T.scale,arrowHeadScale:T.arrowHead,width:T.width,arrows:U.map((c,y)=>{const V=Math.sqrt(c.east_vel*c.east_vel+c.north_vel*c.north_vel);return{longitude:c.lon,latitude:c.lat,direction:[c.east_vel/V,c.north_vel/V],scale:V,name:c.name,description:`north: ${c.north_vel}, east: ${c.east_vel}`,index:y}}),click:c=>{k.select("velocities",c)}}])},[k,T,U]);let Z=i("span",{});switch(a){case"files":Z=e?i(Pt,{folder:e,files:r,setFile:async(c,y,V)=>{if(V){let K=m({},r);switch(K[c]=x(m({},K[c]),{currentFilePath:y}),c){case"segment":const ae=await at(V);_(ae),ae.data&&t(ge(ae.data));break;case"block":const se=await st(V);N(se),se.data&&t(he(se.data));break;case"velocity":const oe=await ot(V);X(oe),oe.data&&t(xe(oe.data));break;case"command":const A=await Dn(e,V,r);f(A.commands),_(A.segments),A.segments.data&&t(ge(A.segments.data)),N(A.blocks),A.blocks.data&&t(he(A.blocks.data)),X(A.velocities),A.velocities.data&&t(xe(A.velocities.data)),K=A.openableFiles;break}d(K)}}}):i("span",{});break;case"velocities":Z=i(Kt,{settings:T,setSettings:re,selected:C,velocitys:U,setVelocityData:(c,y)=>{t(y?tt({index:c,data:y}):nt(c))},addNewVelocity:()=>{J({label:"Click to place velocity estimate",mode:"mapClick",callback:c=>{J("normal");const y=U.length;t(et({data:{lat:c.lat,lon:c.lon}})),k.select("velocity",y)}})}});break;case"block":Z=i(Ot,{settings:R,setSettings:ce,selected:$,blocks:W,addNewBlock:()=>{J({label:"Click to place new block",mode:"mapClick",callback:c=>{const y=W.length;t(He({data:{name:"New Block",interior_lon:c.lon,interior_lat:c.lat}})),k.select("block",y),J("normal")}})},setBlockData:(c,y)=>{t(y?We({index:c,data:y}):ze(c))}});break;case"segment":Z=i(Jt,{settings:B,setSettings:de,segments:($e=O.segments)!=null?$e:[],selected:l,setSelectionMode:c=>J(c),addNewSegment:(c,y)=>{const V=O.segments.length;t(qe({start:c,end:y})),k.select("segment",V)},setSegmentData:(c,y)=>{t(y?Ke({index:c,data:y}):Ue({index:c}))},splitSegment:c=>{t(Ze(c))}});break;case"vertex":Z=i(Zt,{settings:L,setSettings:te,vertices:(De=O.vertecies)!=null?De:{},selected:p,setVertexData:(c,y)=>{y&&t(ye({index:c,vertex:y}))},setSelectionMode:c=>J(c),mergeVertices:(c,y)=>{t(Xe({a:c,b:y}))},bridgeVertices:(c,y)=>{t(Ge({a:c,b:y}))},extrudeVertex:(c,y)=>{t(Qe({index:c,targetPoint:y}))}});break}return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:c=>{c.key==="Escape"&&J("normal")},children:[i(Gt,{filesOpen:((Fe=o!=null?o:u)!=null?Fe:g)!==void 0,saveFiles:async()=>{o&&await o.save(),u&&(u.data=O,await u.save()),g&&(g.data=W,await g.save()),E&&(E.data=U,await E.save())},folder:e,openFolder:async()=>{const c=await jn();n(c),s("files")}}),M!=="normal"?i("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[i("span",{className:"text-lg font-semibold",children:M.label}),i("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):i(P,{}),i(Ht,{pointSources:ne,arrowSources:ut,lineSources:ft,drawnPointSource:ht,selections:{segments:l,blocks:$,velocities:C,drawnPoint:p},click:c=>{typeof M!="string"&&M.mode==="mapClick"&&M.callback(c)}}),i(Bt,{view:Z,buttons:e?En:void 0,active:a,setActive:c=>s(c)})]})}const On=kt({reducer:{main:Ct($t({segment:yn,block:on,velocity:kn}))}});function Pn(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:s,onRegisterError:r}=t;let d;const o=async(f=!0)=>{};return"serviceWorker"in navigator&&(d=new Dt("./sw.js",{scope:"./"}),d.addEventListener("activated",f=>{f.isUpdate?window.location.reload():a==null||a()}),d.register({immediate:e}).then(f=>{s==null||s(f)}).catch(f=>{r==null||r(f)})),o}Pn();const Bn=1,An=new Ft({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Bn}}});Lt.render(i(v.exports.StrictMode,{children:i(Vt,{client:An,children:i(It,{store:On,children:i(Rn,{})})})}),document.querySelector("#root"));
