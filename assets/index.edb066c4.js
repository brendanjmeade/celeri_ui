var an=Object.defineProperty,sn=Object.defineProperties;var on=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var ln=Object.prototype.hasOwnProperty,rn=Object.prototype.propertyIsEnumerable;var Ne=(t,e,n)=>e in t?an(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))ln.call(e,n)&&Ne(t,n,e[n]);if(ot)for(var n of ot(e))rn.call(e,n)&&Ne(t,n,e[n]);return t},x=(t,e)=>sn(t,on(e));var C=(t,e,n)=>(Ne(t,typeof e!="symbol"?e+"":e,n),n);import{j as o,a as v,F as E,r as N,M as cn,m as it,R as dn,b as ke,u as un,c as fn,l as lt,d as mn,e as de,f as F,g as rt,h as ct,i as pn,k as hn,n as gn,v as yn,Q as bn,o as vn,p as xn,P as wn}from"./vendor.f616d357.js";const Sn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}};Sn();const _e=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],dt={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Nn(t){return t?m(m({},dt),t):m({},dt)}class ut{constructor(e){C(this,"name");C(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const n=await this.handle.createWritable();await n.write(e),await n.close()}}class Ce{constructor(e){C(this,"name");C(this,"handle");C(this,"fileList");C(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){const n=await this.handle.getFileHandle(e,{create:!0});return new ut(n)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const n=await this.handle.getDirectoryHandle(e),a=new Ce(n);return await a.initialize(),a}}const kn=async()=>{const t=await window.showDirectoryPicker(),e=new Ce(t);return await e.initialize(),e};class _n{constructor(e,n){C(this,"name");C(this,"parent");this.name=e,this.parent=n}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class Le{constructor(e,n){C(this,"name");C(this,"parent");C(this,"fileList");C(this,"folderList");this.name=e,this.parent=n,this.fileList=[],this.folderList=[];const a=n[e];for(const s of Object.keys(a))typeof a[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new _n(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new Le(e,this.parent[this.name])}}const Cn=async t=>new Le("root",t);let ft=async()=>{var e;return Cn((e=window.FakeDirectory)!=null?e:{})};function Ln(t){ft=t}async function $n(){return ft()}async function $e(t){const e={types:[{description:"CSV Files",accept:{"text/plain":t}}]},n=await window.showSaveFilePicker(e);return new ut(n)}function Fn({value:t,fieldDefinition:e,setField:n}){const[a,s]=N.exports.useState(-1),[c,l]=N.exports.useState(t);N.exports.useEffect(()=>{l(t)},[t]);let i=o("input",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",type:typeof t=="number"?"number":"text",value:c,onChange:r=>{const u=typeof t=="number"?Number.parseFloat(r.target.value):r.target.value;l(u),a>-1&&clearTimeout(a),s(setTimeout(()=>n(u),1e3))}});return e.type==="select"&&(i=v("select",{"data-testid":`input-editor-${e.name}`,className:"bg-gray-800 w-full",value:c,onChange:r=>{n(r.currentTarget.value)},children:[o("option",{value:"","data-testid":`input-editor-${e.name}-empty`,children:"\xA0"}),e.items.map(r=>o("option",{value:r.name,"data-testid":`input-editor-${e.name}-${r.name}`,children:r.name},r.name))]})),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[o("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?o("span",{className:"text-sm",children:e.description}):o(E,{})]}),o("span",{className:"w-2/5 flex-shrink-0",children:i})]})}function oe({title:t,items:e,setItems:n,fieldDefinitions:a,ignoreFields:s,deletable:c,controls:l}){const i=e[0],r=Object.keys(i).map((u,f)=>{if(s==null?void 0:s.includes(u))return{element:o("span",{style:{display:"hidden"}},u),order:f+1e4};let w=i[u];for(const b of e)if(b[u]!==w){w="-";break}const d=u in a&&a[u];return d?{element:o(Fn,{value:w,fieldDefinition:d,setField:b=>n({[u]:b})},u),order:d.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":`input-title-${u}`,className:"text-l font-bold",children:u}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{"data-testid":`input-editor-${u}`,className:"bg-gray-800 w-full",type:typeof w=="number"?"number":"text",value:w,onChange:b=>{n({[u]:typeof w=="number"?Number.parseFloat(b.target.value):b.target.value})}})})]},u),order:f+1e3}}).sort((u,f)=>u.order-f.order).map(u=>u.element);return v("div",{className:"flex flex-col gap-2 border-2 border-slate-700 p-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:t}),v("span",{className:"flex flex-row justify-end gap-2 grow",children:[l,c?o("button",{type:"button",className:" bg-black hover:bg-gray-200 p-2",onClick:()=>{n()},children:"Delete"}):o(E,{})]})]}),r]})}oe.defaultProps={ignoreFields:[],controls:o(E,{})};const Dn={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1,plottableKey:""},jn=["",..._e];var At;const Vn=JSON.parse((At=window.localStorage.getItem("blockDisplaySettings"))!=null?At:"false")||Dn;function Mn({settings:t,setSettings:e,selected:n,blocks:a,setBlockData:s,addNewBlock:c,save:l}){const i=f=>{e(f),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(f))},r=n.map(f=>a[f]).filter(f=>f),u=r.length>0?o(oe,{title:r.length===1?r[0].name:"Edit Selected Blocks",items:r,deletable:!0,setItems:f=>s(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):o(E,{});return v(E,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{i(x(m({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Save Blocks"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const f=await $e([".csv"]);l(f)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:f=>{i(x(m({},t),{color:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.selectedColor,onChange:f=>{i(x(m({},t),{selectedColor:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"2",max:"10",step:"0.5",value:t.radius,onChange:f=>{i(x(m({},t),{radius:Number.parseFloat(f.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:f=>{i(x(m({},t),{plottableKey:f.currentTarget.value}))},children:jn.map(f=>o("option",{value:f,children:f},f))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Block"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:c,children:"New Block"})]}),u]})}function In({folder:t,files:e,setFile:n}){const a=Object.keys(e).map(s=>{const c=e[s],l=Array.isArray(c.currentFilePath)?[...c.currentFilePath]:[c.currentFilePath];return c.allowMultiple&&l.push(""),v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[o("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:c.name}),o("span",{className:"text-sm","data-testid":`file-${s}-description`,children:c.description})]}),o("span",{className:"w-2/5 flex-shrink-0 flex-col gap-2 items-stretch",children:l.map((i,r)=>v("select",{"data-testid":`file-${s}-select-${r}`,className:"bg-gray-800 w-full m-1",value:i,onChange:async u=>{const f=u.currentTarget.value;try{const w=await t.getFile(f);n(r,s,w.name,w)}catch{n(r,s,"")}},children:[o("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),t.fileList.filter(u=>u.endsWith(c.extension)).map(u=>o("option",{value:u,"data-testid":`file-${s}-select-${u}`,children:u},u))]},r))})]},s)});return o("div",{className:"flex flex-col gap-2",children:a})}const Pn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Tt;const On=m(m({},Pn),JSON.parse((Tt=window.localStorage.getItem("genericSegmentDisplaySettings"))!=null?Tt:"{}"));function Rn({settings:t,setSettings:e,collections:n,setCollectionVertexKeys:a}){const s=l=>{e(l),window.localStorage.setItem("genericSegmentDisplaySettings",JSON.stringify(l))},c=Object.keys(n).map(l=>{const{startLat:i,startLon:r,endLat:u,endLon:f,segments:w,plot:d}=n[l],b=Object.keys(w[0]).map((k,h)=>({name:k,value:h}));return o(oe,{title:l,items:[{startLat:i,startLon:r,endLat:u,endLon:f,plot:d}],deletable:!1,setItems:k=>{a(m({collection:l,startLat:i,startLon:r,endLat:u,endLon:f,plot:d},k))},fieldDefinitions:{startLat:{order:1,name:"Start Latitude",description:"the column containing the segment start latitude",type:"select",items:b},startLon:{order:0,name:"Start Longitude",description:"the column containing the segment start longitude",type:"select",items:b},endLat:{order:3,name:"End Latitude",description:"the column containing the segment end latitude",type:"select",items:b},endLon:{order:2,name:"End Longitude",description:"the column containing the segment end longitude",type:"select",items:b},plot:{order:3,name:"Plot Key",description:"the column to be plotted on the map",type:"select",items:b}}},l)});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{s(x(m({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:l=>{s(x(m({},t),{color:l.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:l=>{s(x(m({},t),{width:Number.parseFloat(l.target.value)}))}})})]}),c]})}function Bn({view:t,buttons:e,active:n,setActive:a}){if(!e)return o("span",{});const s=[];for(const c of Object.keys(e)){const l=e[c],i=c===n;s.push(o("button",{type:"button","data-testid":`tab-${c}`,className:`${i?"bg-black":"bg-gray-700"} p-2 shadow-inner hover:bg-gray-800 `,onClick:()=>a(i?"":c),children:l},c))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-0 h-1/2 w-2/5 flex flex-col-reverse z-50",children:[n?o("div",{"data-testid":"inspector-view",className:"flex flex-col bg-black flex-grow items-stretch r p-2 shadow-sm overflow-y-auto overflow-x-hidden",children:t}):"",o("div",{"data-testid":"inspector-tabs",className:"flex flex-row -sm gap-0 divide-x divide-gray-600",children:s})]})}const mt={lon:0,lat:0},En=180,ie=360;function pt(t){let{lon:e,lat:n}=t;for(;e<0;)e+=ie;for(;e>ie;)e-=ie;return[e,n]}function Fe([t,e]){return{lon:t<0?t+ie:t,lat:e}}function De(t,e){const n=pt(t),a=pt(e),s=[a[0],a[1]];return a[0]-n[0]>=En?s[0]-=ie:s[0]+=ie,Math.abs(n[0]-a[0])>Math.abs(n[0]-s[0])?[n,s]:[n,a]}const R=1e6;function Q(t,e,n,a){const s=`${Math.floor(t.lon*R)},${Math.floor(t.lat*R)}`;if(s in e)return[e[s],a];const c=a;return n[c]=t,e[s]=c,[c,a+1]}function ht(t,e){let n=!1;for(const a of t.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&t.vertecies[e]){const a=t.vertecies[e],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,c=m({},t.vertecies);delete c[e];const l=m({},t.vertexDictionary);return delete l[s],x(m({},t),{vertecies:c,vertexDictionary:l})}return t}const Y=Math.PI/6,ee=2*Math.PI-Y;function An(t,e,{map:n,popup:a,internalArrowSources:s,mapLoaded:c,internalSelections:l},{arrowSources:i,selections:r}){var w;if(n&&c&&s!==i)if(console.log("Setting arrows in map!"),s){for(const d of s){const b=n.getSource(`arrow:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${d.name}`),n.removeLayer(`layer:arrow:${d.name}:click`);try{n.getLayer(`layer:arrow:${d.name}:labels`)&&n.removeLayer(`layer:arrow:${d.name}:labels`)}catch{console.log("no label layer")}}e({internalArrowSources:void 0})}else{for(const d of i){let b=n.getSource(`arrow:${d.name}`);const k=b===void 0;if(k&&(n.addSource(`arrow:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`arrow:${d.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`arrow:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.arrows.map(h=>{var te;const g=h.scale*d.scale,S=d.scale*d.arrowHeadScale,_=[h.longitude+h.direction[0]*g,h.latitude+h.direction[1]*g],A=[_[0]+(Math.cos(Y)*-h.direction[0]-Math.sin(Y)*-h.direction[1])*S,_[1]+(Math.sin(Y)*-h.direction[0]+Math.cos(Y)*-h.direction[1])*S],L=[_[0]+(Math.cos(ee)*-h.direction[0]-Math.sin(ee)*-h.direction[1])*S,_[1]+(Math.sin(ee)*-h.direction[0]+Math.cos(ee)*-h.direction[1])*S];return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:(te=r[d.name])==null?void 0:te.includes(h.index)},geometry:{type:"LineString",coordinates:[[h.longitude,h.latitude],_,A,_,L]}}})}),n.addLayer({id:`layer:arrow:${d.name}`,type:"line",source:`arrow:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],d.selectedColor,d.color],"line-width":d.width}}),n.addLayer({id:`layer:arrow:${d.name}:click`,type:"line",source:`arrow:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),(w=d.arrows[0])==null?void 0:w.label){const h=n.getSource(`arrow:${d.name}:points`);h&&(h.setData({type:"FeatureCollection",features:d.arrows.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),n.addLayer({id:`layer:arrow:${d.name}:labels`,type:"symbol",source:`arrow:${d.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}k&&(n.on("mouseenter",`layer:arrow:${d.name}:click`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[...g.geometry.coordinates],{description:_}=g.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(_).addTo(n)}}),n.on("mouseleave",`layer:arrow:${d.name}:click`,()=>{a.remove()}),n.on("click",`layer:arrow:${d.name}:click`,h=>{let g;if(t.state.internalArrowSources)for(const _ of t.state.internalArrowSources)g=_.click;if(!h.features||!g)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:_}=S.properties;g(_)}}))}e({internalArrowSources:i})}const u=m({},l);let f=!1;for(const d of Object.keys(r))if(r[d]!==l[d]){for(const b of i)if(b.name===d){f=!0,u[d]=r[d];const k=n==null?void 0:n.getSource(`arrow:${b.name}`);if(k){const h=r[d];k.setData({type:"FeatureCollection",features:b.arrows.map(g=>{const S=g.scale*b.scale,_=b.scale*b.arrowHeadScale,A=[g.longitude+g.direction[0]*S,g.latitude+g.direction[1]*S],L=[A[0]+(Math.cos(Y)*-g.direction[0]-Math.sin(Y)*-g.direction[1])*_,A[1]+(Math.sin(Y)*-g.direction[0]+Math.cos(Y)*-g.direction[1])*_],te=[A[0]+(Math.cos(ee)*-g.direction[0]-Math.sin(ee)*-g.direction[1])*_,A[1]+(Math.sin(ee)*-g.direction[0]+Math.cos(ee)*-g.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:h==null?void 0:h.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.longitude,g.latitude],A,L,A,te]}}})})}}}f&&e({internalSelections:u})}function Tn(t,{map:e,draw:n,drawnPointSettings:a,mapLoaded:s,internalDrawnPointSource:c},{drawnPointSource:l}){if(e&&s&&c!==l){console.log("Drawning Points"),t({internalDrawnPointSource:l});let i=n;if((l.selectedColor!==a.selectedColor||l.selectedRadius!==a.selectedRadius||l.color!==a.color||l.radius!==a.radius)&&(t({drawnPointSettings:{color:l.color,radius:l.radius,selectedRadius:l.selectedRadius,selectedColor:l.selectedColor}}),n&&(e.removeControl(n),i=void 0),l?(i=new cn({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":l.selectedRadius,"circle-color":l.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":l.radius,"circle-color":l.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(i),t({draw:i})):i=void 0),i){const r=i.getAll(),u=l.points.length!==r.features.length?void 0:i.getSelected(),f={type:"FeatureCollection",features:l.points.map(w=>({type:"Feature",id:w.index.toString(),properties:{description:"",index:w.index,name:""},geometry:{type:"Point",coordinates:[w.longitude,w.latitude]}}))};if(i.set(f),u&&u.features.length>0&&u.features[0].properties&&typeof u.features[0].properties.index=="number"){const w=u.features[0].id;w&&i.changeMode("simple_select",{featureIds:[w]})}}}}const K="grid";function Wn(t,e,{map:n,internalGridDisplay:a,popup:s,mapLoaded:c},{displayGrid:l}){if(n&&c&&a!==l){if(console.log("Drawing Grid on map!"),a&&a>0){const i=n.getSource(K);i!==void 0&&i.setData({type:"FeatureCollection",features:[]}),n.removeLayer(K),e({internalGridDisplay:void 0})}else if(l&&l>0){let i=n.getSource(K);const r=i===void 0;if(r&&(n.addSource(K,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i=n.getSource(K)),i!==void 0){const u=[];for(let f=-170;f<=180;f+=l)u.push({type:"Feature",properties:{label:`Lon: ${f<0?f+360:f}`},geometry:{type:"LineString",coordinates:[[f,-90],[f,90]]}});for(let f=-90;f<=90;f+=l)u.push({type:"Feature",properties:{label:`Lat: ${f}`},geometry:{type:"LineString",coordinates:[[180,f],[-180,f]]}});i.setData({type:"FeatureCollection",features:u})}n.addLayer({id:K,type:"line",source:K,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),n.addLayer({id:`${K}:click`,type:"line",source:K,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),r&&(n.on("mouseenter",`${K}:click`,u=>{if(!u.features)return;const f=u.features[0];f.geometry.type==="LineString"&&f.properties&&typeof f.properties.label=="string"&&s.setLngLat(u.lngLat).setHTML(`${f.properties.label}`).addTo(n)}),n.on("mouseleave",`${K}:click`,()=>{s.remove()}))}e({internalGridDisplay:l})}}function Gn(t,e,{map:n,popup:a,internalLineSources:s,mapLoaded:c,internalSelections:l},{lineSources:i,selections:r}){var w;if(n&&c&&s!==i)if(console.log("Setting lines in map!"),s){for(const d of s){const b=n.getSource(`line:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:line:${d.name}`);try{n.getLayer(`layer:line:${d.name}:click`)&&n.removeLayer(`layer:line:${d.name}:click`)}catch{console.log("no click layer")}try{n.getLayer(`layer:line:${d.name}:labels`)&&n.removeLayer(`layer:line:${d.name}:labels`)}catch{console.log("no label layer")}}e({internalLineSources:void 0})}else{for(const d of i){let b=n.getSource(`line:${d.name}`);const k=b===void 0;if(k&&(n.addSource(`line:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addSource(`line:${d.name}:points`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`line:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.lines.map(h=>{var g,S;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,label:(g=h.label)!=null?g:"",selected:((S=r[d.name])==null?void 0:S.includes(h.index))||!1},geometry:{type:"LineString",coordinates:[[h.startLongitude,h.startLatitude],[h.endLongitude,h.endLatitude]]}}})}),n.addLayer({id:`layer:line:${d.name}`,type:"line",source:`line:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],d.selectedColor,d.color],"line-width":["case",["get","selected"],d.selectedWidth,d.width]}}),(w=d.lines[0])==null?void 0:w.label){const h=n.getSource(`line:${d.name}:points`);h&&(h.setData({type:"FeatureCollection",features:d.lines.map(g=>({type:"Feature",properties:{label:g.label},geometry:{type:"Point",coordinates:[(g.startLongitude+g.endLongitude)/2,(g.startLatitude+g.endLatitude)/2]}}))}),n.addLayer({id:`layer:line:${d.name}:labels`,type:"symbol",source:`line:${d.name}:points`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}))}d.click&&(n.addLayer({id:`layer:line:${d.name}:click`,type:"line",source:`line:${d.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":d.width*10}}),k&&(n.on("mouseenter",`layer:line:${d.name}:click`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="LineString"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[(g.geometry.coordinates[0][0]+g.geometry.coordinates[1][0])/2,(g.geometry.coordinates[0][1]+g.geometry.coordinates[1][1])/2],{description:_}=g.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(_).addTo(n)}}),n.on("mouseleave",`layer:line:${d.name}:click`,()=>{a.remove()}),n.on("click",`layer:line:${d.name}:click`,h=>{let g;if(t.state.internalLineSources)for(const _ of t.state.internalLineSources)_.name===d.name&&(g=_.click);if(!h.features||!g)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:_}=S.properties;g(_)}})))}e({internalLineSources:i})}const u=m({},l);let f=!1;for(const d of Object.keys(r))if(r[d]!==l[d]){for(const b of i)if(b.name===d){f=!0,u[d]=r[d];const k=n==null?void 0:n.getSource(`line:${b.name}`);if(k){const h=r[d];k.setData({type:"FeatureCollection",features:b.lines.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:h==null?void 0:h.includes(g.index)},geometry:{type:"LineString",coordinates:[[g.startLongitude,g.startLatitude],[g.endLongitude,g.endLatitude]]}}))})}}}f&&e({internalSelections:u})}function Kn(t,e,{map:n,popup:a,internalPointSources:s,mapLoaded:c,internalSelections:l},{pointSources:i,selections:r}){var w;if(!n||!c)return;if(s!==i)if(console.log("Setting points in map!"),s){for(const d of s){const b=n.getSource(`point:${d.name}`);b!==void 0&&b.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${d.name}`);try{n.getLayer(`layer:point:${d.name}:labels`)&&n.removeLayer(`layer:point:${d.name}:labels`)}catch{console.log("no label layer")}}e({internalPointSources:void 0})}else{for(const d of i){let b=n.getSource(`point:${d.name}`);const k=b===void 0;k&&(n.addSource(`point:${d.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),b=n.getSource(`point:${d.name}`)),b!==void 0&&b.setData({type:"FeatureCollection",features:d.points.map(h=>{var g;return{type:"Feature",properties:{description:h.name||h.description?`<strong>${h.name}</strong><p>${h.description}</p>`:"",index:h.index,name:h.name,selected:!((g=r[d.name])==null?void 0:g.includes(h.index)),label:h.label},geometry:{type:"Point",coordinates:[h.longitude,h.latitude]}}})}),n.addLayer({id:`layer:point:${d.name}`,type:"circle",source:`point:${d.name}`,paint:{"circle-color":["case",["get","selected"],d.color,d.selectedColor],"circle-radius":d.radius}}),((w=d.points[0])==null?void 0:w.label)&&n.addLayer({id:`layer:point:${d.name}:labels`,type:"symbol",source:`point:${d.name}`,layout:{"symbol-placement":"point","text-anchor":"center","text-field":["get","label"],"text-justify":"center","text-size":10,"symbol-z-order":"source","symbol-sort-key":10,"text-offset":[0,1]},paint:{"text-halo-color":"rgba(255,255,255,255)","text-halo-width":1,"text-color":"#000"}}),k&&(n.on("mouseenter",`layer:point:${d.name}`,h=>{if(!h.features)return;const g=h.features[0];if(g.geometry.type==="Point"&&g.properties&&typeof g.properties.description=="string"&&g.properties.description){const S=[...g.geometry.coordinates],{description:_}=g.properties;for(;Math.abs(h.lngLat.lng-S[0])>180;)S[0]+=h.lngLat.lng>S[0]?360:-360;a.setLngLat(S).setHTML(_).addTo(n)}}),n.on("mouseleave",`layer:point:${d.name}`,()=>{a.remove()}),n.on("click",`layer:point:${d.name}`,h=>{let g;if(t.state.internalPointSources)for(const _ of t.state.internalPointSources)g=_.click;if(!h.features||!g)return;const S=h.features[0];if(S.properties&&typeof S.properties.index=="number"&&typeof S.properties.name=="string"){const{index:_}=S.properties;g(_)}}))}e({internalPointSources:i})}const u=m({},l);let f=!1;for(const d of Object.keys(r))if(r[d]!==l[d]){for(const b of i)if(b.name===d){f=!0,u[d]=r[d];const k=n.getSource(`point:${b.name}`);if(k){const h=r[d];k.setData({type:"FeatureCollection",features:b.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:!(h==null?void 0:h.includes(g.index))},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))})}}}f&&e({internalSelections:u})}function zn(t,e,{map:n,internalPolygonSources:a,mapLoaded:s},{polygonSources:c,selections:l}){if(n&&s&&a!==c)if(a){for(const i of a){const r=n.getSource(`poly:${i.name}`);r!==void 0&&r.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:poly:${i.name}`),n.removeLayer(`layer:poly:${i.name}:fill`)}e({internalPolygonSources:void 0})}else{for(const i of c){let r=n.getSource(`poly:${i.name}`);r===void 0&&(n.addSource(`poly:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r=n.getSource(`poly:${i.name}`)),r!==void 0&&r.setData({type:"FeatureCollection",features:i.polygons.map(f=>{var w;return{type:"Feature",properties:{description:f.name||f.description?`<strong>${f.name}</strong><p>${f.description}</p>`:"",index:f.index,name:f.name,selected:((w=l[i.name])==null?void 0:w.includes(f.index))||!1},geometry:{type:"Polygon",coordinates:[f.polygon.map(d=>[d.lon,d.lat])]}}})}),n.addLayer({id:`layer:poly:${i.name}:fill`,type:"fill",source:`poly:${i.name}`,layout:{},paint:{"fill-color":i.color,"fill-opacity":.5}}),n.addLayer({id:`layer:poly:${i.name}`,type:"line",source:`poly:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":i.borderColor,"line-width":i.borderRadius}})}e({internalPolygonSources:c})}}it.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class Hn extends dn.Component{constructor(e){super(e);var n;this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:N.exports.createRef(),popup:new ke.exports.Popup({closeButton:!1,closeOnClick:!1}),style:(n=e.styleUri)!=null?n:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y"}}componentDidMount(){const{mapReference:e,style:n}=this.state,a=typeof e=="object"?e==null?void 0:e.current:void 0;if(it.accessToken&&a){const s=new ke.exports.Map({container:a,style:n,center:[0,0],zoom:2});s.addControl(new ke.exports.NavigationControl),this.setState({map:s}),s.on("load",()=>{this.setState({mapLoaded:!0})}),s.on("click",({lngLat:c})=>{const{click:l}=this.props;l(Fe([c.lng,c.lat]))}),s.on("mousemove",({lngLat:c})=>{const{mouseMove:l}=this.props;l&&l(Fe([c.lng,c.lat]))}),s.on("draw.selectionchange",({features:c})=>{const{internalDrawnPointSource:l}=this.state;if(!l||!(l==null?void 0:l.select))return;const i=c.map(r=>r&&r.type==="Feature"&&r.geometry.type==="Point"&&r.properties&&"index"in r.properties&&typeof r.properties.index=="number"?r.properties.index:-1).filter(r=>r>-1);l.select(i)}),s.on("draw.update",({features:c,action:l})=>{const{internalDrawnPointSource:i}=this.state;if(!!(i==null?void 0:i.update)&&l==="move"&&c.length>0)for(const r of c)r.type==="Feature"&&r.geometry.type==="Point"&&r.properties&&"index"in r.properties&&typeof r.properties.index=="number"&&i.update(r.properties.index,Fe(r.geometry.coordinates))})}}componentDidUpdate(){const{styleUri:e}=this.props,{style:n,map:a}=this.state;return e&&e!==n&&(this.setState({style:e}),a==null||a.setStyle(e)),Wn(this,s=>this.setState(s),this.state,this.props),zn(this,s=>this.setState(s),this.state,this.props),Gn(this,s=>this.setState(s),this.state,this.props),An(this,s=>this.setState(s),this.state,this.props),Kn(this,s=>this.setState(s),this.state,this.props),Tn(s=>this.setState(s),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return o("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const ue={currentStyle:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},currentStyleName:"default",savedStyles:{default:{user:"mapbox-public",styleId:"ckngin2db09as17p84ejhe24y"},"Hill Shaded":{user:"mapbox",styleId:"outdoors-v11"},"Political Light":{user:"mapbox",styleId:"light-v10"},"Political Dark":{user:"mapbox",styleId:"dark-v10"}}},Jn=(()=>{var e;const t=m(m({},ue),JSON.parse((e=window.localStorage.getItem("mapSettings"))!=null?e:"{}"));return t.savedStyles=m(m({},t.savedStyles),ue.savedStyles),t})();function Un({settings:t,setSettings:e}){const[n,a]=N.exports.useState(""),[s,c]=N.exports.useState(""),[l,i]=N.exports.useState(""),r=u=>{e(u),window.localStorage.setItem("mapSettings",JSON.stringify(u))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Select Style"}),o("span",{className:"w-2/5 flex-shrink-0",children:v("select",{className:"bg-gray-800 w-full",value:t.currentStyleName,onChange:u=>{const f=u.target.value;if(f==="***CUSTOM")a(""),i(t.savedStyles.default.styleId),c(t.savedStyles.default.user),r(x(m({},t),{currentStyleName:"",currentStyle:t.savedStyles.default}));else{const w=t.savedStyles[f];a(f),i(w.styleId),c(w.user),r(x(m({},t),{currentStyleName:f,currentStyle:w}))}},children:[o("option",{value:"***CUSTOM",children:"Custom"}),Object.keys(t.savedStyles).map(u=>o("option",{value:u,children:u},u))]})})]}),t.currentStyleName in ue.savedStyles?o(E,{}):v(E,{children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Style Name"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:n,onChange:u=>{a(u.target.value)}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{n&&!(n in ue.savedStyles)&&r({currentStyle:{user:s,styleId:l},currentStyleName:n,savedStyles:x(m({},t.savedStyles),{[n]:{user:s,styleId:l}})})},children:"Save Style"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>{if(n&&n in t.savedStyles&&!(n in ue.savedStyles)){const u={};for(const f of Object.keys(t.savedStyles))f!==n&&(u[f]=t.savedStyles[f]);r({currentStyle:u.default,currentStyleName:"default",savedStyles:u})}},children:"Delete Style"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"User"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:s,onChange:u=>{c(u.target.value)}})}),o("span",{className:"text-l font-bold",children:"Style Id"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"text",value:l,onChange:u=>{i(u.target.value)}})})]}),v("div",{children:["Adding a custom mapbox style:",v("ul",{children:[v("li",{children:["If you are creating a new style, go to"," ",o("a",{href:"https://www.mapbox.com/mapbox-studio",children:"Mapbox Studio"}),", create the style there, and then provide your user & the style's Id"]}),o("li",{children:"If you wish to use an existing style, you must figure out the user & style id. If you found the style URL, you can read it from there: mapbox://styles/*user*/*style id*"})]})]})]})]})}const qn={color:"#ffffff",width:.1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var Wt;const Qn=m(m({},qn),JSON.parse((Wt=window.localStorage.getItem("meshDisplaySettings"))!=null?Wt:"{}"));function Xn({settings:t,setSettings:e}){const n=a=>{e(a),window.localStorage.setItem("meshDisplaySettings",JSON.stringify(a))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Display"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{n(x(m({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:a=>{n(x(m({},t),{color:a.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:a=>{n(x(m({},t),{width:Number.parseFloat(a.target.value)}))}})})]})]})}const je=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],le={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0},Zn={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1,hideProjection:!1,projectionColor:"#ffff00",plottableKey:""};var Gt;const Yn=m(m({},Zn),JSON.parse((Gt=window.localStorage.getItem("segmentDisplaySettings"))!=null?Gt:"{}")),ea=["",...je];function ta({settings:t,setSettings:e,segments:n,selected:a,setSegmentData:s,addNewSegment:c,splitSegment:l,setSelectionMode:i,save:r}){const u=d=>{e(d),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(d))},f=a.map(d=>n[d]).filter(d=>d),w=f.length>0?o(oe,{title:f.length===1?f[0].name:"Edit Selected Segments",items:f,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:d=>s(a,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>l(a),children:"Split Segment"})}):o(E,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{u(x(m({},t),{hide:!t.hide}))}})}),o("span",{className:"text-l font-bold flex-grow",children:"Projection"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hideProjection,onChange:()=>{u(x(m({},t),{hideProjection:!t.hideProjection}))}})})]}),v("div",{className:"flex flex-row justify-between items-center gap-1",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>r(),children:"Save Segments & Vertices"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const d=await $e([".csv"]);r(d)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:d=>{u(x(m({},t),{color:d.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:d=>{u(x(m({},t),{width:Number.parseFloat(d.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.activeColor,onChange:d=>{u(x(m({},t),{activeColor:d.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.activeWidth,onChange:d=>{u(x(m({},t),{activeWidth:Number.parseFloat(d.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Projection Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.projectionColor,onChange:d=>{u(x(m({},t),{projectionColor:d.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:d=>{u(x(m({},t),{plottableKey:d.currentTarget.value}))},children:ea.map(d=>o("option",{value:d,children:d},d))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Segment"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{i({mode:"mapClick",label:"Select Segment Starting Point",callback:d=>{i({mode:"mapClick",label:"Select Segment End point",callback:b=>{c(d,b),i("normal")}})}})},children:"New Segment"})]}),w]})}const gt=()=>un(),re=fn;function na({folder:t,openFolder:e,filesOpen:n,saveFiles:a}){function s(){e()}const c=gt(),[l,i]=re(r=>[r.main.past.length>0,r.main.future.length>0]);return v("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[o("h3",{className:"text-lg font-bold",children:"celeri_ui"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[t?o("button",{type:"button",onClick:()=>{c(lt.ActionCreators.undo())},"data-testid":"undo-button",disabled:!l,children:"Undo"}):o(E,{}),t?o("button",{type:"button",onClick:()=>{c(lt.ActionCreators.redo())},disabled:!i,"data-testid":"undo-button",children:"Redo"}):o(E,{}),t?v("span",{children:["Working in ",t.name]}):o("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),n?o("button",{type:"button",onClick:a,"data-testid":"save-file-button",children:"Save Files"}):o(E,{})]})]})}const Ve=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],aa={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function sa(t){return m(m({},aa),t)}const oa={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1,plottableKey:""},ia=["",...Ve];var Kt;const la=JSON.parse((Kt=window.localStorage.getItem("velocityDisplaySettings"))!=null?Kt:"false")||oa;function ra({settings:t,setSettings:e,selected:n,velocitys:a,setVelocityData:s,addNewVelocity:c,save:l}){const i=f=>{e(f),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(f))},r=n.map(f=>a[f]).filter(f=>f),u=r.length>0?o(oe,{title:r.length===1?r[0].name:"Edit Selected Velocities",items:r,deletable:!0,setItems:f=>s(n,f),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):o(E,{});return v(E,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{i(x(m({},t),{hide:!t.hide}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>l(),children:"Save Velocities"}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:async()=>{const f=await $e([".csv"]);l(f)},children:"Save As"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:f=>{i(x(m({},t),{color:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Selected Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.selectedColor,onChange:f=>{i(x(m({},t),{selectedColor:f.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Scale"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:t.scale,onChange:f=>{i(x(m({},t),{scale:Number.parseFloat(f.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Width"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:t.width,onChange:f=>{i(x(m({},t),{width:Number.parseFloat(f.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Arrow Head Size"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:" w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:t.arrowHead,onChange:f=>{i(x(m({},t),{arrowHead:Number.parseFloat(f.target.value)}))}})})]})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Plotted Value"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("select",{className:"bg-gray-800 w-full",value:t.plottableKey,onChange:f=>{i(x(m({},t),{plottableKey:f.currentTarget.value}))},children:ia.map(f=>o("option",{value:f,children:f},f))})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Add New Velocity"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:c,children:"New Velocity"})]}),u]})}const ca={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var zt;const da=m(m({},ca),JSON.parse((zt=window.localStorage.getItem("vertexDisplaySettings"))!=null?zt:"{}"));function ua({settings:t,setSettings:e,vertices:n,selected:a,setVertexData:s,setSelectionMode:c,mergeVertices:l,bridgeVertices:i,extrudeVertex:r,save:u}){const f=b=>{e(b),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(b))},d=a.map(b=>({selectedVertex:n[b],index:b})).filter(b=>b.selectedVertex).map(({selectedVertex:b,index:k})=>o(oe,{title:"Selected Vertex",items:[b],ignoreFields:[],deletable:!1,setItems:h=>s(k,m(m({},b),h)),fieldDefinitions:{},controls:v(E,{children:[o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:h=>{l(k,h[0]),c("normal")}})},children:"Merge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:h=>{i(k,h[0]),c("normal")}})},children:"Bridge"}),o("button",{type:"button",className:" bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{c({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:h=>{r(k,h),c("normal")}})},children:"Extrude"})]})},k));return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold flex-grow",children:"Display"}),o("span",{className:"w-2/5 flex-shrink",children:o("input",{className:"form-check-input appearance-none w-9 -ml-10 -full float-left h-5 align-top bg-black bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!t.hide,onChange:()=>{f(x(m({},t),{hide:!t.hide}))}})}),o("button",{type:"button",className:"flex-grow-0 bg-gray-700 hover:bg-gray-800 p-2 shaddow-inner",onClick:()=>u(),children:"Save Segments & Vertices"})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.color,onChange:b=>{f(x(m({},t),{color:b.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.radius,onChange:b=>{f(x(m({},t),{radius:Number.parseFloat(b.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Color"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"color",value:t.activeColor,onChange:b=>{f(x(m({},t),{activeColor:b.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[o("span",{className:"text-l font-bold",children:"Active Radius"}),o("span",{className:"w-2/5 flex-shrink-0",children:o("input",{className:"bg-gray-800 w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:t.activeRadius,onChange:b=>{f(x(m({},t),{activeRadius:Number.parseFloat(b.target.value)}))}})})]}),d]})}const fa=t=>t.mode,ma=t=>t.setSelectedBlock,pa=t=>t.setSelectedSegment,ha=t=>t.setSelectedVelocity,ga=t=>t.setSelectedVertex,ya=t=>t.setActiveTab,yt=mn(fa,ma,pa,ha,ga,ya,(t,e,n,a,s,c)=>t==="normal"?(l,i)=>{e(l==="block"?i:[]),n(l==="segment"?i:[]),a(l==="velocities"?i:[]),s(l==="vertex"?i:[]),c(l)}:t.mode==="override"?(l,i)=>{l===t.type&&t.callback(i)}:()=>{});function ba(t,{data:e}){return[...t,Nn(e)]}function va(t,e){const n=[];for(const[a,s]of t.entries())e.includes(a)||n.push(s);return n}function xa(t,e){const n=[...t];for(const a of e.indices){const s=m(m({},n[a]),e.data);n[a]=s}return n}function wa(t,e){return e}function Sa(t,{index:e,position:n}){const a=[...t],s=m({},a[e]);return s.interior_lat=n.lat,s.interior_lon=n.lon,a[e]=s,a}const Na=[],bt=F("createBlock"),vt=F("editBlock"),xt=F("deleteBlock"),Me=F("loadNewBlockData"),wt=F("moveBlock"),ka=de(Na,t=>{t.addCase(bt,(e,n)=>ba(e,n.payload)).addCase(vt,(e,n)=>xa(e,n.payload)).addCase(xt,(e,n)=>va(e,n.payload)).addCase(Me,(e,n)=>wa(e,n.payload)).addCase(wt,(e,n)=>Sa(e,n.payload))});function _a(t,e){return x(m({},t),{[e.name]:{name:e.name,startLat:"startLat",startLon:"startLon",endLat:"endLat",endLon:"endLon",plot:"",segments:e.data}})}function Ca(t,e){const n={};for(const a of Object.keys(t))a!==e&&(n[a]=t[a]);return n}function La(t,e){const n=t[e.collection];if(!n)return t;const a=x(m({},n),{startLon:e.startLon,startLat:e.startLat,endLon:e.endLon,endLat:e.endLat,plot:e.plot});return x(m({},t),{[e.collection]:a})}const $a={},St=F("loadNewGenericCollectionData"),Nt=F("setGenericSegmentPositionKeys"),Fa=F("removeGenericSegmentCollection"),Da=de($a,t=>t.addCase(St,(e,n)=>_a(e,n.payload)).addCase(Nt,(e,n)=>La(e,n.payload)).addCase(Fa,(e,n)=>Ca(e,n.payload)));function ja(t,e){return x(m({},t),{[e.mesh]:e.data})}function Va(t,e){const n={};for(const a of Object.keys(t))a!==e&&(n[a]=t[a]);return n}const Ma={},Ie=F("loadMeshLineData"),Ia=F("removeMesh"),Pa=de(Ma,t=>t.addCase(Ie,(e,n)=>ja(e,n.payload)).addCase(Ia,(e,n)=>Va(e,n.payload)));function Oa(t,{a:e,b:n}){const a=x(m({},le),{start:e,end:n}),s=[...t.segments,a];return x(m({},t),{segments:s})}function Ra(t,e){const n=m({},t.vertecies),a=m({},t.vertexDictionary),{lastIndex:s}=t,[c,l]=Q(e.start,a,n,s),[i,r]=Q(e.end,a,n,l),u=x(m(m({},le),e),{start:c,end:i}),f=[...t.segments,u];return{vertecies:n,vertexDictionary:a,segments:f,lastIndex:r}}function Ba(t,e){const n=[],a=[];let s=m({},t);for(const[c,l]of t.segments.entries())e.index.includes(c)?a.push(l):n.push(l);s.segments=n;for(const c of a)s=ht(ht(s,c.start),c.end);return s}function Ea(t,e){const n=[...t.segments];for(const a of e.indices){const s=m(m({},n[a]),e.data);n[a]=s}return x(m({},t),{segments:n})}function Aa(t,e){const n=m({},t.vertecies),a=m({},t.vertexDictionary),[s,c]=Q(e.targetPoint,a,n,t.lastIndex),l=x(m({},le),{start:e.index,end:s}),i=[...t.segments,l];return{vertecies:n,vertexDictionary:a,segments:i,lastIndex:c}}function Ta(t,e){return e}function Wa(t,{a:e,b:n}){if(e===n)return t;const a=t.segments.map(r=>{let u=r;return u.start===n&&(u=x(m({},u),{start:e})),u.end===n&&(u=x(m({},u),{end:e})),u}).filter(r=>r.start!==r.end),s=t.vertecies[n],c=`${Math.floor(s.lon*R)},${Math.floor(s.lat*R)}`,l=m({},t.vertecies);delete l[n];const i=m({},t.vertexDictionary);return delete i[c],x(m({},t),{vertecies:l,vertexDictionary:i,segments:a})}function Ga(t,{index:e,vertex:n}){const a=m({},t.vertecies),s=m({},t.vertexDictionary),c=[...t.segments],l=a[e],i=`${Math.floor(n.lon*R)},${Math.floor(n.lat*R)}`,r=`${Math.floor(l.lon*R)},${Math.floor(l.lat*R)}`;if(delete s[r],i in s){const u=s[i];for(const f of c)f.start===u&&(f.start=e),f.end===u&&(f.end=e);delete a[u]}return a[e]=n,x(m({},t),{segments:c,vertecies:a,vertexDictionary:s})}function Ka(t,e){const n=m({},t.vertecies),a=m({},t.vertexDictionary),s=[...t.segments];let{lastIndex:c}=t;for(const l of e){const i=t.segments[l],r=t.vertecies[i.start],u=t.vertecies[i.end],f={lon:(r.lon+u.lon)/2,lat:(r.lat+u.lat)/2},[w,d]=Q(f,a,n,c);c=d;const b=x(m({},i),{end:w,name:`${i.name}_a`}),k=x(m({},i),{start:w,name:`${i.name}_b`});s[l]=b,s.push(k)}return{vertecies:n,vertexDictionary:a,segments:s,lastIndex:c}}const za={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},kt=F("bridgeVertices"),_t=F("createSegmet"),Ct=F("deleteSegment"),Lt=F("editSegmentData"),$t=F("extrudeSegment"),Pe=F("loadNewSegmentData"),Ft=F("mergeVertices"),Oe=F("moveVertex"),Dt=F("splitSegment");function Ha(t,e,n){if(n.dip===90||n.locking_depth<=0)return!1;const a=n.dip<90,c=(a?90-n.dip:n.dip-90)*(Math.PI/180),l=Math.abs(Math.tan(c)*n.locking_depth),[i,r]=t.lon>=e.lon?[t,e]:[e,t],u={lon:r.lat-i.lat,lat:-(r.lon-i.lon)};a&&(u.lon*=-1,u.lat*=-1);const f=rt(ct([[i.lon,i.lat],[i.lon+u.lon,i.lat+u.lat]]),l,{units:"kilometers"}),w=rt(ct([[r.lon,r.lat],[r.lon+u.lon,r.lat+u.lat]]),l,{units:"kilometers"});return[i,{lon:f.geometry.coordinates[0],lat:f.geometry.coordinates[1]},{lon:w.geometry.coordinates[0],lat:w.geometry.coordinates[1]},r]}function Ja(t){return t.segments.map(e=>Ha(t.vertecies[e.start],t.vertecies[e.end],e)).filter(e=>e)}const Ua=de(za,t=>{t.addCase(kt,(e,n)=>Oa(e,n.payload)).addCase(_t,(e,n)=>Ra(e,n.payload)).addCase(Ct,(e,n)=>Ba(e,n.payload)).addCase(Lt,(e,n)=>Ea(e,n.payload)).addCase($t,(e,n)=>Aa(e,n.payload)).addCase(Pe,(e,n)=>Ta(e,n.payload)).addCase(Ft,(e,n)=>Wa(e,n.payload)).addCase(Oe,(e,n)=>Ga(e,n.payload)).addCase(Dt,(e,n)=>Ka(e,n.payload))});function qa(t,{data:e}){return[...t,sa(e)]}function Qa(t,e){const n=[];for(const[a,s]of t.entries())e.includes(a)||n.push(s);return n}function Xa(t,e){const n=[...t];for(const a of e.indices){const s=m(m({},n[a]),e.data);n[a]=s}return n}function Za(t,e){return e}function Ya(t,{index:e,position:n}){const a=[...t],s=m(m({},a[e]),n);return a[e]=s,a}const es=[],jt=F("createVelocity"),Vt=F("editVelocity"),Mt=F("deleteVelocity"),Re=F("loadNewVelocityData"),It=F("moveVelocity"),ts=de(es,t=>{t.addCase(jt,(e,n)=>qa(e,n.payload)).addCase(Vt,(e,n)=>Xa(e,n.payload)).addCase(Mt,(e,n)=>Qa(e,n.payload)).addCase(Re,(e,n)=>Za(e,n.payload)).addCase(It,(e,n)=>Ya(e,n.payload))});function fe(t){const e=t.split(/\n/g),n=e[0].split(",").map(c=>c.trim()),a=e.slice(1),s=[];for(const c of a)if(c.trim()!==""){const l=c.split(/\s*,\s*/),i={};for(let r=0;r<n.length;r+=1){let u=l[r];const f=n[r],w=Number.parseFloat(u);u=Number.isNaN(w)?u:w,typeof u=="string"&&(u=u.startsWith('"')&&u.endsWith('"')?u.slice(1,-1).trim():u.trim()),i[f]=u}s.push(i)}return s}function Be(t,e){const n=[e.join(",")];for(const a of t){const s=a;n.push(e.map(c=>{if(c in s){const l=s[c];return typeof l=="string"&&/\s/.test(`${l}`)?`"${l.trim()}"`:`${typeof l=="number"&&(c.includes("lon")||c.includes("lat"))?l.toFixed(6):l}`}return""}).join(","))}return n.join(`
`)}function ns(t){return t.map(e=>{const n={};for(const a of _e)n[a]=e[a]||(a==="name"?"":0);return n})}function as(t){return Be(t,_e)}class ye{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=fe(e);this.data=ns(n)}async save(){var e;await this.handle.setContents(as((e=this.data)!=null?e:[]))}clone(){return new ye(this.handle)}}const ss={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function os(t){return m(m({},ss),t)}function is(t){const e=JSON.parse(t);return os(e)}function ls(t){return JSON.stringify(t)}class Ee{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents();this.data=is(e)}async save(){this.data&&await this.handle.setContents(ls(this.data))}clone(){return new Ee(this.handle)}}class rs{constructor(e){C(this,"data");C(this,"handle");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=fe(e);this.data=n}async save(){}}function cs(t){const n=[...t.matchAll(/^\s*\d+\s+(-?\d+\.?\d+)\s+(-?\d+\.?\d+)/gm)].map(a=>{const s=Number.parseFloat(a[1]),c=Number.parseFloat(a[2]);return{lon:s,lat:c}});return n.splice(0,0,{lon:0,lat:0}),n}const ds={"1":t=>{var a,s;const e=Number.parseInt((a=t[t.length-2])!=null?a:"",10),n=Number.parseInt((s=t[t.length-1])!=null?s:"",10);return!Number.isNaN(e)&&!Number.isNaN(n)?[[e,n]]:!1},"2":t=>{var s,c,l;const e=Number.parseInt((s=t[t.length-3])!=null?s:"",10),n=Number.parseInt((c=t[t.length-2])!=null?c:"",10),a=Number.parseInt((l=t[t.length-1])!=null?l:"",10);return!Number.isNaN(e)&&!Number.isNaN(n)&&!Number.isNaN(a)?[[e,n],[n,a],[a,e]]:!1}};function us(t){return t.split(/\n/).map(e=>e.trim()).map(e=>e.split(/\s+/)).filter(e=>e.length>2).map(e=>{var a;return((a=ds[e[1]])!=null?a:()=>!1)(e)}).filter(e=>e).flat()}function fs(t,e){return e.map(([n,a])=>n!==a&&n>-1&&n<t.length&&a>-1&&a<t.length?[t[n],t[a]]:!1).filter(n=>n)}function ms(t){if(!t.startsWith("$"))return[];const e=t.split("$");let n=[],a=[];for(const s of e)s.startsWith("Nodes")?n=cs(s):s.startsWith("Elements")&&(a=us(s));return fs(n,a)}class ps{constructor(e){C(this,"data");C(this,"handle");C(this,"startLonColumn");C(this,"endLonColumn");C(this,"startLatColumn");C(this,"endLatColumn");this.handle=e,this.data=void 0,this.startLonColumn="",this.endLonColumn="",this.startLatColumn="",this.endLatColumn=""}async initialize(){const e=await this.handle.getContents();if(e.startsWith("$"))this.data=ms(e);else{const n=fe(e);this.data=n.map(a=>{const s={lon:0,lat:0},c={lon:0,lat:0};console.log("parsing row",a),typeof a[this.startLonColumn]=="number"&&(s.lon=a[this.startLonColumn]),typeof a[this.startLatColumn]=="number"&&(s.lat=a[this.startLatColumn]),typeof a[this.endLonColumn]=="number"&&(c.lon=a[this.endLonColumn]),typeof a[this.endLatColumn]=="number"&&(c.lat=a[this.endLatColumn]);const l=Object.keys(a).filter(i=>i!==this.startLatColumn&&i!==this.endLatColumn&&i!==this.startLonColumn&&i!==this.endLonColumn);if(l.length>0){const i={};for(const r of l)i[r]=a[r];return[s,c]}return[s,c]})}}async save(){console.log("Mesh files do not get saved")}}function hs(t){const e=t.map(l=>{const i={};for(const r of je)i[r]=l[r]||(r==="name"?"":0);return i}),n={},a={},s=[];let c=0;for(const l of e){const[i,r]=Q({lon:l.lon1,lat:l.lat1},n,a,c),[u,f]=Q({lon:l.lon2,lat:l.lat2},n,a,r),w=x(m({},l),{start:i,end:u});c=f,s.push(w)}return{vertecies:a,vertexDictionary:n,segments:s,lastIndex:c}}function gs({vertecies:t,segments:e}){const n=e.map(a=>{const s=t[a.start],c=t[a.end];return x(m({},a),{lon1:s.lon,lat1:s.lat,lon2:c.lon,lat2:c.lat})});return Be(n,je)}class be{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=fe(e);this.data=hs(n)}async save(){this.data&&await this.handle.setContents(gs(this.data))}clone(){return new be(this.handle)}tryRemoveVertex(e){if(this.data){let n=!1;for(const a of this.data.segments)if(a.start===e||a.end===e){n=!0;break}if(!n&&this.data.vertecies[e]){const a=this.data.vertecies[e],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,c=m({},this.data.vertecies);delete c[e];const l=m({},this.data.vertexDictionary);delete l[s];const i=this.clone();return i.data=x(m({},this.data),{vertecies:c,vertexDictionary:l}),i}}return this}mergeVertices(e,n){if(this.data){for(const r of this.data.segments)r.start===n&&(r.start=e),r.end===n&&(r.end=e);const a=this.data.vertecies[n],s=`${Math.floor(a.lon*R)},${Math.floor(a.lat*R)}`,c=m({},this.data.vertecies);delete c[n];const l=m({},this.data.vertexDictionary);delete l[s];const i=this.clone();return i.data=x(m({},this.data),{vertecies:c,vertexDictionary:l}),i}return this}moveVertex(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),c=[...this.data.segments],l=a[e],i=`${Math.floor(n.lon*R)},${Math.floor(n.lat*R)}`,r=`${Math.floor(l.lon*R)},${Math.floor(l.lat*R)}`;if(delete s[r],i in s){const f=s[i];for(const w of c)w.start===f&&(w.start=e),w.end===f&&(w.end=e);delete a[f]}a[e]=n;const u=this.clone();return u.data=x(m({},this.data),{segments:c,vertecies:a,vertexDictionary:s}),u}return this}splitSegment(e){if(this.data){const n=this.data.segments[e],a=this.data.vertecies[n.start],s=this.data.vertecies[n.end],c={lon:(a.lon+s.lon)/2,lat:(a.lat+s.lat)/2},[l,i]=Q(c,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),r=x(m({},n),{end:l,name:`${n.name}_a`}),u=x(m({},n),{start:l,name:`${n.name}_b`}),f=[...this.data.segments];f[e]=r,f.push(u);const w=this.clone();return w.data=x(m({},this.data),{segments:f,lastIndex:i}),w}return this}bridgeVertices(e,n){if(this.data){const a=x(m({},le),{start:e,end:n}),s=[...this.data.segments,a],c=this.clone();return c.data=x(m({},this.data),{segments:s}),c}return this}extrudeSegment(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),[c,l]=Q(n,s,a,this.data.lastIndex),i=x(m({},le),{start:e,end:c}),r=[...this.data.segments,i],u=this.clone();return u.data={vertecies:a,vertexDictionary:s,segments:r,lastIndex:l},u}return this}deleteSegment(e){if(this.data){const n=[...this.data.segments],a=n.splice(e,1)[0],s=this.clone();return s.data=x(m({},this.data),{segments:n}),s.tryRemoveVertex(a.start).tryRemoveVertex(a.end)}return this}createSegment(e,n){if(this.data){const a=m({},this.data.vertecies),s=m({},this.data.vertexDictionary),[c,l]=Q(e,s,a,this.data.lastIndex),[i,r]=Q(n,s,a,l),u=x(m({},le),{start:c,end:i}),f=[...this.data.segments,u],w=this.clone();return w.data={vertecies:a,vertexDictionary:s,segments:f,lastIndex:r},w}return this}}function ys(t){return t.map(e=>{const n={};for(const a of Ve)n[a]=e[a]||(a==="name"?"":0);return n})}function bs(t){return Be(t,Ve)}class ve{constructor(e){C(this,"handle");C(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=fe(e);this.data=ys(n)}async save(){var e;await this.handle.setContents(bs((e=this.data)!=null?e:[]))}clone(){return new ve(this.handle)}}async function Pt(t){const e=new be(t);return await e.initialize(),e}async function Ot(t){const e=new ye(t);return await e.initialize(),e}async function Rt(t){const e=new ve(t);return await e.initialize(),e}async function Bt(t){const e=new ps(t);return await e.initialize(),e}async function vs(t){const e=new rs(t);return await e.initialize(),e}async function me(t,e,n){try{const a=await e.getFile(t);return await n(a)}catch{return!1}}async function xs(t,e,n){const a=new Ee(e);if(await a.initialize(),a.data){const s=await me(a.data.segment_file_name,t,Pt),c=await me(a.data.block_file_name,t,Ot),l=await me(a.data.station_file_name,t,Rt),i=await me(a.data.mesh_parameters_file_name,t,async u=>{const f=JSON.parse(await u.getContents());return(await Promise.all(f.map(async d=>me(d.mesh_filename,t,Bt)))).filter(d=>d)}),r=m({},n);return"command"in r&&(r.command=x(m({},r.command),{currentFilePath:e.name})),s&&"segment"in r&&(r.segment=x(m({},r.segment),{currentFilePath:a.data.segment_file_name})),c&&"block"in r&&(r.block=x(m({},r.block),{currentFilePath:a.data.block_file_name})),l&&"velocities"in r&&(r.velocities=x(m({},r.velocities),{currentFilePath:a.data.station_file_name})),i&&"mesh"in r&&(r.mesh=x(m({},r.mesh),{currentFilePath:i.map(u=>u.handle.name)})),{openableFiles:r,commands:a,segments:s,blocks:c,velocities:l,mesh:i}}throw new Error("Can't open command file")}window.location.search.includes("fake-dir")||Ln(kn);var z;(function(t){t.Vertex="Vertices",t.Block="Blocks",t.Velocity="Velocities"})(z||(z={}));const Et={Block:z.Block,Vertex:z.Vertex,Velocity:z.Velocity},ws={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices",mesh:"Mesh",csv:"Generic Segments",map:"Map"};function Ss(){var nt,at,st;const t=gt(),[e,n]=N.exports.useState(),[a,s]=N.exports.useState(""),[c,l]=N.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""},mesh:{name:"Mesh Files",description:"A .msh file containging a triangulation world state",extension:".msh",currentFilePath:"",allowMultiple:!0},csv:{name:"Custom CSV",description:"Arbitrary CSV files with lines",extension:".csv",currentFilePath:"",allowMultiple:!0}}),[i,r]=N.exports.useState(),[u,f]=N.exports.useState(),[w,d]=N.exports.useState(),[b,k]=N.exports.useState(),h=re(p=>p.main.present.segment),g=re(p=>p.main.present.block),S=re(p=>p.main.present.velocity),_=re(p=>p.main.present.meshLine),A=re(p=>p.main.present.genericSegments),[L,te]=N.exports.useState(la),[D,Ae]=N.exports.useState(Vn),[P,Te]=N.exports.useState(Yn),[j,We]=N.exports.useState(da),[H,Ge]=N.exports.useState(Qn),[J,Ke]=N.exports.useState(On),[ce,Ht]=N.exports.useState(Jn),[U,ne]=N.exports.useState("normal"),[ae,Jt]=N.exports.useState(z.Vertex),[xe,ze]=N.exports.useState([]),[He,Je]=N.exports.useState([]),[Ue,qe]=N.exports.useState([]),[Qe,Xe]=N.exports.useState([]),[I,Ls]=N.exports.useState({select:yt({mode:U,setSelectedBlock:ze,setSelectedSegment:Je,setSelectedVelocity:qe,setSelectedVertex:Xe,setActiveTab:s})}),[Ut,qt]=N.exports.useState([]),[Qt,Ze]=N.exports.useState([]),[Xt,Zt]=N.exports.useState([]),[Yt,Ye]=N.exports.useState([]),[en,we]=N.exports.useState({color:j.color,selectedColor:j.activeColor,radius:j.radius,selectedRadius:j.activeRadius,points:[]}),[et,tn]=N.exports.useState({lon:0,lat:0}),[Se,nn]=N.exports.useState(!1);N.exports.useEffect(()=>{I.select=yt({mode:U,setSelectedBlock:ze,setSelectedSegment:Je,setSelectedVelocity:qe,setSelectedVertex:Xe,setActiveTab:s})},[U,I]),N.exports.useEffect(()=>{const p=[];ae!==z.Block&&!D.hide&&p.push({name:"blocks",color:D.color,selectedColor:D.selectedColor,radius:D.radius,points:g.map((y,$)=>({longitude:y.interior_lon,latitude:y.interior_lat,name:y.name,description:"",index:$,label:D.plottableKey in y?`${y[D.plottableKey]}`:""})),click:y=>{I.select("block",[y])}}),ae!==z.Vertex&&!j.hide&&p.push({name:"vertices",color:j.color,selectedColor:j.activeColor,radius:j.radius,click:y=>{I.select("vertex",[y])},points:Object.keys(h.vertecies).map(y=>{const $=Number.parseInt(y,10),M=h.vertecies[$];return M?{longitude:M.lon,latitude:M.lat,index:$,name:"",description:""}:!1}).filter(y=>!!y)}),qt(p)},[D,g,P,I,ae,j.hide,j.color,j.activeColor,j.radius,h.vertecies]),N.exports.useEffect(()=>{const p=[];if(P.hide||p.push({name:"segments",color:P.color,selectedColor:P.activeColor,width:P.width,selectedWidth:P.activeWidth,lines:h.segments.map((y,$)=>{var q,W;const M=(q=h.vertecies[y.start])!=null?q:mt,T=(W=h.vertecies[y.end])!=null?W:mt,[[Z,B],[G,O]]=De(M,T);return{startLongitude:Z,startLatitude:B,endLongitude:G,endLatitude:O,name:y.name,description:`${M.lon},${M.lat} to ${T.lon},${T.lat}`,index:$,label:P.plottableKey in y?`${y[P.plottableKey]}`:""}}),click:y=>{I.select("segment",[y])}}),!H.hide)for(const y of Object.keys(_)){const $=_[y];p.push({name:`mesh:${y}`,color:H.color,selectedColor:H.activeColor,width:H.width,selectedWidth:H.activeWidth,lines:$.map((M,T)=>{const Z=M[0],B=M[1],[[G,O],[q,W]]=De(Z,B);return{startLongitude:G,startLatitude:O,endLongitude:q,endLatitude:W,name:"",description:"",index:T}})||[]})}if(!J.hide)for(const y of Object.keys(A)){const{startLat:$,startLon:M,endLat:T,endLon:Z,plot:B,segments:G}=A[y];$ in G[0]&&T in G[0]&&M in G[0]&&Z in G[0]&&p.push({name:`generic_segment:${y}`,color:J.color,selectedColor:J.activeColor,width:J.width,selectedWidth:J.activeWidth,lines:G.map((O,q)=>{const W={lat:O[$],lon:O[M]},se={lat:O[T],lon:O[Z]};if(typeof W.lat!="number"||typeof W.lon!="number"||typeof se.lat!="number"||typeof se.lon!="number")return!1;const[[pe,V],[he,ge]]=De(W,se);return{startLongitude:pe,startLatitude:V,endLongitude:he,endLatitude:ge,name:"",description:"",index:q,label:B&&B in O?`${O[B]}`:""}}).filter(O=>O)||[]})}Zt(p)},[h,P,J,A,H,_,I]),N.exports.useEffect(()=>{switch(ae){case z.Vertex:{we({color:j.color,radius:j.radius,selectedColor:j.activeColor,selectedRadius:j.activeRadius,points:j.hide?[]:Object.keys(h.vertecies).map(p=>{const y=Number.parseInt(p,10),$=h.vertecies[y];return $?{longitude:$.lon,latitude:$.lat,index:y}:!1}).filter(p=>!!p),update:(p,y)=>{t(Oe({index:p,vertex:y}))},select:p=>{I.select("vertex",p)}});break}case z.Block:{we({color:D.color,radius:D.radius,selectedColor:D.selectedColor,selectedRadius:D.radius,points:D.hide?[]:g.map((p,y)=>({longitude:p.interior_lon,latitude:p.interior_lat,name:p.name,description:"",index:y,label:D.plottableKey in p?`${p[D.plottableKey]}`:""})),update:(p,y)=>{t(wt({index:p,position:y}))},select:p=>{I.select("block",p)}});break}case z.Velocity:{we({color:L.color,radius:L.width,selectedColor:L.selectedColor,selectedRadius:L.width,points:L.hide?[]:S.map((p,y)=>({longitude:p.lon,latitude:p.lat,name:p.name,description:"",index:y})),update:(p,y)=>{t(It({index:p,position:y}))},select:p=>{I.select("velocities",p)}});break}}},[j,I,h.vertecies,t,ae,D.color,D.radius,D.selectedColor,D.hide,g,L.color,L.width,L.selectedColor,L.hide,S,D.plottableKey]),N.exports.useEffect(()=>{L.hide?Ze([]):Ze([{name:"velocities",color:L.color,selectedColor:L.selectedColor,scale:L.scale,arrowHeadScale:L.arrowHead,width:L.width,arrows:S.map((p,y)=>{const $=Math.sqrt(p.east_vel*p.east_vel+p.north_vel*p.north_vel);return{longitude:p.lon,latitude:p.lat,direction:[p.east_vel/$,p.north_vel/$],scale:$,name:p.name,description:`north: ${p.north_vel}, east: ${p.east_vel}`,index:y,label:L.plottableKey in p?`${p[L.plottableKey]}`:""}}),click:p=>{I.select("velocities",[p])}}])},[I,L,S]),N.exports.useEffect(()=>{P.hideProjection||P.hide?Ye([]):Ye([{name:"fault_dip_projections",color:P.projectionColor,borderColor:P.projectionColor,borderRadius:.5,polygons:Ja(h).map((p,y)=>({polygon:p,index:y,name:"",description:""}))}])},[P,h]);let X=o("span",{});switch(a){case"files":X=e?o(In,{folder:e,files:c,setFile:async(p,y,$,M)=>{if(M){let T=m({},c);const Z=T[y];let{currentFilePath:B,allowMultiple:G}=Z;switch(G?Array.isArray(B)?(B=B.map(O=>O),B.length>p?B[p]=$:B.push($)):B=[$]:B=$,T[y]=x(m({},Z),{currentFilePath:B}),y){case"segment":const O=await Pt(M);f(O),O.data&&t(Pe(O.data));break;case"block":const q=await Ot(M);d(q),q.data&&t(Me(q.data));break;case"velocities":const W=await Rt(M);k(W),W.data&&t(Re(W.data));break;case"mesh":const se=await Bt(M);se.data&&t(Ie({mesh:`mesh_file_${p}`,data:se.data}));break;case"csv":const pe=await vs(M);pe.data&&t(St({name:`generic_segment_${p}`,data:pe.data}));break;case"command":const V=await xs(e,M,c);r(V.commands!==!1?V.commands:void 0),f(V.segments!==!1?V.segments:void 0),V.segments!==!1&&V.segments.data&&t(Pe(V.segments.data)),d(V.blocks!==!1?V.blocks:void 0),V.blocks!==!1&&V.blocks.data&&t(Me(V.blocks.data)),k(V.velocities!==!1?V.velocities:void 0),V.velocities!==!1&&V.velocities.data&&t(Re(V.velocities.data)),V.mesh&&V.mesh.map((he,ge)=>(he.data&&t(Ie({mesh:`mesh_file_${ge}`,data:he.data})),ge)),T=V.openableFiles;break}l(T)}}}):o("span",{});break;case"velocities":X=o(ra,{settings:L,setSettings:te,selected:Ue,velocitys:S,setVelocityData:(p,y)=>{y?t(Vt({indices:p,data:y})):(t(Mt(p)),I.select("velocity",[]))},addNewVelocity:()=>{ne({label:"Click to place velocity estimate",mode:"mapClick",callback:p=>{ne("normal");const y=S.length;t(jt({data:{lat:p.lat,lon:p.lon}})),I.select("velocity",[y])}})},save:async p=>{if(p){const y=new ve(p);y.data=S,k(y),await y.save()}else b&&(b.data=S,await b.save())}});break;case"block":X=o(Mn,{settings:D,setSettings:Ae,selected:xe,blocks:g,addNewBlock:()=>{ne({label:"Click to place new block",mode:"mapClick",callback:p=>{const y=g.length;t(bt({data:{name:"New Block",interior_lon:p.lon,interior_lat:p.lat}})),I.select("block",[y]),ne("normal")}})},setBlockData:(p,y)=>{y?t(vt({indices:xe,data:y})):(t(xt(p)),I.select("block",[]))},save:async p=>{if(p){const y=new ye(p);y.data=g,d(y),await y.save()}else w&&(w.data=g,await w.save())}});break;case"segment":X=o(ta,{settings:P,setSettings:Te,segments:(nt=h.segments)!=null?nt:[],selected:He,setSelectionMode:p=>ne(p),addNewSegment:(p,y)=>{const $=h.segments.length;t(_t({start:p,end:y})),I.select("segment",[$])},setSegmentData:(p,y)=>{t(y?Lt({indices:p,data:y}):Ct({index:p}))},splitSegment:p=>{t(Dt(p)),I.select("segment",[])},save:async p=>{if(p){const y=new be(p);y.data=h,f(y),await y.save()}else u&&(u.data=h,await u.save())}});break;case"vertex":X=o(ua,{settings:j,setSettings:We,vertices:(at=h.vertecies)!=null?at:{},selected:Qe,setVertexData:(p,y)=>{y&&t(Oe({index:p,vertex:y}))},setSelectionMode:p=>ne(p),mergeVertices:(p,y)=>{t(Ft({a:p,b:y}))},bridgeVertices:(p,y)=>{t(kt({a:p,b:y}))},extrudeVertex:(p,y)=>{t($t({index:p,targetPoint:y}))},save:async()=>{u&&(u.data=h,await u.save())}});break;case"mesh":X=o(Xn,{settings:H,setSettings:Ge});break;case"csv":X=o(Rn,{settings:J,setSettings:Ke,setCollectionVertexKeys:p=>{t(Nt(p))},collections:A});break;case"map":X=o(Un,{settings:ce,setSettings:Ht});break}const tt={Block:{state:D.hide,change:()=>{Ae(x(m({},D),{hide:!D.hide}))}},Vertex:{state:j.hide,change:()=>{We(x(m({},j),{hide:!j.hide}))}},Velocity:{state:L.hide,change:()=>{te(x(m({},L),{hide:!L.hide}))}},Segment:{state:P.hide,change:()=>{Te(x(m({},P),{hide:!P.hide}))}},Grid:{state:!Se,change:()=>{nn(!Se)}},Mesh:{state:H.hide,change:()=>{Ge(x(m({},H),{hide:!H.hide}))}},GenericSegments:{state:J.hide,change:()=>{Ke(x(m({},J),{hide:!J.hide}))}}};return v("div",{role:"document",className:"w-screen h-screen flex flex-col text-white",onKeyDown:p=>{p.key==="Escape"&&ne("normal")},children:[o(na,{filesOpen:((st=i!=null?i:u)!=null?st:w)!==void 0,saveFiles:async()=>{i&&await i.save(),u&&(u.data=h,await u.save()),w&&(w.data=g,await w.save()),b&&(b.data=S,await b.save())},folder:e,openFolder:async()=>{const p=await $n();n(p),s("files")}}),U!=="normal"?o("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:v("div",{className:"flex flex-col justify-center items-center bg-black p-3 gap-1 ",children:[o("span",{className:"text-lg font-semibold",children:U.label}),U.subtitle?o("span",{className:"text-md font-thin text-gray-500",children:U.subtitle}):o(E,{}),o("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):o(E,{}),v("div",{className:"absolute bottom-0 left-0 flex flex-col bg-black  p-2 gap-5 shadow-sm z-50",children:[o("div",{className:"flex flex-row items-center justify-between gap-5",children:v("span",{className:"p-1 text-sm text-center",children:["Hold ",o("span",{className:"font-bold",children:"Shift"})," to box select"," ",o("span",{className:"font-bold",children:ae})]})}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),v("span",{children:[Math.floor(et.lon*1e3)/1e3,","," ",Math.floor(et.lat*1e3)/1e3]})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[o("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(Et).map(p=>{const y=Et[p];return o("button",{type:"button",className:`${ae===y?"bg-gray-700":"bg-black"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{Jt(y)},children:p},p)})]}),v("div",{className:"flex flex-row items-center justify-start gap-5",children:[v("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(tt).map(p=>{const y=tt[p];return o("button",{type:"button",className:`${y.state?"bg-black":"bg-gray-700"} p-2 shaddow-inner hover:bg-gray-800 `,onClick:()=>{y.change()},children:p},p)})]})]}),o(Hn,{pointSources:Ut,arrowSources:Qt,lineSources:Xt,drawnPointSource:en,polygonSources:Yt,selections:{segments:He,blocks:xe,velocities:Ue,vertices:Qe},displayGrid:Se?10:-1,click:p=>{typeof U!="string"&&U.mode==="mapClick"&&U.callback(p)},mouseMove:p=>{tn(p)},styleUri:`mapbox://styles/${ce.currentStyle.user}/${ce.currentStyle.styleId}`},`${ce.currentStyle.user}:${ce.currentStyle.styleId}`),o(Bn,{view:X,buttons:ws,active:a,setActive:p=>s(p)})]})}const Ns=pn({reducer:{main:hn(gn({segment:Ua,block:ka,velocity:ts,meshLine:Pa,genericSegments:Da}))}});function ks(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:s,onRegisterError:c}=t;let l;const i=async(r=!0)=>{};return"serviceWorker"in navigator&&(l=new yn("./sw.js",{scope:"./"}),l.addEventListener("activated",r=>{r.isUpdate?window.location.reload():a==null||a()}),l.register({immediate:e}).then(r=>{s==null||s(r)}).catch(r=>{c==null||c(r)})),i}ks();const _s=1,Cs=new bn({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:_s}}});vn.render(o(N.exports.StrictMode,{children:o(xn,{client:Cs,children:o(wn,{store:Ns,children:o(Ss,{})})})}),document.querySelector("#root"));
