var Q=Object.defineProperty,Z=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var M=(i,e,t)=>e in i?Q(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v=(i,e)=>{for(var t in e||(e={}))K.call(e,t)&&M(i,t,e[t]);if(I)for(var t of I(e))X.call(e,t)&&M(i,t,e[t]);return i},L=(i,e)=>Z(i,U(e));var f=(i,e,t)=>(M(i,typeof e!="symbol"?e+"":e,t),t);import{j as P,m as z,r as g,a as j,M as Y,v as ee,Q as te,R as ne,b as ie}from"./vendor.2c6bff34.js";const ae=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}};ae();const u=P.exports.jsx,S=P.exports.jsxs,se=P.exports.Fragment;function oe({folder:i,files:e,setFile:t}){const n=Object.keys(e).map(a=>{const s=e[a];return S("div",{className:"flex flex-row justify-between items-center",children:[S("div",{className:"flex flex-col",children:[u("span",{className:"text-l font-bold","data-testid":`file-${a}-label`,children:s.name}),u("span",{className:"text-sm","data-testid":`file-${a}-description`,children:s.description})]}),u("span",{className:"w-2/5 flex-shrink-0",children:S("select",{"data-testid":`file-${a}-select`,className:"w-full rounded",value:s.currentFilePath,onChange:async c=>{const p=c.currentTarget.value;try{const _=await i.getFile(p);t(a,_.name,_)}catch{t(a,"")}},children:[u("option",{value:"","data-testid":`file-${a}-empty`,children:"\xA0"}),i.fileList.filter(c=>c.endsWith(s.extension)).map(c=>u("option",{value:c,"data-testid":`file-${a}-select-${c}`,children:c},c))]})})]},a)});return u("div",{className:"flex flex-col gap-2",children:n})}function re({view:i,buttons:e,active:t,setActive:n}){if(!e)return u("span",{});const a=[];for(const s of Object.keys(e)){const c=e[s],p=s===t;a.push(u("button",{type:"button","data-testid":`tab-${s}`,className:`${p?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>n(p?"":s),children:c},s))}return S("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?u("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:i}):"",u("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:a})]})}z.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const C=Math.PI/6,N=2*Math.PI-C;function le({pointSources:i,arrowSources:e}){const t=g.exports.useRef(null),[n,a]=g.exports.useState(),[s,c]=g.exports.useState(!1),[p,_]=g.exports.useState(),[h]=g.exports.useState(new j.exports.Popup({closeButton:!1,closeOnClick:!1})),[b,F]=g.exports.useState(),[x,$]=g.exports.useState();return g.exports.useEffect(()=>{if(!n&&z.accessToken&&t.current){const l=new j.exports.Map({container:t.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});l.addControl(new j.exports.NavigationControl);const r=new Y({});l.addControl(r),a(l),_(r),l.on("load",()=>{c(!0)})}console.log("Updating map...")},[n,p]),g.exports.useEffect(()=>{if(console.log("Adding layers"),n&&s&&b!==i)if(console.log("Setting points in map!"),b){for(const l of b){const r=n.getSource(`point:${l.name}`);r!==void 0&&r.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:point:${l.name}`)}F(void 0)}else{for(const l of i){let r=n.getSource(`point:${l.name}`);const w=r===void 0;w&&(n.addSource(`point:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r=n.getSource(`point:${l.name}`)),r!==void 0&&r.setData({type:"FeatureCollection",features:l.points.map((o,d)=>({type:"Feature",properties:{description:`<strong>${o.name}</strong><p>${o.description}</p>`,index:d,name:o.name},geometry:{type:"Point",coordinates:[o.longitude,o.latitude]}}))}),n.addLayer({id:`layer:point:${l.name}`,type:"circle",source:`point:${l.name}`,paint:{"circle-color":l.color,"circle-radius":l.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),w&&(n.on("mouseenter",`layer:point:${l.name}`,o=>{if(!o.features)return;const d=o.features[0];if(d.geometry.type==="Point"&&d.properties&&typeof d.properties.description=="string"){const m=[...d.geometry.coordinates],{description:y}=d.properties;for(;Math.abs(o.lngLat.lng-m[0])>180;)m[0]+=o.lngLat.lng>m[0]?360:-360;h.setLngLat(m).setHTML(y).addTo(n)}}),n.on("mouseleave",`layer:point:${l.name}`,()=>{h.remove()}),n.on("click",`layer:point:${l.name}`,o=>{if(!o.features||!l.clickPoint)return;const d=o.features[0];if(d.properties&&typeof d.properties.index=="number"&&typeof d.properties.name=="string"){const{index:m,name:y}=d.properties;l.clickPoint(m,y)}}))}F(i)}},[n,b,i,s,h]),g.exports.useEffect(()=>{if(console.log("Adding layers"),n&&s&&x!==e)if(console.log("Setting arrows in map!"),x){for(const l of x){const r=n.getSource(`arrow:${l.name}`);r!==void 0&&r.setData({type:"FeatureCollection",features:[]}),n.removeLayer(`layer:arrow:${l.name}`)}$(void 0)}else{for(const l of e){let r=n.getSource(`arrow:${l.name}`);const w=r===void 0;w&&(n.addSource(`arrow:${l.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r=n.getSource(`arrow:${l.name}`)),r!==void 0&&r.setData({type:"FeatureCollection",features:l.arrows.map((o,d)=>{const m=o.scale*l.scale,y=l.scale*l.arrowHeadScale,k=[o.longitude+o.direction[0]*m,o.latitude+o.direction[1]*m],q=[k[0]+(Math.cos(C)*-o.direction[0]-Math.sin(C)*-o.direction[1])*y,k[1]+(Math.sin(C)*-o.direction[0]+Math.cos(C)*-o.direction[1])*y],G=[k[0]+(Math.cos(N)*-o.direction[0]-Math.sin(N)*-o.direction[1])*y,k[1]+(Math.sin(N)*-o.direction[0]+Math.cos(N)*-o.direction[1])*y];return{type:"Feature",properties:{description:`<strong>${o.name}</strong><p>${o.description}</p>`,index:d,name:o.name},geometry:{type:"LineString",coordinates:[[o.longitude,o.latitude],k,q,k,G]}}})}),n.addLayer({id:`layer:arrow:${l.name}`,type:"line",source:`arrow:${l.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":l.color,"line-width":4}}),w&&(n.on("mouseenter",`layer:arrow:${l.name}`,o=>{if(!o.features)return;const d=o.features[0];if(d.geometry.type==="Point"&&d.properties&&typeof d.properties.description=="string"){const m=[...d.geometry.coordinates],{description:y}=d.properties;for(;Math.abs(o.lngLat.lng-m[0])>180;)m[0]+=o.lngLat.lng>m[0]?360:-360;h.setLngLat(m).setHTML(y).addTo(n)}}),n.on("mouseleave",`layer:arrow:${l.name}`,()=>{h.remove()}),n.on("click",`layer:arrow:${l.name}`,o=>{if(!o.features||!l.clickArrow)return;const d=o.features[0];if(d.properties&&typeof d.properties.index=="number"&&typeof d.properties.name=="string"){const{index:m,name:y}=d.properties;l.clickArrow(m,y)}}))}$(e)}},[n,x,e,s,h]),u("div",{"data-testid":"map",className:"w-full h-full",ref:t})}function ce({folder:i,openFolder:e}){function t(){e()}return S("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[u("h3",{className:"text-lg font-bold",children:"Celeri UI"}),u("span",{"data-testid":"open-folder-topbar",children:i?S(se,{children:["Working in ",i.name]}):u("button",{type:"button",onClick:t,"data-testid":"open-folder-button",children:"Open Folder"})})]})}function O(i){const e=i.split(/\n/g),t=e[0].split(","),n=e.slice(1),a=[];for(const s of n){const c=s.split(/\s*,\s*/),p={};for(let _=0;_<t.length;_+=1){let h=c[_];const b=t[_],F=Number.parseFloat(h);h=Number.isNaN(F)?h:F,typeof h=="string"&&h.startsWith('"')&&h.endsWith('"')&&(h=h.slice(1,-1)),p[b]=h}a.push(p)}return a}function A(i,e){const t=[e.join(",")];for(const n of i){const a=n;t.push(e.map(s=>s in a?typeof a[s]=="string"&&/\s/.test(`${a[s]}`)?`"${a[s]}"`:`${a[s]}`:"").join(","))}return t.join(`
`)}const R=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"];class de{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=O(e).map(a=>{const s={};for(const c of R)s[c]=a[c]||(c==="name"?"":0);return s});this.data=n}async save(){var t;const e=A((t=this.data)!=null?t:[],R);await this.handle.setContents(e)}}const pe={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function ue(i){return v(v({},pe),i)}class me{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=ue(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}}const T=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"];class fe{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=O(e).map(a=>{const s={};for(const c of T)s[c]=a[c]||(c==="name"?"":0);return s});this.data=n}async save(){var t;const e=A((t=this.data)!=null?t:[],T);await this.handle.setContents(e)}}const H=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class he{constructor(e){f(this,"handle");f(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=O(e).map(a=>{const s={};for(const c of H)s[c]=a[c]||(c==="name"?"":0);return s});this.data=n}async save(){var t;const e=A((t=this.data)!=null?t:[],H);await this.handle.setContents(e)}}async function W(i){const e=new fe(i);return await e.initialize(),e}async function V(i){const e=new de(i);return await e.initialize(),e}async function B(i){const e=new he(i);return await e.initialize(),e}async function ge(i,e,t){const n=new me(e);if(await n.initialize(),n.data){const a=await W(await i.getFile(n.data.segment_file_name)),s=await V(await i.getFile(n.data.block_file_name)),c=await B(await i.getFile(n.data.station_file_name)),p=v({},t);return"command"in p&&(p.command=L(v({},p.command),{currentFilePath:e.name})),"segment"in p&&(p.segment=L(v({},p.segment),{currentFilePath:n.data.segment_file_name})),"block"in p&&(p.block=L(v({},p.block),{currentFilePath:n.data.block_file_name})),"velocities"in p&&(p.velocities=L(v({},p.velocities),{currentFilePath:n.data.station_file_name})),{openableFiles:p,commands:n,segments:a,blocks:s,velocities:c}}throw new Error("Can't open command file")}class _e{constructor(e){f(this,"name");f(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class D{constructor(e){f(this,"name");f(this,"handle");f(this,"fileList");f(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new _e(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),n=new D(t);return await n.initialize(),n}}const we=async()=>{const i=await window.showDirectoryPicker(),e=new D(i);return await e.initialize(),e};class ye{constructor(e,t){f(this,"name");f(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class E{constructor(e,t){f(this,"name");f(this,"parent");f(this,"fileList");f(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const n=t[e];for(const a of Object.keys(n))typeof n[a]=="string"?this.fileList.push(a):this.folderList.push(a)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new ye(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new E(e,this.parent[this.name])}}const be=async i=>new E("root",i);let J=async()=>{var e;return be((e=window.FakeDirectory)!=null?e:{})};function ve(i){J=i}async function xe(){return J()}window.location.search.includes("fake-dir")||ve(we);const Fe={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",mesh:"Mesh"};function Se(){const[i,e]=g.exports.useState(),[t,n]=g.exports.useState(""),[a,s]=g.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[c,p]=g.exports.useState(),[_,h]=g.exports.useState(),[b,F]=g.exports.useState(),[x,$]=g.exports.useState();let l=u("span",{});switch(t){case"files":l=i?u(oe,{folder:i,files:a,setFile:async(r,w,o)=>{if(o){let d=v({},a);switch(d[r]=L(v({},d[r]),{currentFilePath:w}),r){case"segment":h(await W(o));break;case"block":F(await V(o));break;case"velocity":$(await B(o));break;case"command":const m=await ge(i,o,a);p(m.commands),h(m.segments),F(m.blocks),$(m.velocities),d=m.openableFiles;break}s(d)}}}):u("span",{});break}return S("div",{className:"w-screen h-screen flex flex-col",children:[u(ce,{folder:i,openFolder:async()=>{const r=await xe();e(r),n("files")}}),u(le,{pointSources:[{name:"blocks",color:"blue",radius:6,points:(b==null?void 0:b.data)?b.data.map(r=>({longitude:r.interior_lon,latitude:r.interior_lat,name:r.name,description:""})):[],clickPoint:(r,w)=>console.log(`Clicked ${r}: ${w}`)}],arrowSources:[{name:"velocity",color:"yellow",scale:.02,arrowHeadScale:.3,arrows:(x==null?void 0:x.data)?x.data.map(r=>{const w=Math.sqrt(r.east_vel*r.east_vel+r.north_vel*r.north_vel);return{longitude:r.lon,latitude:r.lat,direction:[r.east_vel/w,r.north_vel/w],scale:w,name:r.name,description:`north: ${r.north_vel}, east: ${r.east_vel}`}}):[]}]}),u(re,{view:l,buttons:i?Fe:void 0,active:t,setActive:r=>n(r)})]})}function ke(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:a,onRegisterError:s}=i;let c;const p=async(_=!0)=>{};return"serviceWorker"in navigator&&(c=new ee("./sw.js",{scope:"./"}),c.addEventListener("activated",_=>{_.isUpdate?window.location.reload():n==null||n()}),c.register({immediate:e}).then(_=>{a==null||a(_)}).catch(_=>{s==null||s(_)})),p}ke();const Le=1,$e=new te({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:Le}}});ne.render(u(g.exports.StrictMode,{children:u(ie,{client:$e,children:u(Se,{})})}),document.querySelector("#root"));
