var Dt=Object.defineProperty,$t=Object.defineProperties;var Ft=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var Vt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var se=(n,e,t)=>e in n?Dt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,f=(n,e)=>{for(var t in e||(e={}))Vt.call(e,t)&&se(n,t,e[t]);if(Ee)for(var t of Ee(e))Lt.call(e,t)&&se(n,t,e[t]);return n},v=(n,e)=>$t(n,Ft(e));var V=(n,e,t)=>(se(n,typeof e!="symbol"?e+"":e,t),t);import{j as c,a as b,F as M,r as N,M as jt,m as Pe,R as Mt,b as oe,u as It,c as Rt,l as Ae,d as ae,e as L,f as Ot,g as Bt,h as Et,v as Pt,Q as At,i as Tt,k as Ht,P as Wt}from"./vendor.6cf141b2.js";const zt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};zt();function Jt({value:n,fieldDefinition:e,setField:t}){const[o,s]=N.exports.useState(-1),[r,l]=N.exports.useState(n);return N.exports.useEffect(()=>{l(n)},[n]),b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[c("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?c("span",{className:"text-sm",children:e.description}):c(M,{})]}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof n=="number"?"number":"text",value:r,onChange:a=>{const h=typeof n=="number"?Number.parseFloat(a.target.value):a.target.value;l(h),o>-1&&clearTimeout(o),s(setTimeout(()=>t(h),1e3))}})})]})}function Z({title:n,items:e,setItems:t,fieldDefinitions:o,ignoreFields:s,deletable:r,controls:l}){const a=e[0],h=Object.keys(a).map((d,x)=>{if(s==null?void 0:s.includes(d))return{element:c("span",{style:{display:"hidden"}},d),order:x+1e4};let i=a[d];for(const _ of e)if(_[d]!==i){i="-";break}const y=d in o&&o[d];return y?{element:c(Jt,{value:i,fieldDefinition:y,setField:_=>t({[d]:_})},d),order:y.order}:{element:b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{"data-testid":`input-title-${d}`,className:"text-l font-bold",children:d}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{"data-testid":`input-editor-${d}`,className:"rounded w-full",type:typeof i=="number"?"number":"text",value:i,onChange:_=>{t({[d]:typeof i=="number"?Number.parseFloat(_.target.value):_.target.value})}})})]},d),order:x+1e3}}).sort((d,x)=>d.order-x.order).map(d=>d.element);return b("div",{className:"flex flex-col gap-2 border-2 rounded p-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{"data-testid":"editable-item-title",className:"text-xl font-bold grow-0",children:n}),b("span",{className:"flex flex-row justify-end gap-2 grow",children:[l,r?c("button",{type:"button",className:"rounded bg-white hover:bg-gray-200 p-2",onClick:()=>{t()},children:"Delete"}):c(M,{})]})]}),h]})}Z.defaultProps={ignoreFields:[],controls:c(M,{})};const Gt={color:"#0000ff",selectedColor:"#ff0000",radius:6,hide:!1};var ht;const Ut=JSON.parse((ht=window.localStorage.getItem("blockDisplaySettings"))!=null?ht:"false")||Gt;function qt({settings:n,setSettings:e,selected:t,blocks:o,setBlockData:s,addNewBlock:r}){const l=d=>{e(d),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(d))},a=t.map(d=>o[d]).filter(d=>d),h=a.length>0?c(Z,{title:a.length===1?a[0].name:"Edit Selected Blocks",items:a,deletable:!0,setItems:d=>s(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):c(M,{});return b(M,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Display"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{l(v(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.color,onChange:d=>{l(v(f({},n),{color:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Selected Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:d=>{l(v(f({},n),{selectedColor:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Radius"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:n.radius,onChange:d=>{l(v(f({},n),{radius:Number.parseFloat(d.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Add New Block"}),c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Block"})]}),h]})}function Kt({folder:n,files:e,setFile:t}){const o=Object.keys(e).map(s=>{const r=e[s];return b("div",{className:"flex flex-row justify-between items-center",children:[b("div",{className:"flex flex-col",children:[c("span",{className:"text-l font-bold","data-testid":`file-${s}-label`,children:r.name}),c("span",{className:"text-sm","data-testid":`file-${s}-description`,children:r.description})]}),c("span",{className:"w-2/5 flex-shrink-0",children:b("select",{"data-testid":`file-${s}-select`,className:"w-full rounded",value:r.currentFilePath,onChange:async l=>{const a=l.currentTarget.value;try{const h=await n.getFile(a);t(s,h.name,h)}catch{t(s,"")}},children:[c("option",{value:"","data-testid":`file-${s}-empty`,children:"\xA0"}),n.fileList.filter(l=>l.endsWith(r.extension)).map(l=>c("option",{value:l,"data-testid":`file-${s}-select-${l}`,children:l},l))]})})]},s)});return c("div",{className:"flex flex-col gap-2",children:o})}function Qt({view:n,buttons:e,active:t,setActive:o}){if(!e)return c("span",{});const s=[];for(const r of Object.keys(e)){const l=e[r],a=r===t;s.push(c("button",{type:"button","data-testid":`tab-${r}`,className:`${a?"bg-white":"bg-gray-200"} p-2 shadow-inner hover:bg-gray-100 rounded-t`,onClick:()=>o(a?"":r),children:l},r))}return b("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?c("div",{"data-testid":"inspector-view",className:"flex flex-col bg-white flex-grow rounded-tr p-2 shadow-sm overflow-y-auto",children:n}):"",c("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-300",children:s})]})}const Te={lon:0,lat:0},Xt=180,U=360;function He(n){let{lon:e,lat:t}=n;for(;e<0;)e+=U;for(;e>U;)e-=U;return[e,t]}function ie([n,e]){return{lon:n<0?n+U:n,lat:e}}function Zt(n,e){const t=He(n),o=He(e),s=[o[0],o[1]];return o[0]-t[0]>=Xt?s[0]-=U:s[0]+=U,Math.abs(t[0]-o[0])>Math.abs(t[0]-s[0])?[t,s]:[t,o]}const j=1e3;function A(n,e,t,o){const s=`${Math.floor(n.lon*j)},${Math.floor(n.lat*j)}`;if(s in e)return[e[s],o];const r=o;return t[r]=n,e[s]=r,[r,o+1]}function We(n,e){let t=!1;for(const o of n.segments)if(o.start===e||o.end===e){t=!0;break}if(!t&&n.vertecies[e]){const o=n.vertecies[e],s=`${Math.floor(o.lon*j)},${Math.floor(o.lat*j)}`,r=f({},n.vertecies);delete r[e];const l=f({},n.vertexDictionary);return delete l[s],v(f({},n),{vertecies:r,vertexDictionary:l})}return n}const T=Math.PI/6,H=2*Math.PI-T;function Yt(n,e,{map:t,popup:o,internalArrowSources:s,mapLoaded:r,internalSelections:l},{arrowSources:a,selections:h}){if(t&&r&&s!==a)if(console.log("Setting arrows in map!"),s){for(const i of s){const y=t.getSource(`arrow:${i.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:arrow:${i.name}`),t.removeLayer(`layer:arrow:${i.name}:click`)}e({internalArrowSources:void 0})}else{for(const i of a){let y=t.getSource(`arrow:${i.name}`);const _=y===void 0;_&&(t.addSource(`arrow:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`arrow:${i.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:i.arrows.map(p=>{var D;const m=p.scale*i.scale,w=i.scale*i.arrowHeadScale,k=[p.longitude+p.direction[0]*m,p.latitude+p.direction[1]*m],S=[k[0]+(Math.cos(T)*-p.direction[0]-Math.sin(T)*-p.direction[1])*w,k[1]+(Math.sin(T)*-p.direction[0]+Math.cos(T)*-p.direction[1])*w],J=[k[0]+(Math.cos(H)*-p.direction[0]-Math.sin(H)*-p.direction[1])*w,k[1]+(Math.sin(H)*-p.direction[0]+Math.cos(H)*-p.direction[1])*w];return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:(D=h[i.name])==null?void 0:D.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.longitude,p.latitude],k,S,k,J]}}})}),t.addLayer({id:`layer:arrow:${i.name}`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":i.width}}),t.addLayer({id:`layer:arrow:${i.name}:click`,type:"line",source:`arrow:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":10}}),_&&(t.on("mouseenter",`layer:arrow:${i.name}:click`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="Point"&&m.properties&&typeof m.properties.description=="string"&&m.properties.description){const w=[...m.geometry.coordinates],{description:k}=m.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;o.setLngLat(w).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:arrow:${i.name}:click`,()=>{o.remove()}),t.on("click",`layer:arrow:${i.name}:click`,p=>{let m;if(n.state.internalArrowSources)for(const k of n.state.internalArrowSources)m=k.click;if(!p.features||!m)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:k}=w.properties;m(k)}}))}e({internalArrowSources:a})}const d=f({},l);let x=!1;for(const i of Object.keys(h))if(h[i]!==l[i]){for(const y of a)if(y.name===i){x=!0,d[i]=h[i];const _=t==null?void 0:t.getSource(`arrow:${y.name}`);if(_){const p=h[i];_.setData({type:"FeatureCollection",features:y.arrows.map(m=>{const w=m.scale*y.scale,k=y.scale*y.arrowHeadScale,S=[m.longitude+m.direction[0]*w,m.latitude+m.direction[1]*w],J=[S[0]+(Math.cos(T)*-m.direction[0]-Math.sin(T)*-m.direction[1])*k,S[1]+(Math.sin(T)*-m.direction[0]+Math.cos(T)*-m.direction[1])*k],D=[S[0]+(Math.cos(H)*-m.direction[0]-Math.sin(H)*-m.direction[1])*k,S[1]+(Math.sin(H)*-m.direction[0]+Math.cos(H)*-m.direction[1])*k];return{type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:p==null?void 0:p.includes(m.index)},geometry:{type:"LineString",coordinates:[[m.longitude,m.latitude],S,J,S,D]}}})})}}}x&&e({internalSelections:d})}function en(n,{map:e,draw:t,drawnPointSettings:o,mapLoaded:s,internalDrawnPointSource:r},{drawnPointSource:l}){if(e&&s&&r!==l){console.log("Drawning Points"),n({internalDrawnPointSource:l});let a=t;if((l.selectedColor!==o.selectedColor||l.selectedRadius!==o.selectedRadius||l.color!==o.color||l.radius!==o.radius)&&(n({drawnPointSettings:{color:l.color,radius:l.radius,selectedRadius:l.selectedRadius,selectedColor:l.selectedColor}}),t&&(e.removeControl(t),a=void 0),l?(a=new jt({displayControlsDefault:!1,defaultMode:"simple_select",styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":l.selectedRadius,"circle-color":l.selectedColor,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}},{id:"points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":l.radius,"circle-color":l.color,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}]}),e.addControl(a),n({draw:a})):a=void 0),a){const h=a.getAll(),d=l.points.length!==h.features.length?void 0:a.getSelected(),x={type:"FeatureCollection",features:l.points.map(i=>({type:"Feature",id:i.index.toString(),properties:{description:"",index:i.index,name:""},geometry:{type:"Point",coordinates:[i.longitude,i.latitude]}}))};if(a.set(x),d&&d.features.length>0&&d.features[0].properties&&typeof d.features[0].properties.index=="number"){const i=d.features[0].id;i&&a.changeMode("simple_select",{featureIds:[i]})}}}}const E="grid";function tn(n,e,{map:t,internalGridDisplay:o,popup:s,mapLoaded:r},{displayGrid:l}){if(t&&r&&o!==l){if(console.log("Drawing Grid on map!"),o&&o>0){const a=t.getSource(E);a!==void 0&&a.setData({type:"FeatureCollection",features:[]}),t.removeLayer(E),e({internalGridDisplay:void 0})}else if(l&&l>0){let a=t.getSource(E);const h=a===void 0;if(h&&(t.addSource(E,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a=t.getSource(E)),a!==void 0){const d=[];for(let x=-170;x<=180;x+=l)d.push({type:"Feature",properties:{label:`Lon: ${x<0?x+360:x}`},geometry:{type:"LineString",coordinates:[[x,-90],[x,90]]}});for(let x=-90;x<=90;x+=l)d.push({type:"Feature",properties:{label:`Lat: ${x}`},geometry:{type:"LineString",coordinates:[[180,x],[-180,x]]}});a.setData({type:"FeatureCollection",features:d})}t.addLayer({id:E,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.2)","line-width":1}}),t.addLayer({id:`${E}:click`,type:"line",source:E,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":5}}),h&&(t.on("mouseenter",`${E}:click`,d=>{if(!d.features)return;const x=d.features[0];x.geometry.type==="LineString"&&x.properties&&typeof x.properties.label=="string"&&s.setLngLat(d.lngLat).setHTML(`${x.properties.label}`).addTo(t)}),t.on("mouseleave",`${E}:click`,()=>{s.remove()}))}e({internalGridDisplay:l})}}function nn(n,e,{map:t,popup:o,internalLineSources:s,mapLoaded:r,internalSelections:l},{lineSources:a,selections:h}){if(t&&r&&s!==a)if(console.log("Setting lines in map!"),s){for(const i of s){const y=t.getSource(`line:${i.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:line:${i.name}`),t.removeLayer(`layer:line:${i.name}:click`)}e({internalLineSources:void 0})}else{for(const i of a){let y=t.getSource(`line:${i.name}`);const _=y===void 0;_&&(t.addSource(`line:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`line:${i.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:i.lines.map(p=>{var m;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:(m=h[i.name])==null?void 0:m.includes(p.index)},geometry:{type:"LineString",coordinates:[[p.startLongitude,p.startLatitude],[p.endLongitude,p.endLatitude]]}}})}),t.addLayer({id:`layer:line:${i.name}`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":["case",["get","selected"],i.selectedColor,i.color],"line-width":["case",["get","selected"],i.selectedWidth,i.width]}}),t.addLayer({id:`layer:line:${i.name}:click`,type:"line",source:`line:${i.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":"rgba(0,0,0,0.01)","line-width":i.width*10}}),_&&(t.on("mouseenter",`layer:line:${i.name}:click`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="LineString"&&m.properties&&typeof m.properties.description=="string"&&m.properties.description){const w=[(m.geometry.coordinates[0][0]+m.geometry.coordinates[1][0])/2,(m.geometry.coordinates[0][1]+m.geometry.coordinates[1][1])/2],{description:k}=m.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;o.setLngLat(w).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:line:${i.name}:click`,()=>{o.remove()}),t.on("click",`layer:line:${i.name}:click`,p=>{let m;if(n.state.internalLineSources)for(const k of n.state.internalLineSources)m=k.click;if(!p.features||!m)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:k}=w.properties;m(k)}}))}e({internalLineSources:a})}const d=f({},l);let x=!1;for(const i of Object.keys(h))if(h[i]!==l[i]){for(const y of a)if(y.name===i){x=!0,d[i]=h[i];const _=t==null?void 0:t.getSource(`line:${y.name}`);if(_){const p=h[i];_.setData({type:"FeatureCollection",features:y.lines.map(m=>({type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:p==null?void 0:p.includes(m.index)},geometry:{type:"LineString",coordinates:[[m.startLongitude,m.startLatitude],[m.endLongitude,m.endLatitude]]}}))})}}}x&&e({internalSelections:d})}function sn(n,e,{map:t,popup:o,internalPointSources:s,mapLoaded:r,internalSelections:l},{pointSources:a,selections:h}){if(!t||!r)return;if(s!==a)if(console.log("Setting points in map!"),s){for(const i of s){const y=t.getSource(`point:${i.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),t.removeLayer(`layer:point:${i.name}`)}e({internalPointSources:void 0})}else{for(const i of a){let y=t.getSource(`point:${i.name}`);const _=y===void 0;_&&(t.addSource(`point:${i.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=t.getSource(`point:${i.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:i.points.map(p=>{var m;return{type:"Feature",properties:{description:p.name||p.description?`<strong>${p.name}</strong><p>${p.description}</p>`:"",index:p.index,name:p.name,selected:!((m=h[i.name])==null?void 0:m.includes(p.index))},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}})}),t.addLayer({id:`layer:point:${i.name}`,type:"circle",source:`point:${i.name}`,paint:{"circle-color":["case",["get","selected"],i.color,i.selectedColor],"circle-radius":i.radius}}),_&&(t.on("mouseenter",`layer:point:${i.name}`,p=>{if(!p.features)return;const m=p.features[0];if(m.geometry.type==="Point"&&m.properties&&typeof m.properties.description=="string"&&m.properties.description){const w=[...m.geometry.coordinates],{description:k}=m.properties;for(;Math.abs(p.lngLat.lng-w[0])>180;)w[0]+=p.lngLat.lng>w[0]?360:-360;o.setLngLat(w).setHTML(k).addTo(t)}}),t.on("mouseleave",`layer:point:${i.name}`,()=>{o.remove()}),t.on("click",`layer:point:${i.name}`,p=>{let m;if(n.state.internalPointSources)for(const k of n.state.internalPointSources)m=k.click;if(!p.features||!m)return;const w=p.features[0];if(w.properties&&typeof w.properties.index=="number"&&typeof w.properties.name=="string"){const{index:k}=w.properties;m(k)}}))}e({internalPointSources:a})}const d=f({},l);let x=!1;for(const i of Object.keys(h))if(h[i]!==l[i]){for(const y of a)if(y.name===i){x=!0,d[i]=h[i];const _=t.getSource(`point:${y.name}`);if(_){const p=h[i];_.setData({type:"FeatureCollection",features:y.points.map(m=>({type:"Feature",properties:{description:`<strong>${m.name}</strong><p>${m.description}</p>`,index:m.index,name:m.name,selected:!(p==null?void 0:p.includes(m.index))},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}}))})}}}x&&e({internalSelections:d})}Pe.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";class on extends Mt.Component{constructor(e){super(e);this.state={drawnPointSettings:{selectedColor:"",selectedRadius:0,color:"",radius:0},internalSelections:{},mapReference:N.exports.createRef(),popup:new oe.exports.Popup({closeButton:!1,closeOnClick:!1})}}componentDidMount(){const{mapReference:e}=this.state,t=typeof e=="object"?e==null?void 0:e.current:void 0;if(Pe.accessToken&&t){const o=new oe.exports.Map({container:t,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});o.addControl(new oe.exports.NavigationControl),this.setState({map:o}),o.on("load",()=>{this.setState({mapLoaded:!0})}),o.on("click",({lngLat:s})=>{const{click:r}=this.props;r(ie([s.lng,s.lat]))}),o.on("mousemove",({lngLat:s})=>{const{mouseMove:r}=this.props;r&&r(ie([s.lng,s.lat]))}),o.on("draw.selectionchange",({features:s})=>{const{internalDrawnPointSource:r}=this.state;if(!r||!(r==null?void 0:r.select))return;const l=s.map(a=>a&&a.type==="Feature"&&a.geometry.type==="Point"&&a.properties&&"index"in a.properties&&typeof a.properties.index=="number"?a.properties.index:-1).filter(a=>a>-1);r.select(l)}),o.on("draw.update",({features:s,action:r})=>{const{internalDrawnPointSource:l}=this.state;if(!!(l==null?void 0:l.update)&&r==="move"&&s.length>0)for(const a of s)a.type==="Feature"&&a.geometry.type==="Point"&&a.properties&&"index"in a.properties&&typeof a.properties.index=="number"&&l.update(a.properties.index,ie(a.geometry.coordinates))})}}componentDidUpdate(){return tn(this,e=>this.setState(e),this.state,this.props),nn(this,e=>this.setState(e),this.state,this.props),Yt(this,e=>this.setState(e),this.state,this.props),sn(this,e=>this.setState(e),this.state,this.props),en(e=>this.setState(e),this.state,this.props),!1}render(){const{mapReference:e}=this.state;return c("div",{"data-testid":"map",className:"w-full h-full",ref:e})}}const an={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2,vertexColor:"#ffff00",activeVertexColor:"#00ffff",vertexRadius:3,activeVertexRadius:3,hide:!1};var gt;const rn=f(f({},an),JSON.parse((gt=window.localStorage.getItem("segmentDisplaySettings"))!=null?gt:"{}"));function ln({settings:n,setSettings:e,segments:t,selected:o,setSegmentData:s,addNewSegment:r,splitSegment:l,setSelectionMode:a}){const h=i=>{e(i),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(i))},d=o.map(i=>t[i]).filter(i=>i),x=d.length>0?c(Z,{title:d.length===1?d[0].name:"Edit Selected Segments",items:d,ignoreFields:["lon1","lat1","lon2","lat2","start","end"],deletable:!0,setItems:i=>s(o,i),fieldDefinitions:{name:{order:0,name:"Name",description:"The Segment Name",type:"string"}},controls:c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>l(o),children:"Split Segment"})}):c(M,{});return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Display"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{h(v(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.color,onChange:i=>{h(v(f({},n),{color:i.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Width"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:i=>{h(v(f({},n),{width:Number.parseFloat(i.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Active Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:i=>{h(v(f({},n),{activeColor:i.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Active Width"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.activeWidth,onChange:i=>{h(v(f({},n),{activeWidth:Number.parseFloat(i.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Add New Segment"}),c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{a({mode:"mapClick",label:"Select Segment Starting Point",callback:i=>{a({mode:"mapClick",label:"Select Segment End point",callback:y=>{r(i,y),a("normal")}})}})},children:"New Segment"})]}),x]})}const ze=()=>It(),Y=Rt;function cn({folder:n,openFolder:e,filesOpen:t,saveFiles:o}){function s(){e()}const r=ze(),[l,a]=Y(h=>[h.main.past.length>0,h.main.future.length>0]);return b("div",{"data-testid":"topbar",className:"p-2 bg-gray-900 text-white flex flex-row justify-between",children:[c("h3",{className:"text-lg font-bold",children:"celeri_ui"}),b("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[n?c("button",{type:"button",onClick:()=>{r(Ae.ActionCreators.undo())},"data-testid":"undo-button",disabled:!l,children:"Undo"}):c(M,{}),n?c("button",{type:"button",onClick:()=>{r(Ae.ActionCreators.redo())},disabled:!a,"data-testid":"undo-button",children:"Redo"}):c(M,{}),n?b("span",{children:["Working in ",n.name]}):c("button",{type:"button",onClick:s,"data-testid":"open-folder-button",children:"Open Folder"}),t?c("button",{type:"button",onClick:o,"data-testid":"save-file-button",children:"Save Files"}):c(M,{})]})]})}const dn={color:"#ffffff",scale:.02,width:1,arrowHead:1,selectedColor:"#aaaaaa",hide:!1};var yt;const un=JSON.parse((yt=window.localStorage.getItem("velocityDisplaySettings"))!=null?yt:"false")||dn;function fn({settings:n,setSettings:e,selected:t,velocitys:o,setVelocityData:s,addNewVelocity:r}){const l=d=>{e(d),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(d))},a=t.map(d=>o[d]).filter(d=>d),h=a.length>0?c(Z,{title:a.length===1?a[0].name:"Edit Selected Velocities",items:a,deletable:!0,setItems:d=>s(t,d),fieldDefinitions:{name:{order:0,name:"Name",description:"The Velocity Name",type:"string"}}}):c(M,{});return b(M,{children:[b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Display"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{l(v(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.color,onChange:d=>{l(v(f({},n),{color:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Selected Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.selectedColor,onChange:d=>{l(v(f({},n),{selectedColor:d.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Scale"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:n.scale,onChange:d=>{l(v(f({},n),{scale:Number.parseFloat(d.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Width"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:n.width,onChange:d=>{l(v(f({},n),{width:Number.parseFloat(d.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Arrow Head Size"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:n.arrowHead,onChange:d=>{l(v(f({},n),{arrowHead:Number.parseFloat(d.target.value)}))}})})]})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Add New Velocity"}),c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:r,children:"New Velocity"})]}),h]})}const mn={color:"#ffff00",activeColor:"#00ffff",radius:3,activeRadius:3,hide:!1};var xt;const pn=f(f({},mn),JSON.parse((xt=window.localStorage.getItem("vertexDisplaySettings"))!=null?xt:"{}"));function hn({settings:n,setSettings:e,vertices:t,selected:o,setVertexData:s,setSelectionMode:r,mergeVertices:l,bridgeVertices:a,extrudeVertex:h}){const d=y=>{e(y),window.localStorage.setItem("vertexDisplaySettings",JSON.stringify(y))},i=o.map((y,_)=>({selectedVertex:t[y],index:_})).filter(y=>y.selectedVertex).map(({selectedVertex:y,index:_})=>c(Z,{title:"Selected Vertex",items:[y],ignoreFields:[],deletable:!1,setItems:p=>s(_,f(f({},y),p)),fieldDefinitions:{},controls:b(M,{children:[c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Merge Vertices",subtitle:"Click the vertex you want to merge with",callback:p=>{l(_,p[0]),r("normal")}})},children:"Merge"}),c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({type:"vertex",mode:"override",label:"Bridge Vertices",subtitle:"Click the vertex you want to bridge to",callback:p=>{a(_,p[0]),r("normal")}})},children:"Bridge"}),c("button",{type:"button",className:"rounded bg-gray-700 text-white hover:bg-gray-800 p-2",onClick:()=>{r({mode:"mapClick",label:"Extrude Segment From Vertex",subtitle:"Click the point you want to extrude to",callback:p=>{h(_,p),r("normal")}})},children:"Extrude"})]})},_));return b("div",{className:"flex flex-col gap-2",children:[b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Display"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"form-check-input appearance-none w-9 -ml-10 rounded-full float-left h-5 align-top bg-white bg-no-repeat bg-contain bg-gray-300 focus:outline-none cursor-pointer shadow-sm",type:"checkbox",role:"switch",checked:!n.hide,onChange:()=>{d(v(f({},n),{hide:!n.hide}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.color,onChange:y=>{d(v(f({},n),{color:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Radius"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.radius,onChange:y=>{d(v(f({},n),{radius:Number.parseFloat(y.target.value)}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Active Color"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"color",value:n.activeColor,onChange:y=>{d(v(f({},n),{activeColor:y.target.value}))}})})]}),b("div",{className:"flex flex-row justify-between items-center",children:[c("span",{className:"text-l font-bold",children:"Active Radius"}),c("span",{className:"w-2/5 flex-shrink-0",children:c("input",{className:"rounded w-full",type:"range",min:"0.1",max:"5",step:"0.1",value:n.activeRadius,onChange:y=>{d(v(f({},n),{activeRadius:Number.parseFloat(y.target.value)}))}})})]}),i]})}const Je=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Ge={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function gn(n){return n?f(f({},Ge),n):f({},Ge)}function yn(n,{data:e}){return[...n,gn(e)]}function xn(n,e){const t=[];for(const[o,s]of n.entries())e.includes(o)||t.push(s);return t}function vn(n,e){const t=[...n];for(const o of e.indices){const s=f(f({},t[o]),e.data);t[o]=s}return t}function bn(n,e){return e}function wn(n,{index:e,position:t}){const o=[...n],s=f({},o[e]);return s.interior_lat=t.lat,s.interior_lon=t.lon,o[e]=s,o}const _n=[],Ue=L("createBlock"),qe=L("editBlock"),Ke=L("deleteBlock"),re=L("loadNewBlockData"),Qe=L("moveBlock"),kn=ae(_n,n=>{n.addCase(Ue,(e,t)=>yn(e,t.payload)).addCase(qe,(e,t)=>vn(e,t.payload)).addCase(Ke,(e,t)=>xn(e,t.payload)).addCase(re,(e,t)=>bn(e,t.payload)).addCase(Qe,(e,t)=>wn(e,t.payload))}),Xe=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],q={name:"new_segment",lon1:0,lat1:0,lon2:10,lat2:10,dip:90,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:15,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Nn(n,{a:e,b:t}){const o=v(f({},q),{start:e,end:t}),s=[...n.segments,o];return v(f({},n),{segments:s})}function Sn(n,e){const t=f({},n.vertecies),o=f({},n.vertexDictionary),{lastIndex:s}=n,[r,l]=A(e.start,o,t,s),[a,h]=A(e.end,o,t,l),d=v(f({},q),{start:r,end:a}),x=[...n.segments,d];return{vertecies:t,vertexDictionary:o,segments:x,lastIndex:h}}function Cn(n,e){const t=[],o=[];let s=f({},n);for(const[r,l]of n.segments.entries())e.index.includes(r)?o.push(l):t.push(l);s.segments=t;for(const r of o)s=We(We(s,r.start),r.end);return s}function Dn(n,e){const t=[...n.segments];for(const o of e.indices){const s=f(f({},t[o]),e.data);t[o]=s}return v(f({},n),{segments:t})}function $n(n,e){const t=f({},n.vertecies),o=f({},n.vertexDictionary),[s,r]=A(e.targetPoint,o,t,n.lastIndex),l=v(f({},q),{start:e.index,end:s}),a=[...n.segments,l];return{vertecies:t,vertexDictionary:o,segments:a,lastIndex:r}}function Fn(n,e){return e}function Vn(n,{a:e,b:t}){if(e===t)return n;const o=n.segments.map(h=>{let d=h;return d.start===t&&(d=v(f({},d),{start:e})),d.end===t&&(d=v(f({},d),{end:e})),d}).filter(h=>h.start!==h.end),s=n.vertecies[t],r=`${Math.floor(s.lon*j)},${Math.floor(s.lat*j)}`,l=f({},n.vertecies);delete l[t];const a=f({},n.vertexDictionary);return delete a[r],v(f({},n),{vertecies:l,vertexDictionary:a,segments:o})}function Ln(n,{index:e,vertex:t}){const o=f({},n.vertecies),s=f({},n.vertexDictionary),r=[...n.segments],l=o[e],a=`${Math.floor(t.lon*j)},${Math.floor(t.lat*j)}`,h=`${Math.floor(l.lon*j)},${Math.floor(l.lat*j)}`;if(delete s[h],a in s){const d=s[a];for(const x of r)x.start===d&&(x.start=e),x.end===d&&(x.end=e);delete o[d]}return o[e]=t,v(f({},n),{segments:r,vertecies:o,vertexDictionary:s})}function jn(n,e){const t=f({},n.vertecies),o=f({},n.vertexDictionary),s=[...n.segments];let{lastIndex:r}=n;for(const l of e){const a=n.segments[l],h=n.vertecies[a.start],d=n.vertecies[a.end],x={lon:(h.lon+d.lon)/2,lat:(h.lat+d.lat)/2},[i,y]=A(x,o,t,r);r=y;const _=v(f({},a),{end:i,name:`${a.name}_a`}),p=v(f({},a),{start:i,name:`${a.name}_b`});s[l]=_,s.push(p)}return{vertecies:t,vertexDictionary:o,segments:s,lastIndex:r}}const Mn={vertecies:{},lastIndex:0,segments:[],vertexDictionary:{}},Ze=L("bridgeVertices"),Ye=L("createSegmet"),et=L("deleteSegment"),tt=L("editSegmentData"),nt=L("extrudeSegment"),le=L("loadNewSegmentData"),st=L("mergeVertices"),ce=L("moveVertex"),ot=L("splitSegment"),In=ae(Mn,n=>{n.addCase(Ze,(e,t)=>Nn(e,t.payload)).addCase(Ye,(e,t)=>Sn(e,t.payload)).addCase(et,(e,t)=>Cn(e,t.payload)).addCase(tt,(e,t)=>Dn(e,t.payload)).addCase(nt,(e,t)=>$n(e,t.payload)).addCase(le,(e,t)=>Fn(e,t.payload)).addCase(st,(e,t)=>Vn(e,t.payload)).addCase(ce,(e,t)=>Ln(e,t.payload)).addCase(ot,(e,t)=>jn(e,t.payload))}),at=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"],Rn={lon:0,lat:0,corr:0,other1:0,name:"",east_vel:0,north_vel:0,east_sig:0,north_sig:0,flag:0,up_vel:0,up_sig:0,east_adjust:0,north_adjust:0,up_adjust:0};function On(n){return f(f({},Rn),n)}function Bn(n,{data:e}){return[...n,On(e)]}function En(n,e){const t=[];for(const[o,s]of n.entries())e.includes(o)||t.push(s);return t}function Pn(n,e){const t=[...n];for(const o of e.indices){const s=f(f({},t[o]),e.data);t[o]=s}return t}function An(n,e){return e}function Tn(n,{index:e,position:t}){const o=[...n],s=f(f({},o[e]),t);return o[e]=s,o}const Hn=[],it=L("createVelocity"),rt=L("editVelocity"),lt=L("deleteVelocity"),de=L("loadNewVelocityData"),ct=L("moveVelocity"),Wn=ae(Hn,n=>{n.addCase(it,(e,t)=>Bn(e,t.payload)).addCase(rt,(e,t)=>Pn(e,t.payload)).addCase(lt,(e,t)=>En(e,t.payload)).addCase(de,(e,t)=>An(e,t.payload)).addCase(ct,(e,t)=>Tn(e,t.payload))});function ue(n){const e=n.split(/\n/g),t=e[0].split(","),o=e.slice(1),s=[];for(const r of o)if(r.trim()!==""){const l=r.split(/\s*,\s*/),a={};for(let h=0;h<t.length;h+=1){let d=l[h];const x=t[h],i=Number.parseFloat(d);d=Number.isNaN(i)?d:i,typeof d=="string"&&d.startsWith('"')&&d.endsWith('"')&&(d=d.slice(1,-1)),a[x]=d}s.push(a)}return s}function fe(n,e){const t=[e.join(",")];for(const o of n){const s=o;t.push(e.map(r=>r in s?typeof s[r]=="string"&&/\s/.test(`${s[r]}`)?`"${s[r]}"`:`${s[r]}`:"").join(","))}return t.join(`
`)}class me{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=ue(e).map(s=>{const r={};for(const l of Je)r[l]=s[l]||(l==="name"?"":0);return r});this.data=o}async save(){var t;const e=fe((t=this.data)!=null?t:[],Je);await this.handle.setContents(e)}clone(){return new me(this.handle)}}const zn={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function Jn(n){return f(f({},zn),n)}class pe{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=Jn(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new pe(this.handle)}}class he{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=ue(e).map(h=>{const d={};for(const x of Xe)d[x]=h[x]||(x==="name"?"":0);return d}),s={},r={},l=[];let a=0;for(const h of o){const[d,x]=A({lon:h.lon1,lat:h.lat1},s,r,a),[i,y]=A({lon:h.lon2,lat:h.lat2},s,r,x),_=v(f({},h),{start:d,end:i});a=y,l.push(_)}this.data={vertecies:r,segments:l,vertexDictionary:s,lastIndex:a}}async save(){let e=[];if(this.data){const{vertecies:o,segments:s}=this.data;e=s.map(r=>{const l=o[r.start],a=o[r.end];return v(f({},r),{lon1:l.lon,lat1:l.lat,lon2:a.lon,lat2:a.lat})})}const t=fe(e,Xe);await this.handle.setContents(t)}clone(){return new he(this.handle)}tryRemoveVertex(e){if(this.data){let t=!1;for(const o of this.data.segments)if(o.start===e||o.end===e){t=!0;break}if(!t&&this.data.vertecies[e]){const o=this.data.vertecies[e],s=`${Math.floor(o.lon*j)},${Math.floor(o.lat*j)}`,r=f({},this.data.vertecies);delete r[e];const l=f({},this.data.vertexDictionary);delete l[s];const a=this.clone();return a.data=v(f({},this.data),{vertecies:r,vertexDictionary:l}),a}}return this}mergeVertices(e,t){if(this.data){for(const h of this.data.segments)h.start===t&&(h.start=e),h.end===t&&(h.end=e);const o=this.data.vertecies[t],s=`${Math.floor(o.lon*j)},${Math.floor(o.lat*j)}`,r=f({},this.data.vertecies);delete r[t];const l=f({},this.data.vertexDictionary);delete l[s];const a=this.clone();return a.data=v(f({},this.data),{vertecies:r,vertexDictionary:l}),a}return this}moveVertex(e,t){if(this.data){const o=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),r=[...this.data.segments],l=o[e],a=`${Math.floor(t.lon*j)},${Math.floor(t.lat*j)}`,h=`${Math.floor(l.lon*j)},${Math.floor(l.lat*j)}`;if(delete s[h],a in s){const x=s[a];for(const i of r)i.start===x&&(i.start=e),i.end===x&&(i.end=e);delete o[x]}o[e]=t;const d=this.clone();return d.data=v(f({},this.data),{segments:r,vertecies:o,vertexDictionary:s}),d}return this}splitSegment(e){if(this.data){const t=this.data.segments[e],o=this.data.vertecies[t.start],s=this.data.vertecies[t.end],r={lon:(o.lon+s.lon)/2,lat:(o.lat+s.lat)/2},[l,a]=A(r,this.data.vertexDictionary,this.data.vertecies,this.data.lastIndex),h=v(f({},t),{end:l,name:`${t.name}_a`}),d=v(f({},t),{start:l,name:`${t.name}_b`}),x=[...this.data.segments];x[e]=h,x.push(d);const i=this.clone();return i.data=v(f({},this.data),{segments:x,lastIndex:a}),i}return this}bridgeVertices(e,t){if(this.data){const o=v(f({},q),{start:e,end:t}),s=[...this.data.segments,o],r=this.clone();return r.data=v(f({},this.data),{segments:s}),r}return this}extrudeSegment(e,t){if(this.data){const o=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),[r,l]=A(t,s,o,this.data.lastIndex),a=v(f({},q),{start:e,end:r}),h=[...this.data.segments,a],d=this.clone();return d.data={vertecies:o,vertexDictionary:s,segments:h,lastIndex:l},d}return this}deleteSegment(e){if(this.data){const t=[...this.data.segments],o=t.splice(e,1)[0],s=this.clone();return s.data=v(f({},this.data),{segments:t}),s.tryRemoveVertex(o.start).tryRemoveVertex(o.end)}return this}createSegment(e,t){if(this.data){const o=f({},this.data.vertecies),s=f({},this.data.vertexDictionary),[r,l]=A(e,s,o,this.data.lastIndex),[a,h]=A(t,s,o,l),d=v(f({},q),{start:r,end:a}),x=[...this.data.segments,d],i=this.clone();return i.data={vertecies:o,vertexDictionary:s,segments:x,lastIndex:h},i}return this}}class ge{constructor(e){V(this,"handle");V(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),o=ue(e).map(s=>{const r={};for(const l of at)r[l]=s[l]||(l==="name"?"":0);return r});this.data=o}async save(){var t;const e=fe((t=this.data)!=null?t:[],at);await this.handle.setContents(e)}clone(){return new ge(this.handle)}}async function dt(n){const e=new he(n);return await e.initialize(),e}async function ut(n){const e=new me(n);return await e.initialize(),e}async function ft(n){const e=new ge(n);return await e.initialize(),e}async function Gn(n,e,t){const o=new pe(e);if(await o.initialize(),o.data){const s=await dt(await n.getFile(o.data.segment_file_name)),r=await ut(await n.getFile(o.data.block_file_name)),l=await ft(await n.getFile(o.data.station_file_name)),a=f({},t);return"command"in a&&(a.command=v(f({},a.command),{currentFilePath:e.name})),"segment"in a&&(a.segment=v(f({},a.segment),{currentFilePath:o.data.segment_file_name})),"block"in a&&(a.block=v(f({},a.block),{currentFilePath:o.data.block_file_name})),"velocities"in a&&(a.velocities=v(f({},a.velocities),{currentFilePath:o.data.station_file_name})),{openableFiles:a,commands:o,segments:s,blocks:r,velocities:l}}throw new Error("Can't open command file")}class Un{constructor(e){V(this,"name");V(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class ye{constructor(e){V(this,"name");V(this,"handle");V(this,"fileList");V(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Un(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),o=new ye(t);return await o.initialize(),o}}const qn=async()=>{const n=await window.showDirectoryPicker(),e=new ye(n);return await e.initialize(),e};class Kn{constructor(e,t){V(this,"name");V(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class xe{constructor(e,t){V(this,"name");V(this,"parent");V(this,"fileList");V(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const o=t[e];for(const s of Object.keys(o))typeof o[s]=="string"?this.fileList.push(s):this.folderList.push(s)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Kn(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new xe(e,this.parent[this.name])}}const Qn=async n=>new xe("root",n);let mt=async()=>{var e;return Qn((e=window.FakeDirectory)!=null?e:{})};function Xn(n){mt=n}async function Zn(){return mt()}window.location.search.includes("fake-dir")||Xn(qn);var P;(function(n){n.Vertex="Vertices",n.Block="Blocks",n.Velocity="Velocities"})(P||(P={}));const pt={Block:P.Block,Vertex:P.Vertex,Velocity:P.Velocity},Yn={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities",vertex:"Vertices"};function es(){var Me,Ie,Re;const n=ze(),[e,t]=N.exports.useState(),[o,s]=N.exports.useState(""),[r,l]=N.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[a,h]=N.exports.useState(),[d,x]=N.exports.useState(),[i,y]=N.exports.useState(),[_,p]=N.exports.useState(),m=Y(u=>u.main.present.segment),w=Y(u=>u.main.present.block),k=Y(u=>u.main.present.velocity),[S,J]=N.exports.useState(un),[D,ve]=N.exports.useState(Ut),[B,be]=N.exports.useState(rn),[$,we]=N.exports.useState(pn),[R,W]=N.exports.useState("normal"),[z,vt]=N.exports.useState(P.Vertex),[ee,_e]=N.exports.useState([]),[ke,Ne]=N.exports.useState([]),[Se,Ce]=N.exports.useState([]),[De,$e]=N.exports.useState([]),[F,as]=N.exports.useState({select:(u,g)=>{_e(u==="block"?g:[]),Ne(u==="segment"?g:[]),Ce(u==="velocities"?g:[]),$e(u==="vertex"?g:[]),s(u)}}),[bt,wt]=N.exports.useState([]),[_t,Fe]=N.exports.useState([]),[kt,Ve]=N.exports.useState([]),[Nt,te]=N.exports.useState({color:$.color,selectedColor:$.activeColor,radius:$.radius,selectedRadius:$.activeRadius,points:[]}),[Le,St]=N.exports.useState({lon:0,lat:0}),[ne,Ct]=N.exports.useState(!1);N.exports.useEffect(()=>{R==="normal"?F.select=(u,g)=>{_e(u==="block"?g:[]),Ne(u==="segment"?g:[]),Ce(u==="velocities"?g:[]),$e(u==="vertex"?g:[]),s(u)}:R.mode==="override"?F.select=(u,g)=>{u===R.type&&R.callback(g)}:F.select=()=>{}},[R,F]),N.exports.useEffect(()=>{const u=[];z!==P.Block&&!D.hide&&u.push({name:"blocks",color:D.color,selectedColor:D.selectedColor,radius:D.radius,points:w.map((g,C)=>({longitude:g.interior_lon,latitude:g.interior_lat,name:g.name,description:"",index:C})),click:g=>{F.select("block",[g])}}),z!==P.Vertex&&!$.hide&&u.push({name:"vertices",color:$.color,selectedColor:$.activeColor,radius:$.radius,click:g=>{F.select("vertex",[g])},points:Object.keys(m.vertecies).map(g=>{const C=Number.parseInt(g,10),O=m.vertecies[C];return O?{longitude:O.lon,latitude:O.lat,index:C,name:"",description:""}:!1}).filter(g=>!!g)}),wt(u)},[D,w,B,F,z,$.hide,$.color,$.activeColor,$.radius,m.vertecies]),N.exports.useEffect(()=>{B.hide?Ve([]):Ve([{name:"segments",color:B.color,selectedColor:B.activeColor,width:B.width,selectedWidth:B.activeWidth,lines:m.segments.map((u,g)=>{var Oe,Be;const C=(Oe=m.vertecies[u.start])!=null?Oe:Te,O=(Be=m.vertecies[u.end])!=null?Be:Te,[[K,Q],[X,I]]=Zt(C,O);return{startLongitude:K,startLatitude:Q,endLongitude:X,endLatitude:I,name:u.name,description:`${C.lon},${C.lat} to ${O.lon},${O.lat}`,index:g}}),click:u=>{F.select("segment",[u])}}])},[m,B,F]),N.exports.useEffect(()=>{switch(z){case P.Vertex:{te({color:$.color,radius:$.radius,selectedColor:$.activeColor,selectedRadius:$.activeRadius,points:$.hide?[]:Object.keys(m.vertecies).map(u=>{const g=Number.parseInt(u,10),C=m.vertecies[g];return C?{longitude:C.lon,latitude:C.lat,index:g}:!1}).filter(u=>!!u),update:(u,g)=>{n(ce({index:u,vertex:g}))},select:u=>{F.select("vertex",u)}});break}case P.Block:{te({color:D.color,radius:D.radius,selectedColor:D.selectedColor,selectedRadius:D.radius,points:D.hide?[]:w.map((u,g)=>({longitude:u.interior_lon,latitude:u.interior_lat,name:u.name,description:"",index:g})),update:(u,g)=>{n(Qe({index:u,position:g}))},select:u=>{F.select("block",u)}});break}case P.Velocity:{te({color:S.color,radius:S.width,selectedColor:S.selectedColor,selectedRadius:S.width,points:S.hide?[]:k.map((u,g)=>({longitude:u.lon,latitude:u.lat,name:u.name,description:"",index:g})),update:(u,g)=>{n(ct({index:u,position:g}))},select:u=>{F.select("velocities",u)}});break}}},[$,F,m.vertecies,n,z,D.color,D.radius,D.selectedColor,D.hide,w,S.color,S.width,S.selectedColor,S.hide,k]),N.exports.useEffect(()=>{S.hide?Fe([]):Fe([{name:"velocities",color:S.color,selectedColor:S.selectedColor,scale:S.scale,arrowHeadScale:S.arrowHead,width:S.width,arrows:k.map((u,g)=>{const C=Math.sqrt(u.east_vel*u.east_vel+u.north_vel*u.north_vel);return{longitude:u.lon,latitude:u.lat,direction:[u.east_vel/C,u.north_vel/C],scale:C,name:u.name,description:`north: ${u.north_vel}, east: ${u.east_vel}`,index:g}}),click:u=>{F.select("velocities",[u])}}])},[F,S,k]);let G=c("span",{});switch(o){case"files":G=e?c(Kt,{folder:e,files:r,setFile:async(u,g,C)=>{if(C){let O=f({},r);switch(O[u]=v(f({},O[u]),{currentFilePath:g}),u){case"segment":const K=await dt(C);x(K),K.data&&n(le(K.data));break;case"block":const Q=await ut(C);y(Q),Q.data&&n(re(Q.data));break;case"velocity":const X=await ft(C);p(X),X.data&&n(de(X.data));break;case"command":const I=await Gn(e,C,r);h(I.commands),x(I.segments),I.segments.data&&n(le(I.segments.data)),y(I.blocks),I.blocks.data&&n(re(I.blocks.data)),p(I.velocities),I.velocities.data&&n(de(I.velocities.data)),O=I.openableFiles;break}l(O)}}}):c("span",{});break;case"velocities":G=c(fn,{settings:S,setSettings:J,selected:Se,velocitys:k,setVelocityData:(u,g)=>{g?n(rt({indices:u,data:g})):(n(lt(u)),F.select("velocity",[]))},addNewVelocity:()=>{W({label:"Click to place velocity estimate",mode:"mapClick",callback:u=>{W("normal");const g=k.length;n(it({data:{lat:u.lat,lon:u.lon}})),F.select("velocity",[g])}})}});break;case"block":G=c(qt,{settings:D,setSettings:ve,selected:ee,blocks:w,addNewBlock:()=>{W({label:"Click to place new block",mode:"mapClick",callback:u=>{const g=w.length;n(Ue({data:{name:"New Block",interior_lon:u.lon,interior_lat:u.lat}})),F.select("block",[g]),W("normal")}})},setBlockData:(u,g)=>{g?n(qe({indices:ee,data:g})):(n(Ke(u)),F.select("block",[]))}});break;case"segment":G=c(ln,{settings:B,setSettings:be,segments:(Me=m.segments)!=null?Me:[],selected:ke,setSelectionMode:u=>W(u),addNewSegment:(u,g)=>{const C=m.segments.length;n(Ye({start:u,end:g})),F.select("segment",[C])},setSegmentData:(u,g)=>{n(g?tt({indices:u,data:g}):et({index:u}))},splitSegment:u=>{n(ot(u)),F.select("segment",[])}});break;case"vertex":G=c(hn,{settings:$,setSettings:we,vertices:(Ie=m.vertecies)!=null?Ie:{},selected:De,setVertexData:(u,g)=>{g&&n(ce({index:u,vertex:g}))},setSelectionMode:u=>W(u),mergeVertices:(u,g)=>{n(st({a:u,b:g}))},bridgeVertices:(u,g)=>{n(Ze({a:u,b:g}))},extrudeVertex:(u,g)=>{n(nt({index:u,targetPoint:g}))}});break}const je={Block:{state:D.hide,change:()=>{ve(v(f({},D),{hide:!D.hide}))}},Vertex:{state:$.hide,change:()=>{we(v(f({},$),{hide:!$.hide}))}},Velocity:{state:S.hide,change:()=>{J(v(f({},S),{hide:!S.hide}))}},Segment:{state:B.hide,change:()=>{be(v(f({},B),{hide:!B.hide}))}},Grid:{state:!ne,change:()=>{Ct(!ne)}}};return b("div",{role:"document",className:"w-screen h-screen flex flex-col",onKeyDown:u=>{u.key==="Escape"&&W("normal")},children:[c(cn,{filesOpen:((Re=a!=null?a:d)!=null?Re:i)!==void 0,saveFiles:async()=>{a&&await a.save(),d&&(d.data=m,await d.save()),i&&(i.data=w,await i.save()),_&&(_.data=k,await _.save())},folder:e,openFolder:async()=>{const u=await Zn();t(u),s("files")}}),R!=="normal"?c("div",{className:"fixed top-12 z-10 left-10 right-10 flex flex-row justify-center",children:b("div",{className:"flex flex-col justify-center items-center bg-white p-3 gap-1 rounded",children:[c("span",{className:"text-lg font-semibold",children:R.label}),R.subtitle?c("span",{className:"text-md font-thin text-gray-500",children:R.subtitle}):c(M,{}),c("span",{className:"text-sm font-thin text-gray-500",children:"Press Escape to cancel"})]})}):c(M,{}),b("div",{className:"absolute bottom-0 left-2 flex flex-col bg-white rounded-t p-2 gap-5 shadow-sm z-50",children:[c("div",{className:"flex flex-row items-center justify-start gap-5",children:b("span",{className:"p-1 text-sm text-center",children:["Hold ",c("span",{className:"font-bold",children:"Shift"})," to box select"," ",c("span",{className:"font-bold",children:z})]})}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Coordinates:"," "]}),b("span",{children:[Math.floor(Le.lon*1e3)/1e3,","," ",Math.floor(Le.lat*1e3)/1e3]})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[c("span",{className:"p-1 text-sm font-bold text-center",children:"Editing: "}),Object.keys(pt).map(u=>{const g=pt[u];return c("button",{type:"button",className:`${z===g?"bg-gray-200":"bg-white"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{vt(g)},children:u},u)})]}),b("div",{className:"flex flex-row items-center justify-start gap-5",children:[b("span",{className:"p-1 text-sm font-bold text-center",children:["Displaying:"," "]}),Object.keys(je).map(u=>{const g=je[u];return c("button",{type:"button",className:`${g.state?"bg-white":"bg-gray-200"} p-2 shaddow-inner hover:bg-gray-100 rounded`,onClick:()=>{g.change()},children:u},u)})]})]}),c(on,{pointSources:bt,arrowSources:_t,lineSources:kt,drawnPointSource:Nt,selections:{segments:ke,blocks:ee,velocities:Se,vertices:De},displayGrid:ne?10:-1,click:u=>{typeof R!="string"&&R.mode==="mapClick"&&R.callback(u)},mouseMove:u=>{St(u)}}),c(Qt,{view:G,buttons:e?Yn:void 0,active:o,setActive:u=>s(u)})]})}const ts=Ot({reducer:{main:Bt(Et({segment:In,block:kn,velocity:Wn}))}});function ns(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:s,onRegisterError:r}=n;let l;const a=async(h=!0)=>{};return"serviceWorker"in navigator&&(l=new Pt("./sw.js",{scope:"./"}),l.addEventListener("activated",h=>{h.isUpdate?window.location.reload():o==null||o()}),l.register({immediate:e}).then(h=>{s==null||s(h)}).catch(h=>{r==null||r(h)})),a}ns();const ss=1,os=new At({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:ss}}});Tt.render(c(N.exports.StrictMode,{children:c(Ht,{client:os,children:c(Wt,{store:ts,children:c(es,{})})})}),document.querySelector("#root"));
