var we=Object.defineProperty,ve=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var q=(i,e,t)=>e in i?we(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,h=(i,e)=>{for(var t in e||(e={}))xe.call(e,t)&&q(i,t,e[t]);if(se)for(var t of se(e))be.call(e,t)&&q(i,t,e[t]);return i},S=(i,e)=>ve(i,ye(e));var b=(i,e,t)=>(q(i,typeof e!="symbol"?e+"":e,t),t);import{j as G,m as oe,r as m,a as Q,M as Ne,v as Se,Q as ke,R as Ce,b as Fe}from"./vendor.2c6bff34.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}};$e();const s=G.exports.jsx,v=G.exports.jsxs,E=G.exports.Fragment;function je({value:i,fieldDefinition:e,setField:t}){return v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[s("span",{"data-testid":`input-title-${e.name}`,className:"text-l font-bold",children:e.name}),e.description?s("span",{className:"text-sm",children:e.description}):s(E,{})]}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${e.name}`,className:"rounded w-full",type:typeof i=="number"?"number":"text",value:i,onChange:n=>{t(typeof i=="number"?Number.parseFloat(n.target.value):n.target.value)}})})]})}function re({title:i,item:e,setItem:t,fieldDefinitions:n}){const o=Object.keys(e).map((a,l)=>{const p=e[a],r=a in n&&n[a];return r?{element:s(je,{value:p,fieldDefinition:r,setField:w=>t({[a]:w})},a),order:r.order}:{element:v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{"data-testid":`input-title-${a}`,className:"text-l font-bold",children:a}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{"data-testid":`input-editor-${a}`,className:"rounded w-full",type:typeof p=="number"?"number":"text",value:p,onChange:w=>{t({[a]:typeof p=="number"?Number.parseFloat(w.target.value):w.target.value})}})})]},a),order:l+1e3}}).sort((a,l)=>a.order-l.order).map(a=>a.element);return v("div",{className:"flex flex-col gap-2 border-2 rounded p-2 max-h-96 overflow-y-auto",children:[s("span",{"data-testid":"editable-item-title",className:"text-xl font-bold",children:i}),o]})}const De={color:"#0000ff",selectedColor:"#ff0000",radius:6};var he;const Pe=JSON.parse((he=window.localStorage.getItem("blockDisplaySettings"))!=null?he:"false")||De;function Le({settings:i,setSettings:e,selected:t,blocks:n,setBlockData:o}){const a=r=>{e(r),window.localStorage.setItem("blockDisplaySettings",JSON.stringify(r))},l=n[t],p=l?s(re,{title:l.name,item:l,setItem:r=>o(t,r),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(E,{});return v(E,{children:[v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:i.color,onChange:r=>{a(S(h({},i),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Selected Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:i.selectedColor,onChange:r=>{a(S(h({},i),{selectedColor:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Radius"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"2",max:"10",step:"0.5",value:i.radius,onChange:r=>{a(S(h({},i),{radius:Number.parseFloat(r.target.value)}))}})})]})]}),p]})}function Oe({folder:i,files:e,setFile:t}){const n=Object.keys(e).map(o=>{const a=e[o];return v("div",{className:"flex flex-row justify-between items-center",children:[v("div",{className:"flex flex-col",children:[s("span",{className:"text-l font-bold","data-testid":`file-${o}-label`,children:a.name}),s("span",{className:"text-sm","data-testid":`file-${o}-description`,children:a.description})]}),s("span",{className:"w-2/5 flex-shrink-0",children:v("select",{"data-testid":`file-${o}-select`,className:"w-full rounded",value:a.currentFilePath,onChange:async l=>{const p=l.currentTarget.value;try{const r=await i.getFile(p);t(o,r.name,r)}catch{t(o,"")}},children:[s("option",{value:"","data-testid":`file-${o}-empty`,children:"\xA0"}),i.fileList.filter(l=>l.endsWith(a.extension)).map(l=>s("option",{value:l,"data-testid":`file-${o}-select-${l}`,children:l},l))]})})]},o)});return s("div",{className:"flex flex-col gap-2",children:n})}function Me({view:i,buttons:e,active:t,setActive:n}){if(!e)return s("span",{});const o=[];for(const a of Object.keys(e)){const l=e[a],p=a===t;o.push(s("button",{type:"button","data-testid":`tab-${a}`,className:`${p?"bg-gray-100":"bg-gray-300"} p-2 shadow-inner hover:bg-gray-200 rounded-t`,onClick:()=>n(p?"":a),children:l},a))}return v("div",{"data-testid":"inspector-container",className:"absolute bottom-0 right-2 h-1/2 w-1/3 flex flex-col-reverse z-50",children:[t?s("div",{"data-testid":"inspector-view",className:"flex flex-col bg-gray-100 flex-grow rounded-tr p-2",children:i}):"",s("div",{"data-testid":"inspector-tabs",className:"flex flex-row rounded-sm gap-0 divide-x divide-gray-200",children:o})]})}oe.accessToken="pk.eyJ1IjoiYnJlbmRhbmptZWFkZSIsImEiOiJja3g2ZzVueWMybTJtMzFwaHdzZmV5OGJvIn0.Oz8qQnu5b-jx8XFHlFnKDQ";const A=Math.PI/6,T=2*Math.PI-A;function We({pointSources:i,arrowSources:e,drawnLineSource:t,selections:n}){const o=m.exports.useRef(null),[a,l]=m.exports.useState(),[p,r]=m.exports.useState(!1),[w,x]=m.exports.useState(),[F]=m.exports.useState(new Q.exports.Popup({closeButton:!1,closeOnClick:!1})),[j,B]=m.exports.useState({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),[D,z]=m.exports.useState(),[O,R]=m.exports.useState(),[$,V]=m.exports.useState(),[I,J]=m.exports.useState({});return m.exports.useEffect(()=>{if(!a&&oe.accessToken&&o.current){const f=new Q.exports.Map({container:o.current,style:"mapbox://styles/mapbox-public/ckngin2db09as17p84ejhe24y",center:[0,0],zoom:2});f.addControl(new Q.exports.NavigationControl),l(f),f.on("load",()=>{r(!0)}),f.on("draw.selectionchange",({features:y})=>{if(!t.clickLine)return;let u=-1;for(const c of y)if(c.geometry.type==="LineString"&&c.properties&&"index"in c.properties&&typeof c.properties.index=="number"){u=c.properties.index,w==null||w.changeMode("direct_select",{featureId:c.id});break}t.clickLine(u)})}console.log("Updating map...")},[w,t,a]),m.exports.useEffect(()=>{if(a&&p&&$!==t){console.log("Drawning lines"),V(t);let f=w;(t.activeColor!==j.activeColor||t.activeWidth!==j.activeWidth||t.color!==j.color||t.width!==j.width)&&(B({color:t.color,width:t.activeWidth,activeWidth:t.activeWidth,activeColor:t.activeColor,active:t.active}),w&&a.removeControl(w),t.active?(f=new Ne({displayControlsDefault:!1,controls:{line_string:!0},defaultMode:"simple_select",styles:[{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":2*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth+2,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3*t.activeWidth,"circle-color":t.activeColor}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.activeColor,"line-dasharray":[.2,2],"line-width":t.activeWidth}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","selected"],1],t.activeColor,t.color],"line-width":t.width}}]}),a.addControl(f),x(f)):f=void 0),f&&f.set({type:"FeatureCollection",features:t.lines.flatMap(y=>[{type:"Feature",properties:{name:y.name,index:y.index,selected:n.drawnLine===y.index},id:y.index,geometry:{type:"LineString",coordinates:[[y.startLongitude,y.startLatitude],[y.endLongitude,y.endLatitude]]}}])})}},[a,p,$,t,j,w,n.drawnLine]),m.exports.useEffect(()=>{if(!a||!p)return;if(D!==i)if(console.log("Setting points in map!"),D){for(const u of D){const c=a.getSource(`point:${u.name}`);c!==void 0&&c.setData({type:"FeatureCollection",features:[]}),a.removeLayer(`layer:point:${u.name}`)}z(void 0)}else{for(const u of i){let c=a.getSource(`point:${u.name}`);const N=c===void 0;N&&(a.addSource(`point:${u.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),c=a.getSource(`point:${u.name}`)),c!==void 0&&c.setData({type:"FeatureCollection",features:u.points.map(g=>({type:"Feature",properties:{description:`<strong>${g.name}</strong><p>${g.description}</p>`,index:g.index,name:g.name,selected:g.index!==n[u.name]},geometry:{type:"Point",coordinates:[g.longitude,g.latitude]}}))}),a.addLayer({id:`layer:point:${u.name}`,type:"circle",source:`point:${u.name}`,paint:{"circle-color":["case",["get","selected"],u.selectedColor,u.color],"circle-radius":u.radius,"circle-stroke-width":1,"circle-stroke-color":"#ffffff"}}),N&&(a.on("mouseenter",`layer:point:${u.name}`,g=>{if(!g.features)return;const _=g.features[0];if(_.geometry.type==="Point"&&_.properties&&typeof _.properties.description=="string"){const C=[..._.geometry.coordinates],{description:P}=_.properties;for(;Math.abs(g.lngLat.lng-C[0])>180;)C[0]+=g.lngLat.lng>C[0]?360:-360;F.setLngLat(C).setHTML(P).addTo(a)}}),a.on("mouseleave",`layer:point:${u.name}`,()=>{F.remove()}),a.on("click",`layer:point:${u.name}`,g=>{if(!g.features||!u.clickPoint)return;const _=g.features[0];if(_.properties&&typeof _.properties.index=="number"&&typeof _.properties.name=="string"){const{index:C,name:P}=_.properties;u.clickPoint(C,P)}}))}z(i)}const f=h({},I);let y=!1;for(const u of Object.keys(n))if(n[u]!==I[u]){for(const c of i)if(c.name===u){y=!0,f[u]=n[u];const N=a.getSource(`point:${c.name}`);if(N){const g=n[u];N.setData({type:"FeatureCollection",features:c.points.map(_=>({type:"Feature",properties:{description:`<strong>${_.name}</strong><p>${_.description}</p>`,index:_.index,name:_.name,selected:_.index!==g},geometry:{type:"Point",coordinates:[_.longitude,_.latitude]}}))})}}}y&&J(f)},[a,D,i,p,F,n,I]),m.exports.useEffect(()=>{if(a&&p&&O!==e)if(console.log("Setting arrows in map!"),O){for(const f of O){const y=a.getSource(`arrow:${f.name}`);y!==void 0&&y.setData({type:"FeatureCollection",features:[]}),a.removeLayer(`layer:arrow:${f.name}`)}R(void 0)}else{for(const f of e){let y=a.getSource(`arrow:${f.name}`);const u=y===void 0;u&&(a.addSource(`arrow:${f.name}`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),y=a.getSource(`arrow:${f.name}`)),y!==void 0&&y.setData({type:"FeatureCollection",features:f.arrows.map((c,N)=>{const g=c.scale*f.scale,_=f.scale*f.arrowHeadScale,C=[c.longitude+c.direction[0]*g,c.latitude+c.direction[1]*g],P=[C[0]+(Math.cos(A)*-c.direction[0]-Math.sin(A)*-c.direction[1])*_,C[1]+(Math.sin(A)*-c.direction[0]+Math.cos(A)*-c.direction[1])*_],H=[C[0]+(Math.cos(T)*-c.direction[0]-Math.sin(T)*-c.direction[1])*_,C[1]+(Math.sin(T)*-c.direction[0]+Math.cos(T)*-c.direction[1])*_];return{type:"Feature",properties:{description:`<strong>${c.name}</strong><p>${c.description}</p>`,index:N,name:c.name},geometry:{type:"LineString",coordinates:[[c.longitude,c.latitude],C,P,C,H]}}})}),a.addLayer({id:`layer:arrow:${f.name}`,type:"line",source:`arrow:${f.name}`,layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":f.color,"line-width":f.width}}),u&&(a.on("mouseenter",`layer:arrow:${f.name}`,c=>{if(!c.features)return;const N=c.features[0];if(N.geometry.type==="Point"&&N.properties&&typeof N.properties.description=="string"){const g=[...N.geometry.coordinates],{description:_}=N.properties;for(;Math.abs(c.lngLat.lng-g[0])>180;)g[0]+=c.lngLat.lng>g[0]?360:-360;F.setLngLat(g).setHTML(_).addTo(a)}}),a.on("mouseleave",`layer:arrow:${f.name}`,()=>{F.remove()}),a.on("click",`layer:arrow:${f.name}`,c=>{if(!c.features||!f.clickArrow)return;const N=c.features[0];if(N.properties&&typeof N.properties.index=="number"&&typeof N.properties.name=="string"){const{index:g,name:_}=N.properties;f.clickArrow(g,_)}}))}R(e)}},[a,O,e,p,F]),s("div",{"data-testid":"map",className:"w-full h-full",ref:o})}const Ie={color:"#ffff00",width:1,activeColor:"#00ffff",activeWidth:2};var ge;const Ee=JSON.parse((ge=window.localStorage.getItem("segmentDisplaySettings"))!=null?ge:"false")||Ie;function Ae({settings:i,setSettings:e,segments:t,selected:n,setSegmentData:o}){const a=r=>{e(r),window.localStorage.setItem("segmentDisplaySettings",JSON.stringify(r))},l=t[n],p=l?s(re,{title:l.name,item:l,setItem:r=>o(n,r),fieldDefinitions:{name:{order:0,name:"Name",description:"The Block Name",type:"string"}}}):s(E,{});return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:i.color,onChange:r=>{a(S(h({},i),{color:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.width,onChange:r=>{a(S(h({},i),{width:Number.parseFloat(r.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:i.activeColor,onChange:r=>{a(S(h({},i),{activeColor:r.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Active Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.activeWidth,onChange:r=>{a(S(h({},i),{activeWidth:Number.parseFloat(r.target.value)}))}})})]}),p]})}function Be({folder:i,openFolder:e,filesOpen:t,saveFiles:n}){function o(){e()}return v("div",{"data-testid":"topbar",className:"p-2 bg-gradient-to-r from-blue-700 to-green-700 text-white flex flex-row justify-between",children:[s("h3",{className:"text-lg font-bold",children:"Celeri UI"}),v("span",{"data-testid":"open-folder-topbar",className:"flex flex-row gap-2 items-center",children:[i?v("span",{children:["Working in ",i.name]}):s("button",{type:"button",onClick:o,"data-testid":"open-folder-button",children:"Open Folder"}),t?s("button",{type:"button",onClick:n,"data-testid":"save-file-button",children:"Save Files"}):s(E,{})]})]})}const ze={color:"#ffff00",scale:.02,width:1,arrowHead:1};var _e;const Re=JSON.parse((_e=window.localStorage.getItem("velocityDisplaySettings"))!=null?_e:"false")||ze;function He({settings:i,setSettings:e}){const t=n=>{e(n),window.localStorage.setItem("velocityDisplaySettings",JSON.stringify(n))};return v("div",{className:"flex flex-col gap-2",children:[v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Color"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"color",value:i.color,onChange:n=>{t(S(h({},i),{color:n.target.value}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Scale"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.001",max:"0.1",step:"0.001",value:i.scale,onChange:n=>{t(S(h({},i),{scale:Number.parseFloat(n.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Width"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.1",max:"2",step:"0.1",value:i.width,onChange:n=>{t(S(h({},i),{width:Number.parseFloat(n.target.value)}))}})})]}),v("div",{className:"flex flex-row justify-between items-center",children:[s("span",{className:"text-l font-bold",children:"Arrow Head Size"}),s("span",{className:"w-2/5 flex-shrink-0",children:s("input",{className:"rounded w-full",type:"range",min:"0.5",max:"5",step:"0.1",value:i.arrowHead,onChange:n=>{t(S(h({},i),{arrowHead:Number.parseFloat(n.target.value)}))}})})]})]})}function Z(i){const e=i.split(/\n/g),t=e[0].split(","),n=e.slice(1),o=[];for(const a of n){const l=a.split(/\s*,\s*/),p={};for(let r=0;r<t.length;r+=1){let w=l[r];const x=t[r],F=Number.parseFloat(w);w=Number.isNaN(F)?w:F,typeof w=="string"&&w.startsWith('"')&&w.endsWith('"')&&(w=w.slice(1,-1)),p[x]=w}o.push(p)}return o}function U(i,e){const t=[e.join(",")];for(const n of i){const o=n;t.push(e.map(a=>a in o?typeof o[a]=="string"&&/\s/.test(`${o[a]}`)?`"${o[a]}"`:`${o[a]}`:"").join(","))}return t.join(`
`)}const le=["other1","other2","other3","other4","other5","other6","name","interior_lon","interior_lat","euler_lon","euler_lon_sig","euler_lat","euler_lat_sig","rotation_rate","rotation_rate_sig","rotation_flag","apriori_flag","strain_rate","strain_rate_sig","strain_rate_flag"],Te={other1:0,other2:0,other3:0,other4:0,other5:0,other6:0,name:"",interior_lon:0,interior_lat:0,euler_lon:0,euler_lon_sig:0,euler_lat:0,euler_lat_sig:0,rotation_rate:0,rotation_rate_sig:0,rotation_flag:0,apriori_flag:0,strain_rate:0,strain_rate_sig:0,strain_rate_flag:0};function Ve(i){return h(h({},Te),i)}class K{constructor(e){b(this,"handle");b(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=Z(e).map(o=>{const a={};for(const l of le)a[l]=o[l]||(l==="name"?"":0);return a});this.data=n}async save(){var t;const e=U((t=this.data)!=null?t:[],le);await this.handle.setContents(e)}clone(){return new K(this.handle)}}const Je={file_name:"basic_command_default_values.json",reuse_elastic:"no",reuse_elastic_file:"./celeri_elastic_operators.hdf5",save_elastic:"yes",save_elastic_file:"./celeri_elastic_operators.hdf5",material_lambda:3e10,material_mu:3e10,unit_sigmas:"no",locking_depth_flag2:0,locking_depth_flag3:0,locking_depth_flag4:0,locking_depth_flag5:0,locking_depth_override_flag:"no",locking_depth_overide_value:0,apriori_block_name:"",tri_smooth:1e4,pmag_tri_smooth:0,smooth_type:1,n_iterations:1,tri_edge:[0,0,0],tri_depth_tolerance:0,tri_con_weight:1,strain_method:0,sar_file_name:"",sar_ramp:0,sar_weight:0,tri_slip_constraint_type:0,inversion_type:"standard",inversion_param01:0,inversion_param02:0,inversion_param03:0,inversion_param04:0,inversion_param05:0,save_all:"yes",mogi_file_name:"",solution_method:"backslash",ridge_param:0,tri_full_coupling:"no",tvr_lambda:1,tri_slip_sign:[0,0],n_eigs:0,segment_file_name:"",station_file_name:"",block_file_name:"",mesh_parameters_file_name:"",fault_resolution:1,station_data_weight:1,station_data_weight_min:1,station_data_weight_max:1,station_data_weight_steps:1,slip_constraint_weight:1,slip_constraint_weight_min:1,slip_constraint_weight_max:1,slip_constraint_weight_steps:1,block_constraint_weight:1,block_constraint_weight_min:1,block_constraint_weight_max:1,block_constraint_weight_steps:1,slip_file_names:""};function qe(i){return h(h({},Je),i)}class X{constructor(e){b(this,"handle");b(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),t=JSON.parse(e);this.data=qe(t)}async save(){if(this.data){const e=JSON.stringify(this.data);await this.handle.setContents(e)}}clone(){return new X(this.handle)}}const ce=["name","lon1","lat1","lon2","lat2","dip","res","other3","other6","other7","other8","other9","other10","other11","other12","locking_depth","locking_depth_sig","locking_depth_flag","dip_sig","dip_flag","ss_rate","ss_rate_sig","ss_rate_flag","ds_rate","ds_rate_sig","ds_rate_flag","ts_rate","ts_rate_sig","ts_rate_flag","burial_depth","burial_depth_sig","burial_depth_flag","resolution_override","resolution_other","patch_file_name","patch_flag","patch_slip_file","patch_slip_flag"],Ge={name:"",lon1:0,lat1:0,lon2:0,lat2:0,dip:0,res:0,other3:0,other6:0,other7:0,other8:0,other9:0,other10:0,other11:0,other12:0,locking_depth:0,locking_depth_sig:0,locking_depth_flag:0,dip_sig:0,dip_flag:0,ss_rate:0,ss_rate_sig:0,ss_rate_flag:0,ds_rate:0,ds_rate_sig:0,ds_rate_flag:0,ts_rate:0,ts_rate_sig:0,ts_rate_flag:0,burial_depth:0,burial_depth_sig:0,burial_depth_flag:0,resolution_override:0,resolution_other:0,patch_file_name:0,patch_flag:0,patch_slip_file:0,patch_slip_flag:0};function Qe(i){return h(h({},Ge),i)}class Y{constructor(e){b(this,"handle");b(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=Z(e).map(o=>{const a={};for(const l of ce)a[l]=o[l]||(l==="name"?"":0);return a});this.data=n}async save(){var t;const e=U((t=this.data)!=null?t:[],ce);await this.handle.setContents(e)}clone(){return new Y(this.handle)}}const de=["lon","lat","corr","other1","name","east_vel","north_vel","east_sig","north_sig","flag","up_vel","up_sig","east_adjust","north_adjust","up_adjust"];class ee{constructor(e){b(this,"handle");b(this,"data");this.handle=e,this.data=void 0}async initialize(){const e=await this.handle.getContents(),n=Z(e).map(o=>{const a={};for(const l of de)a[l]=o[l]||(l==="name"?"":0);return a});this.data=n}async save(){var t;const e=U((t=this.data)!=null?t:[],de);await this.handle.setContents(e)}clone(){return new ee(this.handle)}}async function pe(i){const e=new Y(i);return await e.initialize(),e}async function fe(i){const e=new K(i);return await e.initialize(),e}async function ue(i){const e=new ee(i);return await e.initialize(),e}async function Ze(i,e,t){const n=new X(e);if(await n.initialize(),n.data){const o=await pe(await i.getFile(n.data.segment_file_name)),a=await fe(await i.getFile(n.data.block_file_name)),l=await ue(await i.getFile(n.data.station_file_name)),p=h({},t);return"command"in p&&(p.command=S(h({},p.command),{currentFilePath:e.name})),"segment"in p&&(p.segment=S(h({},p.segment),{currentFilePath:n.data.segment_file_name})),"block"in p&&(p.block=S(h({},p.block),{currentFilePath:n.data.block_file_name})),"velocities"in p&&(p.velocities=S(h({},p.velocities),{currentFilePath:n.data.station_file_name})),{openableFiles:p,commands:n,segments:o,blocks:a,velocities:l}}throw new Error("Can't open command file")}class Ue{constructor(e){b(this,"name");b(this,"handle");this.handle=e,this.name=e.name}async getContents(){return(await this.handle.getFile()).text()}async setContents(e){const t=await this.handle.createWritable();await t.write(e),await t.close()}}class te{constructor(e){b(this,"name");b(this,"handle");b(this,"fileList");b(this,"folderList");this.handle=e,this.fileList=[],this.folderList=[],this.name=e.name}async initialize(){for await(const e of this.handle.values())e.kind==="directory"?this.folderList.push(e.name):this.fileList.push(e.name)}async getFile(e){if(!this.fileList.includes(e))throw new Error("Missing File");const t=await this.handle.getFileHandle(e);return new Ue(t)}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("Missing Directory");const t=await this.handle.getDirectoryHandle(e),n=new te(t);return await n.initialize(),n}}const Ke=async()=>{const i=await window.showDirectoryPicker(),e=new te(i);return await e.initialize(),e};class Xe{constructor(e,t){b(this,"name");b(this,"parent");this.name=e,this.parent=t}async getContents(){const e=this.parent[this.name];if(typeof e!="string")throw new Error("No Such File");return e}async setContents(e){this.parent[this.name]=e}}class ae{constructor(e,t){b(this,"name");b(this,"parent");b(this,"fileList");b(this,"folderList");this.name=e,this.parent=t,this.fileList=[],this.folderList=[];const n=t[e];for(const o of Object.keys(n))typeof n[o]=="string"?this.fileList.push(o):this.folderList.push(o)}async getFile(e){if(!this.fileList.includes(e))throw new Error("No Such File");return new Xe(e,this.parent[this.name])}async getDirectory(e){if(!this.folderList.includes(e))throw new Error("No Such File");return new ae(e,this.parent[this.name])}}const Ye=async i=>new ae("root",i);let me=async()=>{var e;return Ye((e=window.FakeDirectory)!=null?e:{})};function et(i){me=i}async function tt(){return me()}window.location.search.includes("fake-dir")||et(Ke);const at={files:"Files",segment:"Segment",block:"Block",velocities:"Velocities"};function it(){var H,ie,ne;const[i,e]=m.exports.useState(),[t,n]=m.exports.useState(""),[o,a]=m.exports.useState({command:{name:"Command File",description:"A file pointing to all the other relevant files",extension:".json",currentFilePath:""},segment:{name:"Segment File",description:"A CSV containing the details of fault locations",extension:".csv",currentFilePath:""},block:{name:"Block File",description:"A CSV containing information on blocks/plates",extension:".csv",currentFilePath:""},velocities:{name:"Velocity Estimations",description:"A CSV containing velocity estimations for various points on the globe",extension:".csv",currentFilePath:""}}),[l,p]=m.exports.useState(),[r,w]=m.exports.useState(),[x,F]=m.exports.useState(),[j,B]=m.exports.useState(),[D,z]=m.exports.useState(Re),[O,R]=m.exports.useState(Pe),[$,V]=m.exports.useState(Ee),[I,J]=m.exports.useState(-1),[f,y]=m.exports.useState(-1),[u,c]=m.exports.useState([]),[N,g]=m.exports.useState([]),[_,C]=m.exports.useState({color:$.color,activeColor:$.activeColor,activeWidth:$.activeWidth,width:$.width,active:r!==void 0,lines:[],clickLine:d=>{y(d),n("segment")}});m.exports.useEffect(()=>{c([{name:"blocks",color:O.color,selectedColor:O.selectedColor,radius:O.radius,points:(x==null?void 0:x.data)?x.data.map((d,k)=>({longitude:d.interior_lon,latitude:d.interior_lat,name:d.name,description:"",index:k})):[],clickPoint:(d,k)=>{J(d),n("block")}}])},[O,x]),m.exports.useEffect(()=>{g([{name:"velocity",color:D.color,scale:D.scale,arrowHeadScale:D.arrowHead,width:D.width,arrows:(j==null?void 0:j.data)?j.data.map(d=>{const k=Math.sqrt(d.east_vel*d.east_vel+d.north_vel*d.north_vel);return{longitude:d.lon,latitude:d.lat,direction:[d.east_vel/k,d.north_vel/k],scale:k,name:d.name,description:`north: ${d.north_vel}, east: ${d.east_vel}`}}):[]}])},[D,j]),m.exports.useEffect(()=>{C({color:$.color,activeColor:$.activeColor,activeWidth:$.activeWidth,width:$.width,active:r!==void 0,lines:(r==null?void 0:r.data)?r.data.map((d,k)=>({startLongitude:d.lon1,endLongitude:d.lon2,startLatitude:d.lat1,endLatitude:d.lat2,name:d.name,index:k,description:""})):[],clickLine:d=>{y(d),n("segment")}})},[$,r]);let P=s("span",{});switch(t){case"files":P=i?s(Oe,{folder:i,files:o,setFile:async(d,k,W)=>{if(W){let M=h({},o);switch(M[d]=S(h({},M[d]),{currentFilePath:k}),d){case"segment":w(await pe(W));break;case"block":F(await fe(W));break;case"velocity":B(await ue(W));break;case"command":const L=await Ze(i,W,o);p(L.commands),w(L.segments),F(L.blocks),B(L.velocities),M=L.openableFiles;break}a(M)}}}):s("span",{});break;case"velocities":P=s(He,{settings:D,setSettings:z});break;case"block":P=s(Le,{settings:O,setSettings:R,selected:I,blocks:(H=x==null?void 0:x.data)!=null?H:[],setBlockData:(d,k)=>{if(x!==void 0){const W=x.data&&x.data[d]?h(h({},x.data[d]),k):Ve(k),M=x.data?[...x.data]:[];M[d]=W;const L=x.clone();L.data=M,F(L)}}});break;case"segment":P=s(Ae,{settings:$,setSettings:V,segments:(ie=r==null?void 0:r.data)!=null?ie:[],selected:f,setSegmentData:(d,k)=>{if(r!==void 0){const W=r.data&&r.data[d]?h(h({},r.data[d]),k):Qe(k),M=r.data?[...r.data]:[];M[d]=W;const L=r.clone();L.data=M,w(L)}}});break}return v("div",{className:"w-screen h-screen flex flex-col",children:[s(Be,{filesOpen:((ne=l!=null?l:r)!=null?ne:x)!==void 0,saveFiles:async()=>{l&&await l.save(),r&&await r.save(),x&&await x.save()},folder:i,openFolder:async()=>{const d=await tt();e(d),n("files")}}),s(We,{pointSources:u,arrowSources:N,drawnLineSource:_,selections:{drawnLine:f,blocks:I}}),s(Me,{view:P,buttons:i?at:void 0,active:t,setActive:d=>n(d)})]})}function nt(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:o,onRegisterError:a}=i;let l;const p=async(r=!0)=>{};return"serviceWorker"in navigator&&(l=new Se("./sw.js",{scope:"./"}),l.addEventListener("activated",r=>{r.isUpdate?window.location.reload():n==null||n()}),l.register({immediate:e}).then(r=>{o==null||o(r)}).catch(r=>{a==null||a(r)})),p}nt();const st=1,ot=new ke({defaultOptions:{queries:{staleTime:Number.POSITIVE_INFINITY,retry:st}}});Ce.render(s(m.exports.StrictMode,{children:s(Fe,{client:ot,children:s(it,{})})}),document.querySelector("#root"));
